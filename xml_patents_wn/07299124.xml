<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07299124-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07299124</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>11504628</doc-number>
<date>20060816</date>
</document-id>
</application-reference>
<us-application-series-code>11</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>JP</country>
<doc-number>2005-236567</doc-number>
<date>20050817</date>
</priority-claim>
</priority-claims>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>19</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>701115</main-classification>
<further-classification>701 25</further-classification>
<further-classification>701102</further-classification>
</classification-national>
<invention-title id="d0e61">Control unit</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>JP</country>
<doc-number>7-040794</doc-number>
<kind>A</kind>
<date>19950200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>JP</country>
<doc-number>2004-192541</doc-number>
<kind>A</kind>
<date>20040700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00003">
<othercit>OSEK OS, OSEK/VDX Operating System, Version 2.2.1, Jan. 16, 2003, pp. 1-86.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>7</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>701 25</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>701102</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>701115</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>16</number-of-drawing-sheets>
<number-of-figures>27</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20070043499</doc-number>
<kind>A1</kind>
<date>20070222</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Nagaura</last-name>
<first-name>Wataru</first-name>
<address>
<city>Hitachinaka</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Miyake</last-name>
<first-name>Junji</first-name>
<address>
<city>Hitachinaka</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="003" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Komatsu</last-name>
<first-name>Hiroaki</first-name>
<address>
<city>Mito</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="004" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Irie</last-name>
<first-name>Toru</first-name>
<address>
<city>Farmington Hills</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Crowell &amp; Moring LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Hitachi, Ltd.</orgname>
<role>03</role>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Cronin</last-name>
<first-name>Stephen K.</first-name>
<department>3747</department>
</primary-examiner>
<assistant-examiner>
<last-name>Hoang</last-name>
<first-name>Johnny H</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">Upon initiation of a initiation processing by a task management, reference is made to a initiation table for processing of initiation, and processing of measurement is performed by an input measurement processing in response to the preset timing. Then the input value is stored in a input value storage buffer. When an application program is acquired, an input value acquisition processing is initiated, the input value is from the buffer, and is transferred to the application program. When the application program is set, an output value updating is initiated, the output value having been transferred from the application program is updated, and the result is stored in an output value storage buffer. Further, output processing means is initiated in response to the timing preset on the initiation table and an output value is outputted from the output value storage buffer.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="212.77mm" wi="164.08mm" file="US07299124-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="233.51mm" wi="164.59mm" file="US07299124-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="225.13mm" wi="159.00mm" file="US07299124-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="257.05mm" wi="158.07mm" file="US07299124-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="254.00mm" wi="161.54mm" file="US07299124-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="242.49mm" wi="165.44mm" file="US07299124-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="242.32mm" wi="165.78mm" file="US07299124-20071120-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="245.70mm" wi="164.25mm" file="US07299124-20071120-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="254.68mm" wi="163.66mm" file="US07299124-20071120-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="235.12mm" wi="158.58mm" file="US07299124-20071120-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="241.13mm" wi="161.54mm" file="US07299124-20071120-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="236.22mm" wi="172.30mm" file="US07299124-20071120-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="233.34mm" wi="183.56mm" file="US07299124-20071120-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="256.96mm" wi="167.89mm" file="US07299124-20071120-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="147.15mm" wi="150.79mm" file="US07299124-20071120-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00015" num="00015">
<img id="EMI-D00015" he="138.68mm" wi="153.75mm" file="US07299124-20071120-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00016" num="00016">
<img id="EMI-D00016" he="174.92mm" wi="157.90mm" file="US07299124-20071120-D00016.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">CLAIM OF PRIORITY</heading>
<p id="p-0002" num="0001">The present application claims priority from Japanese application serial no. 2005-236567, filed on Aug. 17, 2005, the content of which is hereby incorporated by reference into this application.</p>
<heading id="h-0002" level="1">FIELD OF THE INVENTION</heading>
<p id="p-0003" num="0002">The present invention relates to a control unit for controlling an actuator based on external states through a sensor or network, particularly to a control unit for initiating processing synchronous with an event.</p>
<heading id="h-0003" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0004" num="0003">A vehicle engine control unit controls the amount of fuel and injection timing, based on the input such as a crank angle sensor signal. Engine control belongs to an area where high-level real-time processing is required. In recent years, standardization of vehicle control software is processing mainly in Europe. One example is found in the OSEK-OS disclosed in OSEK/VDX Version, OSEK/VDX Operating System, which is the code for a real time operating system.</p>
<p id="p-0005" num="0004">In the description of Japanese Patent Laid-open No. 2004-192541 and Japanese Patent Laid-open No. Hei 7 (1995)-40794, the software incorporated in the control unit is classified into an application program and an interface program. The interface program transfers the information of the input/output signal connected to a control unit over to the application program, and does not require a change of the application program in response to hardware modification.</p>
<heading id="h-0004" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0006" num="0005">In the aforementioned interface program, the input value to be transferred to the application is not restricted to the input signal value connected to the control unit when the input interface has been called. Namely, when the input value acquired through the input interface is a value measured and stored at a predetermined time of an event. In the output, it does not necessarily follow that the output signal connected to the control unit is outputted when the output interface has been called. To be more specific, the output value set through the output interface is the value outputted from the control unit at a predetermined event.</p>
<p id="p-0007" num="0006">The timing for measuring the input signal in the interface program and the timing for outputting the output signal are incorporated at the time of developing the interface program. Accordingly, when the aforementioned timing is to be changed, the interface program per se must be modified.</p>
<p id="p-0008" num="0007">The object of the present invention is to solve the aforementioned prior art problems and to provide a control unit that can be easily changed the timing, without having to modify the interface program.</p>
<p id="p-0009" num="0008">The following describes the structure of the control unit of the present invention achieving the aforementioned object:</p>
<p id="p-0010" num="0009">The control unit of the present invention comprises:</p>
<p id="p-0011" num="0010">storage means for storing an input value from the outside or an output value to the outside separately for each input/output signal;</p>
<p id="p-0012" num="0011">input means for measuring the input signal from the outside and updating the input value stored in the storage means;</p>
<p id="p-0013" num="0012">output means for outputting an output signal to the outside in according with the value stored in the storage means;</p>
<p id="p-0014" num="0013">input value acquisition means for transferring the input value stored in the storage means to an application program;</p>
<p id="p-0015" num="0014">output value updating means for storing the output value transferred from the application program into said storage means;</p>
<p id="p-0016" num="0015">initiation means for initiating said input means and output means; and</p>
<p id="p-0017" num="0016">initiation timing storage means for storing the initiation timing, wherein said input means and output means are initiated by said initiation means in response to the timing stored on said initiation timing storage means.</p>
<p id="p-0018" num="0017">Alternatively, the control unit of the present invention is characterized in that the input means and output means are initiated in response to the timing set on the aforementioned application program, without having the aforementioned initiation means.</p>
<p id="p-0019" num="0018">The present invention provides an advantage of easy modification of the timing of measuring the input signal connected to the control unit or the output signal output timing.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0005" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 1</figref> shows the function block diagram representing a control unit as the first embodiment of the present invention;</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 2</figref> is a flow chart representing the flow of 10-msec processing;</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 3</figref> is a schematic diagram representing the initiation table;</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 4</figref> is a flow chart representing the initiation processing;</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 5</figref> is a flow chart representing the digital input in input processing;</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 6</figref> is a flow chart representing the analog input in input processing;</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 7</figref> is a flow chart representing the communication input in input processing;</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 8</figref> is a flow chart representing the frequency input in input processing;</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 9</figref> is a flow chart representing the digital output in output processing;</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. 10</figref> is a flow chart representing the analog output in output processing;</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 11</figref> is a flow chart representing the communication output in output processing;</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 12</figref> is a flow chart representing the frequency output in output processing;</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. 13</figref> is a schematic diagram showing the input value storage buffer;</p>
<p id="p-0033" num="0032"><figref idref="DRAWINGS">FIG. 14</figref> is a schematic diagram showing the output value storage buffer;</p>
<p id="p-0034" num="0033"><figref idref="DRAWINGS">FIG. 15</figref> is a flow chart representing the digital input in input value acquisition processing;</p>
<p id="p-0035" num="0034"><figref idref="DRAWINGS">FIG. 16</figref> is a flow chart representing the analog input in input value acquisition processing;</p>
<p id="p-0036" num="0035"><figref idref="DRAWINGS">FIG. 17</figref> is a flow chart representing the communication input in input value acquisition processing;</p>
<p id="p-0037" num="0036"><figref idref="DRAWINGS">FIG. 18</figref> is a flow chart representing the frequency input in input value acquisition processing;</p>
<p id="p-0038" num="0037"><figref idref="DRAWINGS">FIG. 19</figref> is a flow chart representing the digital output in the output value updating processing;</p>
<p id="p-0039" num="0038"><figref idref="DRAWINGS">FIG. 20</figref> is a flow chart representing the analog output in the output value updating processing;</p>
<p id="p-0040" num="0039"><figref idref="DRAWINGS">FIG. 21</figref> is a flow chart representing the communication output in the output value updating processing;</p>
<p id="p-0041" num="0040"><figref idref="DRAWINGS">FIG. 22</figref> is a flow chart representing the frequency output in the output value updating processing;</p>
<p id="p-0042" num="0041"><figref idref="DRAWINGS">FIG. 23</figref> is a flow chart representing the 10-msec task processing;</p>
<p id="p-0043" num="0042"><figref idref="DRAWINGS">FIG. 24</figref> is a flow chart representing the 10-msec application processing;</p>
<p id="p-0044" num="0043"><figref idref="DRAWINGS">FIG. 25</figref> is a timing chart representing the operation of input processing;</p>
<p id="p-0045" num="0044"><figref idref="DRAWINGS">FIG. 26</figref> is a timing chart representing the operation of output processing; and</p>
<p id="p-0046" num="0045"><figref idref="DRAWINGS">FIG. 27</figref> is a flow chart representing the processing wherein the processing of timing is called by the application program.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0006" level="1">DESCRIPTION OF THE PREFERRED EMBODIMENTS</heading>
<p id="p-0047" num="0046">The control unit of the present invention has implemented interrupt-synchronous task initiation of reduced OS overhead by improving the software, without having to modify the hardware configuration or OS. The following describes a plurality of examples of the present invention with reference to drawings:</p>
<heading id="h-0007" level="1">Embodiment 1</heading>
<p id="p-0048" num="0047"><figref idref="DRAWINGS">FIG. 1</figref> shows the function block diagram representing a control unit as the first embodiment of the input/output control unit of the present invention. A control unit <b>1</b> is connected with a sensor <b>2</b> and an actuator <b>3</b>, and is also connected with another control unit <b>5</b> via the network <b>4</b>. More than one sensor <b>2</b>, actuator <b>3</b> and the control unit <b>5</b> can be connected to the control unit <b>1</b>.</p>
<p id="p-0049" num="0048">The control unit <b>1</b> is composed of a memory <b>11</b>, CPU <b>12</b> and I/O module <b>13</b>. The I/O module <b>13</b> is connected with the sensor <b>2</b>, actuator <b>3</b> and network <b>4</b>, and is used to capture an input value or to output data. The CPU <b>12</b> executes the program stored in the memory <b>11</b>.</p>
<p id="p-0050" num="0049">The memory <b>11</b> contains a task management <b>120</b> for managing the task initiation, an application program <b>111</b>, input value acquisition processing <b>112</b> for transferring the input value to the application program, and output value updating <b>113</b>. The memory <b>11</b> also contains an input value storage buffer <b>114</b> for storing the input value to be transferred to the application program, an output value storage buffer <b>115</b> for storing the output value transferred from the application program, an input measurement processing <b>116</b> for measuring the input value to be transferred to the application program, and an output processing <b>117</b> for outputting the output value. The memory <b>11</b> also contains an initiation table <b>118</b> that stores what processing is initiated in a predetermined event by an initiation processing <b>119</b> for initializing the input value measurement and output processing. The initiation table <b>118</b> can be set and modified by the initiation table setting means <b>6</b>. In the setting or modification of the initiation table <b>118</b> by the initiation table setting means <b>6</b>, the source file corresponding to the initiation table <b>118</b> prior to storage into the memory <b>11</b> is modified and the modified initiation table <b>118</b> is stored at the time of storage into stored in the memory <b>11</b>.</p>
<p id="p-0051" num="0050"><figref idref="DRAWINGS">FIG. 2</figref> is an explanatory diagram representing the flow of the processing of a program in the control unit. It explains the flow of the processing of the program stored in the control unit <b>1</b> with reference to an example of the 10-msec task as one of the tasks <b>121</b> to be initiated by the task management <b>120</b>.</p>
<p id="p-0052" num="0051">In part of the I/O module <b>13</b>, the task management <b>120</b> is initiated by a timer (not illustrated). The task management <b>120</b> refers to the 10-msec timing in this case, and initiates the 10-msec task <b>121</b>. The 10-msec task includes 10-msec event pre-processing <b>1211</b>, 10-msec application <b>112</b>, and 10-msec event post-processing <b>1213</b>, as shown in <figref idref="DRAWINGS">FIG. 23</figref>.</p>
<p id="p-0053" num="0052">The 10-msec application <b>112</b> initiates the 10-msec event pre-processing <b>1211</b>. The 10-msec event pre-processing <b>1211</b> initiates the initiation processing <b>119</b>. The initiation processing <b>119</b> will be described later.</p>
<p id="p-0054" num="0053">The initiation processing <b>119</b> initiates the input measurement processing <b>116</b> registered in the 10-msec before timing of the initiation table <b>118</b>. The update_in1 is executed in the processing <b>11651</b> of the input value measurement <b>116</b>, and update_in2 is executed in the processing <b>11652</b>.</p>
<p id="p-0055" num="0054">Then the 10-msec application <b>112</b> is initiated. Input value acquisition processing <b>1212</b> is initiated in the 10-msec application to acquire in1 and in2. The get_in1 is executed in processing <b>121251</b>, and get_in2 is executed in processing <b>122152</b>.</p>
<p id="p-0056" num="0055">After executing a predetermined processing, the application initiates the output value updating <b>113</b>, and set_out1 is executed in processing <b>11351</b>.</p>
<p id="p-0057" num="0056">Upon termination of the 10-msec application, the 10-msec event post-processing <b>1213</b> is initiated. The output processing <b>117</b> registered in the 10-msec after timing of the initiation table <b>118</b> is executed in the 10-msec event post-processing. The update_out1 is executed in processing <b>11751</b>. Upon termination of the 10-msec event post-processing, the system goes back to the 10-msec task, and the 10-msec task terminates.</p>
<p id="p-0058" num="0057">The following describes the configuration and function of the components stored in the memory <b>11</b> of <figref idref="DRAWINGS">FIG. 1</figref>.</p>
<p id="p-0059" num="0058"><figref idref="DRAWINGS">FIG. 3</figref> shows the configuration of the initiation table <b>118</b>. In this example, four items in the first half of the event are concerned with synchronization in time, while the two in the latter half are related to synchronization in engine rotation. Input signals are made up of input signal <b>1</b>, input signal <b>2</b>, input signal <b>3</b> and input signal <b>4</b>, while output signals are made up of output signal <b>1</b>, output signal <b>2</b>, output signal <b>3</b> and output signal <b>4</b>. The input signal <b>1</b> is measured at the timing of 10-msec pre-processing initiation. The input signal <b>2</b> is measured at the timing of 10-msec pre-processing. The input signal <b>3</b> is measured at the timing of 20-msec pre-processing. The input signal <b>4</b> is measured at the timing of engine REF timing pre-processing. The output signal <b>1</b> is outputted at the timing of 10-msec post-processing. The output signal <b>2</b> is outputted at the timing of 20-msec post-processing. The output signal <b>3</b> is outputted at the timing of 20-msec post-processing. The output signal <b>4</b> is outputted at the timing of engine REF timing post-processing.</p>
<p id="p-0060" num="0059">In the present Embodiment, the initiation timing of each event, and the head address for measurement corresponding to the name of the signal to be inputted and measured, or the head address for output processing corresponding to the signal name to be outputted are stored in the initiation table <b>118</b> in advance. The input measurement processing <b>116</b> for measuring the input signal in response to the pre-processing and post-processing at each timing, and the output processing <b>117</b> for outputting the output signal are executed for each signal.</p>
<p id="p-0061" num="0060"><figref idref="DRAWINGS">FIG. 4</figref> is a flow chart representing the initiation processing <b>119</b>, which will be explained with reference to 10-msec pre-processing as an example. The initiation processing <b>119</b> is initiated by 10-msec event pre-processing and 10-msec event post-processing in the example of <figref idref="DRAWINGS">FIG. 2</figref></p>
<p id="p-0062" num="0061">In processing <b>1191</b>, timing at this moment is acquired. Processing <b>1192</b> executes signal processing. In the first plate, the input measurement processing update_in1 of the input signal in<b>1</b> registered in the initiation table <b>118</b> is implemented. In decision processing <b>1193</b>, a decision is made to see whether or not there is next signal processing. Since the input processing in<b>2</b> is registered, the system goes back to processing <b>1192</b> to execute the input measurement processing update_in<b>2</b> of the input signal in<b>2</b>. In decision processing <b>1193</b>, processing terminates since the next signal processing is not registered.</p>
<p id="p-0063" num="0062">The initiation processing <b>119</b> is applies to the input measurement and output processing of other signals in the same manner. To be more specific, the input processing update_in<b>3</b> of the input signal in<b>3</b> is initiated in the 20-msec pre-processing, and update_out<b>2</b> as the output processing of the output signal out<b>2</b> and update_out<b>3</b> as the output processing of the output signal out<b>3</b> are initiated in the 20-msec post-processing. The input measuring update_in<b>4</b> of the input signal in<b>4</b> is initiated in the pre-process of engine REF, and the output measuring update_out<b>4</b> of the output signal out<b>4</b> is initiated in the post-process of engine REF.</p>
<p id="p-0064" num="0063"><figref idref="DRAWINGS">FIG. 5</figref> is a flow chart representing the input processing <b>1161</b>. Processing <b>11611</b> measures the input value in<b>1</b>. For example, if the input signal is a digital input signal, the value measured is inputted into the input value storage buffer <b>114</b> for updating the stored value.</p>
<p id="p-0065" num="0064"><figref idref="DRAWINGS">FIG. 6</figref> shows the processing of input measurement for analog input. Processing <b>11621</b> measures the input value in<b>2</b> , and starts analog-to-digital conversion. Processing <b>11622</b> updates the input value storage buffer <b>114</b>, subsequent to analog-to-digital conversion.</p>
<p id="p-0066" num="0065"><figref idref="DRAWINGS">FIG. 7</figref> shows the processing of input measurement by another control unit. It represents processing of the data received via the network from another control unit through communication. Processing <b>11631</b> executes bit-based conversion of the received data (input value in<b>3</b>) to update the input value storage buffer <b>114</b>. For example, when the data in<b>3</b> multiplied by 2 to the power of 3 is used by the application, the value in<b>3</b> is shifted left three bit positions, and the result is stored in the input value storage buffer <b>114</b>.</p>
<p id="p-0067" num="0066"><figref idref="DRAWINGS">FIG. 8</figref> shows the processing of input measurement for frequency input. Processing <b>11641</b> measures the frequency (input value in<b>4</b>), and inputs the result of unit-based conversion of the frequency value into the input value storage buffer <b>114</b> for updating.</p>
<p id="p-0068" num="0067"><figref idref="DRAWINGS">FIG. 9</figref> is a flow chart representing the processing of output <b>11711</b>. Processing <b>11711</b> acquires the value (out<b>1</b>_buff) of the output value storage buffer <b>115</b> and outputs the result of port output conversion to the output signal. For example, if the output signal is a digital output signal, the port value of out<b>1</b> is outputted in response to the ON/OFF value stored in the output value storage buffer. For example, if the value corresponding to the ON operation is 0, and that corresponding to the OFF is 1, 0 will be outputted if the ON is specified, and 1 will be outputted if the OFF is specified.</p>
<p id="p-0069" num="0068"><figref idref="DRAWINGS">FIG. 10</figref> shows the case of an analog signal. In processing <b>11721</b>, the analog value (duty of out<b>2</b>) is outputted in response to the result of converting the register set value of the value (out<b>2</b>_buff) of the output value storage buffer <b>115</b>.</p>
<p id="p-0070" num="0069"><figref idref="DRAWINGS">FIG. 11</figref> shows the processing of transmitting the output value to the network. Processing <b>11731</b> updates the transmission data (out<b>3</b>_buff value) to a value corresponding to the out<b>3</b> bit. For example, if two-bit data from the least significant position of the transmission buffer out<b>3</b>_buff is the data corresponding to the out<b>3</b>, only the two-bit data is updated to the value of out<b>3</b>.</p>
<p id="p-0071" num="0070"><figref idref="DRAWINGS">FIG. 12</figref> shows the frequency output. Processing <b>11741</b> outputs the frequency of the out<b>4</b> in response to the value (out<b>4</b>_buff) of the output value storage buffer <b>115</b>. For example, if the frequency is set at 1 kHz, a 1 kHz-bit pulse is outputted.</p>
<p id="p-0072" num="0071"><figref idref="DRAWINGS">FIG. 13</figref> represents the configuration of the input value storage buffer <b>114</b>. The measured value of the in<b>1</b> is stored in the in<b>1</b>_buff storage buffer <b>1141</b>. The measured value of the in<b>2</b> is stored in the in<b>2</b>_buff storage buffer <b>1142</b>. The measured value of the in<b>3</b> is stored in the in<b>3</b>_buff storage buffer <b>1143</b>. The measured value of the in<b>4</b> is stored in the in<b>4</b>_buff storage buffer <b>1144</b>.</p>
<p id="p-0073" num="0072"><figref idref="DRAWINGS">FIG. 14</figref> represents the configuration of the output value storage buffer <b>115</b>. The out<b>1</b> is stored in the out<b>1</b>_buff storage buffer <b>1151</b>. The out<b>2</b> is stored in the out<b>2</b>_buff storage buffer <b>1152</b>. The out<b>3</b> is stored in the out<b>3</b>_buff storage buffer <b>1153</b>. The out<b>4</b> is stored in the out<b>4</b>_buff storage buffer <b>1154</b>.</p>
<p id="p-0074" num="0073"><figref idref="DRAWINGS">FIGS. 15 through 18</figref> are flow charts representing the input value acquisition processing <b>112</b>. Processing <b>1121</b> of <figref idref="DRAWINGS">FIG. 15</figref> returns the information in<b>1</b>_buff stored in the input value storage buffer <b>114</b>. The information to be transferred is the result of unit-based conversion performed in conformity to the specifications described in the interface.</p>
<p id="p-0075" num="0074">Processing <b>1122</b> of <figref idref="DRAWINGS">FIG. 16</figref> corresponds to the input value acquisition processing of the in<b>2</b>. Processing <b>11221</b> returns the result of converting the value of the in<b>2</b>_buff based on a predetermined unit.</p>
<p id="p-0076" num="0075">Processing <b>1123</b> of <figref idref="DRAWINGS">FIG. 16</figref> corresponds to the input value acquisition processing of the in3. Processing <b>11231</b> returns the value of in<b>3</b>_buff directly to the application program <b>111</b>.</p>
<p id="p-0077" num="0076">Processing <b>1124</b> of <figref idref="DRAWINGS">FIG. 18</figref> corresponds to the input acquisition of the in<b>4</b>. Processing <b>11241</b> returns the value of in<b>4</b>_buff directly.</p>
<p id="p-0078" num="0077"><figref idref="DRAWINGS">FIGS. 19 through 22</figref> are flow charts representing the output value updating <b>113</b>. <figref idref="DRAWINGS">FIG. 19</figref> shows the processing of updating the output value of the out<b>1</b>. Processing <b>11311</b> updates the value out<b>1</b>_val transferred from the application program <b>111</b>, directly to the out<b>1</b>_buff.</p>
<p id="p-0079" num="0078"><figref idref="DRAWINGS">FIG. 20</figref> shows the processing of updating the output value out<b>2</b>. Processing <b>11321</b> updates the value out<b>2</b>_val transferred from thee application program <b>111</b>, directly to the out<b>2</b>_buff.</p>
<p id="p-0080" num="0079"><figref idref="DRAWINGS">FIG. 21</figref> shows the processing of updating the output value out<b>3</b>. Processing <b>11331</b> converts the value out<b>3</b>_val transferred from the application program <b>111</b>, according to a predetermined conversion formula and updates the result of conversion to the out<b>3</b>_buff.</p>
<p id="p-0081" num="0080"><figref idref="DRAWINGS">FIG. 22</figref> shows the processing of updating the output value out<b>4</b>. Processing <b>11341</b> converts the value out<b>4</b>_val transferred from the application program, according to a predetermined conversion formula and updates the result of conversion to the out<b>4</b>_buff.</p>
<p id="p-0082" num="0081"><figref idref="DRAWINGS">FIG. 23</figref> indicates a 10-msec task processing flow. Processing <b>1211</b> by the 10-msec task described with reference to <figref idref="DRAWINGS">FIG. 2</figref> initiates the 10-msec application. Then processing <b>1213</b> initiates the 10-msec event post-processing. Initiation processing <b>119</b> is initiated in processing <b>1211</b> and <b>1213</b>, as described above.</p>
<p id="p-0083" num="0082"><figref idref="DRAWINGS">FIG. 24</figref> is a flow chart representing the appl<sub>—</sub>10-msec by the 10-msec application <b>1212</b> as one of the application programs <b>111</b>. Processing <b>8221</b> acquires the value of in1 through the get_in<b>1</b>, and updates it to in<b>1</b>_val. Processing <b>8212</b> acquires the value of in<b>2</b> through the get_in<b>2</b>, and updates it to in<b>2</b>_val. Processing <b>8213</b> executes 10-msec processing in response to these input values and internal states, and updates the out<b>1</b>_val. Processing <b>8214</b> sets the out<b>1</b>_val to the output value storage buffer <b>115</b> through the set_out<b>1</b>.</p>
<p id="p-0084" num="0083">The following describes the input operation in the present Embodiment. <figref idref="DRAWINGS">FIG. 25</figref> shows the input <b>1</b> and timing chart related thereto. Timing <b>9111</b> and timing <b>9112</b> refer to 10-msec event. Timing <b>9113</b> and timing <b>9114</b> refer to the timing when update_in<b>1</b> (10-msec pre-processing) is executed. The appl<sub>—</sub>10m is executed at timing <b>9115</b> and <b>9116</b>. Processing <b>9117</b> and <b>9118</b> update the in<b>1</b>_buff. Processing <b>9119</b> and <b>9120</b> updates the in<b>1</b>_val.</p>
<p id="p-0085" num="0084"><figref idref="DRAWINGS">FIG. 26</figref> shows the output signal out<b>1</b> and timing chart related thereto. Timing <b>9511</b> and timing <b>9512</b> refer to 10-msec event. Timing <b>9513</b> and timing <b>9514</b> refer to the timing when set_out<b>1</b> (10-msec post-processing) is executed. The out<b>1</b>_buffer is updated at this timing. The subsequent timing refers to the timing when update_out<b>1</b> is called. Processing <b>9117</b> and <b>9118</b> update the out<b>1</b>_buff. Processing <b>9519</b> and <b>9520</b> updates the output signal out<b>1</b> in conformity to the value of out<b>1</b>_buff.</p>
<p id="p-0086" num="0085">In the present embodiment, timing for measurement and output can be changed easily by adjusting settings of the initiation table <b>118</b>, without having to change the interface software. For example, when the measurement timing of the input signal in<b>1</b> is to be changed from the 10-msec pre-processing to the 20-msec pre-processing, the update_in<b>1</b> of the initiation table <b>118</b> should be shifted from the 10-msec pre-processing to the 20-msec pre-processing. No other change is necessary.</p>
<p id="p-0087" num="0086">The present invention is applicable to a control unit constituting a control system required to provide real-time processing, as in automotive control. It easily changes the timing for the measurement of the input value of the external signal connected to the control unit as well as the timing for outputting.</p>
<heading id="h-0008" level="1">Embodiment 2</heading>
<p id="p-0088" num="0087">In Embodiment 1, the input measurement processing <b>116</b> and output processing <b>117</b> are initiated by initiation processing <b>119</b>. They can also be initiated by the application program <b>111</b>.</p>
<p id="p-0089" num="0088">The control unit of the present embodiment includes: storage means for storing an input value from the outside or an output value to the outside separately for each input/output signal; input means for measuring the input signal from the outside and updating the input value stored in the storage means; and output means for outputting the output signal to the outside in response to the output value stored in the storage means. This control unit further contains: input value acquisition means for transferring to an application program the input value stored in the storage means; and output value updating means for storing into the storage means the output value transferred from the application program. Further, the input means and output means are initiated in response to the timing preset in the aforementioned application program.</p>
<p id="p-0090" num="0089">In the conventional art, acquisition of the input value by the input value acquisition processing <b>112</b> and updating of the output value by the output value updating <b>113</b> have been implemented, but the timing for measuring the input value measurement and outputting the output value has been fixed. By contrast, the Embodiment 2 allows the initiation timing to be changed as desired, through direction description of the input measurement processing <b>116</b> and output processing <b>117</b> by the application program, although there is no initiation means described with reference to the Embodiment 1. To put it more specifically, the processing <b>9117</b> and processing <b>9118</b> can be called from the application, as is apparent from <figref idref="DRAWINGS">FIG. 25</figref>.</p>
<p id="p-0091" num="0090"><figref idref="DRAWINGS">FIG. 27</figref> is a flow chart representing the 10-msec application processing wherein the processing of timing is called by the application program. Processing <b>8215</b> measures the input value in<b>1</b>. Processing <b>8211</b> receives the in<b>1</b> and stores it in the int_val. Processing <b>8213</b> executes the application processing. Processing <b>8214</b> sets the out<b>1</b> calculated in the processing <b>8213</b>. Processing <b>8216</b> outputs the out<b>1</b>. In the present example, the in<b>2</b> is a value having been obtained by measurement at a predetermined timed interval. Measurement processing is not called by the application program.</p>
<p id="p-0092" num="0091">In the present embodiment, the timing for measurement can be changed without having to change the interface software. This description is also applicable to the output process: The output timing can be changed by calling the update_out<b>1</b> from the application program <b>111</b>, without having to change the interface software.</p>
<p id="p-0093" num="0092">The present invention is applicable to a control unit constituting a control system required to provide real-time processing, as in automotive control. It easily changes the timing for the measurement of the input value of the external signal connected to the control unit as well as the timing for outputting.</p>
<heading id="h-0009" level="1">Embodiment 3</heading>
<p id="p-0094" num="0093">The following describes the case wherein the aforementioned embodiment 1 is applied to a vehicle engine control. The vehicle engine control unit of the present invention includes: storage means for storing an input value from a sensor and others or an output value to an engine control unit separately for each input/output signal; input means for measuring the input from the sensor and others, and updating the input value stored in the storage means; and output means for outputting an output signal to the engine control unit in according with the value stored in said storage means. This vehicle engine control unit also includes: input value acquisition means for transferring the input value stored in said storage means to an engine control program; output value updating means for storing the output value transferred from the engine control program into the storage means; initiation means for initiating said input means and output means, and initiation timing storage means for storing the initiation timing. Further, the input means and output means are initiated by said initiation means in response to the timing stored on said initiation timing storage means.</p>
<p id="p-0095" num="0094">According to the above description, the input signal in<b>1</b> of the embodiment 1 refers to a digital input and corresponds to the ignition switch or the like. The digital output signal out<b>1</b> corresponds to a power train relay or the like. The input signal in<b>2</b> is an analog input and corresponds to a water temperature or oxygen sensor.</p>
<p id="p-0096" num="0095">Input signal in<b>3</b> is the information received from another control unit through communication, and corresponds to vehicle speed or gear position (e.g. first gear or neutral position), for example. The output signal out<b>3</b> is the information to be sent to another control unit, and corresponds to the state of the control unit (e.g. engine speed), for example. The input signal in<b>4</b> is a pulse input and corresponds to the sensor outputting pulses in response to the crank angle. The output signal out<b>4</b> is a pulse and corresponds to ignition signal or injection signal, for example.</p>
<p id="p-0097" num="0096">In the engine control, processing is divided into two forms; the processing at fixed intervals and processing synchronous with engine rotation. In processing synchronous with engine rotation, the ignition control (ignition position and current application time before ignition) and injection control (injection timing and amount of injection) are performed in response to the state of the vehicle such as engine speed.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A vehicle engine control unit comprising:
<claim-text>storage means for storing an input value from a sensor and others or an output value to an engine control unit separately for each input/output signal;</claim-text>
<claim-text>input means for measuring the input from the sensor and others, and updating the input value stored in said storage means;</claim-text>
<claim-text>output means for outputting an output signal to the engine control unit in according with the value stored in said storage means;</claim-text>
<claim-text>input value acquisition means for transferring the input value stored in said storage means to an engine control program;</claim-text>
<claim-text>output value updating means for storing the output value transferred from said engine control program into said storage means;</claim-text>
<claim-text>initiation means for initiating said input means and output means; and</claim-text>
<claim-text>initiation timing storage means for storing the initiation timing,</claim-text>
<claim-text>wherein said input means and output means are initiated by said initiation means in response to the timing stored on said initiation timing storage means.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. A control unit comprising:
<claim-text>storage means for storing an input value from the outside or an output value to the outside separately for each input/output signal;</claim-text>
<claim-text>input means for measuring the input signal from the outside and updating the input value stored in the storage means;</claim-text>
<claim-text>output means for outputting an output signal to the outside in according with the value stored in said storage means;</claim-text>
<claim-text>input value acquisition means for transferring the input value stored in said storage means to an application program;</claim-text>
<claim-text>output value updating means for storing the output value transferred from said application program into said storage means;</claim-text>
<claim-text>initiation means for initiating said input means and output means; and</claim-text>
<claim-text>initiation timing storage means for storing the initiation timing,</claim-text>
<claim-text>wherein said input means and output means are initiated by said initiation means in response to the timing stored on said initiation timing storage means.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. A control unit comprising:
<claim-text>storage means for storing an input value from the outside or an output value to the outside separately for each input/output signal;</claim-text>
<claim-text>input means for measuring the input from the outside and updating the input value stored in said storage means;</claim-text>
<claim-text>output means for outputting an output value to the outside in according with the value stored in said storage means;</claim-text>
<claim-text>input value acquisition means for transferring the input value stored in said storage means to an application program; and</claim-text>
<claim-text>output value updating means for storing the output value transferred from said application means into said storage means,</claim-text>
<claim-text>wherein said input means and output means are initiated in response to the timing set in said application program.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The control unit according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein said input means and output means are initiated in response to the timing stored on said initiation timing storage means, and implements said processing for each signal.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The control unit according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the contents stored in said initiation timing storage means are set and stored by an initiation timing registration means.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The control unit according to <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein said input means is initiated by said application program.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The control unit according to <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein said output means is initiated by said application program.  </claim-text>
</claim>
</claims>
</us-patent-grant>
