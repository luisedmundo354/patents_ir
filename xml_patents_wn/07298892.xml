<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07298892-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07298892</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>10410550</doc-number>
<date>20030409</date>
</document-id>
</application-reference>
<us-application-series-code>10</us-application-series-code>
<us-term-of-grant>
<us-term-extension>917</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>K</subclass>
<main-group>9</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>382167</main-classification>
<further-classification>348232</further-classification>
<further-classification>347 19</further-classification>
<further-classification>345207</further-classification>
</classification-national>
<invention-title id="d0e53">Producing a balanced digital color image having minimal color errors</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>4101217</doc-number>
<kind>A</kind>
<name>Fergg et al.</name>
<date>19780700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>4707119</doc-number>
<kind>A</kind>
<name>Terashita</name>
<date>19871100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>4945406</doc-number>
<kind>A</kind>
<name>Cok</name>
<date>19900700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>4984013</doc-number>
<kind>A</kind>
<name>Terashita</name>
<date>19910100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>5016043</doc-number>
<kind>A</kind>
<name>Kraft et al.</name>
<date>19910500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>5452105</doc-number>
<kind>A</kind>
<name>Tamagaki et al.</name>
<date>19950900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>358453</main-classification></classification-national>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>5907629</doc-number>
<kind>A</kind>
<name>Funt et al.</name>
<date>19990500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382162</main-classification></classification-national>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>6243133</doc-number>
<kind>B1</kind>
<name>Spaulding et al.</name>
<date>20010600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>3482231</main-classification></classification-national>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>6459425</doc-number>
<kind>B1</kind>
<name>Holub et al.</name>
<date>20021000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>345207</main-classification></classification-national>
</citation>
<citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>6563945</doc-number>
<kind>B2</kind>
<name>Holm</name>
<date>20030500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382162</main-classification></classification-national>
</citation>
<citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>6628823</doc-number>
<kind>B1</kind>
<name>Holm</name>
<date>20030900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382162</main-classification></classification-national>
</citation>
<citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>6681042</doc-number>
<kind>B1</kind>
<name>Weldy</name>
<date>20040100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382167</main-classification></classification-national>
</citation>
<citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>6985622</doc-number>
<kind>B2</kind>
<name>Hubel</name>
<date>20060100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382165</main-classification></classification-national>
</citation>
<citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>7103217</doc-number>
<kind>B2</kind>
<name>Haikin</name>
<date>20060900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382167</main-classification></classification-national>
</citation>
<citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>7139217</doc-number>
<kind>B2</kind>
<name>Scott</name>
<date>20061100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>367 20</main-classification></classification-national>
</citation>
<citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>7207645</doc-number>
<kind>B2</kind>
<name>Busch et al.</name>
<date>20070400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>347 19</main-classification></classification-national>
</citation>
<citation>
<nplcit num="00017">
<othercit>Preffered Color Spaces for White Balancing, Xiao et al, XP-002364458, Dept of Psychology , Stanford University.</othercit>
</nplcit>
<category>cited by examiner</category>
</citation>
<citation>
<nplcit num="00018">
<othercit>Reference Input/ Output Medium Metric RGB color Encoding, Spaulding et al, Kodak Comapny, NY,USA.</othercit>
</nplcit>
<category>cited by examiner</category>
</citation>
<citation>
<nplcit num="00019">
<othercit>Feng Xiao et al., Preferred Color Spaces for White Balancing, Conference on Sensors and Camera Systems for Scientific, Industrial and Digital Photography Applications IV and Proceedings of the SPIE—The International Society for Optical Engineering SPIE-Int. Soc. Opt. Eng USA, vol. 5017, Jan. 21, 2003, pp. 342-350, XP002364458.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00020">
<othercit>H. R. Kang, Computational Accuracy of RGB Encoding Standards, IS&amp;T's NIP16: Internation Conference on Digital Printing Technologies, Oct. 15, 2000, pp. 661-664, XP008058909.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00021">
<othercit>K. E. Spaulding et al., Reference Input/Output Medium Metric RGB Color Encodings (RIMM/ROMM RGB), Proceedings of the Conference on Image Processing, Image Quality and Image Capture Systems, May 26, 2000, pp. 155-163, XP008034009.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00022">
<othercit>G. Woolfe et al., Optimal Color Spaces for Balancing Digital Color Images, IS&amp;T/SID Eleventh Color Imaging Conference, Nov. 3, 2003, pp. 66-70, XP008058893.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>48</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>382162</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>382167</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>356326</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>348232</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>5</number-of-drawing-sheets>
<number-of-figures>5</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20040202365</doc-number>
<kind>A1</kind>
<date>20041014</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Spaulding</last-name>
<first-name>Kevin E.</first-name>
<address>
<city>Spencerport</city>
<state>NY</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Woolfe</last-name>
<first-name>Geoffrey J.</first-name>
<address>
<city>Penfield</city>
<state>NY</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="003" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Giorgianni</last-name>
<first-name>Edward J.</first-name>
<address>
<city>Rochester</city>
<state>NY</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<last-name>Owens</last-name>
<first-name>Raymond L.</first-name>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Eastman Kodak Company</orgname>
<role>02</role>
<address>
<city>Rochester</city>
<state>NY</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Ahmed</last-name>
<first-name>Samir</first-name>
<department>2624</department>
</primary-examiner>
<assistant-examiner>
<last-name>Bitar</last-name>
<first-name>Nancy</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A method for correcting the color balance of an input digital color image in an input color space captured under a capture illuminant to produce a balanced digital color image includes transforming the input digital color image to a balancing color space, wherein the balancing color space has three color channels corresponding to three color space primaries, the color space primaries being chosen so that minimal color errors can be produced when correcting the color balance for a set of one or more capture illuminants relative to aim colors that would be produced if the digital color image were captured under reference conditions; and correcting the color balance of the input digital color image in the balancing color space to produce a balanced digital color image having minimal color errors relative to aim colors that would be produced if the digital color image were captured under reference conditions.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="151.13mm" wi="61.04mm" file="US07298892-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="161.12mm" wi="153.42mm" orientation="landscape" file="US07298892-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="134.20mm" wi="147.24mm" orientation="landscape" file="US07298892-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="173.74mm" wi="65.53mm" file="US07298892-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="197.87mm" wi="158.50mm" file="US07298892-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="139.95mm" wi="143.59mm" orientation="landscape" file="US07298892-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">FIELD OF THE INVENTION</heading>
<p id="p-0002" num="0001">This invention pertains to the field of digital image processing, and more particularly to the field of applying color balance corrections to digital images captured under different capture illuminants.</p>
<heading id="h-0002" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0003" num="0002">Digital imaging systems are becoming increasingly common both in the field of still photography, as well as in the field of motion imaging as is evidenced by the proliferation of digital cameras and video recorders, as well as services for digitizing photographic film.</p>
<p id="p-0004" num="0003">Color digital imaging devices generally utilize an array of color sensors to capture the image information. The sensors typically have spectral sensitivities that correspond roughly to the red, green and blue portions of the visible spectrum. Alternatively, sensors with other spectral sensitivities such as cyan, magenta and yellow, or cyan, magenta, yellow and green have also been used. Typically, the exposure values captured by the color sensors are integerized to form quantized color values (code values) and stored in memory for later processing. The later processing steps typically include color correction, as well as a variety of spatial processing steps such as sharpening and/or noise removal.</p>
<p id="p-0005" num="0004">Sensors used for image capture, including both photographic film and solid state sensors, differ fundamentally from the human visual system in that they lack the ability to adapt to the ambient illumination. While the human visual system adapts to both the luminance and chromatic content of the scene illuminant, image capture systems require a number of compensation mechanisms to mimic such adaptation. These compensation mechanisms can be broadly divided into two classes—pre-exposure mechanisms and post-exposure mechanisms. Pre-exposure correction mechanisms can be thought of as “light altering” in that they change the light captured by the image sensor, whereas post-exposure correction mechanism can be thought of as “signal altering” in that they are used to modify the signal captured by the image sensor. Some degree of pre-exposure compensation to the average illumination level is accomplished using the exposure controls—aperture and shutter speed—available on most cameras. These controls provide a basic level of adjustment over the exposure given to the sensor(s), but they are seldom reliable enough to produce perfectly balanced pictures in every instance. Furthermore, camera exposure controls provide no mechanism for compensation for variations in the chromaticity of the ambient illumination. The only pre-exposure mechanism that attempts to correct for illuminant chromaticity is the use of color correction filters. Again, such corrections are generally only approximate since color correction filters are designed for specific discrete illuminant spectral power distributions.</p>
<p id="p-0006" num="0005">Pre-exposure compensation mechanisms have historically relied on the skill and sophistication of the photographer for their success, but modern automatic exposure metering systems are able to achieve reasonably good results, even in the hands of a neophyte. Since pre-exposure compensation mechanisms only provide a partial solution to the problem of illuminant variability, most images require further compensation for the scene illuminant variability using post-capture mechanisms. There are numerous techniques available to accomplish such compensation. In the traditional silver-halide-negative photography arena, post-exposure illuminant compensation has been accomplished by adjustment of the enlarger or printer lamphouse filtration and control of the printing exposure. The magnitude of such adjustments can be determined by trial and error, or by algorithmic corrections based on statistical measurements of the negative transmittance. In some cases, the “post-exposure correction” may be specified before the exposure is made, as in the case of specifying white-balance gain corrections by selecting a white-balance setting on a digital camera. However, such corrections should not be confused with “pre-exposure corrections” since the corrections are not actually applied until after the image is captured.</p>
<p id="p-0007" num="0006">Digital imaging opens up many additional possibilities for post-exposure illuminant compensation. Such compensation is generally performed using mathematical transforms applied to the digital image data. For example, white balance adjustments can be applied in a digital camera, or adjustment to the scanned densities of a color negative can be applied in a digital photofinishing system. These transforms are generally applied to a numerical encoding of the scene colors. Many such encodings—both device dependent and device independent—are available to represent colors.</p>
<p id="p-0008" num="0007">The intent of balancing transforms in digital imaging applications is usually to modify the image in a manner that is consistent with the adaptation mechanisms in the human visual system. Typically, simple transforms consisting of either a multiplicative scaling factor (gain adjustment) in a linear color encoding or an additive shift in a logarithmic color encoding are used to map a particular visually neutral reference in the scene to a set of aim coordinates in the color encoding. The same transform that is used to map the reference neutral is also applied to all other colors in the image.</p>
<p id="p-0009" num="0008">Since most scenes do not contain a reference neutral patch that can be used for the balancing operation, a neutral reference is usually estimated by analysis of the scene content. Algorithms that perform this scene analysis to determine an estimate of the necessary correction are sometimes referred to as “scene balance algorithms.” (For example, see “Automatic Color Printing Techniques,” Image Technology, April/May 1969, pp. 39-43; U.S. Pat. No. 4,101,217 assigned to AGFA-Gevaert A. G.; U.S. Pat. Nos. 4,707,119 and 4,984,013 assigned to Fuji Photo Film Co., Ltd.; U.S. Pat. No. 4,945,406 assigned to Eastman Kodak Company; and U.S. Pat. No. 5,016,043 assigned to Gretag Systems.) Scene balance algorithms can vary widely in their complexity, as well as in the accuracy of their results. They typically involve analyzing the distribution of overall exposure levels and relative color signal levels in an image to determine the appropriate level of exposure and color balance compensation that is needed. Frequently, these algorithms work by first computing a low-resolution version of the image and then analyzing that image.</p>
<p id="p-0010" num="0009">Even if the balancing transform produces a perfectly balanced result for the reference neutral, the results obtained for other image colors may not be consistent with human visual system adaptation, and would therefore be perceived as an error. The extent of these errors is a function of the magnitude of the balancing correction (a function therefore of the scene illuminant) and of the color encoding in which the balancing transform is applied.</p>
<p id="p-0011" num="0010">For example, consider the case where an image is captured by a digital imaging system under a 18,000K daylight illuminant, which might correspond to a shadow scene that was illuminated with blue skylight and no direct sunlight. If the imaging system were optimized to produce well-balanced imaged from a 5000K daylight source, the unbalanced image would have a significantly blue cast. Consider the case where a color balance correction is applied by transforming the image to a linear RGB color space having the primaries of the well-known sRGB color space, and scaling the resulting RGB values using multiplicative scale factors such that a neutral scene object were perfectly corrected. If the aim of the color balance correction is to produce an image that is identical to one where the scene were captured using the nominal 5000K daylight source, the color errors can be determined by computing the color difference between the aim colors and the balanced image colors. The RMS ΔE*<sub>ab </sub>color error calculated for a set of about 400 test patches corresponding to representative scene reflectance spectra, was found to be 12.07. <figref idref="DRAWINGS">FIG. 1</figref> is a CIELAB a*-b* plot showing these color errors for each of the test patches.</p>
<p id="p-0012" num="0011">If in the example above, the sRGB primaries were replaced by the primaries associated with the RIMM RGB color space described in ANSI/I3A IT10.7466 “Electronic Still Picture Imaging—Reference input medium metric RGB color encoding (RIMM-RGB),” the RMS ΔE*<sub>ab </sub>color error calculated for the same test patches, was found to be 9.40. <figref idref="DRAWINGS">FIG. 2</figref> is a CIELAB a*-b* plot showing these color errors for each of the test patches. While this represents an improvement in the RMS color error over those associated with the sRGB primaries, they are still far from perfect.</p>
<p id="p-0013" num="0012">Spaulding et al. have disclosed a method for applying scene balance corrections in a digital imaging system by transforming to a standard color space for performing the analysis of the digital image (see commonly-assigned U.S. Pat. No. 6,243,133). This method has the advantage that a single scene balance algorithm can be used for many different digital imaging devices without needing to retune the algorithm for each device. However, with the method of Spaulding et al., the actual correction step is applied to the digital image in the input color space. Therefore, the resulting color errors will have the same inherent characteristics as those resulting from applying the scene balance correction algorithm directly in the input color space.</p>
<heading id="h-0003" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0014" num="0013">It is an object of the present invention to provide an improved way to produce balanced digital color images having reduced color errors.</p>
<p id="p-0015" num="0014">These objects are achieved by a method for correcting the color balance of an input digital color image in an input color space captured under a capture illuminant to produce a balanced digital color image comprising the steps of:</p>
<p id="p-0016" num="0015">a) transforming the input digital color image to a balancing color space, wherein the balancing color space has three color channels corresponding to three color space primaries, the color space primaries being chosen so that minimal color errors can be produced when correcting the color balance for a set of one or more capture illuminants relative to aim colors that would be produced if the digital color image were captured under reference conditions; and</p>
<p id="p-0017" num="0016">b) correcting the color balance of the input digital color image in the balancing color space to produce a balanced digital color image having minimal color errors relative to aim colors that would be produced if the digital color image were captured under reference conditions.</p>
<p id="p-0018" num="0017">The present invention has the advantage over the prior art that color errors resulting from the application of color balance correction operations can be minimized by performing the color balance operation in a color space optimized for this purpose. Using this approach it is possible to obtain more pleasing and realistic images with little or no increase in the complexity of the color balancing algorithm.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 1</figref> is a CIELAB a*-b* plot showing the color errors obtained when a color balance correction is applied to a color space with the prior art sRGB color space primaries;</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 2</figref> is a CIELAB a*-b* plot showing the color errors obtained when a color balance correction is applied to a color space with the prior art RIMM RGB color space primaries;</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 3</figref> is a flowchart showing a preferred method for applying color balance corrections in accordance with the present invention;</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 4</figref> is a flowchart showing a preferred method for determining balancing color space primaries according to the method of the present invention; and</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 5</figref> is a CIELAB a*-b* plot showing the color errors obtained when a color balance correction is applied to a color space with optimized balancing color space primaries in accordance with the present invention.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DETAILED DESCRIPTION OF THE INVENTION</heading>
<p id="p-0024" num="0023">This invention represents a way for color balancing images in a way that minimizes the color errors associated with prior art color balance adjustment methods. Referring to <figref idref="DRAWINGS">FIG. 3</figref>, a flow diagram illustrating a preferred embodiment of the present invention is illustrated. With this method, an input digital color image in an input color space <b>100</b> has been captured under a capture illuminant. A transform to balancing color space step <b>105</b> is used to apply a color space transformation to the input digital color image in an input color space <b>100</b> to determine a corresponding input digital color image in the balancing color space <b>110</b>, wherein the balancing color space has three color channels corresponding to three color space primaries, the color space primaries being chosen so as to produce minimal color errors when correcting the color balance for a set of one or more capture illuminants relative to aim colors that would be produced if the digital color image were captured under reference conditions. Next, a correct color balance of digital image step <b>115</b> is used to determine a balanced digital color image in the balancing color space <b>120</b>. Finally, an optional transform to output color space step <b>125</b> is used to apply a color space transformation to determine a corresponding balanced digital color image in an output color space <b>130</b>.</p>
<p id="p-0025" num="0024">The various elements of the present invention will now be discussed in more detail. The input digital color image in an input color space <b>100</b> can be captured using a variety of different means. In one preferred embodiment of the present invention, the input digital color image in an input color space <b>100</b> is captured using a digital image capture device such as a digital camera. In another preferred embodiment of the present invention, the input digital color image in an input color space <b>100</b> is captured using photographic film and subsequently scanned using a film scanner. Other possible types of image capture devices can include video cameras, or reflection print scanners that are used to scan reflection prints. The method can also be applied to computer-generated images that are simulations of actual scene captures.</p>
<p id="p-0026" num="0025">The input digital color image in an input color space <b>100</b> can be in a number of input color spaces. In one preferred embodiment of this invention, the input color space would be the capture color space of the image capture device. For example, it can be the fundamental sensor RGB color space for a digital camera, where each color channel would be associated with the spectral sensitivity of the individual sensor color channels. Similarly, the input color space can also be the capture color space associated with the fundamental sensor RGB color space for a film scanner, or the capture color space associated with the spectral sensitivities of a conventional photographic film material.</p>
<p id="p-0027" num="0026">Alternatively, the input color space can be some intermediate color space to which the captured image had been transformed. For example, the input color space can be a standard device-dependent color space such as the well-known sRGB color space, or it can be a device-independent color space such as the well-known CIE XYZ or CIELAB color spaces. In such cases, a color transform is typically used to transform the captured digital image to the intermediate color space. In some cases, this transform may be well-defined and exact, whereas in other cases the color transform may be only an approximation. For example, consider the case of a digital camera. If the sensors in the digital camera have spectral sensitivities that are linear combinations of the CIE color matching functions, there will be a simple and exact relationship between the captured sensor RGB color values and the corresponding CIE XYZ color values for the scene. On the other hand, if the sensors in the digital camera have spectral sensitivities that cannot be represented by linear combinations of the CIE color matching functions, then any transformation to CIE XYZ would only produce an approximation of the actual scene color value due to sensor metamerism limitations. Methods for determining such approximate color transformations are well-known in the art, and typically involve some kind of error minimization process such as least squares.</p>
<p id="p-0028" num="0027">For the current discussion, it will be assumed that the input digital color image is captured by a digital camera having spectral sensitivities that are linear combinations of the CIE color matching functions, and that the input digital color image has been transformed to the CIE XYZ color space by applying the appropriate matrix transformation to the linear sensor RGB color values. However, it should be noted that this method is not dependent on this condition, and can be applied equally well with other types of input color spaces and image capture devices.</p>
<p id="p-0029" num="0028">The input digital image will be captured under some capture illuminant. Typically, most image capture devices are optimized for some reference illuminant, and therefore will produce a well-balanced image with accurate colors when a real scene is captured under this reference illuminant. However, when a scene is captured under a different capture illuminant, the input digital image will often not produce a desirable image unless a color balance correction is applied. For example, consider the case where an image capture device is optimized to produce a pleasing image under a daylight illuminant with a 5000K color temperature (e.g., CIE Illuminant D50). If this device is used to capture an image under a tungsten illuminant, the resulting image will typically look very “warm” if no color balance correction is applied due to the fact that tungsten illuminants have much more red content and much less blue content. Similarly, other types of illuminants such as fluorescent illuminants will also produce undesirable results if no color balance correction is applied. Even images captured under daylight illumination with different color temperatures (for example at different times of day, or under different sky conditions, etc.) may also produce undesirable images.</p>
<p id="p-0030" num="0029">While the human visual system automatically adapts to changes in the viewing illumination, photographic imaging systems need to include a color balance correction step to be able to provide desirable images under a variety of different capture illuminants. In a conventional film-based photographic system, the color balance correction step is typically applied when a photographic negative is printed using an optical enlarger by adjusting the filtration to compensate for the color balance error. For example, the filtration can be adjusted to shift the color balance of an image captured under a tungsten illuminant to shift it in a blue direction. In digital imaging systems, the color balance correction step can either be implemented by adjusting the analog gains for the sensor circuitry, or by using a post-capture digital image processing operation. When a post-capture digital image processing operation is used, this commonly involves applying multiplicative color balance scale factors to each of the color channels of the digital image. (Or if a logarithmic color encoding is used, color balance offset values are added to each of the color channels.)</p>
<p id="p-0031" num="0030">The goal of the correct color balance of digital image step <b>115</b> in the present invention is typically to adjust the color values so that a neutral gray object in the scene is mapped to the same color values that it would have been mapped to if the digital color image were captured under reference conditions. For example, many digital cameras are designed such that a neutral object will produce equal RGB color values when the scene is captured under a reference illuminant. However, if the scene is captured under some other illuminant, the RGB color values will no longer be equal. Most color balance correction operations will simply apply multiplicative color balance scale factors to the individual RGB color channels such that the neutrals will once more have equal code values. (Typically, these color balance scale factors are applied to radiometrically linear RGB values, but they can also be applied to RGB values that have been encoded using a power-function type nonlinearity.)</p>
<p id="p-0032" num="0031">The color balance scale factors are typically estimated using automatic color balance estimation algorithms to analyze the captured scene. For example, the assumption is sometimes made that typical scenes will average to gray. In that case, the appropriate color balance scale factors can be estimated by computing the average RGB values for the image, then determining the gain values that would be necessary to equate them. However, simple algorithms like this are easily fooled, which has led to the development of more sophisticated methods for estimating the appropriate color balance scale factors. The details of these algorithms are beyond the scope of this discussion, but any such method can be used for the method of the present invention.</p>
<p id="p-0033" num="0032">In some cases, a manual scene balance operation can be used where a user interface is provided that enables a user to specify a desired color balance correction. For example, the user interface can include a series of color balance slide bars or a mechanism allowing the user to click on a neutral object in the image.</p>
<p id="p-0034" num="0033">In some cases, information may be available about the scene illumination that can be used to determine the appropriate color balance correction. For example, if a digital camera fires its flash, this information can be used to determine appropriate color balance scale factors since the scene illumination will have a known spectral composition. Alternatively, information about the scene illumination can be determined from color temperature sensors on the camera, or the user can specify the appropriate scene illumination type by selecting from a list of typical scene illuminants.</p>
<p id="p-0035" num="0034">It should be noted that the color balance correction operation may be used to provide color balance modifications beyond those necessary to simply account for the capture illuminant variability. For example, the imaging system may include other sources of variability that would affect the overall color balance of the image, such as sensor/film sensitivity variability, film processing variability, etc. The color balance correction operation can also be used to apply a user-specified color balance adjustment to satisfy the preferences of a particular individual or a group of individuals. Such preferences can be specified on an image-by-image basis, or as an overall color balance bias that should be applied to all images.</p>
<p id="p-0036" num="0035">As was noted earlier in the Background of the Invention section, a color balance correction that perfectly corrects the neutral scene elements can still produce undesirable distortions for other colors in the scene. For example, the hue of a blue sky might go purplish, or a yellow object may become de-saturated and turn greenish. The most objectionable errors are typically associated with hue and/or saturation errors for various memory colors, which can result in unnatural looking images. Problems can become particularly apparent when the color balancing operation causes the color name to change. The method of the present invention is designed to minimize these problems by applying the correct color balance of digital image step <b>115</b> in a balancing color space that has been optimized to preserve the color accuracy. In particular, the balancing color space has three color channels corresponding to three color space primaries, the color space primaries being chosen so as to produce minimal color errors when correcting the color balance for a set of one or more capture illuminants.</p>
<p id="p-0037" num="0036">After the correct color balance of digital image step <b>115</b> is used to determine a balanced digital color image in the balancing color space <b>120</b>, an optional transform to output color space step <b>125</b> can be used to apply a color space transformation to determine a corresponding balanced digital color image in an output color space <b>130</b>. In some cases, it may be desire to transform the balanced digital color image back to the input color space. In this case, the output color space is equal to the input color space. Alternatively, it may be desirable to transform the balanced digital color image to some other output color space. For example, it may be desirable to transform to an output color space associated with a standard output device such as an sRGB video display.</p>
<p id="p-0038" num="0037">Referring now to <figref idref="DRAWINGS">FIG. 4</figref>, an optimal set of balancing color space primaries can be determined in accordance with the present invention will now be described in more detail. In this method, the color errors are minimized for a set of input test patches characterized by a set of test patch reflectance spectra <b>200</b>. Aim color values <b>215</b> for the set of test patches are determined using a compute aim color values step <b>210</b>. The aim color values <b>215</b> are typically determined using a reference illuminant spectrum <b>205</b> corresponding to the design illuminant for the image capture system together with the test patch reflectance spectra <b>200</b>. In one preferred embodiment of this invention, the aim color values <b>215</b> are defined by the CIE XYZ color space values for the test patches as viewed under the reference illuminant. The CIE XYZ color space values can be determined using straightforward calculations familiar to those skilled in the art. The aim color values <b>215</b> can be expressed directly in terms of the CIE XYZ values, or alternatively, they can be converted to some other color space. For example, they can be expressed in terms of the well-known CIELAB or CIELUV color spaces, or in terms of color appearance metrics using any one of a number of color appearance spaces familiar to those skilled in the art (e.g., CIECAM2000).</p>
<p id="p-0039" num="0038">Alternatively, the aim color values <b>215</b> can be determined using a number of other methods. For example, in one embodiment of the present invention aim color values <b>215</b> can be determined corresponding to the color values captured by a reference image capture device having a specified set of spectral sensitivities. In another embodiment of the present invention, the aim color values <b>215</b> can be determined from the test patch reflectance spectra and a particular capture illuminance spectrum by determining the CIE XYZ values of the patches under the capture illuminant, and then using a chromatic adaptation transform to determine corresponding CIE XYZ color values that would be required to produce the same patch color appearance under the reference illuminant. There are many different types of chromatic adaptation transforms that can be used that are familiar to those skilled in the art.</p>
<p id="p-0040" num="0039">In a preferred embodiment of the present invention, the set of test patch reflectance spectra <b>200</b> will include a representative sampling of reflectance spectra that would be encountered in real scenes that are relevant to the particular application. Generally, it will be desirable that the test patches include colors that are distributed throughout color space, as well as important memory colors such as human skin tones, foliage, etc. It will usually be useful to also include a series of non-selective neutral patches. (These can be used for determining the appropriate color balance corrections for a given capture illuminant.)</p>
<p id="p-0041" num="0040">Next, a compute unbalanced color values step <b>225</b> is used to determine a set of unbalanced color values <b>230</b> from a set of one or more capture illuminant spectra <b>220</b>, and the same set of input test patch reflectance spectra <b>200</b>. In a preferred embodiment of the present invention, the unbalanced color values are defined by the CIE XYZ color space values for the test patches as viewed under each of the capture illuminant spectra <b>220</b>. As was discussed with reference to the computation of the aim color values <b>215</b>, the unbalanced color values <b>230</b> can be expressed in any one of a multiplicity of different color spaces, including device-dependent color spaces for a reference image capture device having a specified set of spectral sensitivities.</p>
<p id="p-0042" num="0041">The set of capture illuminant spectra <b>220</b> should include a representative sampling of capture illuminants that are relevant to the particular application. Examples of illuminants that would be typically encountered in photographic scenes would include daylight illuminants, tungsten illuminants, blackbody illuminants, fluorescent illuminants, and electronic flash illuminants. Each of these different types of illuminants may be represented at one or more different color temperatures. In some applications, there may be only one illuminant that is of particular interest. For example, if a photographic application uses well controlled studio illumination, the set of capture illuminant spectra <b>220</b> would only need to include that particular illuminant. In other applications, the illuminants can be expected to vary quite widely. In those cases, it will generally be desirable to include a diverse set of illuminants in the set of capture illuminant spectra <b>220</b>. In some applications, there may be special illumination conditions that can be accounted for. For example, for underwater photography, the illumination will usually be daylight that has been filtered by various depths of water. In this case, effective underwater illuminants can be defined corresponding to the product of the illuminant spectra and the spectral transmittance of the water.</p>
<p id="p-0043" num="0042">Next, a transform to balancing color space step <b>240</b> is used to transform the unbalanced color values <b>230</b> to corresponding unbalanced color values in the balancing color space <b>250</b>. The balancing color space is an additive RGB color space, having three color channels corresponding to three balancing color space primaries <b>290</b>. Such additive RGB color spaces will have a simple linear matrix relationship to CIE XYZ tristimulus values. The three color space primaries are usually defined in terms of their CIE x-y chromaticity coordinates. For cases where the unbalanced color values <b>230</b> are represented in terms of a color space derived from CIE colorimetry, there will be a straightforward and exact transformation between the unbalanced color values <b>230</b> and the corresponding unbalanced color values in the balancing color space <b>250</b>. For example, if the unbalanced color values <b>230</b> are expressed as CIE XYZ color values, a simple linear 3×3 matrix transformation can be used to determine the corresponding balancing color space color values. This matrix can be determined from the chromaticity coordinates of the balancing color space primaries <b>290</b> and chromaticity values for a balancing color space white point using methods well-known to those skilled in the art. Typically, the balancing color space white point will be defined to be consistent with the reference illuminant spectra <b>205</b>, although this is not a requirement.</p>
<p id="p-0044" num="0043">For cases where the unbalanced color values <b>230</b> are represented in terms of a device-dependent color spaces for a reference image capture device having a specified set of spectral sensitivities, there will generally not be an exact relationship between the unbalanced color values and CIE XYZ values due to sensor metamerism issues. In such cases, an approximate transformation to CIE XYZ color values can be determined using well-known modeling techniques such as least squares error minimization. The resulting CIE XYZ values can then be transformed to the balancing color space using the simple linear 3×3 matrix transformation discussed above.</p>
<p id="p-0045" num="0044">Depending on the chromaticity coordinates of the balancing color space primaries <b>290</b>, some of the unbalanced color values may have negative RGB values for one or more color values when transformed to the balancing color space. For the purposes of these calculations, there is no need to clip these negative values that would limit the color gamut of the colors that can be represented. Likewise, some of the unbalanced color values may have RGB values greater than 1.0 for one or more color values when transformed to the balancing color space. These also can be preserved in order to not impose any gamut limitations.</p>
<p id="p-0046" num="0045">In some cases, it may be desirable to apply a nonlinear encoding function to the balancing color space color values. This is particularly true when it is desired to use an integer digital representation. Typically “gamma functions” or logarithmic nonlinearities are used in such cases. These types of functions have the advantage that the code values are more uniformly distributed visually than linear encoding functions. (It will generally be desirable to utilize nonlinear encoding functions that preserve the extended range color values as was noted above.)</p>
<p id="p-0047" num="0046">At this point, the optimal balancing color space primaries <b>290</b> have not yet been determined. Therefore, it is necessary to make some initial guess at their chromaticity coordinates. The particular initial chromaticity coordinates that are assumed are not particularly important provided that a robust optimization process is used to determine the optimal values. An example of a set of initial primary values that can be assumed would be (0.0, 0.0), (0.0, 1.0) and (1.0, 0.0).</p>
<p id="p-0048" num="0047">Returning to a discussion of <figref idref="DRAWINGS">FIG. 4</figref>, an apply balance correction to color values step <b>255</b> is next used to determine balanced color values in the balancing color space <b>260</b>. In a preferred embodiment of the present invention, this is accomplished by applying multiplicative color balance scale factors to each of the color channels of the unbalanced color values in the balancing color space <b>250</b> to form balanced color values in the balancing color space <b>260</b>. The multiplicative color balance scale factors appropriate for a given capture illuminant can be most easily determined by computing the ratios of the unbalanced color values in the balancing color space <b>250</b> for a spectrally non-selective neutral patch to the corresponding color values for the reference illuminant. In equation form, the multiplicative color balance scale factors F<sub>R</sub>, F<sub>G </sub>and F<sub>B </sub>for the three color channels of the balancing color space can be determined by:</p>
<p id="p-0049" num="0048">
<maths id="MATH-US-00001" num="00001">
<math overflow="scroll">
  <mrow>
    <msub>
      <mi>F</mi>
      <mi>R</mi>
    </msub>
    <mo>=</mo>
    <mfrac>
      <msub>
        <mi>R</mi>
        <mrow>
          <mi>K</mi>
          <mo>,</mo>
          <mi>ref</mi>
        </mrow>
      </msub>
      <msub>
        <mi>R</mi>
        <mrow>
          <mi>K</mi>
          <mo>,</mo>
          <mi>cap</mi>
        </mrow>
      </msub>
    </mfrac>
  </mrow>
</math>
</maths>
<maths id="MATH-US-00001-2" num="00001.2">
<math overflow="scroll">
  <mrow>
    <msub>
      <mi>F</mi>
      <mi>G</mi>
    </msub>
    <mo>=</mo>
    <mfrac>
      <msub>
        <mi>G</mi>
        <mrow>
          <mi>K</mi>
          <mo>,</mo>
          <mi>ref</mi>
        </mrow>
      </msub>
      <msub>
        <mi>G</mi>
        <mrow>
          <mi>K</mi>
          <mo>,</mo>
          <mi>cap</mi>
        </mrow>
      </msub>
    </mfrac>
  </mrow>
</math>
</maths>
<maths id="MATH-US-00001-3" num="00001.3">
<math overflow="scroll">
  <mrow>
    <msub>
      <mi>F</mi>
      <mi>B</mi>
    </msub>
    <mo>=</mo>
    <mfrac>
      <msub>
        <mi>B</mi>
        <mrow>
          <mi>K</mi>
          <mo>,</mo>
          <mi>ref</mi>
        </mrow>
      </msub>
      <msub>
        <mi>B</mi>
        <mrow>
          <mi>K</mi>
          <mo>,</mo>
          <mi>cap</mi>
        </mrow>
      </msub>
    </mfrac>
  </mrow>
</math>
</maths>
<br/>
where (R<sub>K,ref</sub>, G<sub>K,ref</sub>, B<sub>K,ref</sub>) are the color values in the balancing color space <b>250</b> for the spectrally non-selective neutral patch for the reference illuminant, and (R<sub>K,cap</sub>, G<sub>K,cap</sub>, B<sub>K,cap</sub>) are the color values in the balancing color space <b>250</b> for the spectrally non-selective neutral patch for the capture illuminant. (If the white point of the balancing color space corresponds to the reference illuminant, then R<sub>K,ref</sub>, G<sub>K,ref </sub>and B<sub>K,ref </sub>should all be equal.) Other forms of transforms may be appropriate for use in the apply balance correction to color values step <b>255</b> as well, particularly for the case where a nonlinear encoding is used for the balancing color space.
</p>
<p id="p-0050" num="0049">After applying the apply balance correction to color values step <b>255</b> all spectrally non-selective patches in the set of test patches should be perfectly corrected. However, as was discussed earlier, the color values for non-neutral colors can have significant distortions introduced into them. To evaluate the magnitude of these color errors, a compute balanced color values step <b>265</b> is used to determine balanced color values <b>270</b> by converting the balanced color values in the balancing color space <b>260</b> to the same color space that was used to represent the aim color values <b>215</b>. This transformation will be a function of the balancing color space primaries <b>290</b>.</p>
<p id="p-0051" num="0050">Next, patch color errors <b>280</b> are determined using a compute patch color errors step <b>275</b>. There are many different ways that they patch color errors <b>280</b> can be determined. In a preferred embodiment of the present invention, the patch color errors are determined by computing color differences in a so-called uniform color space such as CIELAB or CIELUV. This is accomplished by first transforming the aim color values <b>215</b> and the balanced color values <b>270</b> to the uniform color space, and then determining the color difference values for each of the test patches and each of the illuminants. The color difference values can be determined using a color difference metric such as CIE ΔE*<sub>ab</sub>:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>Δ<i>E*</i><sub>ab</sub>=√{square root over ((<i>L*</i><sub>aim</sub><i>−L*</i><sub>bal</sub>)<sup>2</sup>+(<i>a*</i><sub>aim</sub><i>−a*</i><sub>bal</sub>)<sup>2</sup>{(<i>b*</i><sub>aim</sub><i>−b*</i><sub>bal</sub>)<sup>2</sup>)}{square root over ((<i>L*</i><sub>aim</sub><i>−L*</i><sub>bal</sub>)<sup>2</sup>+(<i>a*</i><sub>aim</sub><i>−a*</i><sub>bal</sub>)<sup>2</sup>{(<i>b*</i><sub>aim</sub><i>−b*</i><sub>bal</sub>)<sup>2</sup>)}{square root over ((<i>L*</i><sub>aim</sub><i>−L*</i><sub>bal</sub>)<sup>2</sup>+(<i>a*</i><sub>aim</sub><i>−a*</i><sub>bal</sub>)<sup>2</sup>{(<i>b*</i><sub>aim</sub><i>−b*</i><sub>bal</sub>)<sup>2</sup>)}<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where L*<sub>aim</sub>, a*<sub>aim </sub>and b*<sub>aim </sub>are the CIELAB coordinates for the aim color values <b>215</b> and L*<sub>bal</sub>, a*<sub>bal </sub>and b*<sub>bal </sub>are the CIELAB coordinates for the balanced color values <b>270</b>. Other uniform color difference metrics such as the well-known CIE ΔE*<sub>94 </sub>can also be used. Similarly, color differences can also be determined between color values expressed in terms of a color appearance space such as CIECAM2000.
</p>
<p id="p-0052" num="0051">The color errors for the various test patches and capture illuminants can be combined to determine a color error cost function. In a preferred embodiment of the present invention, the cost function is determined by averaging the patch color errors <b>280</b> across all of the patches and all of the capture illuminants.</p>
<p id="p-0053" num="0052">
<maths id="MATH-US-00002" num="00002">
<math overflow="scroll">
<mrow>
  <mrow>
    <mi>cos</mi>
    <mo>⁢</mo>
    <mstyle>
      <mspace width="0.6em" height="0.6ex"/>
    </mstyle>
    <mo>⁢</mo>
    <mi>t</mi>
  </mrow>
  <mo>=</mo>
  <mrow>
    <mfrac>
      <mn>1</mn>
      <mrow>
        <msub>
          <mi>N</mi>
          <mi>P</mi>
        </msub>
        <mo>⁢</mo>
        <msub>
          <mi>N</mi>
          <mi>I</mi>
        </msub>
      </mrow>
    </mfrac>
    <mo>⁢</mo>
    <mrow>
      <munderover>
        <mo>∑</mo>
        <mrow>
          <mi>i</mi>
          <mo>=</mo>
          <mn>1</mn>
        </mrow>
        <msub>
          <mi>N</mi>
          <mi>P</mi>
        </msub>
      </munderover>
      <mo>⁢</mo>
      <mrow>
        <munderover>
          <mo>∑</mo>
          <mrow>
            <mi>j</mi>
            <mo>=</mo>
            <mn>1</mn>
          </mrow>
          <msub>
            <mi>N</mi>
            <mi>I</mi>
          </msub>
        </munderover>
        <mo>⁢</mo>
        <mrow>
          <mi>Δ</mi>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.3em" height="0.3ex"/>
          </mstyle>
          <mo>⁢</mo>
          <msubsup>
            <mi>E</mi>
            <mrow>
              <mi>i</mi>
              <mo>,</mo>
              <mi>j</mi>
            </mrow>
            <mo>*</mo>
          </msubsup>
        </mrow>
      </mrow>
    </mrow>
  </mrow>
</mrow>
</math>
</maths>
<br/>
where ΔE*<sub>i,j </sub>is the patch color error for the i<sup>th </sup>test patch and the j<sup>th </sup>capture illuminant, N<sub>P </sub>is the number of test patches, and N<sub>I </sub>is the number of capture illuminants. Variations of this basic cost function would include weighting color patches for more important colors more heavily than for other colors and/or weighting the color errors for more important capture illuminants more heavily than for other capture illuminants. For example, it might be desirable to weight color errors for skin tones more heavily since those colors are more important to human observers. Similarly, it might be desirable to weight the most common capture illuminants more heavily than less common capture illuminants. It will be obvious to one skilled in the art that many different forms of cost functions can also be used in accordance for the present invention. For example, it might be desirable to weight hue errors more heavily than lightness errors, or it might be desirable to combine the patch color errors using other methods besides simple arithmetic means.
</p>
<p id="p-0054" num="0053">Finally, an adjust color space balancing primaries to minimize color balance errors step <b>285</b> is used to determine an optimal set of balancing color space primaries <b>290</b>. In a preferred embodiment of the present invention this is done by finding the set of balancing color space primaries <b>290</b> that minimize the color error cost function. There are many nonlinear optimization techniques that are well-known in the art for minimizing cost functions such as those described herein. Many of these techniques involve iteratively adjusting the chromaticities of the balancing color space primaries <b>290</b> and evaluating the cost function to determine which adjustments reduce the value of the cost function. The iteration process is repeated until the minimum cost function value is identified. An example of such a nonlinear optimization technique is the well-known Levenberg-Marquardt algorithm.</p>
<p id="p-0055" num="0054">It may be useful to incorporate a number of constraints into the nonlinear optimization process. For example, it may be desirable to constrain the positions of the balancing color space primaries <b>290</b> so that they are spread widely enough to encompass a set of important scene colors so as not to cause any substantial color gamut limitations on input digital color images when they are converted to the balancing color space. It may also be desirable to constrain the positions of the balancing color space primaries <b>290</b> so that the chromaticity coordinates are within certain ranges (e.g., 0&lt;x&lt;1 and 0&lt;y&lt;1).</p>
<p id="p-0056" num="0055">The cost function minimization technique described herein was used to determine optimal balancing color space primaries for a typical photographic application. For this example, a set of several hundred real-world object reflectance spectra were used for test patch reflectance spectra <b>200</b>. CIE Illuminant D50 was used for the reference illuminant spectra <b>205</b>. A number of different sets of capture illuminant spectra <b>220</b> were evaluated, including daylight, blackbody and fluorescent illuminants. A Levenberg-Marquardt nonlinear optimization algorithm was used to identify the optimal set of balancing color space primaries <b>290</b>, by minimizing a color error cost function comprising the average color error for the set of test patches expressed in terms of CIE ΔE*<sub>ab</sub>.</p>
<p id="p-0057" num="0056">The following table shows the resulting CIE x-y chromaticity coordinates for the optimal balancing color space primaries <b>290</b> corresponding to several different sets of common capture illuminant spectra <b>220</b>. This set of illuminants spans a range of illuminants that are likely to be encountered in conventional photography. The set of balancing color space primaries corresponding to the pooled results for all of the illuminant sets shown in the table should perform well for most general photography applications. The chromaticity coordinate ranges indicated in the table would be representative of those that would be expected for the optimized sets of balancing color space primaries <b>290</b> given the types of capture illuminants and the cost function used for this example. However, the values can vary beyond these ranges depending on the particular set of illuminants that were included in the set, as well as the set of test patches and exact form of the cost function and optimization constraints.</p>
<p id="p-0058" num="0057">
<tables id="TABLE-US-00001" num="00001">
<table frame="none" colsep="0" rowsep="0" pgwide="1">
<tgroup align="left" colsep="0" rowsep="0" cols="4">
<colspec colname="offset" colwidth="70pt" align="left"/>
<colspec colname="1" colwidth="84pt" align="center"/>
<colspec colname="2" colwidth="84pt" align="center"/>
<colspec colname="3" colwidth="84pt" align="center"/>
<tbody valign="top">
<row>
<entry/>
<entry namest="offset" nameend="3" align="center" rowsep="1"/>
</row>
<row>
<entry/>
<entry>Primary 1</entry>
<entry>Primary 2</entry>
<entry>Primary 3</entry>
</row>
</tbody>
</tgroup>
<tgroup align="left" colsep="0" rowsep="0" cols="7">
<colspec colname="1" colwidth="70pt" align="center"/>
<colspec colname="2" colwidth="42pt" align="center"/>
<colspec colname="3" colwidth="42pt" align="center"/>
<colspec colname="4" colwidth="42pt" align="center"/>
<colspec colname="5" colwidth="42pt" align="center"/>
<colspec colname="6" colwidth="42pt" align="center"/>
<colspec colname="7" colwidth="42pt" align="center"/>
<tbody valign="top">
<row>
<entry>Capture Illuminants</entry>
<entry>x</entry>
<entry>y</entry>
<entry>x</entry>
<entry>y</entry>
<entry>x</entry>
<entry>y</entry>
</row>
<row>
<entry namest="1" nameend="7" align="center" rowsep="1"/>
</row>
<row>
<entry>CIE Standard Daylight</entry>
<entry>0.667</entry>
<entry>0.333</entry>
<entry>0.225</entry>
<entry>0.727</entry>
<entry>0.115</entry>
<entry>0.020</entry>
</row>
<row>
<entry>(4,000 K-9,000 K)</entry>
</row>
<row>
<entry>CIE Standard Daylight</entry>
<entry>0.659</entry>
<entry>0.341</entry>
<entry>0.229</entry>
<entry>0.720</entry>
<entry>0.113</entry>
<entry>0.019</entry>
</row>
<row>
<entry>(4,000 K-18,000 K)</entry>
</row>
<row>
<entry>Blackbody Radiators</entry>
<entry>0.681</entry>
<entry>0.320</entry>
<entry>0.248</entry>
<entry>0.713</entry>
<entry>0.112</entry>
<entry>0.045</entry>
</row>
<row>
<entry>(2,000 K-4,500 K)</entry>
</row>
<row>
<entry>Pooled Results for All</entry>
<entry>0.67 ± 0.03</entry>
<entry>0.33 ± 0.03</entry>
<entry>0.23 ± 0.03</entry>
<entry>0.72 ± 0.02</entry>
<entry>0.11 ± 0.01</entry>
<entry>0.03 ± 0.03</entry>
</row>
<row>
<entry>Illuminant Sets</entry>
</row>
<row>
<entry namest="1" nameend="7" align="center" rowsep="1"/>
</row>
</tbody>
</tgroup>
</table>
</tables>
</p>
<p id="p-0059" num="0058">The resulting color errors can be calculated for these pooled optimized balancing color space primaries <b>290</b> using the same method and set of test patches that were discussed above with reference to <figref idref="DRAWINGS">FIGS. 1 and 2</figref>. In this case, the RMS ΔE*<sub>ab </sub>color error is found to be 5.37, which is significantly improved relative to the prior art color space primaries. <figref idref="DRAWINGS">FIG. 5</figref> is a CIELAB a*-b* plot showing the color errors for each of the test patches in the set. It can be seen that the magnitude of the color errors is much smaller than those found in <figref idref="DRAWINGS">FIGS. 1 and 2</figref>.</p>
<p id="p-0060" num="0059">In some cases, it might be desirable to use a set of capture illuminants optimized for particular applications. For example, the following table shows the optimized primaries that would correspond to a range of different fluorescent capture illuminants.</p>
<p id="p-0061" num="0060">
<tables id="TABLE-US-00002" num="00002">
<table frame="none" colsep="0" rowsep="0">
<tgroup align="left" colsep="0" rowsep="0" cols="4">
<colspec colname="offset" colwidth="77pt" align="left"/>
<colspec colname="1" colwidth="49pt" align="center"/>
<colspec colname="2" colwidth="49pt" align="center"/>
<colspec colname="3" colwidth="42pt" align="center"/>
<tbody valign="top">
<row>
<entry/>
<entry namest="offset" nameend="3" align="center" rowsep="1"/>
</row>
<row>
<entry/>
<entry>Primary 1</entry>
<entry>Primary 2</entry>
<entry>Primary 3</entry>
</row>
</tbody>
</tgroup>
<tgroup align="left" colsep="0" rowsep="0" cols="7">
<colspec colname="1" colwidth="77pt" align="left"/>
<colspec colname="2" colwidth="21pt" align="center"/>
<colspec colname="3" colwidth="28pt" align="center"/>
<colspec colname="4" colwidth="21pt" align="center"/>
<colspec colname="5" colwidth="28pt" align="center"/>
<colspec colname="6" colwidth="21pt" align="center"/>
<colspec colname="7" colwidth="21pt" align="center"/>
<tbody valign="top">
<row>
<entry>Capture Illuminants</entry>
<entry>x</entry>
<entry>y</entry>
<entry>x</entry>
<entry>y</entry>
<entry>x</entry>
<entry>y</entry>
</row>
<row>
<entry namest="1" nameend="7" align="center" rowsep="1"/>
</row>
<row>
<entry>Standard Fluorescent</entry>
<entry>0.663</entry>
<entry>0.330</entry>
<entry>0.323</entry>
<entry>0.677</entry>
<entry>0.103</entry>
<entry>0.094</entry>
</row>
<row>
<entry>Illuminants (F2-F12)</entry>
</row>
<row>
<entry namest="1" nameend="7" align="center" rowsep="1"/>
</row>
</tbody>
</tgroup>
</table>
</tables>
</p>
<p id="p-0062" num="0061">The method of the present invention can be applied in many different applications. For example, it can be built into a digital camera system. In this case, the input digital color image captured in the device-dependent sensor color space can be transformed to the balancing color space, where the color balance correction is applied. The balanced digital color image can then be transformed to an output color space such as sRGB. These operations can either be applied inside the digital camera so that the output of the digital camera is a properly balanced image, or alternatively, the balancing operations can be applied in a host computer that accepts unbalanced images from the digital camera.</p>
<p id="p-0063" num="0062">The method of the present invention is also appropriate for use in digital photofinishing systems. The source of images in such systems can be conventional photographic negatives that are scanned to produce input digital color images. Alternatively, images can come into such systems from sources such as scans of photographic prints or slides, or from digital cameras. Digital photofinishing systems typically produce prints on digital printing devices, although they can also produce digital images appropriate for storing on a computer readable storage medium. The computer readable storage medium can comprise, for example; magnetic storage media such as magnetic disc (such as a floppy disc) or magnetic tape; optical storage media such as optical disk, optical tape, or machine readable bar code; solid state electronic storage devices such as random access memory (RAM), or read only memory (ROM); or any other physical device or medium employed to store digital images.</p>
<p id="p-0064" num="0063">A computer program product having a computer readable storage medium can have a computer program stored thereon for performing all the steps of the present invention. The computer readable storage medium can comprise any physical device or medium employed to store a computer program including the examples mentioned earlier.</p>
<p id="p-0065" num="0064">The invention has been described in detail with particular reference to certain preferred embodiments thereof, but it will be understood that variations and modifications can be effected within the spirit and scope of the invention.</p>
<heading id="h-0006" level="1">PARTS LIST</heading>
<p id="p-0066" num="0000">
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0065"><b>100</b> input digital color image in an input color space</li>
    <li id="ul0001-0002" num="0066"><b>105</b> transform to balancing color space step</li>
    <li id="ul0001-0003" num="0067"><b>110</b> input digital color image in the balancing color space</li>
    <li id="ul0001-0004" num="0068"><b>115</b> correct color balance of digital image step</li>
    <li id="ul0001-0005" num="0069"><b>120</b> balanced digital color image in the balancing color space</li>
    <li id="ul0001-0006" num="0070"><b>125</b> transform to output color space step</li>
    <li id="ul0001-0007" num="0071"><b>130</b> balanced digital color image in an output color space</li>
    <li id="ul0001-0008" num="0072"><b>200</b> test patch reflectance spectra</li>
    <li id="ul0001-0009" num="0073"><b>205</b> reference illuminant spectrum</li>
    <li id="ul0001-0010" num="0074"><b>210</b> compute aim color values step</li>
    <li id="ul0001-0011" num="0075"><b>215</b> aim color values</li>
    <li id="ul0001-0012" num="0076"><b>220</b> capture illuminant spectra</li>
    <li id="ul0001-0013" num="0077"><b>225</b> compute unbalanced color values step</li>
    <li id="ul0001-0014" num="0078"><b>230</b> unbalanced color values</li>
    <li id="ul0001-0015" num="0079"><b>240</b> transform to balancing color space step</li>
    <li id="ul0001-0016" num="0080"><b>250</b> unbalanced color values in the balancing color space</li>
    <li id="ul0001-0017" num="0081"><b>255</b> apply balance correction to color values step</li>
    <li id="ul0001-0018" num="0082"><b>260</b> balanced color values in the balancing color space</li>
    <li id="ul0001-0019" num="0083"><b>265</b> compute balanced color values step</li>
    <li id="ul0001-0020" num="0084"><b>270</b> balanced color values</li>
    <li id="ul0001-0021" num="0085"><b>275</b> compute patch color errors step</li>
    <li id="ul0001-0022" num="0086"><b>280</b> patch color errors</li>
    <li id="ul0001-0023" num="0087"><b>285</b> adjust color space balancing primaries to minimize color balance errors step</li>
    <li id="ul0001-0024" num="0088"><b>290</b> balancing color space primaries</li>
</ul>
</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-math idrefs="MATH-US-00001 MATH-US-00001-2 MATH-US-00001-3" nb-file="US07298892-20071120-M00001.NB">
<img id="EMI-M00001" he="22.27mm" wi="76.20mm" file="US07298892-20071120-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00002" nb-file="US07298892-20071120-M00002.NB">
<img id="EMI-M00002" he="9.14mm" wi="76.20mm" file="US07298892-20071120-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method for correcting the color balance of an input digital color image in an input color space captured under a capture illuminant to produce a balanced digital color image comprising the steps of:
<claim-text>a) choosing three color space primaries for a balancing color space so that reduced color errors can be produced when correcting the color balance in the balancing color space for a set of one or more capture illuminants relative to aim colors that would be produced if the digital color image were captured under reference conditions;</claim-text>
<claim-text>b) transforming the input digital color image to the balancing color space, wherein the balancing color space has three color channels corresponding to the three color space primaries; and</claim-text>
<claim-text>c) correcting the color balance of the input digital color image in the balancing color space to produce a balanced digital color image having reduced color errors relative to aim colors that would be produced if the digital color image were captured under reference conditions.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the set of capture illuminants is a set of illuminants that would typically encountered in photographic scenes.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the set of capture illuminants includes one or more daylight illuminants of various color temperatures.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the set of capture illuminants includes one or more tungsten illuminants of various color temperatures.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the set of capture illuminants includes one or more blackbody illuminants of various color temperatures.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the set of capture illuminants includes one or more fluorescent illuminants of various color temperatures.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the set of capture illuminants includes one or more electronic flash illuminants.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the set of capture illuminants includes one or more illuminants corresponding to underwater illumination where an illuminant spectrum has been modified by the spectral transmittance of water.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the color space primaries producing reduced color errors are determined by minimizing a cost function.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The method of <claim-ref idref="CLM-00009">claim 9</claim-ref> wherein the cost function is the average color errors for a set of test color patches captured with the set of capture illuminants.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref> wherein the color patches for more important colors are weighted more heavily than for other colors.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref> wherein the color errors for more important capture illuminants are weighted more heavily than for other capture illuminants.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the cost function is minimized using a nonlinear optimization process.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the input color space corresponds to the capture color space of an image capture device.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the input color space corresponds to the capture color space for a photographic film.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the color errors are computed by determining color differences in an approximately visually uniform color space.</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The method of <claim-ref idref="CLM-00015">claim 15</claim-ref> wherein the color differences are determined in the CIELAB color space.</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the color errors are computed using a uniform color difference metric.</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The method of <claim-ref idref="CLM-00018">claim 18</claim-ref> wherein the uniform color difference metric is ΔE*<sub>94</sub>.</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the balancing color space is an additive RGB color space having a matrix relationship with CIE XYZ tristimulus values.</claim-text>
</claim>
<claim id="CLM-00021" num="00021">
<claim-text>21. The method of <claim-ref idref="CLM-00020">claim 20</claim-ref> wherein a additive RGB color space further includes a nonlinear encoding function that is applied to each color channel of the balancing color space.</claim-text>
</claim>
<claim id="CLM-00022" num="00022">
<claim-text>22. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein step b) includes applying multiplicative color balance scale factors to each of the color channels of the input digital color image in the balancing color space to form the balanced digital color image.</claim-text>
</claim>
<claim id="CLM-00023" num="00023">
<claim-text>23. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein step b) includes adding color balance offset values to each of the color channels of the input digital color image in the balancing color space to form the balanced digital color image.</claim-text>
</claim>
<claim id="CLM-00024" num="00024">
<claim-text>24. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein step b) further includes the step of applying an automatic color balance estimation algorithm to the input digital image to estimate the required color balance correction.</claim-text>
</claim>
<claim id="CLM-00025" num="00025">
<claim-text>25. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein step b) further includes a user interface that enables a user to specify a desired color balance correction.</claim-text>
</claim>
<claim id="CLM-00026" num="00026">
<claim-text>26. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein step b) further includes the step of using information about the scene illumination to estimate the required color balance correction.</claim-text>
</claim>
<claim id="CLM-00027" num="00027">
<claim-text>27. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the color space primaries are selected so as not to cause any substantial color gamut limitations on the input digital color image in the balancing color space.</claim-text>
</claim>
<claim id="CLM-00028" num="00028">
<claim-text>28. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further including the step of transforming the balanced digital color image in the balancing color space back to the input color space to produce a balanced digital image in the input color space.</claim-text>
</claim>
<claim id="CLM-00029" num="00029">
<claim-text>29. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further including the step of transforming the balanced digital color image in the balancing color space to an output color space to produce a balanced digital image in the output color space.</claim-text>
</claim>
<claim id="CLM-00030" num="00030">
<claim-text>30. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the color space primaries are chosen subject to one or more constraints.</claim-text>
</claim>
<claim id="CLM-00031" num="00031">
<claim-text>31. The method of <claim-ref idref="CLM-00030">claim 30</claim-ref> wherein the color space primaries are constrained to encompass a set of important colors.</claim-text>
</claim>
<claim id="CLM-00032" num="00032">
<claim-text>32. The method of <claim-ref idref="CLM-00030">claim 30</claim-ref> wherein chromaticity coordinates for the color space primaries are constrained to be within a specified range.</claim-text>
</claim>
<claim id="CLM-00033" num="00033">
<claim-text>33. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the input digital color image is an image captured using a digital camera.</claim-text>
</claim>
<claim id="CLM-00034" num="00034">
<claim-text>34. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the input digital color image is an image captured by scanning a photographic negative.</claim-text>
</claim>
<claim id="CLM-00035" num="00035">
<claim-text>35. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the input digital color image is an image captured by scanning a photographic print.</claim-text>
</claim>
<claim id="CLM-00036" num="00036">
<claim-text>36. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the input digital color image is an image captured by scanning a photographic transparency.</claim-text>
</claim>
<claim id="CLM-00037" num="00037">
<claim-text>37. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the input digital color image is an image captured using a video camera.</claim-text>
</claim>
<claim id="CLM-00038" num="00038">
<claim-text>38. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> further including the step of printing the balanced digital color image on a digital printing device.</claim-text>
</claim>
<claim id="CLM-00039" num="00039">
<claim-text>39. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> further including the step of storing the balanced digital color image on a computer readable storage medium.</claim-text>
</claim>
<claim id="CLM-00040" num="00040">
<claim-text>40. A digital photofinishing system for producing prints of input images on a digital printing device wherein the method of <claim-ref idref="CLM-00001">claim 1</claim-ref> is used to correct the color balance of the input images.</claim-text>
</claim>
<claim id="CLM-00041" num="00041">
<claim-text>41. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the color errors are minimized relative to aim color values corresponding to the CIE colorimetry of input colors captured with a reference illuminant.</claim-text>
</claim>
<claim id="CLM-00042" num="00042">
<claim-text>42. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the color errors are minimized relative to aim color values corresponding to the CIE colorimetry of input colors captured with the capture illuminant and then chromatically adapted to a reference illuminant.</claim-text>
</claim>
<claim id="CLM-00043" num="00043">
<claim-text>43. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the color errors are minimized relative to aim color values corresponding to color values captured under a reference illuminant using a reference image capture device having a specified set of spectral sensitivities.</claim-text>
</claim>
<claim id="CLM-00044" num="00044">
<claim-text>44. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the color errors are minimized relative to aim color values expressed in terms of a color appearance metric for input colors captured with a reference illuminant.</claim-text>
</claim>
<claim id="CLM-00045" num="00045">
<claim-text>45. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the balancing color space producing reduced color errors has a first color space primary with CIE x-y chromaticity values of (0.67±0.03, 0 33±0.03), a second color space primary with CIE x-y chromaticity values of (0.23±0.03, 0.72±0.02) and a third color space primary with CIE x-y chromaticity values of (0.11±0.01, 0.03±0.03).</claim-text>
</claim>
<claim id="CLM-00046" num="00046">
<claim-text>46. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further including a user-specified color balance adjustment.</claim-text>
</claim>
<claim id="CLM-00047" num="00047">
<claim-text>47. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the color balance correction is used to correct for other sources of color balance error in addition to capture illuminant variability.</claim-text>
</claim>
<claim id="CLM-00048" num="00048">
<claim-text>48. A computer program product, comprising a computer readable storage medium having therein a program for practicing the method of <claim-ref idref="CLM-00001">claim 1</claim-ref>.</claim-text>
</claim>
</claims>
</us-patent-grant>
