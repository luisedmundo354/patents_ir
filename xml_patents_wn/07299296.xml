<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07299296-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07299296</doc-number>
<kind>B1</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>10246244</doc-number>
<date>20020918</date>
</document-id>
</application-reference>
<us-application-series-code>10</us-application-series-code>
<us-term-of-grant>
<us-term-extension>797</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>15</main-group>
<subgroup>173</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>709238</main-classification>
<further-classification>370231</further-classification>
<further-classification>370389</further-classification>
</classification-national>
<invention-title id="d0e53">Filtering data flows based on associated forwarding tables</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>6341130</doc-number>
<kind>B1</kind>
<name>Lakshman et al.</name>
<date>20020100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370389</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>6594268</doc-number>
<kind>B1</kind>
<name>Aukia et al.</name>
<date>20030700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370400</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6754729</doc-number>
<kind>B1</kind>
<name>Hass et al.</name>
<date>20040600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710 14</main-classification></classification-national>
</citation>
<citation>
<nplcit num="00004">
<othercit>U.S. Appl. No. 10/080,865, entitled “Distributed Filtering for Networks”, filed Feb. 21, 2002, Ross Callon.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00005">
<othercit>U.S. Appl. No. 10/235,455, entitled “Systems and Methods for Identifying Sources of Network Attacks”, filed Sep. 5, 2002, Ben Eater, Rob Jaeger.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>22</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>709238</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370400</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370231-235</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>5</number-of-drawing-sheets>
<number-of-figures>5</number-of-figures>
</figures>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Lo</last-name>
<first-name>Jeffrey Y</first-name>
<address>
<city>Palo Alto</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Mackie</last-name>
<first-name>Scott</first-name>
<address>
<city>Santa Cruz</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Shumaker &amp; Sieffert, P.A.</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Juniper Networks, Inc.</orgname>
<role>02</role>
<address>
<city>Sunnyvale</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Dalencourt</last-name>
<first-name>Yves</first-name>
<department>2157</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">Techniques are described for selectively filtering data, such as network packets, that correspond to forwarding tables. For example, a router receives packets from an input interface of an interface card (IFC). The router applies one or more input interface filters associated with the input interface that received the packet. The router selectively associates the packet with a forwarding table, applies a corresponding forwarding filter, and determines the output interface corresponding to the next hop of the packet. The router may further apply one or more output interface filters associated with the output interface, and forwards the packet in accordance with the respective forwarding information.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="243.33mm" wi="186.10mm" file="US07299296-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="229.45mm" wi="185.17mm" file="US07299296-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="227.84mm" wi="116.08mm" orientation="landscape" file="US07299296-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="216.75mm" wi="183.39mm" file="US07299296-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="245.53mm" wi="188.30mm" file="US07299296-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="234.95mm" wi="188.38mm" orientation="landscape" file="US07299296-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">TECHNICAL FIELD</heading>
<p id="p-0002" num="0001">The invention relates to computer networks and, more particularly, to techniques for filtering data within computer networks.</p>
<heading id="h-0002" level="1">BACKGROUND</heading>
<p id="p-0003" num="0002">A computer network is a collection of interconnected computing devices that exchange data and share resources. In a packet-based network, such as the Internet, the computing devices communicate data by dividing the data into small blocks called packets. The packets are individually routed across the network from a source device to a destination device. The destination device extracts the data from the packets and assembles the data into its original form. Dividing the data into packets enables the source device to resend only those individual packets that may be lost during transmission.</p>
<p id="p-0004" num="0003">Certain devices within the network, such as routers, maintain routing information that describes routes through the network. Each route defines a path between two locations on the network. From the routing information, the routers may generate forwarding information, which is used by the routers to relay packet flows through the network and, more particularly to relay the packet flows to a next hop. In reference to forwarding a packet, the “next hop” from a network router typically refers to a neighboring device along a given route. Conventional routers often maintain the forwarding information in the form of one or more forwarding tables. Upon receiving an incoming packet, the router examines information within the packet to identify the destination for the packet. Based on the destination, the router forwards the packet in accordance with one of the forwarding tables.</p>
<p id="p-0005" num="0004">The routers may further apply packet filters to packet flows through the routers. For example, the router may compare header information within the packet to a set of filtering rules, sometimes referred to as “terms”. The filtering rules may specify, for example, particular source IP address, destination IP addresses, and other criteria for filtering packets. Specifically, the router identify packets from the packet flows that match the filtering rules, and perform an associated action on the packet depending on which filtering rule the packet matched. The action may include dropping the packet, remarking the packet as lower priority, counting packets that match the filtering rule, and the like. For example, the router drop packets having a source IP address of a device sourcing a denial of service (DoS) attack by applying a filtering rule for the source IP address dropping any packets matching the filter rule Conventional routers typically apply the filters to packet flows based on the interfaces from with the flows are received, i.e., on an interface-by-interface basis. For instance, the router may apply an interface-specific filter to each of the packet flows received by a given interface. Alternatively, the routers may apply a single packet filter to all packet flows regardless of the interface from which the packet.</p>
<heading id="h-0003" level="1">SUMMARY</heading>
<p id="p-0006" num="0005">In general, the invention is directed to techniques for selectively applying filters to packets depending on the forwarding tables used by the router to forward the packets. A router, for example, may receive packets from multiple customer site networks via multiple interfaces, and apply a “forwarding filter” to the packets. Accordingly, as referred to herein, a forwarding filter refers to a filter applied by the router to packet flows that are forwarded to the network in accordance with a forwarding table.</p>
<p id="p-0007" num="0006">More specifically, the router maintains a set of forwarding filters, and may associate each filter with a forwarding table. The router applies the forwarding filter to compare, for example, header information of packets with a set of defined filtering rules. When a packet matches one of the filtering rules, the router performs an associated action to the matching packet. The action associated with the filtering rule, sometimes referred to as an “action modifier”, may include dropping the packet, counting the packet in order to maintain traffic statistics, sampling the traffic for traffic profiling, remarking the packet with a lower priority, and relaying the packet to an alternate forwarding table. When a packet does not match any of the filtering rules, the router forwards the packet to a public network in accordance with the respective forwarding table. In this manner, the router may filter the packet flows of multiple customer site networks, for example, with a common forwarding filter.</p>
<p id="p-0008" num="0007">The router may support multi-level filtering in that, in addition to application of the forwarding filters, the router may apply input and output interface filters to the packets. For example, the router may apply a first input interface filter to a packet flow received from a first interface, and a second input interface filter to a packet flow received from a second interface. The router may then apply a common forwarding filter to the packet flows, and may also apply one or more output interface filters to the packet flows before forwarding the packets via output interfaces.</p>
<p id="p-0009" num="0008">In one embodiment, a method comprises receiving a data unit. The method further comprises identifying a forwarding table based on the data unit. The method also includes selectively applying a forwarding filter to the data unit based on the identified forwarding table.</p>
<p id="p-0010" num="0009">In another embodiment, a network device comprises an input interface. The network device further comprises a forwarding table corresponding to the input interface. The network device also includes a forwarding filter associated with the forwarding table to filter the data unit received from the corresponding input interface for the forwarding table.</p>
<p id="p-0011" num="0010">In another embodiment, a computer-readable medium comprises a forwarding table to control a forwarding engine of a network device. The computer-readable medium further comprises a forwarding filter associated with the forwarding table to filter data units received by the network device.</p>
<p id="p-0012" num="0011">In another embodiment, a method comprises forwarding a data unit in accordance with a forwarding table. The method further comprises filtering the data unit with a forwarding filter based on the forwarding table.</p>
<p id="p-0013" num="0012">In another embodiment, a computer-readable medium comprises instructions that cause a processor to receive a data unit, and identify a forwarding table based on the data unit. The computer-readable medium further comprises instructions that cause the processor to filter the data unit with a forwarding filter associated with the forwarding table.</p>
<p id="p-0014" num="0013">In another embodiment, a network device comprises a forwarding table having respective a forwarding filter. The network device further comprises a control unit to receive a data unit and forward the data unit in accordance with the forwarding table, wherein the control unit applies the forwarding filter to the data unit based on the forwarding table.</p>
<p id="p-0015" num="0014">The invention may provide one or more advantages. The described techniques may, for example, simplify the management of packet filters within a router. An administrator may configure the forwarding filters of the router to include filtering rules that are common to the packet flows of a corresponding forwarding table. When new filtering rules must be applied to the packet flows, the administrator may update the common forwarding filter as opposed to individually updating each of the interface filters associated with each of the packet flows. The described techniques may further allow for instantiation and destruction of interfaces without monitoring and adding interface filters. For instance, the router may instantiate a logical interface, and filter packet flows of the instantiated logical interface with an associated forwarding filter.</p>
<p id="p-0016" num="0015">The details of one or more embodiments of the invention are set forth in the accompanying drawings and the description below. Other features, objects, and advantages of the invention will be apparent from the description and drawings, and from the claims.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF DRAWINGS</heading>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram illustrating an example system in which routers filter packet flows associated with forwarding tables in accordance with the principles of the invention.</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 2</figref> is a block diagram illustrating the flow of packets through a router in accordance with the principles of the invention.</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 3</figref> is a block diagram illustrating an exemplary router that filters packet flows associated with forwarding tables in accordance with the principles of the invention.</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 4</figref> is a flow diagram illustrating an example method employed by a router to filter packet flows associated with forwarding tables.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 5</figref> is a block diagram illustrating another exemplary router that filters packet flows associated with forwarding tables.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram illustrating an example system <b>10</b> comprising routers <b>12</b>A-<b>12</b>B (“routers <b>12</b>”) that filter packet flows associated with forwarding tables in accordance with the principles of the invention. Routers <b>12</b> couple customer site networks <b>14</b>A-<b>14</b>B (“customer site networks <b>14</b>”) to a public network <b>16</b>. Public network <b>16</b> includes one or more autonomous systems (not shown) having a number of devices, such as routers and switches, used to forward packets across public network <b>16</b>.</p>
<p id="p-0023" num="0022">Customer site networks <b>14</b> may be geographically distributed sites of multiple customers. In the example of <figref idref="DRAWINGS">FIG. 1</figref>, customer site networks <b>14</b> include customer site networks for two customers: customer A and customer B. For example, customer A includes customer site networks <b>14</b>A′, <b>14</b>A″, and <b>14</b>A′″. Each of customer site networks <b>14</b> includes one or more devices (not shown), such as personal computers, laptop computers, handheld computers, workstations, servers, routers, switches, printers, fax machines, or the like. Customer site networks <b>14</b> may include one or more Local Area Networks (LANs), Wide Area Network (WANs), or the like. Although system <b>10</b> may include any number of customer site networks <b>14</b> coupled to public network <b>16</b> by any number of routers <b>12</b>, <figref idref="DRAWINGS">FIG. 1</figref>, for simplicity, shows only customer site networks <b>14</b> coupled to public network <b>16</b> by routers <b>12</b>. Each of customer site networks <b>14</b> connects to routers <b>12</b> via one or more access links <b>18</b>A-E (“access links <b>18</b>”).</p>
<p id="p-0024" num="0023">Customer site networks <b>14</b> may communicate with remote network devices within public network <b>16</b>. Further, customer site networks <b>14</b> may securely transmit packet flows between associated customers site networks <b>14</b> via corresponding virtual private networks (not shown). For example, customer A may securely transmit packet flows between customer site network <b>14</b>A′, customer site network <b>14</b>A ″, and customer site network <b>14</b>A′″ via an associated VPN and routers <b>12</b>.</p>
<p id="p-0025" num="0024">In general, routers <b>12</b> filter packet flows transmitted between customer site networks <b>14</b> and public network <b>16</b> in accordance with the invention. More specifically, routers <b>12</b> filter the packet flows based on forwarding tables used by routers <b>12</b> to forward the packet flows across public network <b>16</b>. Accordingly, as referred to herein, a “forwarding filter” refers to a filter applied by routers <b>12</b> to packet flows that are forwarded to public network <b>16</b> in accordance with a forwarding table.</p>
<p id="p-0026" num="0025">More specifically, using router <b>12</b>A as an example, router <b>12</b>A maintains a set of forwarding filters, and may associate the forwarding filters with a forwarding table. Router <b>12</b>A applies the forwarding filters to compare, for example, header information of the packets to a set of forwarding rules of the forwarding filter. When a packet of a packet flow matches one of the filtering rules, router <b>12</b>A performs an associated action on the matching packet. The action associated with the filtering rule, sometimes referred to as an “action modifier”, may include dropping the packet, counting the packet in order to maintain traffic statistics, sampling the traffic for traffic profiling, remarking the packet with a lower priority, and relaying the packet to an alternate forwarding table. When a packet of a packet flow does not match any of the filtering rules, router <b>12</b>A forwards the packet to public network <b>16</b> in accordance with the respective forwarding table. For example, router <b>12</b>A may apply a forwarding filter to reduce the volume of traffic through router <b>12</b>A. Router <b>12</b>A may apply a forwarding filter that has filtering rules and associated actions that discard packets with a low priority, while not affecting packets with a high priority. By applying the forwarding filter, the volume of traffic through router <b>12</b>A may decrease while high priority packets continue to be forwarded.</p>
<p id="p-0027" num="0026">Router <b>12</b>A may support multi-level filtering in that, in addition to application of the forwarding filters, router <b>12</b>A may apply input and output interface filters to the packets. For example, router <b>12</b>A may apply a first input interface filter to a packet flow received from a first interface, and a second input interface filter to a packet flow received from a second interface. Router <b>12</b>A may then apply a common forwarding filter to the packet flows, and may also apply one or more output interface filters to the packet flows before forwarding the packets via output interfaces.</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 2</figref> is a block diagram illustrating the flow of packets through one of routers <b>12</b>, such as router <b>12</b>A. Router <b>12</b>A receives packet flows <b>20</b>A-<b>20</b>C (“packet flows <b>20</b>”), and selectively applies input interface filters <b>22</b>A-<b>22</b>B (“interface filters <b>22</b>”) to packet flows <b>20</b>. In the illustrated example of <figref idref="DRAWINGS">FIG. 2</figref>, router <b>12</b>A applies input interface filter <b>22</b>A to packet flow <b>20</b>A and input interface filter <b>22</b>B to packet flow <b>20</b>B. Router <b>12</b>A does not apply an input interface filter <b>22</b> to packet flow <b>20</b>C. Input interface filters <b>22</b> may include, for example, interface-specific filtering rules and associated actions, which router <b>12</b>A may apply to packet flows <b>20</b>.</p>
<p id="p-0029" num="0028">Router <b>12</b>A applies a forwarding filter <b>24</b> to packet flows <b>20</b> based on a forwarding table <b>26</b> used by router <b>12</b>A to forward the packets. Forwarding filter <b>24</b> includes forwarding table-specific filtering rules and associated actions that are applied to packet flows <b>20</b>. In this manner, router <b>12</b>A filters packets of packet flows <b>20</b> that correspond to forwarding table <b>26</b> with common forwarding rules.</p>
<p id="p-0030" num="0029">Router <b>12</b>A determines a next hop for packets of packet flows <b>20</b> from forwarding information <b>28</b>, which may associate network destinations with specific next hops. Router <b>12</b>A selectively applies an output interface filter <b>30</b> to packet flows <b>20</b>. For instance, router <b>12</b>A may apply an output interface filter <b>30</b> to packet flows destined for a particular next hop. In the example of <figref idref="DRAWINGS">FIG. 2</figref>, router <b>12</b>A applies output interface filter <b>30</b> to packet flows <b>20</b>A and <b>20</b>C, and does not apply an output interface filter <b>30</b> to packet flow <b>20</b>B. Although router <b>12</b>A may include any number input interfaces <b>22</b> and output interfaces <b>30</b> associated with any number of forwarding tables <b>26</b>, <figref idref="DRAWINGS">FIG. 1</figref>, for simplicity, shows only input interfaces <b>22</b> and output interface <b>30</b> associated with forwarding table <b>26</b>.</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 3</figref> is a block diagram illustrating an exemplary embodiment of router <b>12</b>A that filters packets in accordance with the principles of the invention. In particular, router <b>12</b>A selectively filters packet flows based on a respective one of forwarding tables <b>26</b>A-<b>26</b>N (“forwarding tables <b>26</b>”) that forwards the packet flows across public network <b>16</b>.</p>
<p id="p-0032" num="0031">Router <b>12</b>A includes interface cards <b>32</b>A-<b>32</b>M (“IFCs <b>32</b>”) that receive and send packet flows via network links <b>34</b> and <b>36</b>, respectively. IFCs <b>32</b> are typically coupled to network links <b>34</b>, <b>36</b> via a number of interface ports. An interface <b>38</b> may couple each of IFCs <b>32</b> to a control unit <b>40</b>. Each of interfaces <b>38</b> may correspond to one or more physical or logical interfaces. Each physical or logical interface may correspond to one or more packet flows.</p>
<p id="p-0033" num="0032">Control unit <b>40</b> maintains forwarding tables <b>26</b> that include forwarding information <b>28</b>A-<b>28</b>N (“forwarding information <b>28</b>”). Forwarding information <b>28</b> may associate, for example, network destinations with specific next hops and corresponding IFCs <b>32</b>. Control unit <b>40</b> may, for example, maintain a separate forwarding table <b>26</b> corresponding with different VPNs of different customers. Forwarding tables <b>26</b> may further include forwarding filters <b>24</b>A-<b>24</b>N (“forwarding filters <b>24</b>”). Forwarding tables <b>26</b> need not be tables. For example, forwarding tables <b>26</b> may be link lists, radix trees, databases, flat files, or any other data structures. Although in the example shown in <figref idref="DRAWINGS">FIG. 3</figref> all of forwarding tables <b>26</b> include a corresponding forwarding filters <b>24</b>, this need not be the case. For instance, router <b>12</b>A may forward packet flows across public network <b>16</b> without applying one of forwarding filters <b>24</b>.</p>
<p id="p-0034" num="0033">Control unit <b>34</b> may also maintain input interface filters <b>22</b>A-<b>22</b>K (“input interface filters <b>22</b>”), and output interface filters <b>30</b>A-<b>30</b>J (“output interface filters <b>30</b>”). Interface filters <b>22</b> and <b>30</b> include interface-specific filtering rules applied to packet flows. Interface filters <b>22</b> and <b>30</b> may correspond to logical interfaces and/or physical interfaces between control unit <b>40</b> and IFCs <b>32</b>. Interface filters <b>22</b> and <b>30</b> may further correspond to individual packet flows.</p>
<p id="p-0035" num="0034">Router <b>12</b>A may further include a chassis <b>44</b> for housing control unit <b>40</b>. Chassis <b>44</b> has a number of slots (not shown) for receiving a set of cards, including IFCs <b>32</b>. Each card may be inserted into a corresponding slot of chassis <b>44</b> for electrically coupling the card to control unit <b>40</b> via a bus, backplane, or other electrical communication mechanism.</p>
<p id="p-0036" num="0035">One of IFCs <b>32</b> receives a packet of a packet flow via a respective inbound network link <b>34</b>, and relays the packet to control unit <b>40</b> via interface <b>38</b>. IFCs <b>32</b> may receive the packet from one of customer site networks <b>14</b> or from public network <b>16</b>. Control unit <b>40</b> receives the packet from a respective one of IFCs <b>32</b>, and selectively applies input interface filters <b>22</b> to the packet. For instance, control unit <b>40</b> may apply one or more input interface filters <b>22</b> that correspond to the interface of IFCs <b>32</b> that received the packet. Control unit <b>40</b> may, alternatively, apply input interface filters <b>22</b> based on the particular packet flow of the packet.</p>
<p id="p-0037" num="0036">Control unit <b>40</b> further associates the packet with one of forwarding tables <b>26</b>. For example, control unit <b>40</b> may identify which interface of a respective one of IFCs <b>32</b> received the packet, and associate the packet with one of forwarding tables <b>26</b> based on the interface of IFC <b>32</b> that received the packet. Alternatively, control unit <b>40</b> may associate the packet with one of the forwarding tables <b>26</b> based on the packet flow to which the packet belongs. Control unit <b>40</b> may apply forwarding filters <b>24</b> associated with forwarding tables <b>26</b> to the packet. In this manner, router <b>12</b>A filters packets of packet flows that correspond to a particular one of forwarding tables <b>26</b> with one of forwarding filters <b>24</b>.</p>
<p id="p-0038" num="0037">Control unit <b>40</b> further identifies the next hop of the packet from forwarding information <b>28</b> of forwarding tables <b>26</b>, and selectively filters the packet based on the identified next hop. For example, the next hop may correspond with an output interface of one of IFCs <b>32</b> corresponding to one of customer site networks <b>14</b>. The output interface of IFCs <b>32</b> corresponding to the next hop of the packet may be associated with one or more of output interface filters <b>225</b>. Control unit <b>40</b> applies output interface filters <b>2230</b> associated with the output interface corresponding to the next hop, and forwards the packet to the next hop in accordance with forwarding information <b>28</b>.</p>
<p id="p-0039" num="0038">IFCs <b>32</b> may apply interface filters <b>22</b> and <b>30</b> instead of control unit <b>40</b>. For example, IFCs <b>32</b> may each maintain one or more interface filters <b>22</b> and <b>30</b>, or may access interface filters <b>22</b> and <b>30</b> stored in control unit <b>40</b>, and apply one or more of interface filters <b>22</b> and <b>30</b> to the packet flows through IFCs <b>32</b>.</p>
<p id="p-0040" num="0039">Router <b>12</b>A may further dynamically instantiate logical interfaces between control unit <b>40</b> and IFCs <b>32</b>, and associate the instantiated logical interfaces with a respective one of forwarding tables <b>26</b>. Router <b>12</b>A filters the packet flows of the instantiated logical interfaces with forwarding filters <b>24</b> associated with forwarding tables <b>26</b>. In this manner, associating the dynamically instantiated logical interfaces with respective forwarding tables <b>26</b> and, in turn, forwarding filters <b>24</b> allows for instantiation and destruction of interfaces without monitoring and adding interface filters <b>22</b> and <b>30</b>.</p>
<p id="p-0041" num="0040">Router <b>12</b>A may operate according to executable instructions fetched from a computer-readable medium. Examples of such media include random access memory (RAM), read-only memory (ROM), non-volatile random access memory (NVRAM), electrically erasable programmable read-only memory (EEPROM), flash memory, and the like. The functions of router <b>12</b>A may be implemented by executing the instructions of the computer-readable medium with one or more processors, discrete hardware circuitry, firmware, software executing on a programmable processor, or a combination of any of the above.</p>
<p id="p-0042" num="0041"><figref idref="DRAWINGS">FIG. 4</figref> is a flow diagram illustrating an example method employed by one of routers <b>12</b>, such as router <b>12</b>A, to filter packets in accordance with the principles of the invention. A client, such as a human user or an automated script application, configures input interface filters <b>22</b>, output interface filters <b>30</b> and forwarding filters <b>24</b> (<b>50</b>). For example, the client may configure forwarding filters <b>24</b> of router <b>12</b>A to filter certain network traffic as a matter of customer policy, and may configure interface filters <b>22</b> and <b>30</b> to limit the amount of bandwidth customers may use.</p>
<p id="p-0043" num="0042">Router <b>12</b>A receives a packet of a packet flow via one of IFCs <b>32</b>, and relays the packet to control unit <b>40</b> (<b>52</b>, <b>53</b>). Control unit <b>40</b> determines whether any of input interface filters <b>22</b> correspond to the packet flow to which the packet belongs (<b>54</b>). For example, control unit <b>40</b> may maintain a mapping that associates packet flows with respective input interface filters <b>22</b>. When at least one of input interface filters <b>22</b> corresponds to the packet flow, control unit <b>40</b> applies the corresponding one or more of input interface filters <b>22</b> to the packet (<b>56</b>). Control unit <b>40</b> compares packets of packet flows with filtering rules of the corresponding input interface filters <b>22</b> (<b>58</b>). For example, control unit <b>40</b> may compare header information of the packets, such as source IP address, destination IP address, port number, and protocol type, with the filtering rules to identify matches. Alternatively, router <b>12</b>A may compare information within the packet, e.g., within the payload of the packet, with the filtering rules to identify matches. When control unit <b>40</b> finds a match between the packet information and one of the filtering rules of input interface filters <b>22</b>, control unit <b>40</b> performs an associated action to the packet (<b>60</b>). Control unit <b>40</b> may, for example, increment a packet counter to maintain traffic statistics for a particular forwarding table. Alternatively, control unit <b>40</b> may discard the packet and notify the sending device that the packet was undeliverable, or discard the packet without notifying the sending device.</p>
<p id="p-0044" num="0043">When none of filtering rules of input interface filters <b>22</b> matches the packet information, control unit <b>40</b> associates the packet with one of forwarding tables <b>26</b> (<b>62</b>). For instance, control unit <b>40</b> may maintain a mapping that associates packet flows with forwarding tables <b>26</b>. Control unit <b>40</b> determines whether one of forwarding tables <b>26</b> that forwards the packet includes associated forwarding filters <b>24</b> (<b>63</b>). When one or more forwarding filters <b>24</b> are associated with the forwarding tables <b>26</b>, control unit <b>40</b> applies one or more forwarding filters <b>24</b> associated with forwarding tables <b>26</b> to the packet (<b>64</b>). Forwarding filters <b>24</b> includes filtering rules that control unit <b>40</b> compares with packet information, such as header information of the packets (<b>66</b>). When one of forwarding filters <b>24</b> identifies a match between the filtering rules and the packet information, control unit <b>40</b> performs an associated action on the packet (<b>60</b>).</p>
<p id="p-0045" num="0044">When forwarding filter <b>24</b> does not find a match between any of the filtering rules and the packet information or when none of forwarding filters <b>24</b> are associated with forwarding tables <b>26</b>, control unit <b>40</b> determines the next hop of the packet from forwarding information <b>28</b> of the associated forwarding table <b>26</b> (<b>68</b>). The output interface may be a physical or logical interface of one of IFCs <b>32</b>. Control unit <b>40</b> further determines whether any of output interface filters <b>30</b> correspond to the determined next hop or associated output interface (<b>70</b>). When none of output interface filters <b>22</b> correspond to the next hop or associated output interface, control unit <b>40</b> forwards the packet in accordance with forwarding information <b>28</b> associated with forwarding tables <b>26</b> (<b>72</b>).</p>
<p id="p-0046" num="0045">When one of output interface filters <b>30</b> corresponds to the output interface, control unit <b>40</b> applies the corresponding output interface filter <b>30</b> to the packet to identify any matches between the filtering rules of corresponding output interface filters <b>30</b> and packet information (<b>74</b>, <b>76</b>). When control unit <b>40</b> identifies a match, control unit <b>40</b> performs an associated action on the packet (<b>60</b>). When control unit <b>40</b> does not identify a match, control unit <b>40</b> forwards the packet in accordance with forwarding information <b>28</b> associated with forwarding table <b>26</b> (<b>72</b>).</p>
<p id="p-0047" num="0046"><figref idref="DRAWINGS">FIG. 5</figref> is a block diagram illustrating another exemplary router <b>112</b> that filters packet flows in accordance with the principles of the invention. Router <b>112</b> includes interface cards <b>132</b>A-<b>132</b>M (“IFCs <b>132</b>”) that receive and send packet flows via network links <b>134</b> and <b>136</b>, respectively. An interface <b>138</b> may couple each of IFCs <b>132</b> to a control unit <b>140</b>. In addition, router <b>112</b> may include service cards <b>133</b>A-<b>133</b>H (“service cards <b>133</b>”) that provide services to packet flows through router <b>112</b>. A number of input logical interfaces <b>129</b> and output logical interfaces <b>131</b> may couple service cards <b>133</b> to control unit <b>140</b>.</p>
<p id="p-0048" num="0047">Control unit <b>140</b> comprises a routing engine <b>135</b> and at least one forwarding engine <b>137</b>. Routing engine <b>135</b> is primarily responsible for maintaining routing information <b>141</b>, which describes the topology of a network. In particular, routing information <b>141</b> describes various routes within the network, and the appropriate next hops for each route, i.e., the neighboring devices of router <b>112</b> along each of the routes. Routing engine <b>135</b> periodically updates routing information <b>141</b> to accurately reflect the network topology.</p>
<p id="p-0049" num="0048">Routing engine <b>135</b> analyzes routing information <b>141</b> and generates forwarding tables <b>126</b>A-<b>126</b>N (“forwarding tables <b>126</b>”) for forwarding engine <b>137</b>. Forwarding tables <b>126</b> each include associated forwarding information <b>128</b>. Forwarding tables <b>126</b> may also include an associated forwarding filter <b>124</b>. Forwarding engine <b>137</b> further includes input interface filters <b>122</b>A-<b>122</b>K (“input interface filters <b>122</b>”) and output interface filters <b>130</b>A-<b>130</b>J (“output interface filters <b>130</b>”).</p>
<p id="p-0050" num="0049">As described in detail above, control unit <b>140</b> receives packet flows from an input interface of one of IFCs <b>132</b> or service cards <b>133</b>. Control unit <b>140</b> may apply one or more of input interface filters <b>122</b> associated with the input interface that received the packet. Control unit <b>140</b> selectively associates the packet with one of forwarding tables <b>126</b>, applies the corresponding forwarding filter <b>124</b>, and determines the next hop. Control unit <b>140</b> may apply output interface filters <b>130</b> associated with the next hop, or the output interface corresponding to the next hop. Control unit <b>134</b> forwards the packet in accordance with forwarding information <b>128</b> of the respective forwarding table <b>126</b>.</p>
<p id="p-0051" num="0050">In one embodiment, each of routing engine <b>135</b> and forwarding engine <b>137</b> may comprise one or more dedicated processors, hardware, and the like, and may be communicatively coupled by a data communication channel <b>147</b>. Data communication channel <b>147</b> may be a high-speed network connection, bus, shared-memory or other data communication mechanism. Routing engine <b>135</b>, forwarding engine <b>137</b>, or both, may make use of the data structures and organization described above.</p>
<p id="p-0052" num="0051">Various embodiments of the invention have been described. Although the embodiments have been described in terms of packet-based systems and methods, any data units may be used without departing from the principles of the invention. For example, the principles of the invention may be readily applied to a variety of protocols, such as the Transmission Control Protocol (TCP), the User Datagram Protocol (UDP), the Internet Protocol (IP), Asynchronous Transfer Mode (ATM), Frame Relay, and the like. Accordingly, “packet” is used to encompass any such unit of data, and may be interchanged with the term “cell,” or other similar terms used in such protocols to describe a unit of data communicated between resources within the network. These and other embodiments are within the scope of the following claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>The invention claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method of forwarding packets using a router having a plurality of input interfaces coupled to a centralized control unit, the method comprising:
<claim-text>maintaining, within the control unit, a plurality of forwarding tables that each associate a plurality of network destinations with next hops in a network;</claim-text>
<claim-text>maintaining, within the control unit, a plurality of sets of forwarding filters, wherein each of the sets of forwarding filters corresponds to a different one of the plurality of forwarding tables, and wherein each of the forwarding filters include at least one forwarding rule and an associated action;</claim-text>
<claim-text>receiving, with one of the plurality of input interfaces, a data unit from the network;</claim-text>
<claim-text>forwarding the data unit from the input interface that received the packet to the control unit;</claim-text>
<claim-text>selecting, with the control unit, one of the plurality of forwarding tables to be used by the control unit to forward the packet;</claim-text>
<claim-text>selectively applying to the data unit only the forwarding rules and associated actions of the forwarding filters of the set of forwarding filters that corresponds to the selected forwarding table; and</claim-text>
<claim-text>forwarding the data unit with the control unit to an output interface in accordance with the selected one of the plurality of forwarding tables maintained by the control unit.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein one or more of the plurality of forwarding tables corresponds to more than one of the plurality of input interfaces.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>identifying the output interface for the data unit based on the selected forwarding table; and</claim-text>
<claim-text>applying an output interface filter to the data unit based on the identified output interface.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>dynamically instantiating a logical interface between the input interface that received the data unit and the control unit;</claim-text>
<claim-text>associating the instantiated interface with a first forwarding table of the plurality of forwarding tables; and</claim-text>
<claim-text>filtering the data unit of the instantiated interface with a forwarding filter associated with the first forwarding table.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein selectively applying the forwarding filters comprises:
<claim-text>accepting the data unit based on an examination of header information; and</claim-text>
<claim-text>forwarding the accepted data unit.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein selectively applying the forwarding filters comprises:
<claim-text>rejecting the data unit based on an examination of header information; and</claim-text>
<claim-text>discarding the rejected data unit.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein each of the plurality of forwarding tables maintained by the control unit corresponds to one of a plurality of different customer virtual private networks (VPNs).</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein selecting one of the plurality of forwarding tables comprises selecting one of the plurality of forwarding tables based on the data unit.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein selecting one of the plurality of forwarding tables comprises selecting one of the plurality of forwarding tables based on the input interface that received the data unit from the network.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. A network device comprising:
<claim-text>a plurality of input interfaces that receive at least one data unit from a network; and</claim-text>
<claim-text>a control unit coupled to the input interfaces, wherein the control unit includes:
<claim-text>a plurality of forwarding tables that each associate a plurality of network destinations with specific next hops in a network;</claim-text>
<claim-text>a plurality of sets of forwarding filters, each of the sets of forwarding filters being associated with a different one of the forwarding tables, and each of the forwarding filters including at least one forwarding rule and an associated action; and</claim-text>
</claim-text>
<claim-text>wherein the control unit receives the data unit from the one of the input interfaces that received the data unit from the network, selects one of the plurality of forwarding tables to forward the data unit, selectively applies the forwarding filters to the data unit by applying only the forwarding rules and associated actions of the set of forwarding filters associated with the selected forwarding table, and forwards the data unit to an output interface in accordance with the selected one of the plurality of forwarding tables maintained by the control unit.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The network device of <claim-ref idref="CLM-00010">claim 10</claim-ref>, further comprising a set of interface filters, wherein each of the set of interface filters filters packets for a respective one of the plurality of input interfaces.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The network device of <claim-ref idref="CLM-00010">claim 10</claim-ref>, further comprising:
<claim-text>an output interface; and</claim-text>
<claim-text>an interface filter that filters data units of the output interface.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The network device of <claim-ref idref="CLM-00012">claim 12</claim-ref>, further comprising:
<claim-text>an interface card; and,</claim-text>
<claim-text>a service card,</claim-text>
<claim-text>wherein the interface card and the service card each provide a number of input interfaces and a number of output interfaces.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The network device of <claim-ref idref="CLM-00013">claim 13</claim-ref>, further comprising a chassis having slots to receive and couple the interface card and the service card to the control unit.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The network device of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein each of the plurality of forwarding tables may be one or more of a list, radix tree, database, flat file, and table.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The network device of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein each of the plurality of forwarding tables maintained by the control unit corresponds to one of a plurality of different customer virtual private networks (VPNs).</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. A computer-readable storage medium comprising instructions that cause a processor to:
<claim-text>maintain, within a centralized control unit of a router, a plurality of forwarding tables that each associate a plurality of network destinations with next hops in a network;</claim-text>
<claim-text>maintain, within the control unit, a plurality of sets of forwarding filters, wherein each of the sets of forwarding filters corresponds to a different one of the plurality of forwarding tables, and wherein each of the forwarding filters include at least one forwarding rule and an associated action;</claim-text>
<claim-text>receive, with one of a plurality of input interfaces coupled to the control unit, a data unit from the network;</claim-text>
<claim-text>forward the data unit from the input interface that received the packet to the control unit;</claim-text>
<claim-text>select, with the control unit, one of the plurality of forwarding tables to be used by the control unit to forward the packet selectively apply to the data unit only the forwarding filters rules and associated actions of the forwarding filters of the set of forwarding filters that corresponds to the selected-forwarding table; and</claim-text>
<claim-text>forward the data unit with the control unit to an output interface in accordance with the selected one of the plurality of forwarding tables maintained by the control unit.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The computer-readable medium of <claim-ref idref="CLM-00017">claim 17</claim-ref>, further comprising instructions that cause the processor to filter the data unit with an interface filter corresponding to the input interface that received the data unit.</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The computer-readable medium of <claim-ref idref="CLM-00017">claim 17</claim-ref>, further comprising instructions that cause the processor to:
<claim-text>identify an output interface for the data unit based on the identified forwarding table;</claim-text>
<claim-text>filter the data unit with an interface filter associated with the identified output interface; and</claim-text>
<claim-text>forward the data unit via the identified output interface.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. The computer-readable medium of <claim-ref idref="CLM-00019">claim 19</claim-ref>, further comprising instructions that cause the processor to:
<claim-text>dynamically instantiate a logical interface between the input interface that received the data unit and the control unit;</claim-text>
<claim-text>associate the instantiated interface with a first forwarding table of the plurality of forwarding tables; and</claim-text>
<claim-text>filter the data unit of the instantiated interface with a forwarding filter associated with the first forwarding table.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00021" num="00021">
<claim-text>21. The computer-readable medium of <claim-ref idref="CLM-00017">claim 17</claim-ref>, wherein each of the plurality of forwarding tables maintained by the control unit corresponds to one of a plurality of different customer virtual private networks (VPNs).</claim-text>
</claim>
<claim id="CLM-00022" num="00022">
<claim-text>22. A network device comprising:
<claim-text>a plurality of input interfaces that receive data units from a network, wherein at least one of the input interfaces includes one or more interface filters that filter the data units received on the respective input interfaces;</claim-text>
<claim-text>a control unit coupled to each of the plurality of interfaces, wherein the control unit maintains a plurality of forwarding tables that each associate a plurality of network destinations with specific next hops in a network, and further wherein the control unit maintains a plurality of sets of forwarding filters, each of the sets of forwarding filters being associated with a different one of the forwarding tables, and each of the forwarding filters including at least one forwarding rule and an associated action; and</claim-text>
<claim-text>wherein the control unit receives data its from the input interfaces, identifies one of the plurality of forwarding tables for each of the data units, applies to each of the data units the set of forwarding filters associated with the identified one of the plurality of forwarding tables, and forwards at least a Portion of the data units in accordance with the identified one of the plurality of forwarding tables.</claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
