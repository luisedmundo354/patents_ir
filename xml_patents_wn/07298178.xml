<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07298178-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07298178</doc-number>
<kind>B1</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>11427717</doc-number>
<date>20060629</date>
</document-id>
</application-reference>
<us-application-series-code>11</us-application-series-code>
<us-term-of-grant>
<disclaimer>
<text>This patent is subject to a terminal disclaimer.</text>
</disclaimer>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>03</class>
<subclass>D</subclass>
<main-group>9</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>327 10</main-classification>
<further-classification>327 99</further-classification>
<further-classification>327298</further-classification>
</classification-national>
<invention-title id="d0e51">Clock-generator architecture for a programmable-logic-based system on a chip</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>4479097</doc-number>
<kind>A</kind>
<name>Larson et al.</name>
<date>19841000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5485127</doc-number>
<kind>A</kind>
<name>Bertoluzzi et al.</name>
<date>19960100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>5757212</doc-number>
<kind>A</kind>
<name>Sevalia</name>
<date>19980500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>5774701</doc-number>
<kind>A</kind>
<name>Matsui et al.</name>
<date>19980600</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>6515519</doc-number>
<kind>B1</kind>
<name>Miyazaki et al.</name>
<date>20030200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>6661254</doc-number>
<kind>B1</kind>
<name>Agrawal et al.</name>
<date>20031200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>326 41</main-classification></classification-national>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>7102391</doc-number>
<kind>B1</kind>
<name>Sun et al.</name>
<date>20060900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2005/0237083</doc-number>
<kind>A1</kind>
<name>Bakker et al.</name>
<date>20051000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>9</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>None</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>17</number-of-drawing-sheets>
<number-of-figures>20</number-of-figures>
</figures>
<us-related-documents>
<continuation>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>10903473</doc-number>
<kind>00</kind>
<date>20040729</date>
</document-id>
<parent-grant-document>
<document-id>
<country>US</country>
<doc-number>7102391</doc-number>
<kind>A </kind>
</document-id>
</parent-grant-document>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>11427717</doc-number>
</document-id>
</child-doc>
</relation>
</continuation>
<continuation-in-part>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>10843701</doc-number>
<kind>00</kind>
<date>20040510</date>
</document-id>
<parent-grant-document>
<document-id>
<country>US</country>
<doc-number>7170315</doc-number>
<kind>A </kind>
</document-id>
</parent-grant-document>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>10903473</doc-number>
</document-id>
</child-doc>
</relation>
</continuation-in-part>
<us-provisional-application>
<document-id>
<country>US</country>
<doc-number>60491788</doc-number>
<kind>00</kind>
<date>20030731</date>
</document-id>
</us-provisional-application>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Sun</last-name>
<first-name>Shin-Nan</first-name>
<address>
<city>Fremont</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Zhu</last-name>
<first-name>Limin</first-name>
<address>
<city>Fremont</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="003" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Speers</last-name>
<first-name>Theodore</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="004" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Bakker</last-name>
<first-name>Gregory</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Sierra Patent Group, Ltd.</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Actel Corporation</orgname>
<role>02</role>
<address>
<city>Mountain View</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Wells</last-name>
<first-name>Kenneth B.</first-name>
<department>2816</department>
</primary-examiner>
<assistant-examiner>
<last-name>Luu</last-name>
<first-name>An T.</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A programmable system-on-a-chip integrated circuit device comprises at least one of a crystal oscillator circuit, an RC oscillator circuit, and an external oscillator input. A clock conditioning circuit is selectively coupleable to one of the programmable logic block, the crystal oscillator circuit, the RC oscillator circuit, and the external oscillator input. A real-time clock is selectively coupleable to one of the programmable logic block, the crystal oscillator circuit, the RC oscillator circuit, and the external oscillator input. A programmable logic block is coupled to the clock conditioning circuit and the real-time clock.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="130.47mm" wi="169.67mm" file="US07298178-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="140.21mm" wi="128.61mm" file="US07298178-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="169.76mm" wi="118.45mm" orientation="landscape" file="US07298178-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="148.08mm" wi="130.47mm" file="US07298178-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="171.20mm" wi="129.54mm" file="US07298178-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="163.75mm" wi="122.17mm" file="US07298178-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="93.64mm" wi="123.53mm" file="US07298178-20071120-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="150.79mm" wi="126.15mm" orientation="landscape" file="US07298178-20071120-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="169.84mm" wi="120.06mm" file="US07298178-20071120-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="149.18mm" wi="122.60mm" file="US07298178-20071120-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="179.41mm" wi="102.87mm" file="US07298178-20071120-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="124.46mm" wi="119.80mm" file="US07298178-20071120-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="182.29mm" wi="131.49mm" orientation="landscape" file="US07298178-20071120-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="152.91mm" wi="123.11mm" orientation="landscape" file="US07298178-20071120-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="149.69mm" wi="106.17mm" file="US07298178-20071120-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00015" num="00015">
<img id="EMI-D00015" he="182.29mm" wi="131.40mm" file="US07298178-20071120-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00016" num="00016">
<img id="EMI-D00016" he="142.66mm" wi="172.89mm" file="US07298178-20071120-D00016.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00017" num="00017">
<img id="EMI-D00017" he="134.70mm" wi="162.64mm" file="US07298178-20071120-D00017.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATIONS</heading>
<p id="p-0002" num="0001">This application is a Continuation of U.S. patent application Ser. No. 10/903,473, filed Jul. 29, 2004, now U.S. Pat. No. 7,102,391, which is a Continuation-in-Part of U.S. patent application Ser. No. 10/843,701, filed May 10, 2004, now U.S. Pat. No. 7,170,315 and this application claims priority from U.S. Provisional Patent application Ser. No. 60/491,788, filed Jul. 31, 2003.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0003" num="0002">1. Field of the Invention</p>
<p id="p-0004" num="0003">The present invention relates to integrated circuits. More particularly, the present invention relates to a system-on-a-chip integrated circuit device including a programmable logic block, at least one user non-volatile memory block, and analog circuits on a single semiconductor integrated circuit chip, flip chip, face-to-face, or other multiple die configuration.</p>
<p id="p-0005" num="0004">2. Background</p>
<p id="p-0006" num="0005">Field-programmable gate array (FPGA) integrated circuits are known in the art. An FPGA comprises any number of logic modules, an interconnect-routing architecture and programmable elements that may be programmed to selectively interconnect the logic modules to one another and to define the functions of the logic modules. To implement a particular circuit function, the circuit is mapped into the array and the appropriate programmable elements are programmed to implement the necessary wiring connections that form the user circuit.</p>
<p id="p-0007" num="0006">An FPGA includes an array of general-purpose logic circuits, called cells or logic blocks, whose functions are programmable. Programmable buses link the cells to one another. The cell types may be small multifunction circuits (or configurable functional blocks or groups) capable of realizing Boolean functions of multiple variables. The cell types are not restricted to gates. For example, configurable functional groups typically include memory cells and connection transistors that may be used to configure logic functions such as addition, subtraction, etc., inside of the FPGA. A cell may also contain a plurality of flip-flops. Two types of logic cells found in FPGA devices are those based on multiplexers and those based on programmable read only memory (PROM) table-lookup memories. Erasable FPGAs can be reprogrammed many times. This technology is especially convenient when developing and debugging a prototype design for a new product and for small-scale manufacture.</p>
<p id="p-0008" num="0007">An FPGA circuit can be programmed to implement virtually any set of digital functions. Input signals are processed by the programmed circuit to produce the desired set of outputs. Such inputs flow from the user's system, through input buffers and through the circuit, and finally back out the user's system via output buffers referred to as input/output ports (I/Os). Such buffers provide any or all of the following input/output (I/O) functions: voltage gain, current gain, level translation, delay, signal isolation or hysteresis. The input/output ports provide the access points for communication between chips. I/O ports vary in complexity depending on the FPGA.</p>
<p id="p-0009" num="0008">Recent advances in user-programmable interconnect technology have resulted in the development of FPGAs which may be customized by a user to perform a wide variety of combinatorial and sequential logic functions. Numerous architectures for such integrated circuits are known. Examples of such architectures are found disclosed in U.S. Pat. No. 4,870,302 to Freeman, U.S. Pat. No. 4,758,745 to El Gamal et al., and U.S. Pat. No. 5,132,571 to McCollum et al. The architecture employed in a particular FPGA integrated circuit will determine the richness and density of the possible interconnections that can be made among the various circuit elements disposed on the integrated circuit and thus profoundly affect its usefulness.</p>
<p id="p-0010" num="0009">Traditionally, FPGAs and other programmable logic devices (PLDs) have been limited to providing digital logic functions programmable by a user. Recently, however, FPGA manufacturers have experimented with adding application specific integrated circuit (ASIC) blocks onto their devices (See, e.g., U.S. Pat. No. 6,150,837). Such ASIC blocks have included analog circuits (see U.S. Pat. No. 5,821,776). In addition, ASIC manufacturers have embedded programmable logic blocks in their devices to add programmable functionality to otherwise hardwired devices (See, e.g., devices offered (or formerly offered) by Triscend Corporation, Adaptive Silicon Inc., and Chameleon Systems.</p>
<p id="p-0011" num="0010">Programmable logic devices with clock-conditioning circuitry including a phase lock loop circuit (PLL) are known in the art, such as FPGAs (see, e.g., the Accelerator product available from Actel Corporation, Mountain View, Calif.), and CPLDs (see U.S. Pat. No. 6,272,646 to Rangasayee et al.). Programmable logic devices such as FPGAs, however, do not typically include an on-chip crystal oscillator circuit or an RC oscillator circuit.</p>
<p id="p-0012" num="0011">System on a chip devices with analog circuitry; programmable logic, such as registers for configuring and selecting the other circuitry on the device, and an on-chip crystal oscillator circuit are known (see, e.g., U.S. Pat. No. 5,563,526 to Hastings and U.S. Pat. No. 6,614,320 to Sullam). Although the system on a chip disclosed by Sullam includes a PLL circuit and a selectable clock signal (32 KHz or 24 MHz), the clocking circuitry is not programmable to output multiple clock frequencies along a broad spectrum of frequencies, according to user needs. The PLL disclosed in Sullam is used to provide a precise clocking signal, but is not configurable to synthesize arbitrary clock frequencies.</p>
<p id="p-0013" num="0012">While these devices contain “programmable logic,” it is not logic of the type that can manage the overall operation of the system on a chip device, but logic that functions as registers and configuration bits to select various circuits and make selected connections on the system on a chip devices. The logic is not of a sufficient size or density or complexity to be programmed to perform most any arbitrary function that might be required by a complex user circuit design to be programmed into the system on a chip device. Furthermore, the programmable logic of the known system on a chip devices described above cannot function as the master control of the system on a chip device (see, e.g., Sullam, where a microcontroller functions as the master control of the device). In addition to Sullam, other known system on a chip devices have included a real time clock (see, e.g., U.S. Pat. Nos. 5,687,325 and 6,260,087 to Chang). The real time clock disclosed in the system of Chang, however, functions to initiate DRAM refresh cycles.</p>
<heading id="h-0003" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0014" num="0013">A programmable system-on-a-chip integrated circuit device comprises at least one of a crystal oscillator circuit, an RC oscillator circuit, and an external oscillator input. A clock conditioning circuit is selectively coupleable to one of the programmable logic block, the crystal oscillator circuit, the RC oscillator circuit, and the external oscillator input. A real-time clock is selectively coupleable to one of the programmable logic block, the crystal oscillator circuit, the RC oscillator circuit, and the external oscillator input. A programmable logic block is coupled to the clock conditioning circuit and the real-time clock.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram of one illustrative embodiment of a system-on-a-chip according to one aspect of the present invention.</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 2</figref> is a simplified diagram of a portion of an illustrative interconnect architecture that may be used to interconnect the inputs and outputs of the various circuit elements of the system-on-a-chip of <figref idref="DRAWINGS">FIG. 1</figref> to form user circuit systems.</p>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 3</figref> is a block diagram of another illustrative embodiment of a system-on-a-chip that includes a volatile memory block such as an SRAM block.</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 4</figref> is a block diagram of another illustrative embodiment of a system-on-a-chip based on use of a highly successful flash FPGA architecture, for the programmable logic block.</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 5</figref> is a block diagram of another illustrative embodiment of a system-on-a-chip based on use of a flash FPGA architecture for the programmable logic block.</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 6</figref> is a schematic diagram of an illustrative glitchless clock multiplexer that is suitable for use in the SOC of the present invention.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 7</figref> is a block diagram of a portion of the SOC of <figref idref="DRAWINGS">FIG. 5</figref> showing analog I/O function circuits grouped into sets according to one illustrative embodiment of the present invention.</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 8</figref> is a diagram of a pre-scaler circuit that can scale external voltages by one of eight factors.</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 9</figref> is a diagram of an illustrative configuration for the amplifier of <figref idref="DRAWINGS">FIG. 7</figref>.</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 10</figref> is a diagram of an illustrative temperature monitor circuit that may be usefully employed in the analog I/O function circuit of <figref idref="DRAWINGS">FIG. 7</figref>.</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 11</figref> is a diagram of an illustrative gate drive circuit that may be usefully employed in the analog I/O function circuit of <figref idref="DRAWINGS">FIG. 7</figref>.</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 12</figref> is a diagram of an illustrative embodiment of internal interface circuits from <figref idref="DRAWINGS">FIG. 5</figref> that are particularly useful for the SOC of the present invention.</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 13</figref> is a schematic diagram of an illustrative bandgap reference that may be used in the SOC of the present invention.</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 14</figref> is a more detailed diagram of the analog-to-digital converter shown in <figref idref="DRAWINGS">FIG. 5</figref>.</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. 15A</figref> is a power-up sequence state-machine flow chart showing a typical SOC internal power up sequence.</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 15B</figref> is a timing diagram showing a typical SOC internal power up sequence.</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 16</figref> is a more detailed block diagram of system supervisor master block <b>140</b> from <figref idref="DRAWINGS">FIG. 5</figref>.</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. 17</figref> is a diagram showing an illustrative power-up control circuit for performing functions in the power-up sequence of the SOC of the present invention.</p>
<p id="p-0033" num="0032"><figref idref="DRAWINGS">FIG. 18</figref> is a block diagram showing a clock-generator architecture for a programmable-logic-based system on a chip according to the present invention.</p>
<p id="p-0034" num="0033"><figref idref="DRAWINGS">FIG. 19</figref> is a block diagram showing a more detailed view of the operation of an illustrative real time clock in the system on a chip of the present invention.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0035" num="0034">U.S. Provisional Patent application Ser. No. 60/491,788, filed Jul. 31, 2003 is hereby incorporated by reference into this disclosure. Those of ordinary skill in the art will realize that the following description of the present invention is illustrative only and not in any way limiting. Other embodiments of the invention will readily suggest themselves to such skilled persons.</p>
<p id="p-0036" num="0035">The term “system-on-a-chip” or “SOC” generally refers to an integrated circuit device that includes multiple types of integrated circuits on a single die, where the circuits are of types that have traditionally been constructed on separate silicon wafers.</p>
<p id="p-0037" num="0036">An SOC <b>10</b> according to the present invention design is shown generally in a block-diagram architectural level drawing in <figref idref="DRAWINGS">FIG. 1</figref>, which shows its main components. As shown in <figref idref="DRAWINGS">FIG. 1</figref>, an illustrative embodiment of the present invention is a system-on-a-chip integrated circuit <b>10</b> that includes a programmable logic block <b>12</b>, at least one non-volatile memory block <b>14</b>, analog ASIC circuit blocks <b>16</b><i>a </i>through <b>16</b><i>f</i>, digital ASIC circuit blocks <b>18</b><i>a </i>through <b>18</b><i>f</i>, digital input/output (“I/O”) circuit blocks <b>20</b> and analog I/O circuit blocks <b>22</b>. ASIC refers to “application specific integrated circuits” and is used to refer to circuit blocks that are largely hardwired, in contrast to those that are programmable, writeable, or otherwise able to be modified or configured after manufacturing of the device. System-on-a-chip integrated circuit <b>10</b> also includes a system controller circuit block <b>24</b> and a clock circuit <b>26</b>.</p>
<p id="p-0038" num="0037">Programmable logic block <b>12</b> may be an FPGA array. FPGA arrays are well known in the art, and it is contemplated for purposes of the present invention that any type of FPGA circuit block may be employed in the system-on-a-chip integrated circuit <b>10</b> of the present invention. The number of data inputs and outputs and the number of implementable combinatorial and sequential logic functions will depend on the particular design of FPGA circuit used in the FPGA array. Persons of ordinary skill in the art will appreciate that other programmable logic blocks such as complex programmable logic devices (CPLD) and other programmable logic blocks may be used in the present invention.</p>
<p id="p-0039" num="0038">Non-volatile memory block <b>14</b> may be formed from an array of, as a non-limiting example, flash memory cells and a memory controller for the array. Flash memory cells are well known in the art and the present invention is not limited to use of any particular kind of flash memory cells or other non-volatile memory technology, such as nanocrystal, SONOS, solid-electrolyte switching devices, and other types as will be appreciated by persons of ordinary skill in the art. Persons of ordinary skill in the art will appreciate that, in some embodiments of the present invention, non-volatile memory block <b>14</b> may be segmented into a plurality of separately addressable arrays, each with its own memory controller. The number of data inputs and outputs and address inputs will depend on the size of the array used.</p>
<p id="p-0040" num="0039">Analog ASIC circuit blocks <b>16</b><i>a </i>through <b>16</b><i>f </i>are illustrated in <figref idref="DRAWINGS">FIG. 1</figref>, although persons of ordinary skill in the art will observe that the provision of six analog ASIC circuit blocks <b>16</b><i>a </i>through <b>16</b><i>f </i>in <figref idref="DRAWINGS">FIG. 1</figref> is merely illustrative and in no way limiting. Actual embodiments of system-on-a-chip integrated circuits according to the present invention may have an arbitrary number of analog ASIC circuit blocks. Analog ASIC circuit blocks <b>16</b><i>a </i>through <b>16</b><i>f </i>may alternatively be described as “hardwired,” “mask programmable,” or “ASIC” circuits or circuit blocks. These analog blocks are also referred to as “analog peripherals,” and may include, as non-limiting examples, a digital-to-analog converter (DAC), an analog-to-digital converter (ADC), a Pulse Width Modulator (PWM), a MOSFET Controller, a Voltage Reference circuit, a Low-dropout (LDO) regulator, an Analog multiplexer (MUX), or an RF Transceiver. In addition to the more general-purpose types of analog blocks described above, stand alone analog circuit blocks for more specific functions may be provided, as described above. For example, a stand-alone hardwired current monitor, a stand-alone hardwired temperature monitor, or a stand-alone hardwired voltage monitor may be provided. Stand-alone hard analog blocks may include I/O circuits.</p>
<p id="p-0041" num="0040">Embedded analog peripherals may also be used to enhance generic microcontroller (“MCU”) functions with a programmable “soft” processor core programmed into the programmable logic block. As will be appreciated by persons of ordinary skill in the art, the numbers and kinds of inputs and outputs of the individual analog ASIC circuit blocks <b>16</b><i>a </i>through <b>16</b><i>f </i>will depend on the functional nature of the circuits employed.</p>
<p id="p-0042" num="0041">Digital ASIC circuit blocks <b>18</b><i>a </i>through <b>18</b><i>f </i>are illustrated in <figref idref="DRAWINGS">FIG. 1</figref>, although persons of ordinary skill in the art will observe that the provision of six digital ASIC circuit blocks <b>18</b><i>a </i>through <b>18</b><i>f </i>in <figref idref="DRAWINGS">FIG. 1</figref> is merely illustrative and in no way limiting. Actual embodiments of system-on-a-chip integrated circuits according to the present invention may have an arbitrary number of digital ASIC circuit blocks. Digital ASIC circuit blocks <b>18</b><i>a </i>through <b>18</b><i>f </i>may comprise circuit blocks such as, but not limited to, state machines, analog sequencers, microprocessors, digital signal processors (“DSPs”). Hard digital blocks are especially useful to implement interfaces such as the interface between the programmable logic and the memory blocks on a device. The FPGA/Memory interface is described in more detail in the section describing the non-volatile memory controller. Hard digital blocks may also be used to implement interfaces between the programmable logic or the memory blocks and hard analog blocks. A hard digital block is used as a control block for the non-volatile memory block. The non-volatile memory controller is described in more detail herein.</p>
<p id="p-0043" num="0042">Such digital blocks may be implemented in a similar manner to the way in which such digital blocks are implemented in current application-specific integrated circuits (“ASICs”). In addition to being implemented as hard digital circuit blocks, all, or a portion of each of these types of blocks may be implemented in programmable logic, sometimes referred to as “soft” implementations. As will be appreciated by persons of ordinary skill in the art, the numbers and kinds of inputs and outputs of the individual digital ASIC circuit blocks <b>18</b><i>a </i>through <b>18</b><i>f </i>will depend on the functional nature of the circuits employed.</p>
<p id="p-0044" num="0043">System-on-a-chip integrated circuit <b>10</b> also includes digital I/O circuit blocks <b>20</b>. Digital I/O circuit blocks <b>20</b> may comprise conventional digital I/O circuitry, such as that commonly employed in known FPGA and similar integrated circuits.</p>
<p id="p-0045" num="0044">System-on-a-chip integrated circuit <b>10</b> also includes analog I/O circuit blocks <b>22</b>. Analog I/O circuit blocks <b>22</b> may comprise any of the many analog amplifier circuits that are well known in the art.</p>
<p id="p-0046" num="0045">System-on-a-chip integrated circuit <b>10</b> also includes a system controller circuit block <b>24</b>. A system controller circuit block <b>24</b> provides master control functionality for the other blocks in the SOC device, including managing power up sequencing and inter-operation of the various components of the system on a chip. In addition, the system controller <b>24</b> may control off-chip devices via signals output via the digital or analog I/Os of the device of the present invention such as reset and enable signals. The system controller <b>24</b> includes various circuits for managing the different functions of the SOC device. In some embodiments, these circuits may all be implemented in hardwired circuit blocks, while in other embodiments, some of the circuits may be implemented in a portion of the programmable logic of the programmable logic block <b>12</b>. An advantage of implementing control functions in programmable logic is that the user is able to adapt the control functions to the user's application. This is especially useful if the user wishes to employ the programmable system on a chip device to control elements of the user's system that are outside the system on a chip device.</p>
<p id="p-0047" num="0046">In the embodiment of a system controller shown in <figref idref="DRAWINGS">FIG. 1</figref>, a portion of the system controller's circuits are implemented in hardwired blocks, and a portion are implemented in programmable logic. The system controller <b>24</b> shown in <figref idref="DRAWINGS">FIG. 1</figref> includes a power-up control circuit, an analog power supply circuit, a voltage reference circuit, and a system supervisor circuit. The power-up control circuit includes circuitry for managing the SOC device during power-up, as will be described in more detail below.</p>
<p id="p-0048" num="0047">System-on-a-chip integrated circuit <b>10</b> also includes a clock circuit <b>26</b>. Clock circuit <b>26</b> may include one or more clock sources and clock-signal-distribution systems. The number of such clocks provided on any system-on-a-chip integrated circuit fabricated according to the present invention is a matter of design choice. Such circuits and systems are well known in the art.</p>
<p id="p-0049" num="0048">The inputs and outputs of the various circuit elements of the programmable logic block <b>12</b>, a non-volatile memory block <b>14</b>, analog ASIC circuit blocks <b>16</b><i>a </i>through <b>16</b><i>d</i>, digital ASIC circuit blocks <b>18</b><i>a </i>through <b>18</b><i>d</i>, digital input/output (“I/O”) circuit blocks <b>20</b> and analog I/O circuit blocks <b>22</b>, system controller circuit block <b>24</b> and clock circuit <b>26</b> may be connected together by a user by programmably connecting together their various inputs and outputs through a network of programmable interconnect conductors that is provided on the system-on-a-chip integrated circuit.</p>
<p id="p-0050" num="0049">A simplified diagram of a portion of an illustrative programmable interconnect architecture that may be employed with the system-on-a-chip integrated circuit of <figref idref="DRAWINGS">FIG. 1</figref> is shown in <figref idref="DRAWINGS">FIG. 2</figref>. <figref idref="DRAWINGS">FIG. 2</figref> illustrates a portion of an illustrative interconnect architecture. Persons of ordinary skill in the art will understand that <figref idref="DRAWINGS">FIG. 2</figref> is largely schematic and simplified in nature, and in no way limits the present invention to the particular interconnect architecture depicted.</p>
<p id="p-0051" num="0050">As can be seen from an examination of <figref idref="DRAWINGS">FIG. 2</figref>, an illustrative interconnect architecture that can be implemented with the present invention may include interconnect conductors that run in horizontal and vertical directions in metal interconnect layers disposed over the surface of the silicon die comprising the system-on-a-chip integrated circuit <b>10</b>. Both the horizontal and vertical interconnect conductors may be segmented to allow versatility in forming interconnect between inputs and outputs of the various circuit elements disposed in system-on-a-chip integrated circuit <b>10</b> of <figref idref="DRAWINGS">FIG. 1</figref>. As is known in the art, the various interconnect conductors may be of varying lengths or may be segmented into varying lengths. In addition, either flat or hierarchical interconnect systems may be employed.</p>
<p id="p-0052" num="0051">The segments of the horizontal and vertical interconnect conductors may be programmably joined together by user-programmable interconnect elements indicated by the circled “X” symbols shown on <figref idref="DRAWINGS">FIG. 2</figref>. Intersections formed by individual ones of the horizontal and vertical interconnect conductors may also be populated by user-programmable interconnect elements. The user-programmable interconnect elements may be in the form of one-time programmable antifuse elements as are known in the art, or may be in the form of reprogrammable switches as are also known in the art. The latter reprogrammable interconnect switches may employ technologies such as flash memory, SRAM, and other known interconnect switch technologies.</p>
<p id="p-0053" num="0052">As shown in <figref idref="DRAWINGS">FIG. 2</figref>, a group <b>30</b> of segmented horizontal interconnect conductors is shown crossing a group <b>32</b> of segmented vertical interconnect conductors to form intersections. Persons of ordinary skill in the art will recognize that the horizontal interconnect conductors and the vertical interconnect conductors are disposed in different metal interconnect layers of the system-on-a-chip integrated circuit. An exemplary individual horizontal interconnect conductor is shown to be comprised of segments <b>34</b><i>a</i>, <b>34</b><i>b</i>, <b>34</b><i>c</i>, and <b>34</b><i>d</i>, each adjoining segment being coupled to one another by user-programmable interconnect elements <b>36</b>, <b>38</b>, and <b>40</b>, as shown in <figref idref="DRAWINGS">FIG. 2</figref>. Similarly, an exemplary individual vertical interconnect conductor is shown to be comprised of segments <b>42</b><i>a</i>, <b>42</b><i>b</i>, <b>42</b><i>c</i>, and <b>42</b><i>d</i>, each adjoining segment being coupled to one another by user-programmable interconnect elements <b>44</b>, <b>46</b>, and <b>48</b>, as also shown in <figref idref="DRAWINGS">FIG. 2</figref>.</p>
<p id="p-0054" num="0053">Horizontal interconnect conductor segment <b>34</b><i>d </i>is shown intersecting vertical interconnect conductor segment <b>42</b><i>b</i>. The intersection of these two interconnect conductor segments is populated with a user-programmable interconnect element <b>50</b>.</p>
<p id="p-0055" num="0054">By programming appropriate ones of the user-programmable interconnect elements, a conductive path may be formed between the output of one of the circuit elements on the system-on-a-chip integrated circuit and the input of another one of the circuit elements on the system-on-a-chip integrated circuit to form a connection therebetween. Persons of ordinary skill in the art will appreciate that the illustrative interconnect architecture depicted in <figref idref="DRAWINGS">FIG. 2</figref> may appear more or less regular over areas such as the FPGA array of logic block <b>12</b> of <figref idref="DRAWINGS">FIG. 1</figref> and may vary in density, pattern, and/or and direction over other areas and circuit blocks of the system-on-a-chip integrated circuit <b>10</b> of <figref idref="DRAWINGS">FIG. 1</figref> as appropriate for the desired connection opportunities.</p>
<p id="p-0056" num="0055"><figref idref="DRAWINGS">FIG. 3</figref> is a block diagram of a system-on-a-chip integrated circuit <b>60</b> similar to the system-on-a-chip integrated circuit <b>10</b> shown in <figref idref="DRAWINGS">FIG. 1</figref>, in that it includes a programmable logic block <b>62</b>, a non-volatile memory block <b>64</b>, analog ASIC circuit blocks <b>66</b><i>a </i>through <b>66</b><i>f</i>, digital ASIC circuit blocks <b>68</b><i>a </i>through <b>68</b><i>f</i>, digital input/output (“I/O”) circuit blocks <b>70</b> and analog I/O circuit blocks <b>72</b>, a system controller circuit block <b>74</b> and a clock circuit <b>76</b>. System-on-a-chip integrated circuit <b>60</b> also includes a volatile memory block <b>78</b> (e.g., an SRAM block). As in the embodiment illustrated in <figref idref="DRAWINGS">FIG. 1</figref>, the configuration shown in <figref idref="DRAWINGS">FIG. 3</figref> is simply suggestive of the feature set of a system-on-a-chip integrated circuit and is not intended to be limiting in terms of the number and distribution of circuit blocks, layout and other design-choice features.</p>
<p id="p-0057" num="0056">Another embodiment of an FPGA-based system-on-a-chip <b>80</b> is shown in <figref idref="DRAWINGS">FIG. 4</figref>. As in the embodiments shown in <figref idref="DRAWINGS">FIGS. 1 and 3</figref>, the FPGA-based system-on-a-chip shown in <figref idref="DRAWINGS">FIG. 4</figref> includes a programmable logic block <b>82</b>, a non-volatile memory block <b>84</b>, analog ASIC circuit blocks <b>86</b><i>a </i>through <b>86</b><i>f</i>, digital ASIC circuit blocks <b>88</b><i>a </i>through <b>88</b><i>f</i>, digital input/output (“I/O”) circuit blocks <b>90</b> and analog I/O circuit blocks <b>92</b>, system controller circuit block <b>94</b> and a clock circuit <b>96</b>. The system-on-a-chip integrated circuit <b>80</b> of <figref idref="DRAWINGS">FIG. 4</figref> also includes SRAM block <b>98</b>. The system-on-a-chip integrated circuit <b>80</b> of <figref idref="DRAWINGS">FIG. 4</figref> also includes a microprocessor <b>100</b>. In the embodiment of <figref idref="DRAWINGS">FIG. 4</figref>, Flash memory block <b>84</b> and SRAM block <b>98</b> are large enough to allow full use of the microprocessor. An example of such an embodiment may include a microprocessor such as an 8051 hardwired core (a popular 1970's 8-bit microprocessor with a 16-bit address space) with 64 K-bytes of SRAM and 64 K-bytes of flash memory. According to one aspect of the present invention, it will be advantageous to configure the SRAM block <b>98</b> and flash memory block <b>84</b> into separate small blocks (e.g., 1K, 2 k, or 4K) and allow them to be programmed into the address space of the microprocessor <b>100</b> as desired. In such an embodiment, memory blocks that are not used by the processor could be allocated for use by the FPGA block <b>82</b> of the circuit.</p>
<p id="p-0058" num="0057">According to another aspect of the present invention, a more sophisticated microprocessor or microcontroller, a system bus and other features like timers, UARTs, SRAM or DRAM ports, etc., may be provided. The SRAM may operate under DMA mode for the microprocessor. An FPGA or other programmable logic device, including a microprocessor (soft or hard) requires memory for program store. When program-storage memory is static, an on-board PROM program-store block is useful for this task. PROM memory has an advantage as it is much denser than SRAM and does not need to be loaded from some external source. The PROM however may be quite slow, so a SRAM cache may be provided for the fast processor into which the PROM program-store is loaded (perhaps in parallel or in the background) such that the entire PROM would not need to be duplicated in SRAM. There are well known methods for a processor to download blocks of memory to the cache as they are needed.</p>
<p id="p-0059" num="0058">SRAM-based FPGA is typically configured by a bit-stream that is stored in non-volatile memory, by integrating a microcontroller and flash FPGA in one chip, The microcontroller can take control of FPGA re-configuration for certain applications during boot-up or on-the-fly system operation. On the other hand, the configuration procedure can be reversed to let the FPGA set up the microcontroller, for example, if the system times out or hangs during operation, the FPGA can send a soft reset to the microcontroller instead of requiring a hard reset. Both the microcontroller and FPGA blocks share on-chip SRAM, which can be designed as dual-port SRAM to be accessed synchronously. In order to reduce data latency, on-chip SRAM can work under DMA mode for the microcontroller. Customized instructions can be implemented in flash memory, or FPGA blocks can be reconfigured as a co-processor either through the on-chip microcontroller or external host to build a powerful flash-based FPGA on-chip processor platform.</p>
<p id="p-0060" num="0059">One particular embodiment of the invention may be configured using a highly successful flash FPGA architecture as the programmable logic block <b>12</b> of <figref idref="DRAWINGS">FIG. 1</figref>. An example of such an architecture may be found in the ProASIC line of FPGA integrated circuits available from Actel Corporation of Mountain View, Calif. By combining an advanced flash FPGA core with embedded flash memory blocks or analog peripherals, system-on-a-chip devices according to the present invention dramatically simplify system design, and as a result, save both board space and overall system cost. The state-of-the-art flash memory technology offers very high-density integrated flash arrays and therefore a substantial cost saving over use of external flash chips to configure SRAM-based FPGAs, the traditional alternative. The multiple analog circuit blocks extend the traditional FPGA application from the purely digital domain to mixed-signal applications. The embedded flash memory and integrated analog circuit blocks can be used with an integrated soft (i.e., configured from programmable logic) processor to implement a full functional flash microcontroller unit (MCU), or the advanced analog circuit blocks can be used with high speed FPGA logic to offer system and power supervisory abilities.</p>
<p id="p-0061" num="0060">Such an embodiment of the present invention is illustrated in the block diagram of <figref idref="DRAWINGS">FIG. 5</figref>. SOC <b>110</b> includes a field-programmable gate array (FPGA) that includes an FPGA core <b>112</b> comprising logic tiles, routing, and flash-cell switches and programming structures and techniques as is known in the art. General-purpose input/output (GPIO) circuits <b>116</b> may be coupled to the FPGA core <b>112</b> through I/O tiles <b>114</b> as is known in the art.</p>
<p id="p-0062" num="0061">A clock generator circuits block <b>118</b> and distribution system is included to provide an on-chip source for clock signals. The clock generator circuits block <b>118</b> may include RC oscillators. One or more of these moderate precision (1-2%) clock sources may be completely contained within the SOC <b>110</b> and may be used for internal charge pumps and NVM erase/program timing. They can also be the source of clocks for the FPGA and/or the external system where precise frequency control is not needed. The clock generator circuits block <b>118</b> in SOC <b>110</b> of the present invention may also include a crystal oscillator circuit. This relatively high-precision clock source (˜100 PPM) requires an inexpensive external crystal that may be connected to the SOC <b>110</b> through a pair of I/O pins as shown in <figref idref="DRAWINGS">FIG. 5</figref>. The clock-generator circuits block <b>118</b> can be used for all FPGA and system clock requirements. The SOC may further include one or more phase locked loops (PLLs) <b>120</b>.</p>
<p id="p-0063" num="0062">In addition, clock generator <b>118</b> of the SOC <b>110</b> of <figref idref="DRAWINGS">FIG. 5</figref> may also include a glitchless clock multiplexer to allow clean switching between multiple internal or external clock sources. The glitchless clock multiplexer may be used to provide a selectable low power (low frequency) mode to on-chip clocked systems, or to switch between clocks for any other application reason. This can save board space in a system in which the SOC is used and provides a reliable clock source for critical system management functions. An illustrative clock multiplexer will be described with reference to <figref idref="DRAWINGS">FIG. 6</figref>.</p>
<p id="p-0064" num="0063">A flash programming circuit <b>122</b> for programming the FPGA, is coupled to a JTAG TAP controller <b>124</b>, designed in accordance with the JTAG standard, for entering the programming data through a JTAG port <b>126</b> to define the configuration of the FPGA circuits as is known in the art. A security circuit implementing an encryption/decryption algorithm may be provided. For example, decryption circuit <b>128</b> may be a circuit designed to implement the AES encryption/decryption standard. The Advanced Encryption Standard (“AES”) (FIPS PUB <b>197</b>) National Institute of Standards and Technology (NIST), Gaithersburg, Md., is available from National Technical Information Service (NTIS), 5285 Port Royal Road, Springfield, Va. 22161. The Advanced Encryption Standard (AES) specifies a cryptographic algorithm that can be used to protect electronic data. The AES algorithm is a symmetric block cipher that can encrypt (encipher) and decrypt (decipher) information. The AES algorithm is capable of using cryptographic keys of 128, 192, and 256 bits to encrypt and decrypt data in blocks of 128 bits. The algorithm specified in this standard may be implemented in software, firmware, hardware, or any combination thereof. The specific implementation may depend on several factors such as the application, the environment, the technology used, etc. Encryption can be used to protect the FPGA configuration information, the contents of the non-volatile memory, etc.</p>
<p id="p-0065" num="0064">GPIO circuits that would normally be disposed along the lower edge of the FPGA core are shown replaced in <figref idref="DRAWINGS">FIG. 1</figref> by internal interface circuits <b>130</b> for making connections between the FPGA core <b>112</b> and the other SOC circuit blocks. According to one aspect of the present invention these GPIO circuits and interface blocks may be in the form of “tiles” having identical footprints.</p>
<p id="p-0066" num="0065">SOC <b>110</b> also includes at least one non-volatile memory (NVM) block. In the illustrative embodiment of the present invention shown in <figref idref="DRAWINGS">FIG. 5</figref> there are two NVM blocks <b>132</b> and <b>134</b> that are stand-alone flash memory arrays. According to another aspect of the present invention, the flash memory arrays are preferably sized between about 64 kBytes to about 512 Kbytes. Each of flash memory arrays <b>132</b> and <b>134</b> has built-in known charge pumps and programming circuits to allow each to operate independently from the other and from the FPGA core. The provision of more than one flash memory block permits the SOC <b>110</b> of <figref idref="DRAWINGS">FIG. 5</figref> to simultaneously perform two separate system functions using non-volatile memory. In the illustrative embodiment of the invention shown in <figref idref="DRAWINGS">FIG. 5</figref>, timing input is provided to the flash memory blocks from the on-chip clock generator circuits <b>118</b> for accurate/reliable programming and erase of each flash memory array <b>132</b> and <b>134</b>.</p>
<p id="p-0067" num="0066">According to another aspect of the present invention, provision is made for several possible NVM programming paths for NVM blocks <b>132</b> and <b>134</b>, including through the FPGA from data sources in the FPGA core <b>112</b>, through the FPGA core from data sources outside the FPGA core <b>112</b> through the GPIO <b>116</b>, directly from the JTAG port <b>124</b> from external JTAG masters (such as an FPGA programmer), and data streams decrypted by the AES block <b>126</b> from JTAG data sources. The FPGA to NVM module interface provides JTAG full capture and control boundary scan register functionality. A boundary scan register can directly control and capture all core to NVM inputs and can capture all NVM outputs in a manner known in the boundary-scan art.</p>
<p id="p-0068" num="0067">According to another aspect of the present invention, the NVM blocks <b>132</b> and <b>134</b> can be used to store data appropriate to provide power-up initialization of FPGA memories, analog-to-digital converter (ADC) sequencing and configuration data, system-wide power up parameters, program storage for microcontrollers or microprocessors, and general data storage as is known in the art.</p>
<p id="p-0069" num="0068">The SOC <b>110</b> of <figref idref="DRAWINGS">FIG. 5</figref> also includes an ADC <b>136</b>. According to one illustrative embodiment of the invention, the ADC may select from one of a plurality of multiplexed analog inputs and converts the applied voltage to an equivalent digital value. The ADC may also include selectable conversion resolution (e.g., 8, 10, or 12 bit conversion). According to one illustrative embodiment of the invention, a voltage reference input at the input of ADC <b>136</b> corresponds to full-scale output. As will be further disclosed herein, ADC <b>136</b> may include a multiplexer coupled to its input to allow multiple analog voltage sources to be used. The ADC <b>136</b> is coupled to analog I/O <b>138</b>. Analog I/O <b>138</b> is also coupled to interface tiles <b>130</b> as will be more fully disclosed herein.</p>
<p id="p-0070" num="0069">The SOC <b>110</b> of <figref idref="DRAWINGS">FIG. 5</figref> also includes a system supervisor master block <b>140</b>. System supervisor master block <b>140</b> includes an on-chip power up control block <b>142</b>, analog voltage supply charge pumps <b>144</b>, an on-chip voltage reference <b>146</b> and a system supervisor block <b>148</b>.</p>
<p id="p-0071" num="0070">Referring now to <figref idref="DRAWINGS">FIG. 6</figref>, an illustrative glitchless clock multiplexer <b>150</b> that is suitable for use in the SOC of the present invention is shown. Glitchless clock multiplexer <b>150</b> may be used to select between a “Clock A” input at line <b>152</b> and a “Clock B” input at line <b>154</b> by use of a select line <b>156</b>. The clock A input <b>152</b> drives the clock inputs of data latches <b>158</b> and <b>160</b> and one input of AND gate <b>162</b>. Select line <b>156</b> is coupled to one input of an AND gate <b>164</b> whose output drives the data input of data latch <b>158</b>.</p>
<p id="p-0072" num="0071">Similarly, the clock B input <b>154</b> drives the clock inputs of data latches <b>166</b> and <b>168</b> and one input of AND gate <b>170</b>. The data output of data latch <b>168</b> drives the other input of AND gate <b>170</b>. Select line <b>156</b> is coupled to one (inverted) input of an AND gate <b>172</b> whose output drives the data input of data latch <b>166</b>. The output of AND gate <b>170</b> drives the other (inverted) input of AND gate <b>164</b> and the output of AND gate <b>162</b> drives the other (inverted) input of AND gate <b>172</b>. The outputs of AND gates <b>162</b> and <b>170</b> drive inputs of OR gate <b>174</b>. Persons of ordinary skill in the art will observe that the circuit of <figref idref="DRAWINGS">FIG. 6</figref> allows selecting between the clock inputs A and B without producing any glitches at the output of OR gate <b>174</b>.</p>
<p id="p-0073" num="0072">As previously mentioned, analog I/O circuits <b>138</b> in <figref idref="DRAWINGS">FIG. 5</figref> are used to provide inputs and outputs to ADC <b>136</b>. According to one illustrative embodiment of the present invention, shown in <figref idref="DRAWINGS">FIG. 7</figref>, analog I/O functions may be grouped into sets. Analog I/O circuits <b>138</b> may contain a number of these sets.</p>
<p id="p-0074" num="0073">The set of analog I/O circuits shown in <figref idref="DRAWINGS">FIG. 7</figref> has four members. Persons of ordinary skill in the art will realize that <figref idref="DRAWINGS">FIG. 7</figref> is illustrative only, and a set of analog I/O circuits in an actual SOC may have fewer or more members. In the embodiment illustrated in <figref idref="DRAWINGS">FIG. 7</figref>, a first member <b>180</b> of the set may be a voltage input block coupled to I/O pad <b>182</b>. I/O pad <b>182</b> that may either have a direct connection to the input of ADC <b>136</b> (or one input of its input multiplexer), or may be connected to it through a buffered prescaler circuit <b>184</b>. Prescaler circuit <b>184</b> may have a programmable gain set to 1 of n selectable values as will be disclosed further herein. Multiplexer <b>186</b> is employed to select between the direct input or the prescaled input. The select inputs of multiplexer <b>186</b> may be controlled from the FPGA. According to another aspect of the SOC of the present invention, I/O pad <b>182</b> can be configured through digital input circuit <b>188</b> as a low-performance digital input to the FPGA core.</p>
<p id="p-0075" num="0074">A second member <b>190</b> of the set may be a current-monitor input block coupled to I/O pad <b>192</b>. Like I/O pad <b>182</b>, I/O pad <b>192</b> may either have a direct connection to the input of ADC <b>136</b> (or one input of its input multiplexer), or may be connected to it through a buffered prescaler <b>194</b>. Like prescaler <b>184</b>, prescaler <b>194</b> may have a programmable gain set to 1 of n selectable values as will be disclosed further herein. Multiplexer <b>196</b> is employed to select between the direct input from I/O pad <b>192</b> or the prescaled input. The select inputs of multiplexer <b>196</b> may be controlled from the FPGA. Like I/O pad <b>182</b>, I/O pad <b>192</b> can be configured through digital input circuit <b>198</b> as a low-performance digital input to the FPGA core.</p>
<p id="p-0076" num="0075">In addition to the functions that are identical to that for I/O pad <b>182</b>, set member <b>190</b> may be used to measure the difference between I/O pad <b>182</b> and <b>192</b>. This may be used to measure a voltage drop across a small resistor in series with an external power supply. I/O pad <b>192</b> is connected to one input of an amplifier <b>160</b>. The other input of amplifier <b>198</b> is coupled to I/O pad <b>182</b>. The output of amplifier <b>160</b> is presented to a third input of multiplexer <b>194</b>. If a low value (e.g., 0.1 ohms) resistor (not shown in FIG. <b>7</b>) is coupled between I/O pads <b>182</b> and <b>192</b>, and a voltage supply potential is coupled to I/O pad <b>182</b> and a load is coupled to I/O pad <b>192</b>, the voltage drop across that resistor can be sensed and amplified by amplifier <b>200</b>. That voltage drop is directly proportional to the current flowing through the resistor. An illustrative configuration for amplifier <b>160</b> is shown and described with reference to <figref idref="DRAWINGS">FIG. 9</figref>.</p>
<p id="p-0077" num="0076">A third member <b>210</b> of the set may be a temperature-monitor input block coupled to I/O pad <b>212</b>. Like I/O pad <b>182</b>, I/O pad <b>212</b> may either have a direct connection to the input of ADC <b>136</b> (or one input of its input multiplexer), or may be connected to it through a buffered prescaler <b>214</b>. Like prescaler <b>184</b>, prescaler <b>214</b> may have a programmable gain set to 1 of n selectable values as will be disclosed further herein. Multiplexer <b>216</b> is employed to select between the direct input from I/O pad <b>210</b> or the prescaled input. The select inputs of multiplexer <b>216</b> may be controlled from the FPGA. Like I/O pad <b>182</b>, I/O pad <b>212</b> can be configured through digital input circuit <b>218</b> as a low-performance digital input to the FPGA core.</p>
<p id="p-0078" num="0077">In addition to the functions that are identical to that for I/O pad <b>182</b>, set member <b>210</b> may be used as a temperature monitor for a signal on I/O pad <b>212</b>. This set member <b>210</b> may be configured to measure temperature of an external diode by taking advantage of the temperature behavior of the I-V characteristics of a diode. A temperature monitor circuit <b>220</b> may also be coupled to an input of multiplexer <b>216</b>. The SOC of the present invention may be supplied with a plurality of temperature monitor circuits. According to one embodiment of the invention, a number of temperature sensors are for measuring external temperature (e.g., the junction temperatures of other ICs or air temperature) and one for measuring its own junction temperature. Temperature monitor circuit <b>220</b> is explained in more detail with reference to <figref idref="DRAWINGS">FIG. 10</figref>.</p>
<p id="p-0079" num="0078">A fourth member <b>230</b> of the set may be a gate-driver output block coupled to I/O pad <b>232</b>. Power MOSFET gate driver circuit <b>234</b> drives I/O pad <b>232</b> from the FPGA. I/O pad <b>232</b> may be coupled to I/O pad <b>232</b> and/or I/O pad <b>212</b> through either of pull-up resistors <b>236</b> and <b>238</b>, respectively. Persons of ordinary skill ion the art will realize that resistors <b>236</b> and <b>238</b> are optional. An optional ramp resistor <b>200</b> may be coupled to I/O pad <b>232</b> or I/O pad <b>212</b>. Gate driver circuit <b>234</b> is explained in more detail with reference to <figref idref="DRAWINGS">FIG. 11</figref>.</p>
<p id="p-0080" num="0079">According to one embodiment of the present invention, the pre-scaler circuits <b>184</b>, <b>194</b>, and <b>214</b> are provided to scale external voltages up or down. Referring now to <figref idref="DRAWINGS">FIG. 8</figref>, a pre-scaler circuit is shown that can scale external voltages by one of eight factors. The pre-scaler circuit can be used in voltage monitor functions or in any analog input functions. The pre-scaler circuit may be based upon a current mirror circuit. A first side of the current mirror circuit including a resistor <b>250</b> coupled between I/O pad <b>192</b> and diode-connected n-channel MOS transistor <b>252</b>. The gate and drain of diode-connected n-channel MOS transistor <b>252</b> are connected to the gates of n-channel MOS transistors <b>254</b>, <b>256</b>, <b>258</b>, and <b>260</b>. The ratios of the width of diode-connected n-channel MOS transistor <b>252</b> to the widths of n-channel MOS transistors <b>254</b>, <b>256</b>, <b>258</b>, and <b>260</b> are selected to produce the desired scaling factors.</p>
<p id="p-0081" num="0080">The sources of n-channel MOS transistors <b>254</b>, <b>256</b>, <b>258</b>, and <b>260</b> are coupled to a fixed potential, such as ground, through enable n-channel transistors <b>262</b>, <b>264</b>, <b>266</b>, and <b>268</b>, respectively. The gates of enable n-channel transistors <b>262</b>, <b>264</b>, <b>266</b>, and <b>268</b> are driven from a decoder circuit <b>310</b>. The control lines of decoder circuit <b>310</b> are driven from the FPGA array. The drains of n-channel MOS transistors <b>254</b>, <b>256</b>, <b>258</b>, and <b>260</b> are coupled together to the non-inverting input of operational amplifier <b>312</b>. Resistor <b>314</b> sets the gain of operational amplifier <b>312</b>.</p>
<p id="p-0082" num="0081">According to one aspect of the invention, the following voltage-scaling factors: 0.20161, 0.40322, 0.80645, 1.6129, 3.2258, 6.45161, 12.90322, and 25.80645 have been found to be particularly useful. This is particularly useful where the full-scale voltage of ADC <b>136</b> of <figref idref="DRAWINGS">FIG. 5</figref> is 3.3V. The choice of these eight scaling factors is controlled by three binary control signals coming from the FPGA. Using these factors 16V can be scaled down to 3.3V using the factor 0.20161 (16*0.20161=3.3) and 125 mv can be scaled up to 3.3V using the factor 25.80645 (0.125*25.80645=3.3). Also the pre-scaler can scale negative voltages to positive voltages (i.e. −16V can be converted to 3.3V). Hence the function of the pre-scaler is to convert input voltages into ranges that are acceptable by the ADC. The reason for employing the exemplary scaling factors recited herein is for user convenience to achieve correspondence between the digital output of the ADC and one-millivolt steps. From an examination of this disclosure, persons of ordinary skill in the art will appreciate that any number of different scaling factors may be selected.</p>
<p id="p-0083" num="0082">An illustrative configuration for amplifier <b>200</b> of <figref idref="DRAWINGS">FIG. 7</figref> is shown and described with reference to <figref idref="DRAWINGS">FIG. 8</figref>. External resistor <b>280</b> is shown coupled between I/O pads <b>142</b> and <b>192</b>. By the initial positions of switches <b>282</b>, <b>284</b>, <b>286</b>, and <b>288</b> (shown in <figref idref="DRAWINGS">FIG. 8</figref>), the offset value of the operational amplifier <b>290</b> is stored in capacitor <b>292</b> so that the output of the operational amplifier <b>250</b> is approximately at ground. Also the capacitors <b>294</b> and <b>296</b> are charged to the voltage level which is at the right side of the external resistor <b>280</b> and the non-inverting input of the operational amplifier <b>290</b> is at ground. The inverting input of operational amplifier <b>290</b> is at virtual ground. Switches <b>282</b>, <b>284</b>, <b>286</b>, and <b>288</b> are then switched in order (first switch <b>282</b>, then switch <b>284</b>, then switch <b>286</b>, then switch <b>288</b>). After all the switches <b>282</b>, <b>284</b>, <b>286</b>, and <b>288</b> are at their new positions, the voltage drop across the external resistor <b>280</b> is amplified by the operational amplifier <b>290</b> with a gain defined by (C<sub>256</sub>+C<sub>258</sub>)/C<sub>258</sub>. The output voltage of the operational amplifier <b>290</b> is applied to the input of the ADC. Since the value of the external resistor value is known, the current through the external resistor is known. The configuration of the circuit of <figref idref="DRAWINGS">FIG. 9</figref> has the advantage of avoiding amplifying the voltage offset of operational amplifier <b>290</b>.</p>
<p id="p-0084" num="0083">Referring now to <figref idref="DRAWINGS">FIG. 10</figref>, temperature monitor circuit <b>220</b> is explained in more detail. This circuit forces two different currents through a diode and measures the voltage drop difference across the diode. It then amplifies this voltage by a factor of five and sends it to the ADC. This amplified voltage difference directly corresponds to temperature (in ° K).</p>
<p id="p-0085" num="0084">For example, as shown in <figref idref="DRAWINGS">FIG. 10</figref>, a voltage difference of 59.6 mV (corresponding to diode temperature of 25° C.) is measured by sequentially forcing 10 uA and 100 uA across diode <b>300</b>. This is amplified 5×—which gives 298 mV—which corresponds to 298K (25 C). Diode is coupled to I/O pad <b>212</b>. Two current-generating circuits are shown, allowing the diode <b>300</b> to be oriented in either direction. The first current-generating circuit which sources current includes a first leg including p-channel MOS transistors <b>302</b>, <b>304</b>, and <b>306</b> coupled in series between a supply potential of +3.3 VDC and the I/O pad <b>212</b>. The gate of transistor <b>302</b> is coupled to a positive bias potential. The gate of transistor <b>304</b> is coupled to ground and the gate of transistor <b>306</b> is coupled to a Source/Sink control signal. The sizes of transistors <b>302</b>, <b>304</b>, and <b>306</b> and the value of the positive bias potential are chosen to cause 10 μA to flow (source) through diode <b>300</b>.</p>
<p id="p-0086" num="0085">The second leg in the first current-generating circuit includes p-channel MOS transistors <b>308</b>, <b>310</b>, and <b>312</b> coupled in series between the supply potential of +3.3 VDC and the I/O pad <b>212</b>. The gate of transistor <b>308</b> is coupled to the positive bias potential. The gate of transistor <b>310</b> is coupled to a control signal “S” and the gate of transistor <b>312</b> is coupled to the Source/Sink control signal. The sizes of transistors <b>308</b>, <b>310</b>, and <b>312</b> and the value of the positive bias potential are chosen to cause an additional 90 μA to flow (source) through diode <b>300</b>.</p>
<p id="p-0087" num="0086">Similarly, The second current-generating circuit which sinks current includes a first leg including n-channel MOS transistors <b>314</b>, <b>316</b>, and <b>318</b> coupled in series between a supply potential of −3.3 VDC and the I/O pad <b>212</b>. The gate of transistor <b>314</b> is coupled to a negative bias potential. The gate of transistor <b>316</b> is coupled to a positive voltage and the gate of transistor <b>318</b> is coupled to the Source/Sink control signal. The sizes of transistors <b>314</b>, <b>316</b>, and <b>318</b> and the value of the negative bias potential are chosen to cause 10 μA to flow (sink) through diode <b>300</b>.</p>
<p id="p-0088" num="0087">The second leg in the first current-generating circuit includes n-channel MOS transistors <b>280</b>, <b>282</b>, and <b>284</b> coupled in series between the supply potential of −3.3 VDC and the I/O pad <b>212</b>. The gate of transistor <b>280</b> is coupled to the negative bias potential. The gate of transistor <b>282</b> is coupled to the control signal “S” and the gate of transistor <b>284</b> is coupled to the Source/Sink control signal. The sizes of transistors <b>280</b>, <b>282</b>, and <b>284</b> and the value of the negative bias potential are chosen to cause 90 μA to flow (sink) through diode <b>300</b>.</p>
<p id="p-0089" num="0088">If the Source/Sink control signal is low, the current sourcing transistors operate. If the Source/Sink control signal is high, the current sinking transistors operate. In either case, the first leg of the circuit (either transistors <b>302</b>, <b>304</b>, and <b>306</b> or transistors <b>314</b>, <b>316</b>, and <b>318</b>) are turned on, sourcing or sinking 10 μA through diode <b>300</b>. When the “S” (or “S!”) signal is asserted, the second leg of the circuit (either transistors <b>308</b>, <b>310</b>, and <b>312</b> or transistors <b>320</b>, <b>322</b>, and <b>324</b>) is also turned on, sourcing or sinking a total of 100 μA through diode <b>300</b>.</p>
<p id="p-0090" num="0089">The remaining components of the circuit include operational amplifier <b>326</b> having its non-inverting input grounded, capacitor <b>328</b> coupled between I/O pad <b>212</b> and the inverting input of operational amplifier <b>326</b>, and capacitor <b>330</b>, coupled between the inverting input of operational amplifier <b>326</b> and its output through n-channel MOS transistor <b>332</b>. In the example of <figref idref="DRAWINGS">FIG. 10</figref>, capacitor <b>328</b> has five times the capacitance of capacitor <b>330</b>, which determines the gain of the circuit. Capacitor <b>330</b> stores and thus cancels the offset of operational amplifier <b>326</b>.</p>
<p id="p-0091" num="0090">The common connection of capacitor <b>330</b> and transistor <b>332</b> is coupled to ground through n-channel MOS transistor <b>334</b>. The gate of transistor <b>332</b> is coupled to a control signal Y! and the gate of transistor <b>334</b> is connected to a control signal Y. An n-channel MOS transistor <b>336</b> is coupled between the inverting input sand the output of operational amplifier <b>326</b> and has its gate coupled to a control signal X. An n-channel MOS transistor <b>338</b> is coupled to the inverting input of operational amplifier <b>326</b> and has its gate coupled to a control signal X!. The relative timing of the control signals X, Y, Y! and S is shown at the right side of <figref idref="DRAWINGS">FIG. 10</figref>. The difference in diode voltage before and after the timing sequence is amplified by the circuit gain and appears at the output of the operational amplifier <b>326</b>, corresponding to the absolute temperature.</p>
<p id="p-0092" num="0091">Persons of ordinary skill in the art will appreciate that the actual current source and sink levels, supply voltage values circuit gains can be changed without changing the nature of the circuit operation. In addition, such skilled persons will realize that, while a single-ended circuit is shown in <figref idref="DRAWINGS">FIG. 10</figref>, a differential circuit could be used to measure the voltage across the diode.</p>
<p id="p-0093" num="0092">Referring now to <figref idref="DRAWINGS">FIG. 11</figref>, the operation of gate driver circuit <b>234</b> of <figref idref="DRAWINGS">FIG. 7</figref> is explained in more detail. External power MOSFET <b>340</b> has its source coupled to supply potential <b>342</b>. Its gate is coupled to I/O pad <b>232</b> and its drain is coupled to I/O pad <b>212</b> or <b>192</b> (see <figref idref="DRAWINGS">FIG. 7</figref>). If supply potential <b>342</b> is positive, power MOSFET <b>340</b> will be a p-channel device and if supply potential <b>342</b> is negative, power MOSFET <b>340</b> will be an n-channel device. Resistor <b>236</b> or <b>238</b> (again see <figref idref="DRAWINGS">FIG. 7</figref>) may be disposed in the SOC device and is used to assure that the power MOSFET <b>340</b> will be turned off unless a gate drive signal is supplied at I/O pad <b>232</b>.</p>
<p id="p-0094" num="0093">Operational amplifier <b>344</b> drives the gate of p-channel MOS gate-drive transistor <b>346</b>. The drain of p-channel MOS gate-drive transistor <b>346</b> is coupled to I/O pad <b>232</b>. The source of p-channel MOS transistor gate-drive <b>346</b> is coupled to a positive supply potential through p-channel MOS enable transistor <b>348</b>. The non-inverting input of operational amplifier <b>344</b> is coupled to the drain of power MOSFET <b>340</b> via I/O pad <b>192</b> (or <b>212</b>) through resistor <b>350</b>. The inverting input of operational amplifier <b>348</b> is coupled to capacitor <b>352</b> driven by constant-current source <b>354</b>.</p>
<p id="p-0095" num="0094">Similarly, operational amplifier <b>356</b> drives the gate of n-channel MOS gate-drive transistor <b>358</b>. The drain of n-channel MOS gate-drive transistor <b>358</b> is coupled to I/O pad <b>232</b>. The source of n-channel MOS transistor gate-drive <b>358</b> is coupled to a negative supply potential through n-channel MOS enable transistor <b>360</b>. The inverting input of operational amplifier <b>356</b> is coupled to the drain of power MOSFET <b>340</b> via I/O pad <b>192</b> (or <b>212</b>) through resistor <b>340</b>. The non-inverting input of operational amplifier <b>356</b> is coupled to capacitor <b>362</b> driven by constant-current source <b>364</b>. The non-inverting input of operational amplifier <b>344</b> and the inverting input of operational amplifier <b>356</b> are coupled to ground through resistor <b>366</b>.</p>
<p id="p-0096" num="0095">In the example shown in <figref idref="DRAWINGS">FIG. 11</figref> where an n-channel MOS power transistor <b>340</b> is to be driven, p-channel enable transistor <b>348</b> is turned on. To turn on n-channel MOS power transistor <b>340</b>, current source <b>354</b> is turned on and charges capacitor <b>352</b> at a linear rate. The voltage on capacitor <b>352</b> is amplified with a negative gain, producing a decreasing ramp voltage at the output of operational amplifier <b>348</b>. This causes a decreasing ramp voltage at the drain of p-channel gate drive transistor <b>346</b> to turn on p-channel MOS power transistor <b>340</b>. The final gate voltage on the MOS power transistor <b>340</b> is established by the IR drop across the gate-to-source resistor <b>236</b> or <b>238</b> and is determined by the current through the p-channel enable transistor <b>348</b>. If it is desired to turn on a p-channel MOS power transistor, n-channel enable transistor <b>360</b> is turned on, current source <b>364</b> is turned on and charges capacitor <b>362</b> at a linear rate. The voltage on capacitor <b>362</b> is amplified with a positive gain, producing an increasing ramp voltage at the output of operational amplifier <b>356</b>. This causes an increasing ramp voltage at the drain of n-channel gate drive transistor <b>358</b> to turn on the p-channel MOS power transistor. The feedback provided to the operational amplifiers <b>344</b> and <b>356</b> through resistor <b>350</b> assures controlled ramp rates on the load.</p>
<p id="p-0097" num="0096">Referring now to <figref idref="DRAWINGS">FIG. 12</figref>, illustrative embodiments of internal interface circuits <b>130</b> (<figref idref="DRAWINGS">FIG. 5</figref>) that are particularly useful for the SOC of the present invention are shown. Persons of ordinary skill in the art will observe that the circuits shown in <figref idref="DRAWINGS">FIG. 12</figref> are illustrative only and not limiting. Such skilled persons will appreciate that other interface circuits may be used.</p>
<p id="p-0098" num="0097">Internal interface circuit <b>130</b> (<figref idref="DRAWINGS">FIG. 5</figref>) may include a plurality of “tiles”, each having a plurality of different types of interface circuits. For the purposes of this disclosure, a “tile” is a layout subunit where the inputs and outputs are placed in the same physical locations to allow for modular chip design. More than one of each type of circuit may be included in each tile, the exact number of each being a matter of design choice.</p>
<p id="p-0099" num="0098">For example, a pair of buffers <b>370</b> and <b>372</b> may be provided. Buffers <b>370</b> and <b>372</b> are shown in <figref idref="DRAWINGS">FIG. 12</figref> having their inputs coupled together and having their outputs independently connectable. Buffers <b>370</b> and <b>372</b> act as input buffers for the FPGA core.</p>
<p id="p-0100" num="0099">Internal interface circuit <b>130</b> may also include inverting buffer <b>374</b> disposed between an input node <b>376</b> and an output node <b>378</b>. A first programmable element <b>380</b> is coupled between the input of buffer <b>374</b> and the output node <b>378</b>. A second programmable element <b>382</b> is coupled between the output of buffer <b>374</b> and the output node <b>378</b>. To bypass buffer <b>374</b>, programmable element <b>380</b> is programmed and programmable element <b>382</b> is left unprogrammed, connecting input node <b>376</b> directly to output node <b>378</b>. To place the buffer <b>374</b> in the circuit, programmable element <b>382</b> is programmed and programmable element <b>380</b> is left unprogrammed, coupling input node <b>376</b> to output node <b>378</b> through buffer <b>374</b>. Buffer <b>374</b> acts as an output buffer for the FPGA core.</p>
<p id="p-0101" num="0100">In addition, a pair of programmable elements <b>384</b> and <b>386</b> may be connected in series between a logic-high voltage potential and a logic-low voltage potential. The common connection between these programmable elements is used as an output node <b>388</b> to drive, for example, the gate of transistor <b>348</b> or <b>360</b> in <figref idref="DRAWINGS">FIG. 11</figref>, or at least one of the control lines of multiplexers <b>186</b> <b>196</b> <b>216</b> of <figref idref="DRAWINGS">FIG. 7</figref>.</p>
<p id="p-0102" num="0101">According to an illustrative embodiment of the invention, power for the analog portion of the ADC <b>136</b> may be 3.3V. The analog I/O circuits may also employ a +/−3.3V supply. These supply voltages may be generated on chip from the 1.5V V<sub>CC </sub>power supply using charge pump circuits in a manner known in the art. Alternatively, 3.3 volts may be supplied to the SOC and 1.5 volts may be generated on chip by regulating down from the 3.3 volts.</p>
<p id="p-0103" num="0102">A high-precision voltage is needed as a reference voltage input to the ADC <b>136</b> or may be generated within the ADC <b>136</b>. This voltage may be scaled from an on chip Bandgap voltage source using known techniques. Such a bandgap reference is shown in <figref idref="DRAWINGS">FIG. 13</figref>. A first grounded-base PNP transistor <b>390</b> has a resistor <b>392</b> coupled between its emitter and the output of operational amplifier <b>394</b>. A second grounded base pnp transistor <b>396</b> has a pair of resistors <b>398</b> and <b>400</b> coupled between its emitter and the output of operational amplifier <b>394</b>. The emitter of transistor <b>390</b> is coupled to the non-inverting input of operational amplifier <b>394</b> and the common connection of resistors <b>398</b> and <b>400</b> is coupled to the inverting input of operational amplifier <b>394</b>. The output voltage V<sub>ref </sub>of the operational amplifier <b>394</b> is given by the expression shown in <figref idref="DRAWINGS">FIG. 13</figref>.</p>
<p id="p-0104" num="0103">A separate power source for the bandgap reference is useful for reducing the risk of coupling noise from FPGA sources. The output of the bandgap reference may also be used for controlling the level of on-chip generated analog supplies. The output of the bandgap reference may be supplied to the non-volatile memory (NVM) blocks if the particular NVM being used requires a stable reference voltage (e.g., for the sense amplifiers). The bandgap reference circuit is used to generate a reference voltage that will be used by other analog blocks as well as the ADC <b>136</b> of <figref idref="DRAWINGS">FIG. 5</figref>. The operational amplifier <b>394</b> is not necessarily but advantageously powered by a 3.3V charge pump. Although the V<sub>ref </sub>output of the circuit is voltage-, process-, and temperature-independent, the minimum voltage supply required by the operational amplifier is about 1.35V. Hence it is preferably supplied by a 3.3V charge pump and not by 1.5V V<sub>CC</sub>.</p>
<p id="p-0105" num="0104">Referring now to <figref idref="DRAWINGS">FIG. 14</figref>, ADC <b>136</b> of <figref idref="DRAWINGS">FIG. 5</figref> is shown in more detail. ADC <b>136</b> may be a capacitor-based successive approximation (SAR) ADC as is known in the art. The ADC <b>136</b> is divided into two portions, an analog portion <b>410</b> and a digital portion <b>412</b>. The analog portion <b>410</b> contains an analog multiplexer <b>414</b>, capacitor array <b>416</b> and a comparator <b>418</b>. The digital part contains successive approximation register <b>420</b>, clock divider <b>422</b>, and conversion control logic <b>424</b>. Also, as is known in the art, calibration logic <b>426</b> is coupled to a calibration capacitor array <b>428</b>.</p>
<p id="p-0106" num="0105">In the illustrative example shown in <figref idref="DRAWINGS">FIG. 14</figref>, the analog multiplexer <b>414</b> chooses one out of 32 input channels. Once a channel is selected using the multiplexer select lines, it charges the main capacitor array <b>416</b> during the sample phase. After that the sampled input that charged the capacitor array is compared to a known voltage and based on the compare result the capacitors are switched according to the successive approximation algorithm. When the two inputs of comparator <b>418</b> are equal, the data in the successive approximation register <b>420</b> is the digital equivalent of the analog input. Clock divider and sample time (which are programmable) determine the speed of this conversion.</p>
<p id="p-0107" num="0106">Referring again to <figref idref="DRAWINGS">FIG. 5</figref>, system supervisor master <b>140</b> is intended to provide all chip-level and system level power-on/initialization/reset functions. The power-up control circuit includes circuitry for managing the SOC device during power-up, as will be described in more detail below.</p>
<p id="p-0108" num="0107">The analog power supply circuitry may include known power supply and management circuits, for supplying the required voltages for operation of the various circuit blocks of the SOC device, as well as different voltages for programming the programmable elements of the SOC device. In the embodiment shown in <figref idref="DRAWINGS">FIG. 5</figref>, the programmable logic block and digital hardwired blocks have their own power supply circuits separate from the system controller circuit block. In this embodiment, the system controller circuit does include an analog power supply circuit block <b>144</b>. The analog power supply circuit block <b>144</b> supplies power to the analog blocks as well as performing power monitoring functions for monitoring the power input to all blocks on the SOC device. The analog power supply circuitry includes voltage monitoring circuits, charge pumps, and voltage supply circuitry. These types of circuits are all known in the art and are used on other types of semiconductor devices, such as ASICs.</p>
<p id="p-0109" num="0108">The analog power supply circuitry <b>144</b> includes a voltage conversion and supply circuit block that may include, for example, voltage reference circuits, charge pumps, switching supplies, switch regulators, buck/boost regulators, and voltage regulators. Use of such circuits is known by those skilled in the art. Different circuit blocks in the SOC device may require different voltages, and these voltages may be different from the voltage supplied by the system of which the SOC device is a part. The voltage conversion and supply circuitry may be implemented, therefore, to provide the required power to the various components, as is known in the art. Once the voltage input to the device has been stepped up or stepped down, if required, via the circuits discussed above, the required voltages are provided to the various components of the SOC device via hardwired power lines.</p>
<p id="p-0110" num="0109">In the illustrative example of this disclosure, the voltage input to the device may be 3.3V, but the hardwired analog circuit blocks may require 1.5V so the voltage conversion and supply circuitry steps the device input voltage (V<sub>CC</sub>) down to 1.5V in order to supply the digital circuits with the proper voltage. In the alternative 1.5 volts could be supplied to the SOC and pumped up to 3.3 volts. In the embodiment shown in the figure, other elements of the SOC, such as the programmable logic block and the non-volatile memory block have separate voltage conversion and supply circuitry that is not included in the system controller circuit block.</p>
<p id="p-0111" num="0110">The analog power supply circuitry <b>144</b> also includes a voltage monitoring circuit for comparing an input voltage to a reference voltage, as is known in the art. The voltage monitoring circuit receives a voltage reference signal (e.g., a bandgap reference signal from a voltage reference circuit, described below) as an input and uses it to compare other voltage supplies (e.g., the programmable logic block voltage supply, the non-volatile memory voltage supply, and the analog voltage supply) on the SOC device to the bandgap reference. If the voltages of the monitored supplies do not compare favorably with the reference voltage (i.e., are outside a predetermined error range), the voltage monitoring circuit may output a signal indicating the problem. The output error signal could be used to delay start-up, trigger power down, generate one or more resets, assert an interrupt, or shut down operation of the SOC device.</p>
<p id="p-0112" num="0111">A voltage reference circuit <b>146</b> included in the system controller circuit may be, for example, a bandgap reference circuit like the one described previously with reference to <figref idref="DRAWINGS">FIG. 13</figref>, or other type of circuit known in the art for supplying an accurate reference voltage. A bandgap reference circuit provides an absolute voltage output for reference by other circuits on the SOC device. Other power supplies can be compared to the reference voltage, as described above. The voltage reference circuit <b>146</b> may include other circuitry, for example, operational amplifiers and buffers to change the level of the voltage. Bandgap voltage reference circuits other than the one illustrated in <figref idref="DRAWINGS">FIG. 13</figref> may be used in other embodiments of the invention, such as, for example a bandgap voltage reference circuit available from QualCore Logic, Inc, of Sunnyvale, Calif. that may be adapted for use in the particular SOC device. This bandgap voltage reference circuit may be separate from the general bandgap voltage source used for other circuit blocks on the SOC device, such as the programmable logic block, in order to provide a high-precision voltage input for components such as the ADC circuit, and to reduce the risk of coupling noise from other circuits.</p>
<p id="p-0113" num="0112">The power-up control circuit <b>142</b> controls the internal power-up sequence of the SOC device. The power-up sequence is used to insure that circuits receive the proper initialization, in the proper order, as power is supplied to the device. A typical power-up sequence is shown in the state-machine diagram of <figref idref="DRAWINGS">FIG. 15A</figref>. Use of such a sequence reduces the chance for errors or damage to the SOC device resulting from circuits operating at an improper voltage (e.g., insufficient voltage or excessive voltage due to a spike) or to an improper sequence (e.g., an active circuit trying to communicate with a circuit that is not yet initialized. The power-up control circuit <b>142</b> includes circuits that determine whether sufficient voltage is present to activate a circuit during power-up. These circuits can also be used to monitor the same voltages during operation of the SOC device, in addition to monitoring voltages during power-up. A timing diagram showing a typical startup sequence is shown in <figref idref="DRAWINGS">FIG. 15B</figref>.</p>
<p id="p-0114" num="0113">A power-up control circuit <b>142</b> implementing a power-up sequence such as the example described herein may be implemented in hardwired circuitry, or a combination of hardwired circuitry and programmable logic. As is known in the art, regulator circuits, charge pumps, voltage reference generators, etc. must be implemented in hardwired circuits, while sequence and control circuits may be implemented in hardwired circuits or programmed in programmable logic, as long as they are not required to be used before the programmable logic block is active.</p>
<p id="p-0115" num="0114">As shown in <figref idref="DRAWINGS">FIG. 16</figref>, a more detailed block diagram of system supervisor master block <b>140</b> from <figref idref="DRAWINGS">FIG. 5</figref>, the power-up control circuit <b>142</b> is shown to be comprised of circuits employing standard circuit elements to provide signals to activate various elements of the SOC device when the proper conditions are met (e.g., timing, sufficient voltage, etc.). In the embodiment shown in <figref idref="DRAWINGS">FIG. 16</figref>, the power-up control circuit includes a voltage-reference-good circuit <b>440</b> for indicating that the circuit supplying the reference voltage is active and functioning within predetermined parameters. The power-up control circuit also includes circuits <b>442</b> and <b>444</b> for indicating that each voltage supply (3.3V and 1.5V, in the example shown) is good (meaning active and functioning within predetermined parameters). The power-up control circuit may also include voltage filter circuits for filtering voltages supplied to various components of the SOC device, such as, for example, the Vdd filter circuit <b>446</b> shown in <figref idref="DRAWINGS">FIG. 16</figref>.</p>
<p id="p-0116" num="0115">In addition to verifying and managing the power supplies, the power-up control circuit includes circuitry for activating various components of the SOC device such as the programmable logic block (circuit <b>448</b>) and the non-volatile memory block (circuit <b>410</b>), determining whether the component has become active, and outputting a signal to indicate that the circuit has become active. The signal indicating that a component is active may be used to activate the next step in the power-up sequence. Also shown in <figref idref="DRAWINGS">FIG. 16</figref> are circuits for managing the power-up functions of the ADC. Specifically, the ADC-reference-good circuit <b>412</b> indicates that the reference voltage input to the ADC is accurate, and ADC-calibrate circuit <b>414</b> to indicates that the ADC is calibrated.</p>
<p id="p-0117" num="0116">The particular circuits used in actual embodiments of the present invention embodiments will depend on the particulars of the programmable logic, memory, analog, and digital hardwired blocks employed in the particular device. Examples of standard circuits that may be adapted to perform the power-up control functions are multiplexers, control circuits, power monitor circuits, crystal oscillators, bandgap reference circuits, operational amplifiers, instrument amplifiers, charge pumps, filters, power supply regulators, known in the art and available from circuit design and IP licensing companies such as QualCore Logic, Inc., Sunnyvale, Calif.; TriCN, Inc., San Francisco, Calif.; or SliceX, Inc., Salt Lake City, Utah.</p>
<p id="p-0118" num="0117"><figref idref="DRAWINGS">FIG. 17</figref> shows a portion of the power-up control circuit <b>460</b> for performing functions early in the power-up sequence. Also shown in <figref idref="DRAWINGS">FIG. 17</figref> is the voltage reference (bandgap) circuit of <figref idref="DRAWINGS">FIG. 13</figref> in communication with the power-up circuits. For illustration purposes, the power-up circuits shown in <figref idref="DRAWINGS">FIG. 17</figref> are a 1.5 volt regulator circuit <b>462</b> for supplying 1.5 volts to the digital circuitry of the SOC device, a −Ve charge pump circuit <b>464</b> for supplying a negative voltage for the hardwired analog circuits of the SOC device, and a Vdd filter circuit <b>466</b> for providing a filtered 3.3 volt source to circuits requiring a filtered voltage (e.g., the bandgap voltage regulator circuit).</p>
<p id="p-0119" num="0118">More particularly, 3.3V is supplied to the SOC through I/O pad <b>468</b> and is supplied to 1.5 volt regulator circuit <b>462</b> as shown. As can be seen from <figref idref="DRAWINGS">FIG. 17</figref>, I/O pad <b>468</b> is also coupled to −Ve charge pump circuit <b>464</b> and to Vdd filter circuit <b>466</b>. The 1.5V output of 1.5 volt regulator circuit <b>462</b> drives the base of external emitter-follower NPN transistor <b>470</b> through I/O pad <b>472</b>. The output of the external transistor <b>470</b> is fed back to 1.5 volt regulator circuit <b>462</b> via I/O pad <b>474</b>. Comparator <b>476</b> produces the 3.3V supply good signal when the voltage on I/O pad <b>474</b> is above the value set by the voltage from the 1.5 volt regulator <b>462</b>. Comparator <b>478</b> produces the 1.5V supply good signal when the voltage on I/O pad <b>474</b> is above a preset value derived from the voltage at I/O pad <b>474</b>.</p>
<p id="p-0120" num="0119">The output of −Ve charge pump circuit <b>464</b> is presented at I/O pad <b>480</b> and the output of Vdd filter circuit <b>466</b> is presented at I/O pad <b>482</b>.</p>
<p id="p-0121" num="0120">As shown in the power-up sequence flow chart of <figref idref="DRAWINGS">FIG. 15A</figref>, the first signal produced in the power-up sequence is the bandgap-good signal. This signal indicates that the bandgap reference circuit is outputting the accurate, regulated voltage for which it is designed. Since this voltage is the reference for the other circuits on the device, it is the first required to be operational during power-up. As power input to the bandgap circuit increases during power-up, the voltage output by the bandgap circuit almost exactly matches the input voltage until the input voltage rises above the voltage the bandgap circuit is designed to output (“reference voltage”). The reference voltage for the device is generally below the input voltage (Vcc) of the SOC device. For example, the reference voltage for the SOC device may be 1.2V where Vcc for the SOC device is 3.3 volts.</p>
<p id="p-0122" num="0121">The portion of the power-up control circuit shown in <figref idref="DRAWINGS">FIG. 17</figref> also includes a threshold p-channel MOS transistor <b>484</b> and a small current source <b>486</b> for indicating when the bandgap reference circuit <b>488</b> is outputting the correct bandgap output voltage. In the example shown in <figref idref="DRAWINGS">FIG. 17</figref>, the bandgap circuit <b>488</b> receives a voltage input from the Vdd filter circuit <b>466</b> and outputs a controlled voltage via an output <b>490</b>. The source of threshold transistor <b>484</b> is coupled to the Vdd filter circuit output, and a buffer <b>500</b> and the current source <b>486</b> are connected to the drain of threshold transistor <b>484</b>. The gate of the threshold transistor <b>484</b> is connected to the bandgap output <b>490</b>. In this configuration, the threshold transistor <b>484</b> will turn on when the voltage input to the bandgap circuit <b>488</b> exceeds the bandgap circuit output by the threshold of the p-channel threshold transistor <b>484</b>. Once the threshold transistor <b>484</b> turns on, current flows through the threshold transistor <b>484</b> and the bandgap-good signal is activated, via the buffer <b>500</b>. This insures that the bandgap circuit <b>488</b> will not be indicated as active until it is outputting the proper reference voltage.</p>
<p id="p-0123" num="0122">The threshold of the threshold transistor <b>484</b> may be designed to a predetermined value by varying the geometry and materials of the transistor, as is known in the art. Although the exact threshold may vary with temperature, the transistor can be designed so any variance will not interfere with the basic functionality of the circuit. This functionality can be maintained as long as the general input voltage for the device sufficiently exceeds the reference voltage. A small current source <b>486</b>, on the order of 1 μA, connected between the buffer <b>500</b> and ground insures that the current through the threshold transistor <b>484</b> is sufficient before the bandgap good signal is activated at the output of buffer <b>500</b>. Once the bandgap good signal is activated, indicating that there is an accurate reference voltage available on the device, the other circuits in the power-up control circuit can begin their operations, for example, by comparing their input voltages to the known good reference voltage.</p>
<p id="p-0124" num="0123">The system controller circuit block <b>140</b> also includes a system supervisor circuit. The system supervisor circuit may be implemented in hardwired circuits, programmed into programmable logic, or a combination of both. The system supervisor circuit block <b>148</b> manages on-chip and off-chip signals following the power-up of the SOC device. Once the SOC device is powered up and active, the system supervisor circuit block may perform power-up management of the system of which the SOC device of the present invention is a part, and provide other system management functions such as managing voltage monitoring circuits to monitor system voltages during operation. The system supervisor block may communicate with off-chip devices via, for example, a hardwired JTAG interface circuit block <b>124</b> included in the system controller circuit block <b>140</b>, a hardwired interface designed in accordance with another interface standard, or via the general purpose I/Os of the SOC device.</p>
<p id="p-0125" num="0124">The system supervisor <b>148</b> may use, for example, known circuits such as a microprocessor, a microcontroller, or a system control state machine that are either hardwired or programmed into the programmable logic portion of the SOC device using circuit design and programming techniques known to those skilled in the art. These known circuits perform system management functions such as power-up sequencing of off-chip devices, system clock enabling, and system reset, as is known to those skilled in the art. In addition, known level compare circuits, filter circuits, and external device control circuits may be implemented in either programmable logic, or hardwired into the SOC device to add functionality to the system controller. The particular embodiments of the system supervisor circuit will be highly dependent on the user system, and therefore it is desirable to implement much of the circuit in programmable logic. For example, different user systems may have different numbers of power supplies, operating at various voltages, to be monitored. The user can configure the system supervisor circuit to accommodate the parameters of the user's particular system.</p>
<p id="p-0126" num="0125">For example, the system supervisor circuit <b>148</b> may be configured to include a specialized microcontroller-type circuit for power-up and power monitoring called an ADC sequencer circuit. System voltages, as well as the reference voltage, may be input to the ADC, which converts the voltages to digital values that are input to the programmable logic block. An ADC sequencer circuit programmed into the programmable logic block may compare the digital values and use the results to control system elements via signals output from the SOC device (e.g., power-up enable signals, etc.).</p>
<p id="p-0127" num="0126">According to another aspect of the present invention as illustrated in <figref idref="DRAWINGS">FIG. 18</figref>, a clock-generator architecture is disclosed for a programmable-logic-based system on a chip.</p>
<p id="p-0128" num="0127">Referring now to <figref idref="DRAWINGS">FIG. 18</figref>, a clock-generating architecture <b>510</b> for the system on a chip of the present invention includes a crystal oscillator circuit <b>512</b> excited by an external crystal <b>514</b> coupled to I/O pads <b>516</b> and <b>518</b>. If the accuracy of a crystal oscillator circuit is not needed, and an external crystal is not desired, an on-chip RC oscillator circuit <b>520</b> may be used to provide the clock signal. An external clock source <b>522</b> may be coupled into the system via I/O pad <b>524</b>. The outputs of the crystal oscillator <b>512</b>, the RC oscillator <b>520</b>, and the external clock input <b>524</b> are buffered by buffers <b>526</b>.</p>
<p id="p-0129" num="0128">As shown in <figref idref="DRAWINGS">FIG. 18</figref>, the clock signals may be input to the clock conditioning circuit (shown as a dotted line at reference numeral <b>530</b>) via a PLL-input multiplexer <b>532</b> so that the desired clock signal source may be selected by the user. The PLL-input multiplexer <b>532</b> is connected to a first divider circuit <b>534</b> so that the input frequency may be divided down before synthesizing by the PLL <b>536</b>. The first divider circuit is a digital divider circuit that has programmable inputs that are configured via a connection to the programmable logic block <b>538</b> so that the input frequency may be divided down before synthesizing by the PLL <b>536</b>.</p>
<p id="p-0130" num="0129">In a preferred embodiment the programmable logic block <b>538</b> is an FPGA or other logic block capable of being configured to perform a myriad of arbitrary complex logic functions. Once the system controller (described above) has managed the power-up of the system on a chip device, the programmable logic block <b>538</b> (as configured by the user) manages the operation of the device.</p>
<p id="p-0131" num="0130">A PLL divider circuit <b>540</b> is placed in the feedback loop of PLL <b>536</b>. This PLL divider circuit <b>540</b> is also controlled by signals from the programmable logic block <b>538</b> that select the divisor. The PLL divider circuit is a digital divider circuit that has programmable inputs that are configured by the programmable logic block <b>538</b>. By configuring the programmable logic block <b>538</b>, therefore, the user can select the characteristics of the PLL divider circuit <b>540</b> and the PLL <b>536</b> will output a frequency selected by the user.</p>
<p id="p-0132" num="0131">If it is not desired to put the clock signal through the PLL circuit <b>536</b> (for example, because the clock signal is already at the desired frequency), one of the aforementioned clock signals may be selected by the PLL output/bypass multiplexer <b>542</b> to bypass the PLL <b>536</b>. PLL output/bypass multiplexer <b>542</b> selects between the outputs of one of buffers <b>526</b> and the output of PLL <b>536</b>. In one embodiment of the invention, the PLL output/bypass multiplexer <b>542</b> may be a glitchless clock multiplexer of the type described above in reference to <figref idref="DRAWINGS">FIG. 6</figref>. The output of multiplexer <b>542</b> drives an output divider circuit <b>544</b>. The output divider circuit <b>544</b> is also a digital divider circuit configurable via its connection to the programmable logic block <b>538</b> and can be used to further divide the frequency of the clock signal. After passing through the output divider circuit <b>544</b>, the clock signal is input to a delay line <b>546</b> that is used to set the phase for the clock signal. The delay line may comprise a digital buffer chain as is known in the art. The amount of delay is controlled from the programmable logic block.</p>
<p id="p-0133" num="0132">Another alternative embodiment of the present invention contemplates programming a ring oscillator (not shown) into a portion of the programmable logic block, as is known in the art, and providing a clock signal from the ring oscillator to the clock conditioning circuitry via a connection from the programmable logic block <b>538</b> to the PLL input multiplexer <b>532</b>. In still another alternative embodiment (not shown), an external clock source is input directly into the programmable logic block, which may be programmed to perform logical operations, such as, but not limited to, gating, frequency division, on the signal and then sends the signal to the clock conditioning circuitry for further conditioning or for distribution to other portions of the system on a chip device.</p>
<p id="p-0134" num="0133">As shown in <figref idref="DRAWINGS">FIG. 18</figref>, the clock signal output by the clock conditioning circuitry may be input to the programmable logic block <b>538</b> (through buffer <b>548</b>) to serve as the clock signal for operating the programmable logic block <b>538</b>. In the embodiment shown in <figref idref="DRAWINGS">FIG. 18</figref>, any of the clock signals may be directed to I/O pad <b>550</b> to supply a clock source for other devices in the system. Output multiplexer <b>552</b> selects between the buffered outputs of the crystal oscillator or the RC oscillator, the output of PLL output/bypass multiplexer <b>542</b> via delay line <b>546</b>, and a clock signal that may be generated in programmable logic block <b>538</b>. The selected signal is buffered by buffer <b>554</b> and presented to I/O pad <b>550</b>.</p>
<p id="p-0135" num="0134">The user may make any of these clock signals available to other devices in the system as a system clock source. In addition, the user may make one clock frequency available to the other devices of the system via an output pad while inputting a second frequency to the programmable logic block.</p>
<p id="p-0136" num="0135">Not only is the clock signal output by the clock conditioning circuitry variable, but in the present invention, the input is variable as well. In addition to being able to generate and output various clock frequencies, the input frequency for the clocking circuitry of the present invention may be any of a number of arbitrary frequencies. That is, the clock conditioning circuitry is able to operate receiving an input frequency within a wide range (e.g., 32 kHz-300 MHz) and still output a given frequency desired by the user.</p>
<p id="p-0137" num="0136">The clock architecture of the present invention also includes a real-time clock <b>556</b> as shown in <figref idref="DRAWINGS">FIG. 18</figref>. The real-time clock <b>556</b> can be clocked from the external clock, the crystal oscillator, or the RC oscillator through real-time clock multiplexer <b>558</b> as shown in <figref idref="DRAWINGS">FIG. 18</figref>.</p>
<p id="p-0138" num="0137">Referring now to <figref idref="DRAWINGS">FIG. 19</figref>, a more detailed view is shown of the operation of the real-time clock <b>556</b> in the system on a chip of the present invention. As shown in both <figref idref="DRAWINGS">FIGS. 18 and 19</figref>, real-time clock <b>556</b> receives inputs from an external clock source <b>522</b>, a crystal oscillator circuit <b>512</b>, and the RC oscillator circuit <b>520</b> and outputs a clock signal to the programmable logic block <b>538</b>. The real time clock circuit <b>556</b> may be used in the power management system of the system-on-a-chip device.</p>
<p id="p-0139" num="0138">In contrast to devices with more limited logic resources, power management in devices with a large complex programmable logic block <b>538</b> is more important. An FPGA or CPLD-based programmable logic block <b>538</b> consumes significant power not only during operation, but also in stand-by mode so it is desirable to turn that portion of the system-on-a-chip device off whenever it is not being used for a significant time. It may be desirable to turn off other circuits on the system on a chip device as well, such as the non-volatile memory. In designs where the programmable logic block <b>538</b> is non-volatile, the power may be disconnected from it without losing the configuration of the logic. The content of volatile registers of the programmable logic block <b>538</b> may be stored in the non-volatile memory before the power supply is disconnected from the programmable logic block. In embodiments where the programmable logic block is implemented in a volatile technology (e.g., SRAM), the configuration for the entire block may be stored in the non-volatile memory prior to entering sleep mode.</p>
<p id="p-0140" num="0139">The real-time clock <b>556</b> allows the programmable logic block <b>538</b> to be powered down for a specified period of time and then powered up once the time period has elapsed. A “set” signal connection is shown in <figref idref="DRAWINGS">FIG. 19</figref> indicating that the parameters of the real time clock may be set via configuration of the programmable logic block <b>538</b>. In another embodiment, the parameters of the real time clock <b>556</b> may be set via programming of the non-volatile memory. The count (time elapsed) of the real time clock is used internally to the real time clock circuit <b>556</b> to indicate a match when a selected time period has elapsed. A “count” signal may also be input to the programmable logic device, as shown in <figref idref="DRAWINGS">FIG. 19</figref>. A “match” signal generated by the real time clock <b>556</b> indicates when the selected time period has elapsed and is input to the programmable logic block <b>538</b> and a voltage regulator circuit <b>560</b>.</p>
<p id="p-0141" num="0140">The voltage regulator circuit <b>560</b> receives inputs from the programmable logic block <b>538</b>, the real time clock circuit <b>556</b>, and a user controlled input such as a switch <b>562</b>, shown coupled into the SOC at I/O pad <b>564</b>. These inputs can be used to control the voltage regulator circuit to power down the programmable logic block <b>538</b>, the non-volatile memory block (not shown), and other circuits (not shown) on the system-on-a-chip device. Powering down a circuit may also be referred to as putting the circuit block in a “sleep mode,” and powering up a circuit block may be referred to as “waking up” the circuit block.</p>
<p id="p-0142" num="0141">The programmable logic block <b>538</b> may be configured to enter a sleep mode when certain parameters are met. For example, the programmable logic block <b>538</b> may be configured to receive an input from the real time clock <b>556</b> and output a signal to enter a sleep mode when a certain amount of time has elapsed since the programmable logic block was last used or accessed. Alternatively, the programmable logic block may enter a sleep mode on a regular cycle or schedule or if some other parameter, such as the temperature of the device, exceeds a threshold value.</p>
<p id="p-0143" num="0142">The sleep mode may be initiated with a signal output from the programmable logic block <b>538</b> or from the real time clock <b>556</b>. Alternatively, the sleep mode may be initiated with a signal input from an external source such as the user-controlled switch <b>562</b> or an off-chip timer, or another off-chip signal source. When the voltage regulator circuit <b>560</b> receives a signal indicating that a sleep mode is to be entered, the voltage regulator circuit <b>560</b> disconnects the power source from the programmable logic block (and any other circuits to be powered down). The disconnecting of the power source may be done in any known manner. In the example shown in <figref idref="DRAWINGS">FIG. 19</figref>, the voltage regulator circuit <b>560</b> outputs a signal to the control electrode of an off-chip power control transistor <b>566</b> such as a bipolar transistor or MOSFET from I/O pad <b>568</b>. Power control transistor <b>566</b> couples the power supply voltage into the SOC at I/O pad <b>570</b>. In another embodiment, the power control transistor may be disposed on-chip.</p>
<p id="p-0144" num="0143">In the example shown in <figref idref="DRAWINGS">FIG. 19</figref>, the power control transistor <b>566</b> receives a 3.3-volt power supply input from the system in which the system on a chip device is installed. The 3.3-volt supply is also input to power distribution circuitry via an I/O pad <b>572</b>. The 3.3 v power distribution circuitry distributes the 3.3 v to the circuits on the system on a chip device that operate on 3.3 v. For clarity of the drawing, the connections of the 3.3 v power distribution circuitry are not shown, and simply indicated as an arrow showing that the 3.3 v is provided internally on the integrated circuit. The 3.3 v supply is used to drive 3.3-volt circuits on the SOC device, such as, for example, the real time clock, the crystal oscillator circuit, and the RC oscillator circuit. The voltage regulator circuit <b>560</b> steps down the 3.3-volt input to the device to 1.5 volts, the required voltage to supply the programmable logic block <b>538</b> and the non-volatile memory block in this example, and outputs it via the power control transistor <b>566</b> to the programmable logic block <b>538</b> and other circuits requiring a 1.5 volt power supply, such as, for example the non-volatile memory block. Persons of ordinary skill in the art will appreciate that the voltages listed here are an example for illustrative purposes only and by no means limit the range of voltages that may be used to supply the various circuits on a system on a chip device according to the present invention.</p>
<p id="p-0145" num="0144">Once the sleep mode is entered, the programmable logic block <b>538</b> may be awakened via a “wake-up” signal input to the voltage regulator circuit <b>560</b>. As shown in <figref idref="DRAWINGS">FIG. 19</figref>, the match signal from the real time clock <b>556</b> may be used as the wake up signal after the set time period has elapsed. This time period is user-selectable via programming of the programmable logic block <b>538</b> or the non-volatile memory to input a set signal to the real time clock <b>556</b>. Alternatively, the programmable logic block may be awakened before the designated time period has expired by a signal input from an off-chip source such as the user-controlled switch <b>562</b>. The signal from the off-chip signal source and the signal from the real time clock <b>556</b> may be routed through an “OR” gate <b>574</b>, as shown in <figref idref="DRAWINGS">FIG. 19</figref> so that whichever signal arrives first may wake up the programmable logic block <b>538</b>. The programmable logic block <b>538</b> is awakened when the voltage regulator circuit <b>560</b> sends a signal to the power control transistor <b>566</b> to re-connect the power supply to the programmable logic block <b>538</b>. Once the programmable logic block <b>538</b> has received power, the lost contents of volatile circuits such as registers may be re-loaded from the non-volatile memory.</p>
<p id="p-0146" num="0145">In the present invention, therefore, the sleep mode may be initiated by the real time clock circuit <b>556</b>, the programmable logic block <b>538</b>, or an external signal input. The programmable logic block may be woken up by the real time clock or an external signal input.</p>
<p id="p-0147" num="0146">While embodiments and applications of this invention have been shown and described, it would be apparent to those skilled in the art that many more modifications than mentioned above are possible without departing from the inventive concepts herein. The invention, therefore, is not to be restricted except in the spirit of the appended claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A programmable system-on-a-chip integrated circuit device comprising:
<claim-text>an oscillator circuit;</claim-text>
<claim-text>a programmable logic block;</claim-text>
<claim-text>a clock conditioning circuit selectively coupleable to the programmable logic block and the oscillator circuit, wherein the clock conditioning circuit includes a phase locked loop, the phase locked loop includes a frequency divider circuit in its feedback loop;</claim-text>
<claim-text>a real-time clock selectively coupleable to the programmable logic block, and the oscillator circuit; and</claim-text>
<claim-text>a non-volatile memory, wherein the frequency divider circuit is configurable from at least one of the programmable logic block and the non-volatile memory.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The device of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the phase locked loop includes a frequency divider circuit driving its input.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The device of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the phase locked loop drives a frequency divider circuit from its output.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The device of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the oscillator circuit is an RC oscillator circuit.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The device of <claim-ref idref="CLM-00004">claim 4</claim-ref>, further including an external oscillator input, wherein said clock conditioning circuit is selectively coupleable to the external oscillator input.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The device of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the oscillator circuit is a crystal oscillator circuit.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The device of <claim-ref idref="CLM-00006">claim 6</claim-ref>, further including an external oscillator input selectively coupleable to the clock conditioning circuit.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The device of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further including a clock output pad selectively coupleable to one of the programmable logic block and the oscillator circuit.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The device of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the real-time clock includes a match output and further including a voltage-regulator controller circuit coupled to an I/O pad and to the match output for controlling the signal to an external voltage regulator in response to a signal on the match output.</claim-text>
</claim>
</claims>
</us-patent-grant>
