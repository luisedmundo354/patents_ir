<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07298847-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07298847</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>10072663</doc-number>
<date>20020207</date>
</document-id>
</application-reference>
<us-application-series-code>10</us-application-series-code>
<us-term-of-grant>
<us-term-extension>916</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>K</subclass>
<main-group>1</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>L</subclass>
<main-group>9</main-group>
<subgroup>08</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>L</subclass>
<main-group>9</main-group>
<subgroup>14</subgroup>
<symbol-position>L</symbol-position>
<classification-value>N</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>380247</main-classification>
<further-classification>380248</further-classification>
<further-classification>380278</further-classification>
<further-classification>380270</further-classification>
<further-classification>380279</further-classification>
</classification-national>
<invention-title id="d0e53">Secure key distribution protocol in AAA for mobile IP</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>6785823</doc-number>
<kind>B1</kind>
<name>Abrol et al.</name>
<date>20040800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>726  7</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>6915345</doc-number>
<kind>B1</kind>
<name>Tummala et al.</name>
<date>20050700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709225</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6922404</doc-number>
<kind>B1</kind>
<name>Narayanan et al.</name>
<date>20050700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370338</main-classification></classification-national>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>6948074</doc-number>
<kind>B1</kind>
<name>Borella et al.</name>
<date>20050900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713168</main-classification></classification-national>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>7042879</doc-number>
<kind>B2</kind>
<name>Eschbach et al.</name>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370392</main-classification></classification-national>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>7080259</doc-number>
<kind>B1</kind>
<name>Nakanishi et al.</name>
<date>20060700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713193</main-classification></classification-national>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2001/0016492</doc-number>
<kind>A1</kind>
<name>Igarashi et al.</name>
<date>20010800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>455433</main-classification></classification-national>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2002/0062385</doc-number>
<kind>A1</kind>
<name>Dowling</name>
<date>20020500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709230</main-classification></classification-national>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2002/0118674</doc-number>
<kind>A1</kind>
<name>Faccin et al.</name>
<date>20020800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370352</main-classification></classification-national>
</citation>
<citation>
<patcit num="00010">
<document-id>
<country>WO</country>
<doc-number>WO200126322</doc-number>
<date>20010400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
</citation>
<citation>
<nplcit num="00011">
<othercit>Oppliger, et al., “Distributed Registration and Key Distribution (DiRK),” May 1996, “Information Systems Security: Facing the Information Society of the 21st Century,” Chapman and Hall, Ltd., pp. 199-208.</othercit>
</nplcit>
<category>cited by examiner</category>
</citation>
<citation>
<nplcit num="00012">
<othercit>Charles E. Perkins, “Mobile IP Joins Forces with AAA”, <i>IEEE Personal Communications</i>, Aug. 2000, pp. 59-61.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00013">
<othercit>Charles E. Perkins et al., “Mobility Support in Ipv6”, <i>IETF RFC2002</i>, Oct. 1996, pp. 1-11.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00014">
<othercit>Charles E. Perkins et al., “AAA Registration Keys for Mobile IP”, <i>draft-ietfmobileip-aaa-key-01.txt </i>Jan. 2000, pp. 1-10.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00015">
<othercit>Charles E. Perkins et al., “Mobile IP Challenge/Response Extensions”, <i>draft-ietf-mobileip-challenge-01.txt</i>, Feb. 1999, pp. 18.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00016">
<othercit>Whitfield Diffie et al. “New Directions in Cryptography”, <i>IEEE Transactions on Information Theory</i>, V.IT, Jun. 1976, pp. 2940 (644-654).</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00017">
<othercit>D. Harkins et al., “The Internet Key Exchange”, <i>FRC2409</i>, Nov. 1998, pp. 1-41.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00018">
<othercit>P. Calhoun et al., “DIAMETER Base Protocol”, <i>draftcalhoun-diameter-17.txt, IETF work in progress</i>, Sep. 2000, pp. 1-44.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00019">
<othercit>P. Calhoun et al., “DIAMETER Mobile IP Extensions”, <i>draft-calhoun-diameter-mobileip-11.txt, IETF work in progress</i>, Sep. 2000, pp. 1-28.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00020">
<othercit>S. Glass et al., “Mobile IP Authentication, Authorization and Accounting Requirements”, <i>draft-ietf-mobileip-aaereqs-04.txt, IETF work in progress</i>, Jun. 2000, pp. 1-25.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00021">
<othercit>P. Calhoun et al., “Mobile IP Network Address Identifier Extension”,<i>RFC 2794</i>, Mar. 2000, 1-7.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00022">
<othercit>P. Calhoun et al., “DIAMETER Strong Security Extensions”, <i>draft-calhoun-diameter-strong-crypto-05.txt, IETF work in Progress</i>, Sep. 2000, pp. 1-12.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00023">
<othercit>P.-C. Cheng “An Architecture for the Internet Key Exchange Protocol”, <i>IBM Sysems Journal</i>, vol. 40, No. 3, pp. 721-746, 2001.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>20</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>455411</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>455433</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709217</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>380270</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>380248</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>380278</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>380279</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>5</number-of-drawing-sheets>
<number-of-figures>5</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20030147537</doc-number>
<kind>A1</kind>
<date>20030807</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Jing</last-name>
<first-name>Dongfeng</first-name>
<address>
<city>Beijing</city>
<country>CN</country>
</address>
</addressbook>
<nationality>
<country>CN</country>
</nationality>
<residence>
<country>CN</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Perkins</last-name>
<first-name>Charles E.</first-name>
<address>
<city>Saratoga</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Brake Hughes Bellermann LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Nokia Inc.</orgname>
<role>02</role>
<address>
<city>Irving</city>
<state>TX</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Zand</last-name>
<first-name>Kambiz</first-name>
<department>2134</department>
</primary-examiner>
<assistant-examiner>
<last-name>Powers</last-name>
<first-name>William S</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A security key distribution and authentication protocol in AAA for Mobile IP has been described. In order to guarantee the secure protocol, messages between the MN, FA, AAAF, AAAH, and HA are encrypted and signed using public/private keys. IPSEC or PKI infrastructure is not required to support the AAA secure key distribution. This protocol enhances the security, flexible, scalability of AAA, and aids in protecting the Diffie-Hellman algorithm from man-in-the-middle attacks. Through this protocol, it is easy to set up a secure registration path in AAA for Mobile IP. This secure registration path provides a secretive and secure key distribution function for AAA.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="231.48mm" wi="177.21mm" file="US07298847-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="238.68mm" wi="156.97mm" file="US07298847-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="246.30mm" wi="171.96mm" file="US07298847-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="225.72mm" wi="170.94mm" file="US07298847-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="249.17mm" wi="180.34mm" file="US07298847-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="233.60mm" wi="179.15mm" file="US07298847-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">FIELD OF THE INVENTION</heading>
<p id="p-0002" num="0001">The present invention relates to IP networks, and more particularly to a secure key distribution protocol in AAA for Mobile IP networks.</p>
<heading id="h-0002" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0003" num="0002">Mobile IP enables a mobile node to move freely from one point of connection to another. During the movement of the mobile node from one connection point to another there should be no disruption of the TCP end-to-end connectivity. In order to extend Mobile IP for use by cellular telephone companies and check the mobile node's identity in the absence of a preconfigured security association with a foreign authority, an authentication, authorization, and accounting (“AAA”) mechanism may be used.</p>
<p id="p-0004" num="0003">AAA may be used to provide the identity verification of a mobile node (“MN”) when mobile node is connected to the point of the agent on the foreign domain (foreign agent) by the requirement a security association existed between mobile node and its home domain AAA server. When the mobile node shares a security association with its home AAA server, it is possible to use that security association to create derivative security associations between the mobile node and its home agent, and again between the mobile node and the foreign agent.</p>
<p id="p-0005" num="0004">AAA as is exists today, however, may be subject to hacking. For example, an AAA protocol may be subject to a man-in-the-middle attack or a replay attack. What is needed is a way to guard against a man-in-the-middle attack, or some other fraud, without unduly complicating an AAA protocol. It is with respect to these considerations and others that the present invention has been made.</p>
<heading id="h-0003" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0006" num="0005">The present invention is directed at addressing the above-mentioned shortcomings, disadvantages and problems, and will be understood by reading and studying the following specification.</p>
<p id="p-0007" num="0006">According to an aspect of the invention, a protocol is directed at providing secure key distribution, including authentication and key distribution and exchange among foreign authority AAA servers, home authority AAA servers, foreign agents, home agents, and mobile nodes.</p>
<p id="p-0008" num="0007">According to one aspect of the invention, a security association is established between a foreign AAA server (AAAF) and a home AAA server (AAAH). Once the security association is established, information may be securely passed between the AAAF and AAAH. This information may include authentication, authorization, and accounting rules relating to the mobile node.</p>
<p id="p-0009" num="0008">According to another aspect of the invention, a security association may be set up directly between a mobile node and a foreign AAA server. Once the security association is established, information may be securely passed between the AAAF and the MN.</p>
<p id="p-0010" num="0009">According to yet another aspect of the invention, the protocol helps to prevent attacks, such as a man-in-the-middle attack and a replay attack.</p>
<p id="p-0011" num="0010">According to still yet another aspect of the invention, IP Security Protocol (IPSEC) or Public Key Infrastructure (PKI) is not required to support the AAA secure key distribution. The protocol enhances the security, flexible, and scalability of AAA. Through this protocol, a secure registration path in AAA for Mobile IP may be established. This secure registration path provides a secretive and secure key distribution function for AAA.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 1</figref> illustrates an exemplary mobile IP network in which the invention may operate;</p>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 2</figref> is a schematic diagram that shows an exemplary AAA server that is operative to provide authentication, authorization, and accounting rules;</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. 3</figref> illustrates a mobile IP/AAA trust model;</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 4</figref> illustrates a process for a secure protocol procedure; and</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 5</figref> illustrates a diagram of a protocol procedure, in accordance with aspects of the invention.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENT</heading>
<p id="p-0017" num="0016">In the following detailed description of exemplary embodiments of the invention, reference is made to the accompanied drawings, which form a part hereof, and which is shown by way of illustration, specific exemplary embodiments of which the invention may be practiced. Each embodiment is described in sufficient detail to enable those skilled in the art to practice the invention, and it is to be understood that other embodiments may be utilized, and other changes may be made, without departing from the spirit or scope of the present invention. The following detailed description is, therefore, not to be taken in a limiting sense, and the scope of the present invention is defined only by the appended claims.</p>
<p id="p-0018" num="0017">Throughout the specification and claims, the following terms take the meanings explicitly associated herein, unless the context clearly dictates otherwise. The term “node” refers to a network element, such as a router. The term support node refers to both “GGSN” and “SGSN” nodes. The term “NAI” refers to a network access identifier that uniquely identifies a mobile node. The term “user” refers to any person or customer such as a business or organization that employs a mobile node to communicate or access resources over a mobile network. The term “operator” refers to any technician or organization that maintains or services an IP based network. The term “identifier” includes any NAI, Mobile Station Integrated Services Digital Network Number (MSISDN), IP address, or any other information that relates to the location or identity of the mobile node.</p>
<p id="p-0019" num="0018">The term “AAA” refers to authentication, authorization, and accounting. The term “AAAH” refers to a home domain AAA server for a mobile node. The term “AAAF” refers to a foreign domain AAA server relative to a mobile node. The term “HA” refers to a home agent. The term “FA” refers to a foreign agent. The term “home agent” refers to a node, such as a router, on the home network which serves as the point of communications with the mobile node. The term “foreign agent” refers to a node, such as a router, on the mobile node's point of attachment when it travels to a foreign network. The term “MN” refers to a mobile node.</p>
<p id="p-0020" num="0019">Referring to the drawings, like numbers indicate like parts throughout the views. Additionally, a reference to the singular includes a reference to the plural unless otherwise stated or is inconsistent with the disclosure herein.</p>
<p id="h-0006" num="0000">Illustrative Operating Environment</p>
<p id="p-0021" num="0020">With reference to <figref idref="DRAWINGS">FIG. 1</figref>, an exemplary mobile IP network in which the invention may operate is illustrated. As shown in the figure, mobile IP network <b>100</b> includes mobile node (MN) <b>105</b>, radio access network <b>110</b>, Serving GPRS Support Node (SGSN) <b>115</b>, core network <b>120</b>, routers <b>125</b><sub>A-C</sub>, AAA server <b>200</b>, General Packet Radio Service Nodes (GGSNs) <b>135</b> data network <b>140</b>, and data network <b>145</b>.</p>
<p id="p-0022" num="0021">The connections and operation for mobile IP network <b>100</b> will now be described. MN <b>105</b> is coupled to radio access network <b>110</b>. Generally, MN <b>105</b> may include any device capable of connecting to a wireless network such as radio access network <b>110</b>. Such devices include cellular telephones, smart phones, pagers, radio frequency (RF) devices, infrared (IR) devices, integrated devices combining one or more of the preceding devices, and the like. MN <b>105</b> may also include other devices that have a wireless interface such as Personal Digital Assistants (PDAs), handheld computers, personal computers, multiprocessor systems, microprocessor-based or programmable consumer electronics, network PCs, wearable computers, and the like.</p>
<p id="p-0023" num="0022">Radio access network <b>110</b> transports information to and from devices capable of wireless communication, such as MN <b>105</b>. Radio access network <b>110</b> may include both wireless and wired components. For example, radio access network <b>110</b> may include a cellular tower that is linked to a wired telephone network. Typically, the cellular tower carries communication to and from cell phones, pagers, and other wireless devices, and the wired telephone network carries communication to regular phones, long-distance communication links, and the like.</p>
<p id="p-0024" num="0023">Some nodes may be GPRS nodes. For example, SGSN <b>115</b> may send and receive data from mobile stations, such as MS <b>105</b>, over radio access network <b>110</b>. SGSN <b>115</b> also maintains location information relating to MN <b>105</b>. SGSN <b>115</b> communicates between MN <b>105</b> and GGSNs <b>135</b><sub>A-B </sub>through core network <b>120</b>.</p>
<p id="p-0025" num="0024">Core network <b>120</b> is an IP packet based backbone network that includes routers, such as routers <b>125</b><sub>A-C</sub>, to connect the support nodes in the network. Some of the routers may act as a HA or a FA for a MN. Generally, an agent (HA or FA) communicates with AAA server to maintain a secure connection with the mobile node. Routers are intermediary devices on a communications network that expedite message delivery. On a single network linking many computers through a mesh of possible connections, a router receives transmitted messages and forwards them to their correct destinations over available routes. On an interconnected set of LANs, including those based on differing architectures and protocols, a router acts as a link between LANs, enabling messages to be sent from one to another. Communication links within LANs typically include twisted wire pair, fiber optics, or coaxial cable, while communication links between networks may utilize analog telephone lines, full or fractional dedicated digital lines including T1, T2, T3, and T4, Integrated Services Digital Networks (ISDNs), Digital Subscriber Lines (DSLs), wireless links, or other communications links.</p>
<p id="p-0026" num="0025">GGSNs <b>135</b><sub>A-B </sub>are coupled to core network <b>120</b> through routers <b>125</b><sub>A-C </sub>and act as wireless gateways to data networks, such as network <b>140</b> and network <b>145</b>. Networks <b>140</b> and <b>145</b> may be the public Internet or a private data network. GGSNs <b>135</b><sub>A-B </sub>allow MN <b>105</b> to access network <b>140</b> and network <b>145</b>.</p>
<p id="p-0027" num="0026">AAA server <b>200</b> is coupled to core network <b>120</b> through communication mediums. AAA server <b>200</b> may be programmed by an operator to contain the authentication, authorization, and accounting rules associated with the operator's network. AAA server <b>200</b> may be programmed differently under different operator's networks. AAA server <b>200</b> should be programmed such that is can communicate with foreign AAA servers (not shown).</p>
<p id="p-0028" num="0027">Utilizing an AAA server helps to enforce authentication, authorization, and accounting rules to help ensure end-to-end quality of service (QoS) for users. Operators have the flexibility to provide different AAA rules. For example, conversational traffic may be mapped into either the Expedited Forwarding (EF) class or Assured Forwarding (AF) class at the core network. The operator may employ a different charging structure for each class. Also, AAA rules may be established for between a foreign authority and a home authority. An exemplary AAA server is described in more detail in conjunction with <figref idref="DRAWINGS">FIG. 2</figref>.</p>
<p id="p-0029" num="0028">Furthermore, computers, and other related electronic devices may be connected to network <b>140</b> and network <b>145</b>. The public Internet itself may be formed from a vast number of such interconnected networks, computers, and routers. Mobile IP network <b>100</b> may include many more components than those shown in <figref idref="DRAWINGS">FIG. 1</figref>. However, the components shown are sufficient to disclose an illustrative embodiment for practicing the present invention.</p>
<p id="p-0030" num="0029">The media used to transmit information in the communication links as described above illustrates one type of computer-readable media, namely communication media. Generally, computer-readable media includes any media that can be accessed by a computing device. Communication media typically embodies computer-readable instructions, data structures, program modules, or other data in a modulated data signal such as a carrier wave or other transport mechanism and includes any information delivery media. The term “modulated data signal” means a signal that has one or more of its characteristics set or changed in such a manner as to encode information in the signal. By way of example, communication media includes wired media such as twisted pair, coaxial cable, fiber optics, wave guides, and other wired media and wireless media such as acoustic, RF, infrared, and other wireless media.</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 2</figref> is a schematic diagram that shows an exemplary AAA server that is operative to provide authentication, authorization, and accounting rules. Accordingly, AAA server <b>200</b> may receive and transmit data relating to the AAA rules. For instance, AAA server <b>200</b> may transmit AAA rules and receive data from the nodes on the mobile IP network.</p>
<p id="p-0032" num="0031">AAA server <b>200</b> may include many more components than those shown in <figref idref="DRAWINGS">FIG. 2</figref>. However, the components shown are sufficient to disclose an illustrative embodiment for practicing the present invention. As shown in <figref idref="DRAWINGS">FIG. 2</figref>, AAA server <b>200</b> is connected to core network <b>120</b>, or other communications network, via network interface unit <b>210</b>. Network interface unit <b>210</b> includes the necessary circuitry for connecting AAA server <b>200</b> to core network <b>120</b>, and is constructed for use with various communication protocols including the Common Open Policy Services (COPS) protocol that runs on top of the Transmission Control Protocol (TCP). Other communications protocols may be used, including, for example, User Datagram Protocols (UDP). Typically, network interface unit <b>210</b> is a card contained within AAA server <b>200</b>.</p>
<p id="p-0033" num="0032">AAA server <b>200</b> also includes processing unit <b>212</b>, video display adapter <b>214</b>, and a mass memory, all connected via bus <b>222</b>. The mass memory generally includes RAM <b>216</b>, ROM <b>232</b>, and may include one or more permanent mass storage devices, such as hard disk drive <b>228</b>, a tape drive, CD-ROM/DVD-ROM drive <b>226</b>, and/or a floppy disk drive. The mass memory stores operating system <b>220</b> for controlling the operation of policy server <b>200</b>. This component may comprise a general purpose server operating system <b>220</b> as is known to those of ordinary skill in the art, such as UNIX, LINUX™, or Microsoft WINDOWS NT®. Basic input/output system (“BIOS”) <b>218</b> is also provided for controlling the low-level operation of AAA server <b>200</b>.</p>
<p id="p-0034" num="0033">The mass memory as described above illustrates another type of computer-readable media, namely computer storage media. Computer storage media may include volatile and nonvolatile, removable and non-removable media implemented in any method or technology for storage of information, such as computer readable instructions, data structures, program modules or other data. Examples of computer storage media include RAM, ROM, EEPROM, flash memory or other memory technology, CD-ROM, digital versatile disks (DVD) or other optical storage, magnetic cassettes, magnetic tape, magnetic disk storage or other magnetic storage devices, or any other medium which can be used to store the desired information and which can be accessed by a computing device.</p>
<p id="p-0035" num="0034">The mass memory also stores program code and data for AAA server program <b>230</b> (See Figures and Related discussion below), and programs <b>234</b>. AAA server program <b>230</b> includes computer executable instructions which, when executed by AAA server computer <b>200</b>, maintain authentication, authorization, and accounting rules. AAA server <b>200</b> may include a JAVA virtual machine, an HTTP handler application for receiving and handing HTTP requests, JAVA applets for transmission to a WWW browser executing on a client computer, an IPsec handler, a Transport Layer Security (TLS) handler and an HTTPS handler application, and a secure protocol AAA handler, for handling secure connections.</p>
<p id="p-0036" num="0035">AAA server <b>200</b> also comprises input/output interface <b>224</b> for communicating with external devices, such as a mouse, keyboard, scanner, or other input devices not shown in <figref idref="DRAWINGS">FIG. 2</figref>. Likewise, AAA server <b>200</b> may further comprise additional mass storage facilities such as CD-ROM/DVD-ROM drive <b>226</b> and hard disk drive <b>228</b>. Hard disk drive <b>228</b> is utilized by AAA server <b>200</b> to store, among other things, application programs, databases, and program data used by AAA server program <b>230</b>. For example, AAA rules, user databases, relational databases, and the like, may be stored.</p>
<p id="h-0007" num="0000">Protocol Notations</p>
<p id="p-0037" num="0036">In order to simplify the description of the secure key distribution protocol, the following notations will be used. The notation “&lt;. . . &gt;” refers to a non-encrypted text message. The notation “K<sub>A-B</sub>” refers to the key used to encrypt the message transmitted between A and B, where A and B can be selected from a MN (mobile node), HA (home agent), FA (foreign agent), AAAF (foreign AAA), and an AAAH (home AAA). The notation “&lt;-&gt; K<sub>A-B </sub>refers to the cipher text encrypted by key K<sub>A-B</sub>. The notation “X<sub>ID</sub>” refers to an identification number which is used by X or other partners. For example, X<sub>ID </sub>may be X's NAI, or IP Address. The notation “R<sub>x</sub>” refers to a random number which is generated by X. The notation “CH” refers to a challenge generated by a FA. The notation “Ts” refers to a timestamp. The notation “SA” refers to a security association. The notation “n” refers to a random great prime n used in the Diffie-Hellman algorithm. The notation “g” refers to a random great prime g used in the Diffie-Hellman algorithm. The notation “p” refers to the result from p=g<sup>x </sup>mod n in the Diffie-Hellman algorithm, where the AAAH chooses a random number x, keeps x secret, and before MN begins to roam, the MN keeps n, g, and p in its memory. The notation “q” refers to the result from q=g<sup>y </sup>mod n based on the Diffie-Hellman algorithm, where AAAF can generate a SA between itself and an AAAH for a MN. The notation “AUTH<sub>A-B</sub>” refers to a signature produced by a shared key between A and B. The notation “Reg-Req” refers to a MN Registration Request message. The notation “Reg-Reply” refers to a Registration Reply message sent by a HA.</p>
<p id="h-0008" num="0000">Secure Key Distribution Protocol for Mobile IP</p>
<p id="p-0038" num="0037"><figref idref="DRAWINGS">FIG. 3</figref> illustrates a mobile IP/AAA trust model, in accordance with aspects of the invention. As shown in the figure, IP/AAA trust model <b>300</b> includes foreign authority <b>305</b>, foreign agent (FA) <b>330</b>, home authority (<b>310</b>), home agent (HA) <b>325</b>, mobile node <b>335</b>, AAAF <b>315</b>, and AAAH <b>320</b>.</p>
<p id="p-0039" num="0038">Secure associations are established between the MN, AAAH, AAAF, HA, and FA nodes to ensure secure communication. SA1 <b>345</b> is established between AAAH <b>320</b> and mobile node <b>335</b>. SA2 <b>350</b> is established between HA <b>325</b> and AAAH <b>320</b>. SA3 is established between AAAF <b>315</b> and AAAH <b>320</b>. SA4 is established between AAAF <b>315</b> and FA <b>330</b>. SA5 is established between AAAF <b>315</b> and MN <b>335</b>.</p>
<p id="p-0040" num="0039">In order to authenticate mobile nodes and convey session keys from AAAH <b>320</b> to AAAF <b>315</b> a security model, as shown in <figref idref="DRAWINGS">FIG. 3</figref>, may be used. MN <b>335</b> maintains a security association, SA1 <b>345</b>, with AAAH <b>320</b>. SA1 <b>345</b> is used by the home authority to authenticate the mobile node. In this exemplary figure, MN <b>335</b> belongs to home authority, or home domain <b>310</b>. An authority is able to validate a user's credentials and is used to maintain and establish security relationships with authorities that are external to the mobile node's home network. The authority may be a single node, such as a computer or router, on the network, or the authority may include several nodes that are used to make up the authority. The security association SA3 <b>355</b> between AAAF <b>315</b> and AAAH <b>320</b> handles the authentication, authorizations, and possibly the accounting data, between home authority <b>310</b> and foreign authority <b>305</b>. HA <b>325</b> maintains a secure association, SA2 <b>350</b>, with AAAH <b>320</b>. SA5 <b>365</b> may be established between AAAF <b>315</b> and MN <b>335</b>. Similarly, SA4 <b>360</b> is established between AAAF <b>315</b> and FA <b>330</b>. SA's within a single domain may be achieved by local management or static configuration. However, SA's between foreign AAA's is more difficult as there may be many hops between the AAA. Additionally, a secure association does not typically exist between AAA's located within different authorities.</p>
<p id="p-0041" num="0040">Although MN <b>335</b> may not connect directly to AAAF <b>315</b>, sometimes information between them should be passed directly. The direct communication may be for efficiency reasons or security reasons. This is especially true when a mobile node moves between different foreign agents or attendants located in the same AAA domain.</p>
<p id="p-0042" num="0041">A secure protocol, described below, sets up the SA's between the MN and the foreign authority and the home authority. More specifically, the invention is directed at providing functions of: (1) the real-time establishment of a security association between a home AAA and a foreign AAA, such as SA3 <b>355</b>, and between a mobile node and a foreign AAA, such as SA5 <b>365</b>; (2) an authenticated signature on the Registration Request message coming from the mobile node through the foreign AAA and foreign agent to the home authority; (3) secure end-to-end key distribution and exchange among the mobile node, the home AAA and the foreign AAA; (4) authentication among the mobile node, the home AAA and the foreign AAA; and (5) protection against hacking the SA's by schemes such as man-in-the-middle attack, and replay attack.</p>
<p id="p-0043" num="0042">MN <b>335</b> keeps in its memory the Diffie-Hellman parameters n, g, p generated by AAAH <b>320</b>. These parameters may be changed if necessary since a security association always exits between MN <b>335</b> and AAAH <b>320</b>. Although MN <b>335</b> knows the n, g, p, parameters, MN <b>335</b> does not know the security association between AAAF <b>315</b> and AAAH <b>320</b>.</p>
<p id="p-0044" num="0043">Before distributing session keys to other partners, AAAH <b>320</b> confirms the identity of MN <b>335</b> and AAAF <b>315</b> by comparing the MN's new care-of-address and the ID of AAAF <b>315</b>. MN <b>315</b>'s care-of-address is secured by signature AUTH<sub>MN-AAAH</sub>. The ID of AAAF <b>315</b>, AAAF<sub>ID </sub>is secured by the signature AUTH<sub>AAAF-AAAH</sub>. Securing the care-of-address and ID helps to prevent an attack that may intercept the information. If there is an attempted attack, such as a man-in-the-middle attack, the system will recognize that an attack has occurred. AAAF <b>315</b> will not recognize the signature AUTH<sub>AAAH-AAAF </sub>and therefore reject the authentication and end the registration session. AAAF <b>315</b> also checks the ID's, HA<sub>ID </sub>and AAAH<sub>ID</sub>, in the reply message with MN <b>335</b>'s NAI to ensure the identity of AAAH <b>320</b>. When the ID's are not valid, the registration is ended.</p>
<p id="p-0045" num="0044">AAAH <b>320</b> distributes session keys encrypted by different SAs, which protect the authentication results and the information exchange. AAAH <b>320</b> generates the key K<sub>MN-AAAF </sub>that is used by MN <b>335</b> and AAAF <b>315</b> during the MN registration process, and a new key, K<sub>AAAF-AAAH </sub>for the communication between AAAH <b>320</b> and AAAF <b>315</b>.</p>
<p id="p-0046" num="0045"><figref idref="DRAWINGS">FIG. 4</figref> illustrates a process for a secure protocol procedure, in accordance with aspects of the invention. After a start block, the logic flows to block <b>405</b>, at which point a foreign agent issues a challenge. MNs incorporate the challenge in a registration request message. Moving to block <b>410</b>, the MN sends a registration request message to the FA incorporating the challenge. Transitioning to decision block <b>415</b>, a decision is made as to whether the challenge is accepted by the FA. A challenge is accepted when the challenge received is the same challenge issued by the FA and has not been used by a MN. A challenge may also not be accepted when the challenge is not the most recent challenge issued by the FA. When the challenge is not accepted, the process moves to block <b>495</b> at which point the registration process ends. At this point an error message may be generated. When the challenge is accepted, the process moves to block <b>420</b>, at which point the FA prepares and sends a secure message to the AAAF associated with the FA. The message includes a unique identifier associated with the FA and is signed using a public/private key pair associated with the AAAF and FA.</p>
<p id="p-0047" num="0046">Transitioning to decision block <b>425</b>, a decision is made as to whether the message is authenticated. A message is authenticated when the message is signed using the correct key and contains the identifying information relating to the sender within the message. When the message is not authentic, the process moves to block <b>495</b> where the registration process ends and an error message may be generated. When the message is authentic, the process moves to block <b>430</b>.</p>
<p id="p-0048" num="0047">At block <b>430</b>, the AAAF prepares and sends a secure message to the AAAH associated with the MN requesting registration. The AAAF includes a unique identifier, Diffie-Hellman parameters (See <figref idref="DRAWINGS">FIG. 5</figref> and related discussion), and is signed by AAAF using the key pair relating to the AAAF and AAAH.</p>
<p id="p-0049" num="0048">Stepping to decision block <b>435</b>, the AAAH determines if the message is authentic (See discussion relating to block <b>425</b>). When the message is not authentic, the process moves to block <b>495</b> where the registration process ends and an error message may be generated. When the message is authentic, the process moves to block <b>440</b>.</p>
<p id="p-0050" num="0049">At block <b>440</b>, the AAAH prepares and sends a secure message to the HA associated with the MN requesting registration. The AAAH generates session keys for FA, HA and MN that are used for secure communication (See <figref idref="DRAWINGS">FIG. 5</figref> and related discussion), and is signed by AAAH using the key pair relating to the AAAH and HA.</p>
<p id="p-0051" num="0050">Stepping to decision block <b>445</b>, the HA determines if the message is authentic (See discussion relating to block <b>425</b>). When the message is not authentic, the process moves to block <b>495</b> where the registration process ends and an error message may be generated. When the message is authentic, the process moves to block <b>450</b>.</p>
<p id="p-0052" num="0051">Moving to block <b>450</b>, the HA prepares and sends a secure registration reply message to the AAAH. The HA includes a unique identifier (See <figref idref="DRAWINGS">FIG. 5</figref> and related discussion), and is signed by HA using the key pair relating to the AAAH and HA.</p>
<p id="p-0053" num="0052">Transitioning to decision block <b>455</b>, the AAAH determines if the message is authentic (See discussion relating to block <b>425</b>). When the message is not authentic, the process moves to block <b>495</b> where the registration process ends and an error message may be generated. When the message is authentic, the process moves to block <b>460</b>.</p>
<p id="p-0054" num="0053">At block <b>460</b>, the AAAH prepares and sends a secure registration reply message to the AAAF. The AAAH includes a unique identifiers, keys relating to FA, MN, AAAF, and AAAH, and is signed by HA using the key pair relating to the AAAH and AAAF (See <figref idref="DRAWINGS">FIG. 5</figref> and related discussion).</p>
<p id="p-0055" num="0054">Transitioning to decision block <b>465</b>, the AAAF determines if the message is authentic (See discussion relating to block <b>425</b>). When the message is not authentic, the process moves to block <b>495</b> where the registration process ends and an error message may be generated. When the message is authentic, the process moves to block <b>470</b>.</p>
<p id="p-0056" num="0055">Stepping to block <b>470</b>, the AAAF prepares and sends a secure registration reply message to the FA. The AAAF includes a unique identifiers, keys relating to FA, MN, AAAF, and AAAH, and is signed by the AAAF using the key pair relating to the AAAF and FA (See <figref idref="DRAWINGS">FIG. 5</figref> and related discussion).</p>
<p id="p-0057" num="0056">Transitioning to decision block <b>475</b>, the FA determines if the message is authentic (See discussion relating to block <b>425</b>). When the message is not authentic, the process moves to block <b>495</b> where the registration process ends and an error message may be generated. When the message is authentic, the process moves to block <b>480</b>.</p>
<p id="p-0058" num="0057">Moving to block <b>480</b>, the FA prepares and sends a secure registration reply message to the MN. The FA includes a unique identifiers, and keys relating to FA, MN, AAAF, and AAAH, and is signed by the FA (See <figref idref="DRAWINGS">FIG. 5</figref> and related discussion).</p>
<p id="p-0059" num="0058">Transitioning to decision block <b>485</b>, the MN determines if the message is authentic (See discussion relating to block <b>425</b>). When the message is not authentic, the process moves to block <b>495</b> where the registration process ends and an error message may be generated. When the message is authentic, the process moves to block <b>490</b>.</p>
<p id="p-0060" num="0059">At block <b>490</b>, the SA is established and the registration is accepted. The process then moves to an end block and returns to processing other actions.</p>
<p id="p-0061" num="0060"><figref idref="DRAWINGS">FIG. 5</figref> illustrates a diagram of a protocol procedure, in accordance with aspects of the invention. As shown in the figure, protocol procedure <b>500</b> includes MN <b>510</b>, FA <b>515</b>, AAAF <b>520</b>, AAAH <b>525</b>, and HA <b>530</b> arranged in the corresponding order as listed.</p>
<p id="p-0062" num="0061">An exemplary protocol procedure will now be described. Agents within an authority generate a challenge of other information that is used in authenticating a mobile node. According to the present example, FA <b>515</b> issues and broadcasts a challenge, or some other information that is used for authenticating mobile node, across the network. According to one embodiment, the broadcast may be made according to the Router Discovery Protocol as proposed by the Internet Engineering Task Force (IETF). The FA changes its generated broadcast challenge (CH) at predetermined times in order to help ensure that fraud does not occur. In response to receiving the challenge, MN <b>510</b> generates Reg-Req message <b>535</b> and sends the message to FA. Reg-Req message <b>535</b> includes the MN's NAI and a time stamp, the challenge issued by FA <b>515</b>, and the Diffie-Hellman parameters, n, g, p, etc that are used to generate keys and signatures. The Reg-Req message may also include other information as determined by the operator. MN <b>510</b> creates a signature for the entire message using its security association between itself and its home AAA server (AAAH). As a result, Reg-Req message <b>535</b> is signed using the signature AUTH<sub>MN-AAAH</sub>. Once the message is signed, MN <b>510</b> sends message <b>535</b> to FA <b>515</b> through a wired or wireless medium.</p>
<p id="p-0063" num="0062">Next, FA <b>515</b> receives signed encrypted Reg-Req message <b>535</b>. FA <b>515</b> checks the challenge included in the message is valid by ensuring that the challenge value has not already been used by a MN. By checking that the challenge value was previously unused by an MN, the FA precludes attempting to replay a previous advertisement and authentication. The FA may also make sure that the challenge has been issued within a predetermined time. Checking to make sure that the challenge has been issued recently helps to ensure that the challenge is valid. If the FA can not accept the challenge, or finds some other mistakes in the message, the FA may report the error to the MN and then ends the authentication session with the MN. Otherwise, when the challenge is accepted, and there are no errors in the Reg-Req message, FA <b>515</b> adds an identifier to the message and signs the message using its SA with its AAA server, AAAF <b>520</b>, creating message <b>540</b>. The identifier may be an NAI, a new random nonce, a Ts, and the like. FA <b>515</b> uses its key K<sub>FA-AAAF </sub>to sign the message such that the signature of the message is AUTH<sub>FA-AAAF</sub>. Once the message is signed, FA <b>515</b> transmits signed encrypted message <b>540</b> to AAAF <b>520</b>.</p>
<p id="p-0064" num="0063">Next, AAAF <b>520</b> receives the incoming message from FA <b>515</b> and ensures that the message came from FA by checking the signature AUTH<sub>FA-AAAF</sub>. Next, AAAF <b>520</b>, chooses a secret random number y to calculate q=g<sup>y </sup>mod n according to the Diffie-Helman algorithm. The key K<sub>AAAF-AAAAH </sub>is generated based on g<sup>yx </sup>mod n which is based on p, y relating to the Diffie-Helman algorithm. AAAF <b>520</b> then adds some additional factors to the message, such as q and its ID (AAAF<sub>ID</sub>). AAF <b>520</b> signs the message using key K<sub>AAAF-AAAAH </sub>and signs the message with signature AUTH<sub>AAAF-AAAH</sub>. Then, AAAF <b>520</b> sends message <b>545</b> to AAAH <b>525</b>. The AAAH for the MN is determined by an identifier associated with MN <b>510</b>, such as MN <b>510</b>'s NAI. AAAF <b>520</b> sends the message out to the AAAH based on the MN's identifier, such as the MN's network access identifier (NAI). According to one embodiment of the invention, the AAAF also stores the MN Registration Request session time to prevent a Reply message fail or overtime situation.</p>
<p id="p-0065" num="0064">Next, AAAH <b>525</b> receives message <b>545</b> from AAAF <b>520</b>. AAAH <b>525</b> ensures the original message originated from MN <b>510</b> by checking signature AUTH<sub>MN-AAAH</sub>. Based on its identifier and q, AAAH <b>525</b> calculates the SA (K<sub>AAAF-AAAH</sub>) with AAAF <b>520</b> and checks the identity of AAAF <b>520</b> through signature AUTH<sub>AAAF-AAAH</sub>. The MN Reg-Req message received by AAAH <b>525</b> includes a timestamp or a nonce, which helps to protect the authentication process from a replay attack. When AAAH <b>525</b> does not recognize MN <b>510</b>, an error is generated. When an error is generated, AAAH <b>525</b> may send back a message to inform AAAF <b>520</b> of the failure.</p>
<p id="p-0066" num="0065">After confirming the identity of MN <b>510</b>, AAAH <b>525</b> helps the FA, or some other attendant, to directly communicate to HA through a SA. To aid in the SA, AAAH <b>525</b> generates session keys for FA, HA, and MN which are distributed in a secure fashion. AAAH <b>525</b> encrypts the session keys K<sub>HA-FA </sub>and K<sub>FA-HA </sub>by using the SA between AAAH and the home agent for MN <b>510</b> (K<sub>HA-AAAH</sub>). AAAH <b>525</b> forwards Reg-Req message <b>550</b> to HA <b>520</b> signed using AUTH<sub>AAAH-HA. </sub></p>
<p id="p-0067" num="0066">Message <b>550</b> is received by HA <b>530</b>. HA <b>530</b> then registers MN <b>510</b>'s current location, and stores the two session keys received from AAAH <b>525</b>. HA <b>530</b> then generates reply message <b>555</b>, signs the message using AUTH<sub>HA-AAAH</sub>, and sends reply message <b>555</b> to AAAH <b>525</b>.</p>
<p id="p-0068" num="0067">AAAH <b>525</b> receives message <b>555</b> sent by HA <b>530</b>. After authenticating Reg-Reply message <b>555</b>, AAAH <b>525</b> adds session keys K<sub>FA-MN</sub>, K<sub>MN-HA</sub>, and K<sub>MN-AAAF </sub>and newly created key K<sub>AAAH-AAAF </sub>to the message. Keys K<sub>FA-MN</sub>, K<sub>FA-HA</sub>, and K<sub>AAAH-AAAF </sub>are encrypted using the old key K<sub>AAAH-AAAF</sub>. AAAH <b>525</b> also adds keys K<sub>MN-FA</sub>, K<sub>MN-HA</sub>, and K<sub>MN-AAAF </sub>to the message that are encrypted using key K<sub>MN-AAAH</sub>. AAAH <b>525</b> signs message <b>560</b> with signature AUTH<sub>AAAH-AAAF </sub>and sends message <b>560</b> to AAAF <b>520</b>.</p>
<p id="p-0069" num="0068">Next, AAAF <b>520</b> receives message <b>560</b> from AAAH <b>525</b>. AAAF <b>520</b> authenticates the message coming from AAAH <b>525</b> verifying signature AUTH<sub>AAAH-AAAF</sub>, and by comparing MN <b>510</b>'s NAI, or some other identifier, with HA <b>530</b>'s ID or AAAH <b>525</b>'s ID. AAAF <b>520</b> then decrypts and keeps session key K<sub>MN-AAAF </sub>and new K<sub>AAAH-AAAF </sub>in its memory. AAAF <b>520</b> also encrypts keys K<sub>FA-MN </sub>and K<sub>FA-HA </sub>and other MN session keys, along with the reply message, using key K<sub>FA-AAAF </sub>creating message <b>565</b>. Finally, AAAF <b>520</b> sends message <b>565</b> to FA <b>515</b>.</p>
<p id="p-0070" num="0069">Next, FA <b>515</b> receives message <b>565</b> and authenticates the message. When the message is authenticated, FA <b>515</b> decrypts the message and retrieves the session keys using HA and MN and keeps them in the memory. FA <b>515</b> also generates encrypted message <b>570</b> which includes the Reg-Reply, ID's of FA, HA, and AAAF, and the keys K<sub>MN-FA</sub>, K<sub>MN-HA</sub>, K<sub>MN-AAAF </sub>using key K<sub>MN-AAAH</sub>.</p>
<p id="p-0071" num="0070">The security key distribution and authentication protocol described has many advantages. Characteristics of Mobile IP, AAA and the Internet are taken into account. In order to guarantee the secure protocol, messages between the MN, FA, AAAF, AAAH, and HA are designed for security. IPSEC or PKI infrastructure is not required to support the AAA secure key distribution. This protocol enhances the security, flexible, scalability of AAA, and aids in protecting the Diffie-Hellman algorithm from man-in-the-middle attacks. Through this protocol, it is easy to set up a secure registration path in AAA for Mobile IP. This secure registration path provides a secretive and secure key distribution function for AAA.</p>
<p id="p-0072" num="0071">The above specification, examples and data provide a complete description of the manufacture and use of the composition of the invention. Since many embodiments of the invention can be made without departing from the spirit and scope of the invention, the invention resides in the claims hereinafter appended.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>We claim:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A system for a secure key distribution protocol in AAA for Mobile IP, comprising:
<claim-text>an MN that is configured to: generate a Reg-Req message that includes Diffie-Hellman parameters that are used to generate session keys and produce signatures; initiate an authentication session by sending the Reg-Req message; receive a Reg-Reply message that includes session keys that may be used to directly communicate with the AAAH, AAAF, HA, and FA nodes while the MN is in a foreign authority, wherein the session keys are encrypted and wherein the session keys include a first at least one key, a second at least one key, and a third at least one key;</claim-text>
<claim-text>an FA that is configured to: receive the Reg-Req message; ensure that the authentication session is valid; and when valid, sign and send the Reg-Req message; otherwise, end the authentication session; receive, and authenticate the Reg-Reply message, decrypt at least one key of the session keys; sign, and send the Reg-Reply message to the MN;</claim-text>
<claim-text>an AAAF that is configured to: receive and authenticate the Reg-Req message; generate a first at least one key of the session keys using the Diffie-Hellman algorithm and the Diffie-Heilman parameters; add an identifier relating to the Reg-Req message; sign and send the Reg-Req message; receive, authenticate, sign and send the Reg-Reply message to the FA;</claim-text>
<claim-text>an AAAH that is configured to: receive and authenticate the Reg-Req message; generate a second at least one key of the session keys; sign and send the Reg-Req message including the second at least one key; receive and authenticate the Reg-Reply message; generate a third at least one key of the session keys; encrypt the session keys; sign and send the Reg-Reply message including the third at least one key to the AAAF and</claim-text>
<claim-text>an HA that is configured to: receive the Reg-Req message including the second at least one key; prepare a Reg-Reply message in response to the Reg-Req message; and send the Reg-Reply message to the AAAH.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the Diffie-Hellman parameters include an n, a g, and a p parameter; wherein the parameters are used to generate the session keys and are used in signing the Reg-Req message and the Reg-Reply message.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The system of <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the Reg-Req message and the Reg-Reply message include an identifier relating to where the message originated, wherein the identifier is selected from an NAI and a new random nonce.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The system of <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein the Reg-Req message and the Reg-Reply message are signed using a security association between a sender of the Reg-Req message and the Reg-Reply message and a receiver of the Reg-Req message and the Reg-Reply message.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The system of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the AAAF is further configured to: choose a secret random number y to calculate a parameter q=g<sup>y </sup>mod n according to the Diffie-Hellman algorithm that is used in generating the session keys.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The system of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein authenticating the Reg-Req message and the Reg-Reply message further comprises ensuring that the Reg-Req message and the Reg-Reply message came from the sender by checking the signature relating to a security association between the sender and the receiver.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The system of <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein the AAAF is further configured to determine the AAAH for the MN in response to the identifier associated with the MN.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The system of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the AAAF is further configured to store a time associated with the initiation of the authentication session in order to prevent a Reply message failure.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The system of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the AAAH is further configured to protect the authentication process from a replay attack, and when the AAAH does not recognize the MN, generate an error.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The system of <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein the AAAH is further configured to help the FA directly communicate to the HA through a security association by generating the session keys for the FA, HA, and MN, and distributing the session keys in a secure fashion.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The system of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein distributing the session keys in a secure fashion, further comprises encrypting the session keys.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The system of <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein the HA is further configured to register a current location of the MN and store the session keys.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. A method for a secure key distribution protocol in AAA for Mobile IP, comprising:
<claim-text>establishing secure associations between a MN, an AAAH, an AAAF, a HA, and a FA to help ensure secure communication;</claim-text>
<claim-text>securing a Reg-Req message and a Reg-Reply message used in establishing the secure associations;</claim-text>
<claim-text>creating a plurality of session keys by the AAAH and at least another session key by the AAAF; and</claim-text>
<claim-text>distributing the session keys in a secure manners,</claim-text>
<claim-text>wherein a first one of the plurality of the session keys is sent by the AAAH via the Reg-Req message to the HA, and wherein a second one of the plurality of the session keys is sent by the AAAH via the Reg-Reply message to the AAAF.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The method of <claim-ref idref="CLM-00013">claim 13</claim-ref>, further comprising using a home authority and a foreign authority to maintain and help establish the secure associations.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The method of <claim-ref idref="CLM-00014">claim 14</claim-ref>, wherein establishing the secure associations between the MN, the AAAH, the AAAF, the HA, and the FA, further comprises:
<claim-text>establishing a secure association between the MN and the AAAH;</claim-text>
<claim-text>establishing a secure association between the AAAH and the HA;</claim-text>
<claim-text>establishing a secure association between the AAAF and the AAAH;</claim-text>
<claim-text>establishing a secure association between the AAAF and the FA; and</claim-text>
<claim-text>establishing a secure association between the AAAF and the MN.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The method of <claim-ref idref="CLM-00015">claim 15</claim-ref>, further comprising determining when a signature is an authentic signature based on the secure associations and the session keys.</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The method of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein establishing the secure associations between the MN, the AAAH, the AAAF, the HA, and the FA to help ensure secure communication, further comprises:
<claim-text>signing the Reg-Req message and the Reg-Reply message using the session keys; and</claim-text>
<claim-text>authenticating the received Reg-Req message and the Reg-Reply message.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The method of <claim-ref idref="CLM-00017">claim 17</claim-ref>, wherein creating the session keys further comprises utilizing Diffie-Hellman parameters and the Diffie-Hellman algorithm.</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The method of <claim-ref idref="CLM-00018">claim 18</claim-ref>, wherein the Reg-Req message includes an NAI associated with the MN, a timestamp, a challenge issued by the FA, and the Diffie-Hellman parameters.</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. The method of <claim-ref idref="CLM-00019">claim 19</claim-ref>, wherein the Reg-Reply message includes an identifier and the session keys.</claim-text>
</claim>
</claims>
</us-patent-grant>
