<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07299322-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07299322</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>11167433</doc-number>
<date>20050628</date>
</document-id>
</application-reference>
<us-application-series-code>11</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>JP</country>
<doc-number>2005-133914</doc-number>
<date>20050502</date>
</priority-claim>
</priority-claims>
<us-term-of-grant>
<us-term-extension>296</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>13</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>711154</main-classification>
<further-classification>711162</further-classification>
<further-classification>711165</further-classification>
<further-classification>711111</further-classification>
<further-classification>711203</further-classification>
<further-classification>714  6</further-classification>
<further-classification>714  7</further-classification>
</classification-national>
<invention-title id="d0e71">Computer system, storage device and method providing intra-storage volume identifiers corresponding to intra-host volume identifiers through volume switching commands</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>6981115</doc-number>
<kind>B2</kind>
<name>Yamagami et al.</name>
<date>20051200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711162</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>7035883</doc-number>
<kind>B2</kind>
<name>Kezuka et al.</name>
<date>20060400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>707205</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>7047360</doc-number>
<kind>B2</kind>
<name>Soejima et al.</name>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711114</main-classification></classification-national>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>7185164</doc-number>
<kind>B2</kind>
<name>Kusama et al.</name>
<date>20070200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711170</main-classification></classification-national>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>2004/0123180</doc-number>
<kind>A1</kind>
<name>Soejima et al.</name>
<date>20040600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>714  5</main-classification></classification-national>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>2005/0097145</doc-number>
<kind>A1</kind>
<name>Benhase et al.</name>
<date>20050500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>707200</main-classification></classification-national>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2007/0033437</doc-number>
<kind>A1</kind>
<name>Kawamura et al.</name>
<date>20070200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>714 20</main-classification></classification-national>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>JP</country>
<doc-number>11-327986</doc-number>
<date>19991100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>17</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>711161</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>711162</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>711164</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>711165</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>711170</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>711111</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>711204</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>711154</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>714  6</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>714  7</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>707204</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>707205</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709219</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>19</number-of-drawing-sheets>
<number-of-figures>24</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20060248304</doc-number>
<kind>A1</kind>
<date>20061102</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Hosouchi</last-name>
<first-name>Masaaki</first-name>
<address>
<city>Kanagawa</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Oyamada</last-name>
<first-name>Kenichi</first-name>
<address>
<city>Kanagawa</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="003" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Ikegaya</last-name>
<first-name>Naoko</first-name>
<address>
<city>Kanagawa</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="004" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Maki</last-name>
<first-name>Nobuhiro</first-name>
<address>
<city>Kanagawa</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Mattingly, Stanger, Malur &amp; Brundidge, P.C.</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Hitachi, Ltd.</orgname>
<role>03</role>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Kim</last-name>
<first-name>Hong</first-name>
<department>2185</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">Related plural logical volumes can be used after switching over from the host computer therein. A switching command, which a host computer sends, makes a storage device search for a switching target volume, from the volume tables, that is identical to identification information of the switching target volume received among switching target candidate volumes that form a volume pair relation with the switching source volume. The storage device memorizes an intra-host ID of the switching target volume and an intra-storage ID of the switching target volume in a switching table with a correspondence there between. The storage device acquires the intra-storage ID of the switching target volume in reference to the switching table in the case of receiving an access request, such that the intra-host ID of the switching source volume is used as a key, and executes switching to access to the switching target volume.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="253.75mm" wi="181.36mm" file="US07299322-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="255.78mm" wi="184.83mm" file="US07299322-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="233.68mm" wi="170.69mm" file="US07299322-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="212.17mm" wi="158.83mm" file="US07299322-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="168.15mm" wi="117.52mm" file="US07299322-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="201.85mm" wi="150.62mm" file="US07299322-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="126.58mm" wi="145.37mm" file="US07299322-20071120-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="226.74mm" wi="175.43mm" file="US07299322-20071120-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="233.34mm" wi="162.22mm" file="US07299322-20071120-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="208.11mm" wi="177.80mm" file="US07299322-20071120-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="226.74mm" wi="178.99mm" file="US07299322-20071120-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="178.22mm" wi="179.32mm" file="US07299322-20071120-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="201.93mm" wi="167.22mm" file="US07299322-20071120-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="245.03mm" wi="163.32mm" file="US07299322-20071120-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="252.73mm" wi="178.48mm" file="US07299322-20071120-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00015" num="00015">
<img id="EMI-D00015" he="209.13mm" wi="184.23mm" file="US07299322-20071120-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00016" num="00016">
<img id="EMI-D00016" he="216.49mm" wi="175.94mm" file="US07299322-20071120-D00016.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00017" num="00017">
<img id="EMI-D00017" he="149.01mm" wi="157.40mm" file="US07299322-20071120-D00017.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00018" num="00018">
<img id="EMI-D00018" he="216.32mm" wi="121.07mm" orientation="landscape" file="US07299322-20071120-D00018.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00019" num="00019">
<img id="EMI-D00019" he="222.84mm" wi="150.45mm" orientation="landscape" file="US07299322-20071120-D00019.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND</heading>
<p id="p-0002" num="0001">The present invention relates to a computing system, a host computer, storage device used in the computing system and a volume switching method employed in the computing system.</p>
<p id="p-0003" num="0002">To reduce the risk of data losses in a storage device due to accidents or failures, a technique called “host-free copy” is applied. This technique enables data of a storage device to be copied within the device itself or to another storage device without the mediation of a host computer. The data to be copied are handled in a unit of a storage area called a “logical volume” or “volume”. This logical volume is a logically separated area in the storage devices.</p>
<p id="p-0004" num="0003">When a script or an application determines an area to which a file is allocated, a host computer needs a host identifier (host ID). This host ID is used to identify a logical volume uniquely by a host computer. A host ID differs from an intra-storage ID used to allow a storage device to identify a logical volume therein. In addition, the host ID and the intra-storage ID are related to each other in a pre-setting process called “storage device generation”.</p>
<p id="p-0005" num="0004">The Host IDs typically correspond to intra-storage IDs in a one-to-one relation. However, a technique in which use of a single host ID enables the access to multiple logical volumes is disclosed in Japanese Unexamined Patent Application Publication No. 11-327986. In this technique, a host computer switches a relation between a logical volume and a host ID. Specifically, when an application issues an input/output (I/O) request, a host ID related to a certain logical volume makes it possible to access another logical volume to which another host ID is related.</p>
<p id="p-0006" num="0005">It is sometimes difficult to make host IDs corresponding to intra-storage IDs in a one-to-one relation. This may occur when the number of allocatable host IDs is different from that of allocatable intra-storage IDs. The number of allocatable IDs is defined by the capacity of an address area, and this capacity is typically determined by a standard specification or something similar. In other words, if a host computer and a storage device are consistent to a certain standard specification, an address area of a predetermined capacity is used in accordance with the specification. This means that the number of their allocable IDs is limited by the specification.</p>
<p id="p-0007" num="0006">As for a host computer, it uses a host ID in accordance with a standard specification in order to access various storage devices produced by individual venders. In contrast, a storage device uses an intra-storage ID in accordance with a specification defined arbitrarily by venders. This is because the intra-storage ID is used only for internal processing of the storage device.</p>
<p id="p-0008" num="0007">Accordingly, a host ID in compliance with a standard specification confines an address area to a small capacity, and an intra-storage ID in accordance to an arbitrary specification enables an address area of a large capacity to be used. As a result, their capacities differ from each other. In other words, owing to the number of allocatable hosts ID, a host computer cannot access the whole storage areas of a storage device, thereby inhibiting the maximum use of the storage areas within the storage device.</p>
<p id="p-0009" num="0008">Conventionally, host IDs for accessing a storage device are allocated to volumes of a storage device in a one-to-one relation. It is assumed that a host computer A uses a certain volume in order to execute a specific application and the copy of this volume is used by a host computer B for back-up or test use. In this case, upon a failure in the host computer A, the host computer B can inherit the operation of the host computer A by employing the technique disclosed in the above publication No. 11-327986. However, in order to achieve this operation, the host computer B needs to allocate a host ID beforehand not only to the target (copied) volume but also the source volume. In addition, when a target volume is already present, it is necessary to allocate a host ID to the target volume. This is because the host computer is necessary to access the target volume promptly, if a failure occurs in the source volume or if consistency is lacking between the source and target volumes.</p>
<heading id="h-0002" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0010" num="0009">Taking the above disadvantages into account, the present invention has been conceived. An object of the present invention is to provide a technique which enables a single host ID to be related to multiple logical volumes by allowing a host computer to switch these multiple volumes.</p>
<p id="p-0011" num="0010">According to an aspect of the present invention, in order to realize the purpose as described above, the present invention provides a storage device used for a computing system that includes a host computer identifying a volume thereof with an intra-host ID and the storage device that identifies the volume thereof with an intra-storage ID which comprises: 1) a volume pair control table to control volume pairs that execute copy among plural volumes, 2) an I/O receiving process unit to receive a switching command, from the host computer that makes correspondence between the intra-host ID of a switching target volume and identification information of a switching source volume, 3) an I/O target search process unit to search the switching target volume, from the volume tables, that is identical to identification information of the switching target volume receipt among switching target candidate volumes that form the volume pair relation with the switching source volume, 4) an I/O target memory process unit to memorize the intra-host ID of the switching target volume and the intra-storage ID of the switching target volume after being searched in a switching table with a correspondence therebetween, and 5) an I/O processing unit to acquire the intra-storage ID of the switching target volume in reference to the switching table in case of receiving access request, such that the intra-host ID of the switching source volume is a key, and execute switching to access to the switching target volume.</p>
<p id="p-0012" num="0011">Other aspects, features and advantages of the present invention will become apparent upon reading the following specification and claims when taken in conjunction with the accompanying drawings.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0013" num="0012">For more complete understanding of the present invention and the advantages thereof, reference is now made to the following description taken in conjunction with the accompanying drawings wherein:</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. 1</figref> is a schematic that shows an example of a hardware structure regarding an embodiment of the present invention.</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 2</figref> is a schematic that explains a structure of a volume pair control table regarding an embodiment of the present invention.</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 3</figref> is a schematic that explains a structure of a group control table regarding an embodiment of the present invention.</p>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 4</figref> is a schematic that explains a structure of an input-output correspondence control table regarding an embodiment of the present invention.</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 5</figref> is a schematic that explains a structure of a device control table regarding an embodiment of the present invention.</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 6</figref> is a schematic that explains a structure of a channel path control table regarding an embodiment of the present invention.</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 7</figref> is a schematic that explains a structure of a transfer data control table, which the host computer sends to the storage device, regarding an embodiment of the present invention.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 8</figref> is a flow chart that shows an input and output process regarding an embodiment of the present invention.</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 9</figref> is a schematic that explains computer grammar of an I/O target switching command regarding an embodiment of the present invention.</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 10</figref> is a schematic that explains a structure of switching request data.</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 11</figref> is a flow chart that shows a switching request process regarding an embodiment of the present invention.</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 12</figref> is a flow chart that shows an I/O receiving process regarding an embodiment of the present invention.</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 13</figref> is a flow chart that shows an I/O target volume search process regarding an embodiment of the present invention.</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 14</figref> is a flow chart that shows an I/O target volume search process, which is in the primary storage device, regarding an embodiment of the present invention.</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 15</figref> is a flow chart that shows an I/O target volume search process, which is in a self storage device in the case that identification information of the switching target is the volume ID, regarding an embodiment of the present invention.</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. 16</figref> is a flow chart that shows the I/O target volume search process, which is in a self storage device in the case that the identification information of the switching target is suspend time, regarding an embodiment of the present invention.</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 17</figref> is a flow chart that shows an I/O target volume search process, which is in the secondary storage device, regarding an embodiment of the present invention.</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 18</figref> is a flow chart that shows the pair transition process regarding an embodiment of the present invention.</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. 19</figref> is a flow chart that shows the I/O target memory process regarding an embodiment of the present invention.</p>
<p id="p-0033" num="0032"><figref idref="DRAWINGS">FIG. 20</figref> is a flow chart that shows an I/O process regarding an embodiment of the present invention.</p>
<p id="p-0034" num="0033"><figref idref="DRAWINGS">FIG. 21</figref> is a schematic that explains an example of a table content which is used in the cascaded structure in the present invention regarding an embodiment of the present invention.</p>
<p id="p-0035" num="0034"><figref idref="DRAWINGS">FIG. 22</figref> is a flow chart that shows a status monitoring process regarding an embodiment of the present invention.</p>
<p id="p-0036" num="0035"><figref idref="DRAWINGS">FIG. 23</figref> illustrates a one-to-one switching table that is generated by defining a volume pair of a switching source volume and a switching target volume in a scheme that makes a one-to-one relation between an intra-host ID and an intra-storage ID.</p>
<p id="p-0037" num="0036"><figref idref="DRAWINGS">FIG. 24</figref> illustrates a one-to-many switching table that is generated in an embodiment of the present invention.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DETAILED DESCRIPTION OF THE EXEMPLARY EMBODIMENTS OF THE INVENTION</heading>
<p id="p-0038" num="0037">A detailed description will be given below, of a computing system according to one embodiment of the present invention. Referring to <figref idref="DRAWINGS">FIG. 1</figref>, a computing system includes a host computer <b>10</b> composed of a main memory <b>11</b>, a central processing unit (CPU) <b>12</b>, and an I/O interface <b>13</b> such as a host channel adaptor. The I/O interface <b>13</b> is connected to the CPU <b>12</b> via an internal bus.</p>
<p id="p-0039" num="0038">A storage device <b>20</b> is connected to the I/O interface <b>13</b> through a network <b>30</b><i>a</i>. We have defined that the storage device <b>20</b> corresponds to any of storage devices <b>20</b><i>p </i>and <b>20</b><i>s </i>and we will use these assigned numbers to appropriately denote the systems and devices. The network <b>30</b><i>a </i>includes an optical cable, a switch and the like.</p>
<p id="p-0040" num="0039">The storage device <b>20</b> is constituted as follows;
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0040">(1) a port <b>21</b>, such as port <b>21</b><i>a</i>, <b>21</b><i>p </i>or <b>21</b><i>s</i>, that serves as an interface to Fibre Channel, SCSI and the like,</li>
    <li id="ul0001-0002" num="0041">(2) a channel adapter (CHA) <b>22</b>, such as a channel adapter <b>22</b><i>p </i>or <b>22</b><i>s</i>, that controls the port <b>21</b>,</li>
    <li id="ul0001-0003" num="0042">(3) a disk device <b>25</b>, such as a disk device <b>25</b><i>p </i>or <b>25</b><i>s</i>, that is a hardware having a physical memory area,</li>
    <li id="ul0001-0004" num="0043">(4) a disk adapter (DKA) <b>24</b>, such as a disk adapter <b>24</b><i>p </i>or <b>24</b><i>s</i>, that controls the input/output of the disk device <b>25</b>,</li>
    <li id="ul0001-0005" num="0044">(5) a bus and switch <b>23</b>, such as a bus and switch <b>23</b><i>p </i>or <b>23</b><i>s</i>, that both constitute a data communication path between the port <b>21</b> and the disk device <b>25</b>, and</li>
    <li id="ul0001-0006" num="0045">(6) a shared memory <b>27</b>, such as a shared memory <b>27</b><i>p </i>or <b>27</b><i>s</i>, that is a memory accessible from the CHA <b>22</b> and the DKA <b>24</b>.
<br/>
Note that the number of each component is not limited to one, and it may be a plurality.
</li>
</ul>
</p>
<p id="p-0041" num="0046">The host computer <b>10</b> uses the memory area of the disk device <b>25</b> and manages it, as a unit of logically separated area. The volume <b>26</b> corresponds to the logically separated area. The physical location of the volume in the disk device <b>25</b> is stored in the shared memory <b>27</b>. In the configuration of <figref idref="DRAWINGS">FIG. 1</figref>, only the logical volume <b>26</b><i>p </i>contains a device number, and other volumes contain no numbers.</p>
<p id="p-0042" num="0047">The storage device <b>20</b> identifies the volume <b>26</b> by using a volume ID, while the host computer <b>10</b> identifies it by using the device number. Herein, the volume ID and the device number refer to an intra-storage ID and a host ID, respectively. The data length of the device number may be shorter than that of the volume ID. Specifically, since the host computer <b>10</b> manages the storage device in accordance with a specific standard specification, the capacity of the address area, which can be allocated as a device number, is limited by the specification. For example, the number of bytes of the address area is 2. On the other hand, the storage device <b>20</b> manages the device itself in accordance with an original specification and, therefore the capacity of the address area of the volume ID can arbitrarily be defined. For example, the number of bytes of the address area is 4. In this case, the memory capacity in which the host computer <b>10</b> manages the device number is different from that in which the storage device <b>20</b> manages the volume ID.</p>
<p id="p-0043" num="0048">The host computer <b>10</b> includes a device control table <b>500</b> and a channel path control table <b>600</b>. Both these tables store information on the relationships between the device number and an I/O path or the volume ID of a target to which an I/O request is to be issued, when the host computer <b>10</b> is set up. When an I/O process is executed, the main memory <b>11</b> determines an I/O path with reference to the table <b>500</b> or <b>600</b>, and then issues an I/O request to a source volume through the determined path.</p>
<p id="p-0044" num="0049">The switching request process unit <b>1100</b> enables the access to the multiple volumes by using a single device number. Specifically, it switches the corresponding relation between the device number and the volume in response to the input of an I/O target switching command <b>900</b>. The host I/O process unit <b>800</b> generates a transfer data structure <b>700</b> (illustrated in <figref idref="DRAWINGS">FIG. 7</figref>) by determining one of the I/O path and the volume that are related to the device number, and then transfers the transfer data structure <b>700</b> to the storage device <b>20</b> through the network <b>30</b><i>a. </i></p>
<p id="p-0045" num="0050">The switching request process unit <b>1100</b> generates I/O target switching request data <b>1000</b> (illustrated in <figref idref="DRAWINGS">FIG. 10</figref>). An I/O target volume search process unit <b>1300</b>, a pair status transition process unit <b>1800</b>, and an I/O target memory process unit <b>1900</b> refers to the I/O target switching request data <b>1000</b> contained in the transfer data structure <b>700</b> and, then determines a switching target volume while communicating with another storage device <b>20</b>, so that the information on the target volume is stored in an I/O target control table <b>400</b> within the shared memory <b>27</b>. Note that the I/O target control table <b>400</b> refers to a switching table, described hereinafter.</p>
<p id="p-0046" num="0051">An I/O process unit <b>2000</b> requests the input/output of the volume <b>26</b> to which the device number is related, and which is designated by the I/O target control table <b>400</b>. A status monitoring process unit <b>2200</b> monitors the pair status and activates an I/O receiving process unit <b>1200</b> without the request from the host computer <b>10</b>.</p>
<p id="p-0047" num="0052">This embodiment executes the following specific processing:
<ul id="ul0002" list-style="none">
    <li id="ul0002-0001" num="0053">(1) the switching request process unit <b>1100</b> and the status monitoring process unit <b>2200</b> issue a request to the storage device <b>20</b>,</li>
    <li id="ul0002-0002" num="0054">(2) the storage device <b>20</b> refers to the volume pair control table <b>200</b> (also called volume table, herein), which manages a volume pair generated by the host-free copy, and the group control table <b>300</b>, in accordance with the request,</li>
    <li id="ul0002-0003" num="0055">(3) when the volume is ready to create a pair, the storage device <b>20</b> allows the volume or a group to which the volumes belong be a single unit, and</li>
    <li id="ul0002-0004" num="0056">(4) the storage device <b>20</b> changes the target volumes to which an I/O request is issued.</li>
</ul>
</p>
<p id="p-0048" num="0057">The old target is a volume to which the device number is related, and the new target is a partner volume, a volume making a pair with the partner volume, or a volume that used to create a pair. The new target is not related to the device number, and is located in the storage device <b>20</b> or another storage device.</p>
<p id="p-0049" num="0058">Herein, the host-free copy includes a remote copy and local copy performed by the storage device <b>20</b>. By performing the remote copy, a secondary volume <b>26</b><i>s</i>, which is located in the storage device <b>20</b><i>p </i>connected to the host computer <b>10</b>, is generated in the disk device <b>25</b><i>s </i>in the storage device <b>20</b><i>s </i>without the mediation of the host computer <b>10</b>. The storage device <b>20</b><i>s </i>may not be connected to the host computer <b>10</b> directly, as long as it is connected to the storage device <b>20</b><i>p</i>. In this case, the logical volume <b>26</b><i>s </i>is the secondary volume of the logical volume <b>26</b><i>p </i>that is generated by the remote copy.</p>
<p id="p-0050" num="0059">The primary volume <b>26</b><i>p</i>, which is a source, is denoted by the primary volume, and the secondary volume <b>26</b><i>s</i>, which is a target, is denoted by the secondary volume. A pair of the first and the second volumes is represented by a volume pair. The volume pair is aimed at maintaining the consistency between the primary and secondary volumes and controlling it. Alternatively, multiple volumes may create a group.</p>
<p id="p-0051" num="0060">The local copy is such that the secondary volume <b>26</b><i>q</i>, which is located in the disk device <b>25</b>, is copied to the same device, that is, the disk device <b>25</b> itself, without the mediation of the host computer <b>10</b>. Similar to the remote copy, a pair of the primary volume <b>26</b><i>p </i>(source) and secondary volume <b>26</b><i>q </i>(target) is denoted by a volume pair <b>29</b>. The volume pair <b>29</b> may be a group composed of multiple volumes. Note that the logical volume <b>26</b><i>q </i>is the secondary volume of the logical volume <b>26</b><i>p </i>which is generated by the local copy.</p>
<p id="p-0052" num="0061">As shown in the following descriptions (a) to (c), in the volume pair, the primary volume or the secondary volume of a pair A can have the same structure as the primary volume or the secondary volume of a pair B. As the volume included in the volume pair A or B, a group of the same volumes of which source volume is the same is called “copy volume group”.
<ul id="ul0003" list-style="none">
    <li id="ul0003-0001" num="0062">(a) A secondary volume of a volume pair which is generated by a remote copy has the same structure as that of a primary volume of a different volume pair which is generated by a remote copy.</li>
    <li id="ul0003-0002" num="0063">(b) A primary volume of a volume pair which is generated by a remote or local copy has the same structure as that of a primary volume of a different volume pair which is generated by a remote copy or a local copy.</li>
    <li id="ul0003-0003" num="0064">(c) A primary or secondary volume of a volume pair which is generated by a remote copy has the same structure as that of a primary volume of a different volume pair which is generated by a local copy.</li>
</ul>
</p>
<p id="p-0053" num="0065">Referring to tables of <figref idref="DRAWINGS">FIGS. 2 to 4</figref>, the values of each table are extracted from the following table, but these values are merely examples.</p>
<p id="p-0054" num="0066">
<tables id="TABLE-US-00001" num="00001">
<table frame="none" colsep="0" rowsep="0">
<tgroup align="left" colsep="0" rowsep="0" cols="3">
<colspec colname="offset" colwidth="14pt" align="left"/>
<colspec colname="1" colwidth="154pt" align="left"/>
<colspec colname="2" colwidth="49pt" align="left"/>
<thead>
<row>
<entry/>
<entry namest="offset" nameend="2" rowsep="1">TABLE 1</entry>
</row>
<row>
<entry/>
<entry namest="offset" nameend="2" align="center" rowsep="1"/>
</row>
<row>
<entry/>
<entry>ITEM</entry>
<entry>VALUE</entry>
</row>
<row>
<entry/>
<entry namest="offset" nameend="2" align="center" rowsep="1"/>
</row>
</thead>
<tbody valign="top">
<row>
<entry/>
<entry>Device number of logic volume 26p</entry>
<entry>D011</entry>
</row>
<row>
<entry/>
<entry>Sub-channel number of device number D011</entry>
<entry>C011</entry>
</row>
<row>
<entry/>
<entry>Port number of logic volume 26p</entry>
<entry>01</entry>
</row>
<row>
<entry/>
<entry>CHAID of logic volume 26p</entry>
<entry>01</entry>
</row>
<row>
<entry/>
<entry>Volume ID of logic volume 26p</entry>
<entry>11</entry>
</row>
<row>
<entry/>
<entry>System ID of storage device 20p which</entry>
<entry>11111</entry>
</row>
<row>
<entry/>
<entry>logic volume 26p belongs to</entry>
</row>
<row>
<entry/>
<entry>volume ID of logic volume 26q</entry>
<entry>12</entry>
</row>
<row>
<entry/>
<entry>System ID of storage device 20s which</entry>
<entry>22222</entry>
</row>
<row>
<entry/>
<entry>logic volume 26s belongs to</entry>
</row>
<row>
<entry/>
<entry>Volume ID of logic volume 26s</entry>
<entry>21</entry>
</row>
<row>
<entry/>
<entry>Group ID generated by local-copy</entry>
<entry>LG1</entry>
</row>
<row>
<entry/>
<entry>Group ID generated by remote-copy</entry>
<entry>RG1</entry>
</row>
<row>
<entry/>
<entry namest="offset" nameend="2" align="center" rowsep="1"/>
</row>
</tbody>
</tgroup>
</table>
</tables>
</p>
<p id="p-0055" num="0067">Referring to <figref idref="DRAWINGS">FIG. 2</figref>, the entry described for each volume pair in a volume pair control table <b>200</b> contains information including;
<ul id="ul0004" list-style="none">
    <li id="ul0004-0001" num="0068">(1) a primary storage device ID <b>211</b>, such as a serial number, for identifying the primary storage device <b>20</b><i>p </i>uniquely to which the primary volume <b>26</b><i>p </i>belongs,</li>
    <li id="ul0004-0002" num="0069">(2) a primary volume ID <b>212</b> for identifying the primary volume <b>26</b><i>p </i>uniquely in the storage device <b>20</b><i>p, </i></li>
    <li id="ul0004-0003" num="0070">(3) a secondary storage device ID <b>221</b> for identifying the storage device <b>20</b><i>s </i>uniquely to which the secondary volume <b>26</b><i>s </i>belongs,</li>
    <li id="ul0004-0004" num="0071">(4) a secondary volume ID <b>222</b> for identifying the secondary volume <b>26</b><i>s </i>uniquely in the storage device <b>20</b><i>s, </i></li>
    <li id="ul0004-0005" num="0072">(5) a group ID <b>201</b> of a group to which volumes (secondary volume upon local copy) in the storage device belong, for identifying multiple pairs each of which is composed of the same primary volume and a different secondary volume,</li>
    <li id="ul0004-0006" num="0073">(6) a pair status <b>202</b>, and</li>
    <li id="ul0004-0007" num="0074">(7) a copy type <b>203</b> designating the type of the host-free copy such as local or remote copy.</li>
</ul>
</p>
<p id="p-0056" num="0075">In this case, the pair status <b>202</b> indicates the following statuses to identify the consistent status of the volume pairs and the transfer status of the differential data.</p>
<p id="p-0057" num="0076">
<tables id="TABLE-US-00002" num="00002">
<table frame="none" colsep="0" rowsep="0">
<tgroup align="left" colsep="0" rowsep="0" cols="3">
<colspec colname="offset" colwidth="14pt" align="left"/>
<colspec colname="1" colwidth="63pt" align="left"/>
<colspec colname="2" colwidth="140pt" align="left"/>
<thead>
<row>
<entry/>
<entry namest="offset" nameend="2" rowsep="1">TABLE 2</entry>
</row>
<row>
<entry/>
<entry namest="offset" nameend="2" align="center" rowsep="1"/>
</row>
<row>
<entry/>
<entry>PAIR</entry>
<entry/>
</row>
<row>
<entry/>
<entry>STATUS</entry>
<entry>DESCRIPTION</entry>
</row>
<row>
<entry/>
<entry namest="offset" nameend="2" align="center" rowsep="1"/>
</row>
</thead>
<tbody valign="top">
<row>
<entry/>
<entry>SIMPLEX</entry>
<entry>Status that the pair has not been</entry>
</row>
<row>
<entry/>
<entry/>
<entry>established or status that the pair has</entry>
</row>
<row>
<entry/>
<entry/>
<entry>been deleted</entry>
</row>
<row>
<entry/>
<entry>PENDING</entry>
<entry>Status that the pair is created and data</entry>
</row>
<row>
<entry/>
<entry/>
<entry>transfer starts between primary and</entry>
</row>
<row>
<entry/>
<entry/>
<entry>secondary volumes, but data in volume is</entry>
</row>
<row>
<entry/>
<entry/>
<entry>not consistent</entry>
</row>
<row>
<entry/>
<entry>DUPLEX</entry>
<entry>Status that the data transfer from primary</entry>
</row>
<row>
<entry/>
<entry/>
<entry>to secondary volumes is completed, and</entry>
</row>
<row>
<entry/>
<entry/>
<entry>updated data is transferred from primary</entry>
</row>
<row>
<entry/>
<entry/>
<entry>to secondary volumes is completed, and</entry>
</row>
<row>
<entry/>
<entry/>
<entry>updated data is transferred</entry>
</row>
<row>
<entry/>
<entry>SUSPEND</entry>
<entry>Status that the data transfer is</entry>
</row>
<row>
<entry/>
<entry/>
<entry>suspended</entry>
</row>
<row>
<entry/>
<entry>DUPLEX-ERR</entry>
<entry>Status that failure occurs in</entry>
</row>
<row>
<entry/>
<entry/>
<entry>DUPLEX OR PENDING status</entry>
</row>
<row>
<entry/>
<entry>SUSPEND-ERR</entry>
<entry>Status that the failure occurs in</entry>
</row>
<row>
<entry/>
<entry/>
<entry>SUSPEND status</entry>
</row>
<row>
<entry/>
<entry namest="offset" nameend="2" align="center" rowsep="1"/>
</row>
</tbody>
</tgroup>
</table>
</tables>
</p>
<p id="p-0058" num="0077">In the volume pair control table <b>200</b>, the entry that has not been allocated is written or the entry of SIMPLEX status is overwritten, upon reception of a pair establish request. To delete the pair, the entry may be deleted. Alternatively, the status may be changed to SIMPLEX status. In this case, since the volume ID or the storage device ID required for the switching process is left, it can be allocated to the volume <b>26</b> that is a previous partner.</p>
<p id="p-0059" num="0078">Referring to <figref idref="DRAWINGS">FIG. 3</figref>, an entry described for each group in a group control table <b>300</b> includes a group ID, a copy type that is common to all volume pairs in the group, and a suspend time <b>303</b> indicating when a volume pair of a volume belonging to the group is lastly suspended.</p>
<p id="p-0060" num="0079">Referring to <figref idref="DRAWINGS">FIG. 4</figref>, an entry described for each volume <b>26</b> to which a switching request is issued in the I/O target control table <b>400</b> is constituted as follows;
<ul id="ul0005" list-style="none">
    <li id="ul0005-0001" num="0080">(1) a volume ID <b>401</b> of the primary volume <b>26</b><i>p, </i></li>
    <li id="ul0005-0002" num="0081">(2) a switched target primary storage device ID <b>402</b> of a storage device to which a storage device, to which a volume belongs, is switched,</li>
    <li id="ul0005-0003" num="0082">(3) a switched target volume ID <b>403</b> of a volume to which the volume <b>26</b> of an I/O target is switched,</li>
    <li id="ul0005-0004" num="0083">(4) a relay primary storage device ID <b>404</b> of a storage device to which a storage device to which a volume belongs is relayed, and</li>
    <li id="ul0005-0005" num="0084">(5) a relay volume ID <b>405</b> of the volume <b>26</b>, which is a relay target for transferring the transfer data structure <b>700</b> when the I/O target volume and the I/O issuing target volume are contained in different storage devices, respectively.
<br/>
In this case, the switched target is the volume <b>26</b><i>s. </i>
</li>
</ul>
</p>
<p id="p-0061" num="0085">In a device control table <b>500</b> of <figref idref="DRAWINGS">FIG. 5</figref>, an entry is described for each volume <b>26</b> accessible from the host computer <b>10</b> among the volumes <b>26</b> in each storage device <b>20</b>. The entry contains a device number <b>501</b> and sub-channel ID <b>502</b>.</p>
<p id="p-0062" num="0086">In the channel path control table <b>600</b> of <figref idref="DRAWINGS">FIG. 6</figref>, an entry is described for each sub-channel ID. The entry includes a sub-channel ID <b>601</b>, an I/O issuing target port ID <b>602</b> indicating the port <b>21</b> of an I/O issuing target, an I/O issuing target CHA ID <b>603</b> of the adaptor <b>22</b> which is an I/O issuing target, and an I/O issuing target volume ID <b>604</b> of the primary volume <b>26</b><i>p. </i></p>
<p id="p-0063" num="0087">Referring to <figref idref="DRAWINGS">FIG. 7</figref>, a transfer data structure <b>700</b> has the structure including;
<ul id="ul0006" list-style="none">
    <li id="ul0006-0001" num="0088">(1) a computer ID <b>701</b> of the host computer <b>10</b> which has issued an I/O request,</li>
    <li id="ul0006-0002" num="0089">(2) an I/O issuing target port ID <b>702</b> of the port <b>21</b> through which an I/O request is to be issued,</li>
    <li id="ul0006-0003" num="0090">(3) an I/O issuing target CHA ID <b>703</b> of the adaptor <b>22</b> to which an I/O request is to be issued,</li>
    <li id="ul0006-0004" num="0091">(4) an I/O issuing target volume ID <b>704</b> of the primary volume <b>26</b><i>p </i>to which an I/O request is to be issued,</li>
    <li id="ul0006-0005" num="0092">(5) a request code <b>705</b> for interpreting the request for the volume <b>26</b>, such as an input or output request, and</li>
    <li id="ul0006-0006" num="0093">(6) switching data <b>706</b> to be outputted to the volume <b>26</b>.</li>
</ul>
</p>
<p id="p-0064" num="0094">Referring to <figref idref="DRAWINGS">FIG. 8</figref>, the host I/O process unit <b>800</b> first searches the device control table <b>500</b> for an entry containing the device number <b>501</b> (S<b>801</b>) and then identifies sub-channel ID<b>502</b> contained in the entry searched in S<b>801</b>. Subsequently, the host I/O process unit <b>800</b> searches the channel path control table <b>600</b> for an entry containing the determined sub-channel ID<b>502</b> (S<b>802</b>).</p>
<p id="p-0065" num="0095">The host I/O process unit <b>800</b> copies the entry searched in S<b>802</b> to the transfer data structure <b>700</b> (S<b>803</b>). Specifically, the I/O issuing target port ID <b>602</b>, the I/O issuing target CHA ID <b>603</b> and the I/O issuing target volume ID <b>604</b> in the searched entry is copied to the I/O issuing target port ID <b>702</b>, the I/O issuing target CHA ID <b>703</b> and the I/O issuing target volume ID <b>704</b>, respectively.</p>
<p id="p-0066" num="0096">Upon sending of the I/O request, the host I/O process unit <b>800</b> inputs an input or output code to the request code <b>705</b> of the transfer data structure <b>700</b>. Alternatively, upon sending of the I/O target switching request, the host I/O process unit <b>800</b> inputs an I/O target switching request code to the request code <b>705</b> (S<b>804</b>).</p>
<p id="p-0067" num="0097">The host I/O process unit <b>800</b> substitutes an I/O data or an I/O target switching request data into the switching data <b>706</b> of the transfer data structure <b>700</b>. Subsequently, the host I/O process unit <b>800</b> transfers the transfer data structure <b>700</b> to a port designated by the I/O issuing target port ID <b>702</b> (S<b>805</b>).</p>
<p id="p-0068" num="0098">In this case, if the primary volume <b>26</b><i>p </i>to which the device number is related needs to be switched to a volume to which it is not related (for example, the volume <b>26</b><i>q </i>or <b>26</b><i>s</i>), then an I/O target switching command is input to the host computer <b>10</b> through a user or an application or script of the host computer <b>10</b>.</p>
<p id="p-0069" num="0099">Referring to <figref idref="DRAWINGS">FIG. 9</figref>, an operand of the access target switching command <b>900</b> contains, as minimum contents, the device number of the primary volume <b>26</b><i>p</i>, and switched target identification information <b>1010</b> (see <figref idref="DRAWINGS">FIG. 10</figref>). The operand may further contain a switching area for indicating only the volume designated by the switched target identification information <b>1010</b>, or for indicating all the volumes in the group to which the designated volume belongs.</p>
<p id="p-0070" num="0100">The switched target identification information <b>1010</b> is information for identifying a volume to which a current volume is to be switched, in order to send the I/O request to the I/O issuing target volume. This information designates at least one of a pair of a switched target volume ID <b>1012</b> and a switched target storage device ID <b>1011</b> or a request suspend time <b>1013</b>.</p>
<p id="p-0071" num="0101">Referring to <figref idref="DRAWINGS">FIG. 10</figref>, the I/O target switching request data <b>1000</b> contains a request source storage device ID <b>1001</b>, a request source volume ID <b>1002</b>, a switched area <b>1003</b>, and a switched target identification information <b>1010</b>. In this case, the switched area <b>1003</b> shows whether the area to be switched is a volume or a group.</p>
<p id="p-0072" num="0102">Switched target identification information <b>1010</b> contains:
<ul id="ul0007" list-style="none">
    <li id="ul0007-0001" num="0103">(a) a switched target storage device ID <b>1011</b>,</li>
    <li id="ul0007-0002" num="0104">(b) a switched target volume ID <b>1012</b> to which a value is input when the volume ID is designated to the I/O target switching command <b>900</b>,</li>
    <li id="ul0007-0003" num="0105">(c) a request suspend time <b>1013</b> to which a value is input when suspend time is requested, and</li>
    <li id="ul0007-0004" num="0106">(d) a switched target suspend time <b>1014</b> determined so as to be close to the request suspend time <b>1013</b>.</li>
</ul>
</p>
<p id="p-0073" num="0107">As for the request source storage device ID <b>1001</b>, the value is not determined when the I/O target switching request data <b>1000</b> is sent from the host computer <b>10</b> to the primary storage device <b>20</b><i>p</i>. However, its value contains a logical volume ID of the primary storage device <b>20</b><i>p </i>when the I/O target switching request data <b>1000</b> is sent from the primary storage device <b>20</b><i>p </i>to the secondary storage device <b>20</b><i>q. </i></p>
<p id="p-0074" num="0108">First, a description will be given below, of a process in which use of the access target switching command <b>900</b> of <figref idref="DRAWINGS">FIG. 7</figref> allows the entry of the switched target identification information <b>1010</b> to be registered in the volume pair control table <b>200</b>, with reference to <figref idref="DRAWINGS">FIGS. 11 to 19</figref>. Next, a description will be given below, of a process for switching an access to a volume appropriately, with reference to <figref idref="DRAWINGS">FIGS. 20 to 22</figref>.</p>
<p id="p-0075" num="0109">In a flow chart of <figref idref="DRAWINGS">FIG. 11</figref>, once receiving the I/O target switching command <b>900</b>, the switching request process unit <b>1100</b> interprets the operand of the command and then creates the I/O target switching request data <b>1000</b> by the input of the contents of the operand to the switching target identification information <b>1010</b> (S<b>1101</b>).</p>
<p id="p-0076" num="0110">The switching request process unit <b>1100</b> invokes an I/O process with the I/O target switching request data <b>1000</b>. Subsequently, a switching request process unit <b>1100</b> (not shown in <figref idref="DRAWINGS">FIG. 11</figref>) transfers, to the storage device <b>20</b>, the transfer data structure <b>700</b> containing the switching data <b>706</b> to which the I/O target switching request data <b>1000</b> is embedded (S<b>1102</b>). Then, switching request process unit <b>1100</b> waits for a response from the storage device <b>20</b> (S<b>1103</b>).</p>
<p id="p-0077" num="0111">In a flow chart of <figref idref="DRAWINGS">FIG. 12</figref>, if the request code <b>705</b> is an I/O request code sent from the host I/O process unit <b>800</b> of the host computer <b>10</b> or from the I/O process unit <b>2000</b> of another storage device <b>20</b> (“Yes” at S<b>1201</b>), then the I/O receiving process unit <b>1200</b> activates the I/O process unit <b>2000</b> (S<b>2000</b>) thus terminating the process.</p>
<p id="p-0078" num="0112">If the request code <b>705</b> is an I/O target search request code indicating an I/O target search request sent from another storage device (“Yes” at S<b>1202</b>), then the I/O receiving process unit <b>1200</b> activates the I/O target volume search process unit <b>1300</b> (S<b>1300</b>) thus terminating the process.</p>
<p id="p-0079" num="0113">If the request code <b>705</b> is a status transition request code (“Yes” at S<b>1203</b>), then the I/O receiving process unit <b>1200</b> activates the pair status transition process unit <b>1800</b> (S<b>1800</b>) thus terminating the process.</p>
<p id="p-0080" num="0114">If the request code <b>705</b> is a target memorizing request code (“Yes” at S<b>1204</b>), then the I/O receiving process unit <b>1200</b> activates the I/O target memory process unit <b>1900</b> (S<b>1900</b>) thus terminating the process.</p>
<p id="p-0081" num="0115">If the request code <b>705</b> is an I/O target switching request code sent from the switching request process unit <b>1100</b> of the host computer <b>10</b> (“Yes” at S<b>1205</b>), then the I/O receiving process unit <b>1200</b> activates the I/O target volume search process unit <b>1300</b> (S<b>1300</b>).</p>
<p id="p-0082" num="0116">In this case, if the search process at S<b>1300</b> fails (“No” at S<b>1206</b>), then the I/O receiving process unit <b>1200</b> sends an error response to the host computer <b>10</b> (<b>1208</b>) and, then terminates the process.</p>
<p id="p-0083" num="0117">Otherwise, if the search process at S<b>1300</b> succeeded (“Yes” at S<b>1206</b>), then the I/O receiving process unit <b>1200</b> activates the pair status transition process unit <b>1800</b> (S<b>1800</b>). Subsequently, the I/O receiving process unit <b>1200</b> substitutes the storage device ID to which the I/O receiving process unit <b>1200</b> itself belongs and the I/O issuing target volume ID <b>704</b> into the request source storage device ID <b>1001</b> and the request source volume ID <b>1002</b>, respectively (S<b>1207</b>).</p>
<p id="p-0084" num="0118">The I/O receiving process unit <b>1200</b> activates the I/O target memory process unit <b>1900</b> (S<b>1900</b>).</p>
<p id="p-0085" num="0119">In a flow chart of <figref idref="DRAWINGS">FIG. 13</figref>, the I/O target volume search process unit <b>1300</b> identifies a volume pair having a volume of the I/O issuing target volume ID <b>704</b> as the secondary volume. Then, the I/O target volume search process unit <b>1300</b> determines a storage device to which the primary volume of the identified volume pair belongs and activates a search process unit <b>1400</b> (not shown) corresponding to the determined (switched) volume (S<b>1301</b>).</p>
<p id="p-0086" num="0120">If the process of S<b>1301</b> succeeded (“Yes” at S<b>1302</b>), then the I/O target volume search process unit <b>1300</b> substitutes the volume ID of the switched volume and the storage device ID of the device to which the switched volume belongs into the switched target identification information <b>1010</b>. Subsequently, the I/O target volume search process unit <b>1300</b> sends the switched target identification information <b>1010</b> to the switched volume (S<b>1303</b>) thus terminating the process.</p>
<p id="p-0087" num="0121">The I/O target volume search process unit <b>1300</b> activates a search process unit <b>1500</b> (not shown) corresponding to the switched volume in the storage device to which the I/O target volume search process unit <b>1300</b> belongs (S<b>1304</b>). If the process of S<b>1304</b> succeeded (“Yes” at S<b>1305</b>), then the switched target identification information <b>1010</b> is sent to the switched volume (S<b>1303</b>).</p>
<p id="p-0088" num="0122">The I/O target volume search process unit <b>1300</b> identifies a volume pair having a volume of the I/O issuing target volume ID <b>704</b> as a primary volume. Then, the I/O target volume search process unit <b>1300</b> determines a storage device to which the secondary volume of the identified volume pair belongs, and activates an I/O target search process unit <b>1700</b> (not shown) corresponding to the determined (switched) volume (S<b>1306</b>). If the process of S<b>1306</b> succeeded (“Yes” at S<b>1307</b>), then the switched target identification information <b>1010</b> is sent to the switched volume (S<b>1303</b>).</p>
<p id="p-0089" num="0123">If all above processes fail (“No” at S<b>1307</b>), then the I/O target volume search process unit <b>1300</b> sends a message that the processes have failed (S<b>1308</b>).</p>
<p id="p-0090" num="0124">In a flow chart of <figref idref="DRAWINGS">FIG. 14</figref>, the search process unit <b>1400</b> corresponding to the secondary volume searches the volume pair control table <b>200</b> for an entry in which the secondary storage device ID <b>221</b> matches with the storage device ID, and in which the secondary volume ID <b>222</b> matches with the I/O issuing target volume ID <b>704</b> (S<b>1401</b>). If the entry does not exist (“No” at S<b>1402</b>), the result of the search is made to be failed (S<b>1403</b>).</p>
<p id="p-0091" num="0125">Otherwise, if the entry exists (“Yes” at S<b>1402</b>), the following processes are performed. If the primary storage device ID <b>211</b> of the entry is identical to the storage device to which the unit <b>1400</b> belongs (“Yes” at S<b>1404</b>), then the pair is determined to be generated by the local-copy. Then, to search a pair which is generated by the remote-copy and which has the primary volume by the local-copy as a secondary volume, the primary volume ID <b>212</b> is input to the I/O issuing target volume ID <b>704</b> (S<b>1405</b>), and the processes from S<b>1401</b> are performed again.</p>
<p id="p-0092" num="0126">If the primary storage device ID <b>211</b> of the entry is not identical to the storage device to which the unit <b>1400</b> belongs (“No” at S<b>1404</b>), then primary volume ID <b>212</b> that shows the primary volume ID and the I/O target search request code are substituted to the I/O issuing target volume ID <b>704</b> and the request code <b>705</b>, respectively. Subsequently, the transfer data structure <b>700</b> is transferred to the storage device <b>20</b> corresponding to the primary storage device ID <b>211</b> (S<b>1406</b>).</p>
<p id="p-0093" num="0127">Furthermore, the search process unit <b>1400</b> corresponding to the secondary volume searches the storage device <b>20</b> of the primary storage device ID <b>211</b>. Then, the search process unit <b>1400</b> acquires the search result from the storage device <b>20</b> (S<b>1407</b>).</p>
<p id="p-0094" num="0128">If the secondary volume exists (“Yes” at S<b>1408</b>), then the result of the search is made to be a success (S<b>1409</b>).</p>
<p id="p-0095" num="0129"><figref idref="DRAWINGS">FIG. 15</figref> is the flow chart that shows I/O target volume search process wherein the volume <b>26</b> in the storage device <b>20</b> is the target when the switching target storage device ID <b>1011</b> and the switching target volume ID <b>1012</b> are assigned for the switching target identification information <b>1010</b>.</p>
<p id="p-0096" num="0130">The search process unit <b>1500</b> in the switching target volume fails searching (S<b>1502</b>) if the switching target storage device ID <b>1011</b> is identical to ID of the storage device <b>20</b> (“No” in S<b>1501</b>).</p>
<p id="p-0097" num="0131">The search process unit <b>1500</b> of the switching target volume completes searching (S<b>1504</b>) and the volume of the I/O issuing target volume ID <b>704</b> is set as the search result if the switching target storage device ID <b>1011</b> is identical to the ID of the storage device <b>20</b> (“Yes” in S<b>1503</b>).</p>
<p id="p-0098" num="0132">Using the volume pair control table <b>200</b>, the search process unit <b>1500</b> of the switching target volume searches for an entry such that the primary storage device ID <b>211</b> is identical to the ID of the storage device <b>20</b> to which the I/O target search process unit <b>1500</b> belongs as well as the storage device ID<b>221</b> does and the primary volume ID <b>212</b> or the secondary volume ID <b>222</b> is identical to the I/O volume ID <b>704</b> (S<b>1505</b>).</p>
<p id="p-0099" num="0133">If there exists an entry in S<b>1505</b> (“Yes” in S<b>1506</b>), the search process unit <b>1500</b> of the I/O switching target volume searches whether the switching target volume ID <b>1012</b> in the switching target identification information <b>1010</b> is identical to the primary volume ID <b>212</b> or the secondary volume ID <b>222</b>. If an identical entry is obtained (“Yes” in S<b>1507</b>), the search is completed and the primary volume ID <b>212</b> or the secondary volume ID <b>222</b> is set as the search result (S<b>1508</b>).</p>
<p id="p-0100" num="0134">If the search process unit <b>1500</b> of the I/O switching target volume does not show such an identical entry as described above (“No” in S<b>1507</b>), the process is repeated from S<b>1505</b> as the primary volume ID <b>212</b> or the secondary volume ID <b>222</b>, either of which entry is not identical to the I/O issuing target volume is set as the I/O issuing target ID <b>704</b> (S<b>1509</b>).</p>
<p id="p-0101" num="0135"><figref idref="DRAWINGS">FIG. 16</figref> is a flow chart of the I/O target volume search process of which target is the volume of the storage device wherein the request suspend time <b>1013</b> is assigned to the switching target identification information <b>1010</b>.</p>
<p id="p-0102" num="0136">First, in the volume pair control table <b>200</b>, the search process unit <b>1600</b> in the suspend time searches for an entry such that the primary storage device ID <b>211</b> and the secondary device ID <b>221</b> both of which are identical to the ID of the storage device <b>20</b> to which the I/O target search process unit <b>1500</b> belongs and the primary volume ID <b>212</b> or the secondary volume ID <b>222</b> are identical to the I/O issuing target volume ID <b>704</b> (S<b>1601</b>).</p>
<p id="p-0103" num="0137">The search process unit <b>1600</b> of the suspend time stops the process if no entry exists (S<b>1602</b>).</p>
<p id="p-0104" num="0138">The search process unit <b>1600</b> of the suspend time substitutes the secondary storage device ID <b>221</b> of the entry to the switching target storage device ID <b>1011</b>, the secondary volume ID <b>222</b> to the switching target volume ID <b>1012</b> and the suspend time to the switching suspend time <b>1014</b> and sets them as the search candidates (S<b>1604</b>) if the suspend time of the entry in the group control table <b>300</b> is such that the group ID <b>201</b> in the entry equals to the copy time <b>203</b> group ID <b>201</b> in the entry is closer to the request suspend time <b>1013</b> than to the switching target suspend time <b>1014</b> (“Yes” in S<b>1603</b>).</p>
<p id="p-0105" num="0139">Further more, the search process unit <b>1600</b> of the suspend time repeats the process from S<b>1601</b> as setting the primary volume ID <b>212</b> or the secondary ID <b>222</b> of the entry which is not identical to the I/O issuing target volume ID <b>704</b> as the I/O issuing target volume ID <b>704</b> (S<b>1605</b>).</p>
<p id="p-0106" num="0140"><figref idref="DRAWINGS">FIG. 17</figref> is a flow chart that shows the I/O target volume search process in the secondary storage device.</p>
<p id="p-0107" num="0141">In the table <b>200</b>, the I/O target search process unit <b>1700</b> of the secondary storage device searches for an entry such that the ID of the storage device <b>20</b> is identical to the primary storage device ID <b>211</b> and the I/O issuing target volume ID <b>704</b> is identical to the primary volume ID <b>212</b> (S<b>1701</b>). If no entry exists, the search is set as failed (S<b>1703</b>).</p>
<p id="p-0108" num="0142">In the next stage, since the I/O target search unit <b>1700</b> of the secondary storage device is a pair of the local copy, the I/O target search unit <b>1700</b> of the secondary storage devices repeats to execute the secondary volume ID <b>222</b> as the I/O issuing target volume ID <b>704</b> (S<b>1705</b>) in order to search for the pair of the remote copy that sets the secondary volume of the local copy as the primary volume from S<b>1701</b> (S<b>1705</b>), if the secondary storage ID <b>221</b> of the entry is identical to the ID of the storage device <b>20</b> (“Yes” in S<b>1704</b>).</p>
<p id="p-0109" num="0143">Then, since the I/O target search unit <b>1700</b> of the secondary storage device substitutes the secondary volume ID <b>222</b> and the I/O target search request code to the I/O issuing target volume ID <b>704</b> and request code <b>705</b>, respectively, transfers the transfer data structure <b>700</b> to the storage device <b>200</b> of the secondary storage device ID <b>221</b> (S<b>1706</b>), searches in the storage device <b>20</b> of the secondary storage device ID <b>221</b> and receives the search result (S<b>1707</b>) until the response from the storage device <b>20</b> of the secondary storage device ID <b>221</b>.</p>
<p id="p-0110" num="0144">In the processes as shown in <figref idref="DRAWINGS">FIG. 13</figref> to <figref idref="DRAWINGS">FIG. 17</figref>, it is possible to search and specify the volume which may be the I/O target from the copies of the volumes including I/O issuing targets as well as the volumes in the storage devices other than the I/O issuing targets.</p>
<p id="p-0111" num="0145">It is checked whether the volume which is the I/O target is in a switchable status or not. When the volume which is the target of the I/O is the secondary volume of the volume pair, the differential information is independently transferred from the I/O request sent from the host computer <b>10</b> for the pair status of DUPLEX and PENDING and it is not possible to maintain the compliance of the volume contents.</p>
<p id="p-0112" num="0146">Therefore, it is necessary to change the volume pair status, such that the volume which is the I/O target is set as the secondary volume, to SUSPEND by means of the pair status transition process unit <b>1800</b>. Moreover, the pair sequentially change to the SUSPEND after tracing back to the volume which is not in the SUSPEND status or pair (the pair of SIMPLEX status) when the primary of the pair is the secondary volume as well.</p>
<p id="p-0113" num="0147"><figref idref="DRAWINGS">FIG. 18</figref> is the flow chart of the pair status transition process unit <b>1800</b>.</p>
<p id="p-0114" num="0148">The pair status transition process unit <b>1800</b> transfers the transfer data structure <b>700</b> to the storage device <b>20</b> to which the volume to be the I/O target belongs, since the unit refers to the pair status of the volume to be the I/O target. When the switching target storage device ID <b>1011</b> is not identical to the ID of the storage device <b>20</b> (“No” in S<b>1801</b>), the pair status transition request is substituted into the request code <b>705</b>, the secondary volume ID <b>222</b> is substituted in the I/O issuing target volume ID <b>704</b>, the transfer data structure <b>700</b> is transferred to the storage device <b>20</b> of the secondary storage device ID <b>221</b> (S<b>1802</b>) and the process is ended with waiting after the response (S<b>1803</b>).</p>
<p id="p-0115" num="0149">When the pair status transition process unit <b>1800</b> coincides (“Yes” in S<b>1801</b>), the unit shifts itself up to the pair that has the status other than PENDING and DUPLEX.</p>
<p id="p-0116" num="0150">The pair status transition process unit <b>1800</b> searches, from the volume pair control table <b>200</b>, for an entry such that the request volume ID <b>1002</b> is identical to the secondary volume ID <b>222</b> (S<b>1811</b>).</p>
<p id="p-0117" num="0151">The pair status transition process unit <b>1800</b> completes the process searches of the pair status <b>202</b>, in such case that the entry to be PENDING or DUPLEX does not exist (“No” in S<b>1812</b>), in response to the calling source (S<b>1825</b>).</p>
<p id="p-0118" num="0152">The pair status transition process unit <b>1800</b> transfers, when the ID of the entry and the ID of the storage device is not identical (“No” in S<b>1813</b>), the transition data structure <b>700</b> to the storage device <b>20</b> which the entry of the primary storage data ID<b>211</b> appoints and the primary volume belongs to (S<b>1814</b>) and waits for the response (S<b>1815</b>).</p>
<p id="p-0119" num="0153">The pair status transition process unit <b>1800</b> shifts the pair status to suspend and waits until the pair status <b>202</b> of the entry (S<b>1822</b>) is PENDING (“Yes” in S<b>1821</b>).</p>
<p id="p-0120" num="0154">The pair status transition process unit <b>1800</b> keeps the pair status in suspending and waits until the pair status <b>202</b> is suspended (S<b>1824</b>) after setting the pair to suspended if the pair status is DUPLEX (“Yes” in S<b>1823</b>).</p>
<p id="p-0121" num="0155">After shifting to the switchable status, the ID of the volume to be the I/O target and the ID of the storage device <b>20</b> to which the volume belongs are memorized in the shared memory <b>27</b> in the storage device <b>20</b> which contains each volume of the copy volume group in order to judge the I/O target upon the I/O request.</p>
<p id="p-0122" num="0156"><figref idref="DRAWINGS">FIG. 19</figref> shows flow chart of the I/O target memory process unit <b>1900</b>.</p>
<p id="p-0123" num="0157">The I/O target memory process unit <b>1900</b> allocates the entry to the I/O target control table <b>400</b> and substitutes the I/O issuing target volume ID <b>704</b>, the storage device ID to be switching target, the switching target storage device ID, the switching target volume ID and request storage device ID <b>1001</b> to the volume ID <b>401</b>, the primary storage device ID <b>402</b> of the switching target, the switching target volume ID <b>403</b>, the relay primary storage device ID <b>404</b> and the relay volume ID <b>405</b>, respectively (S<b>1901</b>).</p>
<p id="p-0124" num="0158">Among all of the volume pair control tables <b>200</b>, the I/O target memory process unit <b>1900</b> searches the either entry (S<b>1902</b>): one such that the primary storage device ID <b>211</b> is identical to the ID of the storage device <b>20</b>, the primary volume ID <b>212</b> is to the I/O issuing target volume ID <b>704</b>, the secondary storage device ID <b>221</b> is not to the request storage device ID <b>1001</b> and the secondary volume ID <b>222</b> is not to the request volume ID <b>1002</b>, and the other such that the secondary storage device ID <b>221</b> is identical to the ID of the storage device <b>20</b>, the secondary volume ID <b>222</b> is to the I/O issuing target volume ID <b>704</b>, the primary storage device ID <b>211</b> is not to the request storage device ID <b>1001</b> and the primary volume ID <b>212</b> is not to the request volume ID <b>1002</b>.</p>
<p id="p-0125" num="0159">The I/O target memory device process unit <b>1900</b> executes the steps S<b>1904</b> to S<b>1910</b> for the all entries searched in S<b>1902</b> and ends the process if none of the entries exists (S<b>1903</b>).</p>
<p id="p-0126" num="0160">The I/O target memory process unit <b>1900</b> memorizes the ID of the storage device to which the volume, belonging to the same group as the volume of the I/O issuing target volume ID <b>704</b>, is switched and the ID if the group is assigned to the switching range <b>1003</b> (“Yes” in S<b>1904</b>) and searches for an entry such that the group ID <b>201</b> of the entry is same as the copy type <b>203</b> in the volume pair control table <b>200</b> (S<b>1905</b>).</p>
<p id="p-0127" num="0161">The I/O target memory process unit <b>1900</b> allocates the entry to the I/O target control table <b>400</b> and substitutes the switching target storage device ID and NULL to the switching target storage device ID <b>402</b> and the switching target volume ID <b>403</b>, respectively. The I/O target memory process unit <b>1900</b> substitutes the secondary ID <b>222</b>, the primary storage device ID <b>211</b> and the primary volume ID <b>212</b> to the volume ID <b>401</b>, the relay primary storage device ID <b>404</b> and the relay volume ID <b>405</b>, respectively, if the I/O issuing target volume ID <b>704</b> belongs to the secondary volume of the group and does the primary volume ID <b>212</b>, the secondary storage device ID <b>221</b> and the secondary volume ID <b>222</b> to the volume ID <b>401</b>, the relay primary storage device ID <b>404</b> and the relay volume ID <b>405</b>, respectively, if the I/O issuing target volume ID <b>704</b> belongs to the primary volume of the group (S<b>1906</b>).</p>
<p id="p-0128" num="0162">The I/O target memory process unit <b>1900</b> repeatedly executes the primary volume ID <b>212</b>, which is not identical to the I/O issuing target volume ID <b>704</b>, or the secondary volume ID <b>222</b> as I/O issuing target volume ID <b>704</b> (S<b>1909</b>) from the step S<b>1901</b> for the purpose of allocating the entry of I/O target control table <b>400</b> to the volume <b>26</b> which corresponds to the pair of the local copy if both the primary storage device ID <b>211</b> of the entry and the secondary storage device ID <b>221</b> are identical to the ID of the storage device <b>20</b> (“Yes” in S<b>1907</b>)</p>
<p id="p-0129" num="0163">If both the primary storage device ID <b>211</b> of the entry and the secondary storage device ID <b>221</b> are identical to the ID of the storage device <b>20</b> (“No” in S<b>1907</b>), the I/O target memory process unit <b>1900</b> substitutes the ID of the storage device <b>20</b> and the I/O issuing target volume ID <b>704</b> to the request storage device ID <b>1001</b> and the request volume ID <b>1002</b> (S<b>1909</b>), respectively, for the purpose of allocating the entry of the I/O target control table <b>400</b> to the storage device of the volume which corresponds to the pair of the remote copy.</p>
<p id="p-0130" num="0164">The I/O target memory process unit <b>1900</b> substitutes the primary volume ID <b>211</b>, which is not identical to the I/O issuing target volume ID <b>704</b>, or the primary volume ID <b>212</b> to the I/O issuing target volume ID <b>704</b> and transfers the transfer data structure <b>700</b> to the primary storage device ID <b>211</b>, which is not identical to the ID of the storage device <b>20</b>, or the storage device <b>20</b> of the primary storage device ID <b>211</b> (S<b>1910</b>).</p>
<p id="p-0131" num="0165"><figref idref="DRAWINGS">FIG. 20</figref> shows the flow chart of the I/O process unit <b>2000</b>.</p>
<p id="p-0132" num="0166">The I/O process unit <b>2000</b> searches, among the table <b>400</b>, for an entry such that the I/O issuing target volume ID <b>704</b> is identical to the volume ID <b>401</b> (S<b>2001</b>) and executes the input and the output for the volume <b>26</b> of the I/O issuing volume ID <b>704</b> (S<b>2003</b>), since it is not the I/O target if the entry A does not exist (“No” in S<b>2002</b>).</p>
<p id="p-0133" num="0167">If the entry exists (“Yes” in S<b>2002</b>), the switching target primary storage device ID <b>402</b> of the entry A is identical to the ID of the storage device <b>20</b> (“Yes” in S<b>2004</b>) and the I/O volume ID <b>403</b> is not NULL (“No” in S<b>2005</b>), the I/O process unit <b>2000</b> executes the input and the output for the volume <b>26</b> of the switching target volume ID <b>403</b> (S<b>2006</b>).</p>
<p id="p-0134" num="0168">In the case of group assignment, the relay volume ID <b>405</b> is referred to because the switching target volume ID <b>403</b> is NULL (the relay volume ID <b>405</b> indicates the switching target if the switching primary storage device ID <b>402</b> and the relay primary storage device ID <b>404</b> are identical).</p>
<p id="p-0135" num="0169">If the switching target volume ID <b>403</b> is NULL (“Yes” in S<b>2005</b>), the I/O process unit <b>2000</b> executes the input and the output for the volume <b>26</b> of the relay volume ID <b>405</b> (S<b>2007</b>).</p>
<p id="p-0136" num="0170">Furthermore, if the switching target primary storage device ID <b>402</b> is not identical to the ID of the storage device <b>20</b> (“No” in S<b>2004</b>), the I/O process unit <b>2000</b> substitutes the ID of the port <b>21</b> installed in the storage device which has the relay primary storage device ID <b>404</b>, the ID of the adapter <b>22</b> installed in the storage device which has the relay primary storage device ID <b>404</b> and the relay volume ID <b>405</b> to the I/O issuing target port ID <b>702</b>, the I/O issuing target CHA ID <b>703</b> and the I/O issuing target volume ID <b>704</b>, respectively, and transfers the transfer data structure <b>700</b> to the storage device <b>20</b> of the relay primary storage device ID <b>404</b> (S<b>2008</b>).</p>
<p id="p-0137" num="0171">The I/O process unit <b>2000</b> waits for the data response such as the input and output results (S<b>2009</b>) and sends the input and output results to the original calling host computer <b>100</b> or the storage device <b>20</b> (S<b>2010</b>).</p>
<p id="p-0138" num="0172">In the discussion so far, it is understood that the I/O targets are switched against the I/O request from any of the computers once a computer requests the switching of the I/O targets. However, it is possible that the computer that requests the switching of the I/O targets only switches the I/O targets. Therefore, as shown in <figref idref="DRAWINGS">FIG. 19</figref> and <figref idref="DRAWINGS">FIG. 20</figref>, the I/O process unit <b>2000</b> memorizes the I/O target control table <b>400</b> in S<b>1901</b> of the I/O target memory process unit <b>1900</b> and executes the input and output for the volume <b>26</b> of the I/O issuing target volume ID <b>704</b> but not for the switching target if the computer ID <b>701</b> is not identical to the computer ID memorized in the I/O target control table <b>400</b>, in S<b>2002</b> of the I/O process unit <b>2000</b>, even if the entry A exists.</p>
<p id="p-0139" num="0173">An example of the table contents which is used for the embodiment of the present invention which has a cascaded configuration is illustrated in <figref idref="DRAWINGS">FIG. 21</figref>. The I/O target control table <b>400</b> is the one to which the primary volume <b>26</b><i>p </i>that has the intra-host ID provided by host computer <b>10</b> and is the I/O target control table in the storage device <b>20</b><i>p </i>which is connected with the host computer <b>10</b>. The secondary volume <b>26</b><i>q </i>is the secondary volume of the local copy of the primary volume <b>26</b><i>p</i>. The I/O target control table <b>400</b><i>s </i>is the I/O target control table <b>400</b> of the storage device <b>20</b><i>s </i>which is connected with the primary storage device <b>20</b><i>p</i>. The secondary volume <b>26</b><i>s </i>is the secondary volume of the storage device <b>20</b><i>t </i>which is connected with the storage device <b>20</b><i>s</i>. The volume <b>26</b><i>t </i>is the secondary volume of the remote copy of the secondary volume <b>26</b><i>s. </i></p>
<p id="p-0140" num="0174">As shown in <figref idref="DRAWINGS">FIG. 21</figref>, the I/O target is the volume <b>26</b><i>t </i>and the ID of the volume <b>26</b><i>t </i>is set in the I/O switching target volume ID <b>403</b>. The ID of the storage device <b>20</b><i>s </i>is set for the relay primary storage device ID <b>404</b> since the access is executed in such a transferring that the transfer data structure <b>700</b> is transferred to the storage device <b>20</b><i>s </i>which transfers the transfer data structure <b>700</b> to the storage device <b>20</b><i>t </i>via the storage device <b>20</b><i>s </i>from the primary storage device <b>20</b><i>p </i>in order to access to the volume <b>26</b><i>t </i>from the host computer <b>10</b></p>
<p id="p-0141" num="0175">In the discussion so far, the I/O targets are switched by the request from the host computer <b>10</b>. However, there is a case such that the switching is possible according to the internal status of the storage device <b>20</b>. For example, when the secondary volume of the remote copy has the same structure as the primary volume of the local copy, and it is necessary to access the secondary volume of the local copy since the primary volume of the local copy has been updated in case that the pair status of the remote copy is DUPLEX just before the storage device <b>20</b> to which the primary volume of the remote copy has failure if the consistency is not guaranteed and the pair status of the local copy is SUSPEND. If the pair status of the remote copy is SUSPEND, the primary volume of the local copy has the consistency and the latest updated data is obtained if the primary volume is used.</p>
<p id="p-0142" num="0176">As has been discussed above, it is possible to judge which local copies we access from the pair status on the basis of the pair status. Even if the intra-host ID is allocated only for the primary volume of the local copy in the host computer which is connected to the local copy, it is possible to access the consistent data before the completion of returning the primary volume from the secondary volume by changing the access target to be the secondary volume.</p>
<p id="p-0143" num="0177">By setting the status monitoring process <b>2200</b> that can monitor the pair condition, it is possible to switch without waiting for the instruction from the host computer <b>10</b> as well.</p>
<p id="p-0144" num="0178"><figref idref="DRAWINGS">FIG. 22</figref> shows a flow chart regarding the status monitoring process unit <b>2200</b>.</p>
<p id="p-0145" num="0179">The status monitoring process unit <b>2200</b> keeps searching the pair status in volume pair status control table <b>200</b> until an entry is such that the pair status A is abnormal (S<b>2201</b>).</p>
<p id="p-0146" num="0180">In the case that the entry A exists (“Yes” in S<b>2201</b>), the status monitoring process unit <b>2200</b> searches whether an entry B exists, such that the secondary storage device ID <b>221</b> is identical to the ID of the storage device <b>20</b>, the pair status <b>202</b> of the entry A is DUPLEX-ERR, the primary storage device ID <b>211</b> and the secondary storage device ID <b>221</b> are both same as the IDs of the storage device <b>20</b> and the primary volume ID <b>212</b> is equal to the secondary volume ID <b>222</b> of the entry A (S<b>2202</b>).</p>
<p id="p-0147" num="0181">If the entry B exists, the status monitoring process unit <b>2200</b> searches the entry such that the volume ID <b>401</b> is equal to the primary volume ID <b>212</b> of the entry B or the secondary volume ID <b>222</b> and changes the relay volume ID <b>405</b> to the secondary volume ID <b>222</b> of the entry B (S<b>2203</b>).</p>
<p id="p-0148" num="0182">As has been discussed above, the storage device regarding an embodiment of the present invention has;
<ul id="ul0008" list-style="none">
    <li id="ul0008-0001" num="0183">(1) a receiving means to receive the information of the volume ID and the suspend time, being necessary to specify the second logical volume of the I/O target, that are sent to the first logical volume included in the storage device which is allocated within the intra-host ID,</li>
    <li id="ul0008-0002" num="0184">(2) a searching means to search the second logical volume among the first logical volume and one or plural third logical volumes, either of which make the relation of source volume and or target volume which is the host free copy function, for the first logical volume,</li>
    <li id="ul0008-0003" num="0185">(3) a memory means to memorize the ID of the searched second logical volume in the shared memory in each storage device to which the pair volume of the second logical volume belongs,</li>
    <li id="ul0008-0004" num="0186">(4) a waiting means to wait for the completion of changing to the pair status so that the receipt of the differential data is unable, and</li>
    <li id="ul0008-0005" num="0187">(5) an I/O means to input and output for the second logical volume in reference to the ID of the second logical volume which is memorized when the request of the input and output to the first logical volume is received.</li>
</ul>
</p>
<p id="p-0149" num="0188">By using the present storage device, it is possible to increase the quantity of the volumes accessible from the same host computer <b>10</b> by allocating the intra-host ID to other volumes since it is possible to access each of the volumes without setting further intra-host IDs for each volume and therefore it is possible to effectively use the storage devices.</p>
<p id="p-0150" num="0189">Remarkable effects obtained by the embodiments of the present invention are concretely explained.</p>
<p id="p-0151" num="0190"><figref idref="DRAWINGS">FIG. 23</figref> illustrates a one-to-one switching table <b>3000</b> that is obtained by defining a volume pair <b>29</b> of a switching source volume <b>3010</b> and a switching target volume <b>3020</b> in the scheme that makes a one-to-one relation between the intra-host ID <b>3030</b> and the intra-storage ID <b>3040</b>, both to be compared. It is assumed that the intra-host ID <b>3030</b> has a 2 byte length (an amount of addresses of 2<sup>16 </sup>which is 65536 addresses allocatable).</p>
<p id="p-0152" num="0191">In the present scheme to be compared, the intra-storage ID <b>3040</b> is limited to the same quantity as the intra-host ID <b>3030</b> (e.g., as much as 65535). Therefore, if there are more volumes than there are intra-host IDs, the volumes which are over the maximum number of the intra-host IDs are out of use, and the allocation is a waste of computer resources.</p>
<p id="p-0153" num="0192">On the other hand, <figref idref="DRAWINGS">FIG. 24</figref> illustrates a one-to-many switching table <b>4000</b> that is created by the switching command issued from the host computer <b>10</b> in the embodiment of the present invention.</p>
<p id="p-0154" num="0193">In the embodiment of the present invention, the intra-host ID <b>4030</b> is used for the switching source volume <b>4010</b> and the intra-storage IDs <b>4040</b>-<b>1</b>, <b>4040</b>-<b>2</b>, <b>4040</b>-<b>3</b> are used for the switching target volumes <b>4020</b>-<b>1</b>, <b>4020</b>-<b>2</b>, <b>4030</b>-<b>3</b>, respectively. All of the volumes that satisfy the identification information of the switching target volume included in the switching commands are the switching target volumes <b>4020</b>. Therefore, the volumes included in the switching table <b>4000</b> are the switching target volumes <b>4020</b> which are not limited by the quantity of the intra-host IDs <b>4030</b> in addition to the switching source volumes <b>4010</b> which are limited by the quantity of the intra-host IDs <b>4010</b>. Accordingly, the excess volumes can be used for the switching target volumes <b>4020</b> if there are more volumes than there are intra-host IDs <b>4010</b>, and it is possible to effectively utilize all the volumes which are available as the computer resources.</p>
<p id="p-0155" num="0194">From the aforementioned explanation, those skilled in the art will be able to ascertain the essential characteristics of the present invention and can make various modifications and variations to the present invention to adapt it to various usages and conditions without departing from the spirit and scope of the claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A storage device used for a computing system that includes a host computer identifying a volume thereof with an intra-host identifier (ID) and said storage device that identifies said volume thereof with an intra-storage ID comprising:
<claim-text>a volume pair control table to control volume pairs that execute copy among plural volumes;</claim-text>
<claim-text>an input/output (I/O) receiving process unit to receive a switching command, from said host computer, that makes correspondence between said intra-host ID of a switching source volume and identification information of a switching target volume;</claim-text>
<claim-text>an I/O target search process unit to search said switching target volume, from said volume tables, that is identical to identification information of said switching target volume receipt among switching target candidate volumes that form said volume pair relation with said switching source volume;</claim-text>
<claim-text>an I/O target memory process unit to memorize said intra-host ID of said switching source volume and said intra-storage ID of said switching target volume after being searched in a switching table with corresponding therebetween; and</claim-text>
<claim-text>an I/O processing unit to acquire said intra-storage ID of said switching target volume in reference to said switching table in case of receiving an access request such that said intra-host ID of said switching source volume is used as a key, and executes switching to access to said switching target volume.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. A storage device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said volume table controls volumes in plurality sets of said storage device and said switching source volume and said switching target volume separately locates in said storage device.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. A storage device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein a data length of said intra-host ID is shorter than a data length of said intra-storage ID.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. A storage device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein identification information of said switching target volume is said intra-storage ID of said switching target volume and an ID of said storage device that has said switching target volume.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. A storage device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein identification information of said switching target volume is suspend time of said volume pair of said switching target volume.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. A storage device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said switching target candidate volume includes a predetermined volume that makes a relation of said volume pair with said switching source volume and a volume that makes a relation of said volume pair with a predetermined volume.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. A storage device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said volume pair is a pair that executes copy of said switching source volume to said switching target volume and said volume pair changes pair status such that receipt of differential data is unable and has a pair status transition process unit that waits for completion to change pair status such that receipt of differential data is unable.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. A storage device according to <claim-ref idref="CLM-00001">claim 1</claim-ref> having a status monitoring process unit to monitor said volume pair that copy said switching source volume to said pair volume, wherein
<claim-text>said I/O target memory process unit memorizes a predetermined volume in said switching table as said switching volume for a case that failure status which guarantees that pair status of said volume pair maintains consistency and</claim-text>
<claim-text>said I/O target memory process unit memorizes a volume which is a target to copy said pair volume in said switching table as said switching volume for a case that failure status which does not guarantee that pair status of said volume pair maintains consistency.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. A computing system that identifies a volume thereof with an intra-host identifier (ID) and includes a storage device which is connected with said host computer through a communication line and identifies a volume with an intra-storage ID having a central processor device that sends a switching command which makes a correspondence between said intra-host ID of a switching source volume and identification information of a switching volume through an input/output (I/O) interface connected to said communication line,
<claim-text>wherein said storage device has a port connected to said communication line, a channel adapter connected to said port, a shared memory being connected to said channel adapter and said port and storing volume pairs among which copy of volumes is executed, a disk adapter connected to said channel adapter and plural disk devices, being connected to said disk adapter, in which plural volumes are created,</claim-text>
<claim-text>wherein said channel adapter receives a switching command that makes correspondence between said intra-host ID of a switching source volume and identification information of a switching target volume, searches over said shared memory said switching target volume which is identical to said switching target volume in reference to a switching target candidate volume which makes a relation of said volume pair with said switching source volume, memorizes said intra-host ID of said switching source volume and said intra-storage ID of searched said switching target volume both of which are corresponded and switches over to access said switching target volume after acquiring said intra-storage ID of said switching target volume in reference to said shared memory when said channel adapter receives an access command for which said intra-host ID of said switching source volume is set as a key,</claim-text>
<claim-text>wherein said volume pair is a pair that executes copy from said switching source volume to said switching target volume, changes a pair status thereof to a pair status such that differential data cannot be received when said channel adapter is in a pair status such that differential data can be received from said switching source volume and waits until completion of changing to a pair status such that differential data cannot be received,</claim-text>
<claim-text>wherein said channel adapter monitors said volume pair that executes copy from said switching source volume to a predetermined volume, memorizes predetermined volume in said shared memory as said switching target volume if a pair status of said volume pair is in a failure status to guarantee to maintain consistency and memorizes a volume which is a copy target of a predetermined volume in said shared memory as said switching target volume if a pair status is in a failure status not to guarantee to maintain consistency,</claim-text>
<claim-text>wherein said shared memory controls volumes which are in a plurality of said storage devices and said switching source volume and said switching target volume are separately allocated in said storage device,</claim-text>
<claim-text>wherein a data length of said intra-host ID is configured to be shorter than a data length of said intra-storage ID, and</claim-text>
<claim-text>wherein identification information of said switching target volume is said intra-storage ID of said switching target volume, an ID of said storage device which has said switching target volume and suspend time specified to said volume pair of said switching volume.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. A volume switching method that is executed by a computing system including a host computer which identifies a volume thereof with an intra-host identifier (ID) and a storage device which identifies a volume thereof with an intra-storage ID, wherein said storage device carries out steps comprising:
<claim-text>controlling, in a shared memory, a volume pair which executes copying between plural volumes,</claim-text>
<claim-text>receiving, from said host computer, a switching command that makes a correspondence between said intra-host ID of said switching source volume and identification information of a switching target volume,</claim-text>
<claim-text>searching over said shared memory said switching target volume which is identical to said switching target volume in reference to a switching target candidate volume which makes a relation of said volume pair with said switching source volume,</claim-text>
<claim-text>memorizing said intra-host ID of said switching source volume and said intra-storage ID of searched said switching target volume, and</claim-text>
<claim-text>switching over to access said switching target volume after acquiring said intra-storage ID of said switching target volume in reference to said shared memory when said storage device receives an access command for which said intra-host ID of said switching source volume is set as a key.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. A volume switching method according to <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein a data length of said intra-host ID is shorter than a data length of said intra-storage ID.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. A volume switching method according to <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein identification information of said switching target volume is said intra-storage ID of said switching target volume and an ID of said storage device that has said switching target volume.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. A volume switching method according to <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein identification information of said switching target volume is suspend time specified to said volume pair of said switching volume.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. A host computer to be coupled to at least one of storage devices via a network, comprising:
<claim-text>a port to be coupled to said network; a processor coupled to said port; and a memory coupled to said processor;</claim-text>
<claim-text>wherein said memory holds an intra-host identifier (ID) identifies a volume and an intra-storage ID identifies a volume,</claim-text>
<claim-text>wherein said processor generates a switching command which makes a correspondence between said intra-host ID of a switching source volume and identification information of a switching target volume through I/O interface connected to said communication line to said storage device which controls volume pairs which executes copy between plural volumes and sends to said storage device said switching command through said port, wherein</claim-text>
<claim-text>said switching command makes said storage device:</claim-text>
<claim-text>search said switching target volume which is identical to identification information of said switching target volume among switching target candidate volumes which make a relation of said volume pair with said switching source volume,</claim-text>
<claim-text>memorize, in a switching table, said intra-host ID of said switching source volume and said intra-storage ID of searched said switching target volume for which a correspondence is made, and</claim-text>
<claim-text>switch over to access said switching target volume after acquiring said intra-storage ID of said switching target volume in reference to said switching table when said storage device receives an access request for which said intra-host ID of said switching source volume is set as a key.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. A host computer according to <claim-ref idref="CLM-00014">claim 14</claim-ref>, wherein a data length of said intra-host ID is shorter than a data length of said intra-storage ID.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. A host computer according to <claim-ref idref="CLM-00014">claim 14</claim-ref>, wherein identification information of said switching target volume is said intra-storage ID of said switching target volume and an ID of said storage device that has said switching target volume.</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. A host computer according to <claim-ref idref="CLM-00014">claim 14</claim-ref>, wherein identification information of said switching target volume is suspend time specified to said volume pair of said switching target volume.</claim-text>
</claim>
</claims>
</us-patent-grant>
