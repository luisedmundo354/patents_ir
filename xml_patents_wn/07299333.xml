<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07299333-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07299333</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>11078023</doc-number>
<date>20050311</date>
</document-id>
</application-reference>
<us-application-series-code>11</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>JP</country>
<doc-number>2000-372578</doc-number>
<date>20001207</date>
</priority-claim>
</priority-claims>
<us-term-of-grant>
<us-term-extension>248</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>12</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>711170</main-classification>
<further-classification>711112</further-classification>
<further-classification>711114</further-classification>
<further-classification>711162</further-classification>
</classification-national>
<invention-title id="d0e71">Computer system with storage system having re-configurable logical volumes</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5794255</doc-number>
<kind>A</kind>
<name>Hayashi et al.</name>
<date>19980800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5875456</doc-number>
<kind>A</kind>
<name>Stallmo et al.</name>
<date>19990200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711114</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6052759</doc-number>
<kind>A</kind>
<name>Stallmo et al.</name>
<date>20000400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>6289398</doc-number>
<kind>B1</kind>
<name>Stallmo et al.</name>
<date>20010900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>JP</country>
<doc-number>05-020155</doc-number>
<kind>A</kind>
<date>19930100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>JP</country>
<doc-number>07-141231</doc-number>
<kind>A</kind>
<date>19950600</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>JP</country>
<doc-number>07-334398</doc-number>
<kind>A</kind>
<date>19951200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>JP</country>
<doc-number>11-095934</doc-number>
<kind>A</kind>
<date>19990400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>JP</country>
<doc-number>2000-242434</doc-number>
<kind>A</kind>
<date>20000900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>4</number-of-claims>
<us-exemplary-claim>4</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>None</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>14</number-of-drawing-sheets>
<number-of-figures>20</number-of-figures>
</figures>
<us-related-documents>
<continuation>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>09910153</doc-number>
<kind>00</kind>
<date>20010720</date>
</document-id>
<parent-grant-document>
<document-id>
<country>US</country>
<doc-number>6880058</doc-number>
<kind>A </kind>
</document-id>
</parent-grant-document>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>11078023</doc-number>
</document-id>
</child-doc>
</relation>
</continuation>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20050154830</doc-number>
<kind>A1</kind>
<date>20050714</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Mizuno</last-name>
<first-name>Yoichi</first-name>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Matsunami</last-name>
<first-name>Naoto</first-name>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="003" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Muraoka</last-name>
<first-name>Kenji</first-name>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="004" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Mimatsu</last-name>
<first-name>Yasuyuki</first-name>
<address>
<city>Yokohama</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Townsend and Townsend and Crew LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Hitachi, Ltd.</orgname>
<role>03</role>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Ellis</last-name>
<first-name>Kevin L.</first-name>
<department>2188</department>
</primary-examiner>
<assistant-examiner>
<last-name>Chery</last-name>
<first-name>Mardochee</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">In order to enable an area of each logical volume to be expanded while continuously using the logical volume and to integrate separate logical volumes in a single continuous area, a storage has logical volume control means for controlling the construction of a logical volume, a logical volume number map in which logical volume construction information is described, and copy means for copying the logical volume. By allowing two or more inner logical numbers to be described per external logical number in the logical volume number map, improved flexibility in combining the logical volumes in the storage is achieved. By copying a plurality of separate logical volumes into a physical continuous area by the copy means, the logical volumes are integrated.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="212.01mm" wi="164.34mm" file="US07299333-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="221.23mm" wi="168.57mm" file="US07299333-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="234.78mm" wi="160.27mm" orientation="landscape" file="US07299333-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="204.22mm" wi="160.10mm" file="US07299333-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="159.85mm" wi="64.69mm" file="US07299333-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="236.05mm" wi="108.29mm" orientation="landscape" file="US07299333-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="236.47mm" wi="178.99mm" orientation="landscape" file="US07299333-20071120-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="220.30mm" wi="163.41mm" file="US07299333-20071120-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="232.24mm" wi="159.85mm" file="US07299333-20071120-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="173.40mm" wi="123.53mm" file="US07299333-20071120-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="235.80mm" wi="107.36mm" orientation="landscape" file="US07299333-20071120-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="233.51mm" wi="105.66mm" orientation="landscape" file="US07299333-20071120-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="201.25mm" wi="158.33mm" file="US07299333-20071120-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="96.77mm" wi="133.60mm" file="US07299333-20071120-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="118.19mm" wi="100.84mm" file="US07299333-20071120-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0002" num="0001">The present invention relates to a method of changing the construction of a logical volume area in a storage and, more particularly, a method of expanding a logical volume area.</p>
<p id="p-0003" num="0002">Conventionally, as a method of expanding the capacity in a storage, an expansion method by adding a physical disk is known. The method will be described with reference to <figref idref="DRAWINGS">FIG. 15</figref>. Reference numeral <b>100</b> denotes a storage and <b>101</b> indicates a physical disk area as a collection of physical disks. In the physical disk area <b>101</b>, logical volumes called LU (Logical Units) designated by reference numerals <b>1011</b><i>x </i>(<b>1011</b><i>a, </i><b>1011</b><i>b</i>, . . . ) are constructed. In the case of expanding the capacity of the storage, by adding a physical disk to the storage <b>100</b>, as shown by a broken line, an added disk area <b>102</b> is generated. When the logical volumes LU<b>1</b> (<b>1011</b><i>a</i>) and LU<b>2</b> (<b>1011</b><i>b</i>) in the physical disk area <b>101</b> become full, a new logical volume LU<b>3</b> (<b>1011</b><i>c</i>) can be generated in the added disk area <b>102</b>.</p>
<p id="p-0004" num="0003">However, in the case of expanding the area of an internal logical volume already allocated to increase the usable capacity of the storage, a problem occurs. For example, in the case of enlarging the LU<b>1</b> (<b>1011</b><i>a</i>) in <figref idref="DRAWINGS">FIG. 15</figref>, since the LU<b>2</b> (<b>1011</b><i>b</i>) immediately follows, the LU<b>2</b> (<b>1011</b><i>b</i>) has to be released. In order to enlarge the logical volume area in the storage <b>100</b>, the area has to be released once and allocation of the logical volume area has to be newly defined. Consequently, an access to a logical volume has to be interrupted.</p>
<heading id="h-0002" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0005" num="0004">As described above, it is easy to increase the capacity of a logical volume area by adding a physical disk even during operation of the system. On the other hand, since the logical volumes are constructed in an inner continuous area, the area of each logical volume cannot be expanded during operation of the system without newly adding a physical disk. In other words, to enlarge a logical volume area in a storage, the area has to be released once and a logical volume area has to be newly defined. A logical volume area cannot be therefore changed during operation of the system.</p>
<p id="p-0006" num="0005">It is an object of the invention to enable the construction of a logical volume to be freely changed during operation of the system, for example, to expand a logical volume area in a storage. Specifically, an object of the invention is to provide a method of enabling the logical volume area to be expanded without releasing an existing logical volume area and expanding the logical volume area without interrupting an access to an existing logical volume.</p>
<p id="p-0007" num="0006">A computer system to which the invention is applied, thereby obtaining effects has, for example, at least one computer, a storage, and a control utility for instructing a construction change in a logical volume in the storage.</p>
<p id="p-0008" num="0007">According to the invention, the storage has logical volume control means for controlling the construction of the logical volume, and the logical volume control means is provided with a logical volume number map in which logical volume construction information is described. By describing the constructions of the computer and logical volumes and the combination with logical volumes in the storage which can be used by the computer, a construction change in the logical volumes can be freely made. By copying a plurality of separate logical volumes into a physically continuous area so as to be integrated to a single logical volume, management of the logical volume is facilitated.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0009" num="0008"><figref idref="DRAWINGS">FIG. 1</figref> is a diagram showing the configuration of a computer system according to a first embodiment of the invention.</p>
<p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. 2</figref> is a diagram showing an example of an LUN map of a storage <b>1</b> in the first embodiment of the invention.</p>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 3</figref> shows a flowchart of a construction change in a logical volume LU in the first embodiment of the invention.</p>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 4</figref> is a diagram showing a state of the inner LUs in the physical disk area in the first embodiment of the invention.</p>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 5</figref> is a diagram showing an example of an LUN map before an inner LU is changed in the first embodiment of the invention.</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIGS. 6A to 6C</figref> are diagrams showing examples of the LUN map after changing the inner LUs in the first embodiment of the invention.</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 7</figref> is a diagram showing a state of the inner LUs in the physical disk area of <figref idref="DRAWINGS">FIG. 6A</figref>.</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 8</figref> is a diagram showing the configuration of a computer system according to a second embodiment of the invention.</p>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 9</figref> shows a flowchart of a construction change in a logical volume LU in the second embodiment of the invention.</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIGS. 10A to 10C</figref> are diagrams each showing the state of inner LUs in a physical disk area corresponding to a construction change of the logical volume LU according to the second embodiment of the invention.</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 11</figref> is a diagram showing an example of an LUN map before an internal LU in the second embodiment of the invention is changed.</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 12</figref> is a diagram showing an example of an LUN map after the internal LUs of the second embodiment of the invention are changed.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 13</figref> shows a flowchart of a construction change in logical volumes LU of a third embodiment of the invention.</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIGS. 14A and 14B</figref> are diagrams each showing a state of an internal LU in a physical disk area corresponding to a construction change in the logical volume LU according to the third embodiment of the invention.</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 15</figref> is a diagram showing an example of the configuration of a storage according to a conventional technique.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DESCRIPTION OF THE PREFERRED EMBODIMENTS</heading>
<p id="p-0024" num="0023">The invention will be described hereinbelow by referring to the drawings showing embodiments.</p>
<heading id="h-0005" level="1">Embodiment I</heading>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 1</figref> is a diagram showing the configuration of a computer system according to a first embodiment. Shown in the diagram are computers <b>2</b><i>x </i>(<b>2</b><i>a, </i><b>2</b><i>b, </i>. . . , <b>2</b><i>n</i>), a storage <b>1</b> shared by all the computers <b>2</b><i>x, </i>a management console <b>4</b> for managing the computer system, a fiber channel connecting device <b>3</b> for connecting all the computers <b>2</b><i>x, </i>storage <b>1</b>, and management console <b>4</b> with each other, fiber channels <b>5</b><i>x </i>(<b>5</b><i>a, </i><b>5</b><i>b, </i>. . . , <b>5</b><i>n</i>), a LAN (Local Area Network) <b>6</b><i>x </i>(<b>6</b><i>a, </i><b>6</b><i>b, </i>. . . , <b>6</b><i>n</i>) used for communications between the plurality of computers <b>2</b><i>x </i>and the management console <b>4</b>, and communication means <b>7</b> used for communications between the storage <b>1</b> and the management console <b>4</b>.</p>
<p id="p-0026" num="0025">Each of the computers <b>2</b><i>x </i>has therein logical volume management software <b>21</b><i>x </i>(<b>21</b><i>a, </i><b>21</b><i>b, </i>. . . , <b>21</b><i>n</i>) called a file system FS or generally LVM, and a logical unit recognizing means <b>211</b><i>x </i>(<b>211</b><i>a, </i><b>211</b><i>b, </i>. . . , <b>211</b><i>n</i>) for recognizing a logical volume construction or the like of the storage <b>1</b> and notifying the logical volume management software <b>21</b><i>x </i>of a change in the construction. The logical volume is a virtual volume provided in the storage <b>1</b> and is a name defined in the specification of an SCSI (Small Computer System Interface) as one of protocols of an interface connecting the computer <b>2</b><i>x </i>and the storage <b>1</b>. In the following, the logical volume may be also simply called an LU (Logical Unit). A number for identifying an LU will be called a logical unit number (LUN).</p>
<p id="p-0027" num="0026">The management console <b>4</b> has a control utility <b>41</b> used to display the LU construction in the storage <b>1</b>, set an LU in the storage <b>1</b> by the manager of the system, and so on. The control utility <b>41</b> is disposed on the management console <b>4</b> in this case but may be disposed in the computer <b>2</b><i>x </i>or storage <b>1</b>.</p>
<p id="p-0028" num="0027">The storage <b>1</b> has therein a logical volume control means <b>11</b> for controlling the construction of a logical volume in the storage <b>1</b> and notifying of logical volume construction information in response to a request from the logical volume recognizing means <b>211</b><i>x </i>in each computer <b>2</b><i>x. </i>Reference numeral <b>111</b> denotes a logical volume number map (LUN map) and is, as a component of the LU control means <b>11</b>, a map showing logical correspondence between the logical volume in the storage <b>1</b> and the logical volume recognized by the computer <b>2</b><i>x. </i>Reference numeral <b>12</b> denotes a physical disk area which is a collection of physical disks. In the physical disk area <b>12</b>, logical volumes <b>121</b><i>x </i>(<b>121</b><i>a, </i><b>121</b><i>b, </i>. . . , <b>121</b><i>n</i>) logically generated are provided.</p>
<p id="p-0029" num="0028">The logical volume LU will be described. The LU is a logical volume seen from a computer <b>2</b><i>x </i>(<b>2</b><i>a, </i><b>2</b><i>b, </i>. . . , <b>2</b><i>n</i>) of the storage <b>1</b>. The computer recognizes an LU as a logical disk drive. The storage <b>1</b> defines and internally constructs a plurality of LUs which will be called internal logical volumes (internal LUs). In the storage <b>1</b>, in order to control the internal LUs, integers starting from zero are serially given to the internal LUs. The numbers will be called internal logical volume numbers (internal LUNs).</p>
<p id="p-0030" num="0029">Generally, a computer searches a storage connected for an LU at the time of booting the OS. There are the following two constraints to searching methods, which are techniques of shortening a search time.</p>
<p id="p-0031" num="0030">(a) To search the logical volume numbers LUN sequentially from 0.</p>
<p id="p-0032" num="0031">(b) To stop searching when a certain number does not exist on assumption that the logical volume numbers LUN exist as serial numbers.</p>
<p id="p-0033" num="0032">It is also assumed that the computer of the invention has such characteristics. In such a case, when the internal logical volume number LUN is assigned as it is to a computer, a computer to which a number other than zero is assigned cannot detect the LU. Specifically, in each of all the computers, it is assumed that the logical volume numbers LUN used by the computer start from zero. When the inner logical volume numbers are directly assigned as the logical volume numbers LUN, consequently, for the computers to which numbers other than zero are assigned as the internal LUNs, it is equivalent that no logical volume LU is assigned. Therefore, the inner logical volume numbers LUN starting from zero seen from the computer and which are serial numbers have to be assigned to each of all the computers.</p>
<p id="p-0034" num="0033">In the invention, the storage <b>1</b> re-defines the internal LUs used by a computer <b>2</b><i>x </i>so that serial logical volume numbers starting from 0 when seen from the computer <b>2</b><i>x </i>are assigned to the internal LUs used by the computer <b>2</b><i>x, </i>thereby solving the problem. An LU recognized by each computer <b>2</b><i>x </i>will be called an outer logical volume (outer LU) and the number assigned to the outer LU will be called an outer logical volume number (outer LUN), so as to be distinguished from the inner LU and inner LUN, respectively. According to the invention, LUN combining information to define the relation between an outer LU and an inner LU is provided between the outer and inner LUs. By using the LUN combining information, the construction of combination between the outer and inner LUs can be changed. The corresponding relations among the outer LUN, LUN combining information, and inner LUN are managed by the LUN map <b>111</b> in the storage <b>1</b>.</p>
<p id="p-0035" num="0034"><figref idref="DRAWINGS">FIG. 2</figref> shows an example of the LUN map <b>111</b> of the storage <b>1</b>. In the LUN map <b>111</b>, port number, target ID, outer LUN, LUN combining information, inner LUN, WWN, S_ID, and property are stored. The items will be described hereinbelow.</p>
<p id="p-0036" num="0035">In the “port number”, the number of a fiber channel connection port of the storage <b>1</b> is stored. In the embodiment, the number of port is assumed to be one, and “0” is stored.</p>
<p id="p-0037" num="0036">The “target ID” is an identification of the storage <b>1</b> in the connection interface between the computer <b>2</b><i>x </i>and the storage <b>1</b>. As in the embodiment, when the connection interface between the computer <b>2</b><i>x </i>and the storage <b>1</b> is a fiber channel, the only one D_ID (Destination ID) is assigned to each port. Since there is the item of the port number, the target ID may be omitted or D_ID determined at the time of initializing a fiber channel connection port may be stored. In the case of the SCSI, the same port can have a plurality of IDs, so that the target ID to which each LUN belongs is stored. In the embodiment, it is assumed that the fiber channel is used, so that the column of the target ID is not used and zero is stored.</p>
<p id="p-0038" num="0037">The outer LUN, LUN combining information, and inner LUN show corresponding relations of each LUN. First, areas of physical disks in the storage <b>1</b> are the logical volume areas having inner LUNs 0 to n−1 and the logical volume areas having the inner LUN k. To each of the former areas, “0” is assigned as the outer LUN. To each of the latter areas, “1” is assigned as the outer LUN. The LUN combining information is information indicative of combining relation between the outer and inner LUNs. The left side of the LUN combining information indicates the total number of inner LUs assigned to the outer LU and the right side of the LUN combining information indicates the order of the inner LUs. Both of the numbers are connected via a hyphen.</p>
<p id="p-0039" num="0038">The “top LBA” indicates an address in the outer LU to which the top address in each inner LU is assigned when it is seen from the computer <b>2</b><i>x. </i>LBA (Logical Block Address) denotes an address in an LU, and the computer <b>2</b><i>x </i>accesses data in the LU by using the address. When an outer LU is constructed by a single inner LU, “0” is assigned to the top LBA. In the case where an outer LU is constructed by a plurality of inner LUs due to a change in the construction of the LU, the top LBA is rewritten. This point will be concretely described when an example of the construction change of an LU will be described later.</p>
<p id="p-0040" num="0039">“The number of blocks” indicates the number of logical blocks in each inner LU, and the size of each inner LU can be known by the number of blocks.</p>
<p id="p-0041" num="0040">In the “WWN”, world wide name as information to specify each computer <b>2</b><i>x </i>is stored. In a port-login process to establish a connection between a connection port of a fiber channel and a port, the WWN of each computer <b>2</b><i>x </i>is notified to the storage <b>1</b>.</p>
<p id="p-0042" num="0041">“S_ID” denotes ID information stored in a frame header of a fiber channel and is an ID of a source (initiator) which generates a frame. S_ID is dynamically assigned at the time of initializing a fiber channel. The above-mentioned WWN is a value unconditionally set according to the connection port of each fiber channel exchanged at the time of initialization. When WWN and S_ID are associated with each other, without checking the WWN each frame, only by checking S_ID, the computer <b>2</b><i>x </i>can be specified.</p>
<p id="p-0043" num="0042">The “property” indicates the property of each LU. “Exclusive” denotes an LU exclusively used by a single computer <b>2</b><i>x. </i>“Common” indicates an LU shared by a plurality of computers <b>2</b><i>x. </i></p>
<p id="p-0044" num="0043">It is understood from the LUN map <b>111</b> shown in <figref idref="DRAWINGS">FIG. 2</figref> that the inner LUs having the LUNs 0 to n−1 are exclusively assigned to the computers <b>2</b><i>a </i>to <b>2</b><i>n, </i>respectively. Although the inner LUNs are serial numbers, all the outer LUNs are “0”. It is further known that an area having the inner LUN k is set for the common LUs. To the inner LU, the outer LUN of 1 is set. In the case of searching a storage at the time of booting the OS, by searching for 0 of the outer LUN and then 1, each computer can know inner LUs which can be used by itself.</p>
<p id="p-0045" num="0044">A construction change in the logical volume LU will now be described by referring to the flowchart of <figref idref="DRAWINGS">FIG. 3</figref>.</p>
<p id="p-0046" num="0045">The operator of the management console <b>4</b> sends an indication for LU construction change from the control utility <b>41</b>. In the case of expanding an LU, the inner LUN of the LU to be expanded and an inner LUN of an LU newly coupled are designated. The indication is sent via the communication means <b>7</b> to the storage <b>1</b> (step <b>701</b>).</p>
<p id="p-0047" num="0046">The LU control means <b>11</b> in the storage <b>1</b> receives the indication and determines whether the designated LU is correct or not (step <b>702</b>). When the designated inner LU is not correct such that a not-existing LUN is designated, the inner LU to be newly combined has already assigned to another computer <b>2</b><i>x; </i>or the like, the LU control means <b>11</b> returns an error signal to the control utility <b>41</b> and the routine is finished (step <b>708</b>). When the designated LU is correct, the LU control means <b>11</b> rewrites the LUN map <b>111</b> in accordance with the indication (step <b>703</b>).</p>
<p id="p-0048" num="0047">The LU construction change is notified to the LU-recognizing means <b>211</b><i>x </i>in the computer <b>2</b><i>x </i>by arbitrary one of the following methods; a method of transmitting the message from the LU control means <b>11</b> to the LU recognizing means <b>211</b><i>x </i>via the fiber channel <b>5</b><i>x, </i>a method of notifying the control utility <b>41</b> of the message by the LU control means <b>11</b> in the storage <b>1</b> and notifying the message from the control utility <b>41</b> to the LU recognizing means <b>211</b><i>x </i>in the computer <b>2</b><i>x </i>via the LAN <b>6</b><i>x, </i>and a method of operating the computer <b>2</b><i>x </i>directly by the manager to notify the LU recognizing means <b>211</b><i>x </i>of the message (step <b>704</b>).</p>
<p id="p-0049" num="0048">The LU recognizing means <b>211</b><i>x </i>gets the changed LU size from the LU control means <b>11</b>. The LU recognizing means <b>211</b><i>x </i>may request the LU control means <b>11</b> to present the construction information without receiving the notification of the construction change. In this case, the notification of the construction change (step <b>704</b>) can be omitted (step <b>705</b>).</p>
<p id="p-0050" num="0049">The LU recognizing means <b>211</b><i>x </i>notifies the information of the changed LUN and the size to the logical volume management software <b>21</b><i>x </i>(FS or LVM) and the changed LU is enabled to be used on the computer <b>2</b><i>x </i>(step <b>706</b>).</p>
<p id="p-0051" num="0050">As described above, while continuing an on-line access to an existing LU, the construction change can be made reflected.</p>
<p id="p-0052" num="0051">An example of the LU construction change will now be concretely presented and rewriting of the LUN map <b>111</b> will be described in detail. As an example of the LU construction change, a case of expanding the LU<b>0</b> area in the computer <b>2</b><i>a </i>will be taken. <figref idref="DRAWINGS">FIG. 4</figref> shows a state of the inner LUs in the physical disk area <b>12</b>. <b>120</b><i>x </i>(<b>120</b><i>a </i>to <b>120</b><i>c</i>) denote inner LUs. In the physical disk area <b>12</b>, an LU<b>0</b> area <b>120</b><i>a, </i>an LU<b>1</b> area <b>120</b><i>b, </i>and an LU<b>2</b> area <b>120</b><i>c </i>are continuously constructed. To simplify the explanation, it is now assumed that the LU<b>0</b> area <b>120</b><i>a </i>is assigned to the computer <b>2</b><i>a, </i>the LU<b>1</b> area <b>120</b><i>b </i>is assigned to the computer <b>2</b><i>b, </i>and the LU<b>2</b> area <b>120</b><i>c </i>is of an inner LU which is not assigned to any computer. In the example, although the LU area <b>120</b><i>c </i>is of the inner LU which is not assigned to any computer, since the LU<b>1</b> area <b>120</b><i>b </i>is formed continuously after the LU<b>0</b> area <b>120</b><i>a, </i>the LU<b>0</b> area <b>120</b><i>a </i>cannot be expanded physically. In this state, the computer <b>2</b><i>a </i>sees the LU<b>0</b> area <b>120</b><i>a </i>as its logical volume, and the computer <b>2</b><i>b </i>sees the LU<b>1</b> area <b>120</b><i>b </i>as its logical volume.</p>
<p id="p-0053" num="0052"><figref idref="DRAWINGS">FIG. 5</figref> shows the LUN map <b>111</b> at this time. The inner LUN<b>0</b> area is assigned to the computer <b>2</b><i>a </i>(WWNa), the inner LUN<b>1</b> area is assigned to the computer <b>2</b><i>b </i>(WWNb), and the inner LUN<b>2</b> area is blank (and the items are not defined). When a request of expanding the LU of the computer <b>2</b><i>a </i>is received, as described by referring to <figref idref="DRAWINGS">FIG. 3</figref>, the LU control means <b>11</b> rewrites the LUN map <b>111</b> so that the inner LU<b>2</b> <b>120</b><i>c </i>becomes the inner LU of the computer <b>2</b><i>a </i>on the basis of the instruction of the construction change sent from the control utility <b>41</b>. <figref idref="DRAWINGS">FIG. 6A</figref> shows the LUN map <b>111</b> rewritten in such a manner. As understood from the above, the computer <b>2</b><i>a </i>can recognize LUs having the inner LUNs <b>0</b> and <b>2</b> as the LUs which can be used by itself. Since the inner LUN<b>2</b> is used continuously after the inner LUN<b>0</b>, it is assumed that a process starts from the number of blocks of the top LBA of the inner LUN <b>2</b>. The process is performed by the LU control means <b>11</b>. In association with the process, WWN, S_ID, and the like corresponding to those of the computer <b>2</b><i>a </i>are stored. In the case of accessing the LU from the computer <b>2</b><i>a, </i>either the inner LU<b>0</b> or LU<b>2</b> to be accessed can be known from the top LBA.</p>
<p id="p-0054" num="0053"><figref idref="DRAWINGS">FIG. 7</figref> is a diagram for explaining the state of the inner LUs in the physical disk area <b>12</b> rewritten as described above. As obviously understood in contrast to <figref idref="DRAWINGS">FIG. 4</figref>, although the inner LU<b>120</b>x (<b>120</b><i>a </i>to <b>120</b><i>c</i>) are formed continuously in a manner similar to the above, an area <b>122</b> indicated by an alternate long and short dash line functions as an LU of the computer <b>2</b><i>a. </i>In this state, the computer <b>2</b><i>a </i>sees the total area <b>122</b> of the LU<b>0</b> area <b>120</b><i>a </i>and the LU<b>2</b> area <b>120</b><i>c </i>as a logical volume which can be used by itself. The computer <b>2</b><i>b </i>sees the LU<b>1</b> area <b>120</b><i>b </i>as its logical volume.</p>
<p id="p-0055" num="0054"><figref idref="DRAWINGS">FIGS. 6B and 6C</figref> show LUN maps <b>111</b> of other examples of the changed LU construction. <figref idref="DRAWINGS">FIG. 6B</figref> shows a state where, in addition to the logical volume obtained by adding the inner LU<b>2</b> to the inner LU<b>0</b> for the computer <b>2</b><i>a, </i>the inner LU<b>5</b> is further added. <figref idref="DRAWINGS">FIG. 6C</figref> shows a state where, in addition to the logical volume obtained by adding the inner LU<b>5</b> to the inner LU<b>0</b> of the computer <b>2</b><i>a, </i>the inner LU<b>2</b> is further added. That is, <figref idref="DRAWINGS">FIGS. 6B and 6C</figref> show examples which are different from each other with respect to the order of adding the inner LUNs. The difference in the orders does not mean anything for the computer <b>2</b><i>a. </i>As long as the LU control means <b>11</b> properly stores the top LBA and information such as WWN, S_ID, and the like associated with the construction change, in any of <figref idref="DRAWINGS">FIGS. 6B and 6C</figref>, the construction of the logical volume having the block numbers of the total three inner LUs can be used to execute the function of the computer of the LU control means <b>11</b>.</p>
<p id="p-0056" num="0055">By virtually managing the LU areas as described above, the construction change such as expansion of an LU which cannot be physically made out can be realized.</p>
<p id="p-0057" num="0056">According to the embodiment, an effect of freely changing the construction of the logical volume areas in the storage is produced. According to the embodiment, another effect such that the logical volume area can be expanded while continuing an access to an existing logical volume is produced. Further, according to the embodiment, the construction can be changed in the storage, an effect such that the logical volume area can be expanded independent of the OS of the computer is produced.</p>
<heading id="h-0006" level="1">Embodiment II</heading>
<p id="p-0058" num="0057"><figref idref="DRAWINGS">FIG. 8</figref> is a diagram showing the configuration of a computer system according to a second embodiment. The construction of the computer system is the same as that of the first embodiment except for the point that a copy means <b>13</b> is added to the storage <b>1</b>. The copy means <b>13</b> is a means for copying an LU to another area.</p>
<p id="p-0059" num="0058">An LU construction change will be described by using the flowchart of <figref idref="DRAWINGS">FIG. 9</figref>. The operator of the management console <b>4</b> sends an indication for LU construction change from the control utility <b>41</b>. In the case of expanding an LU, the inner LUN of the LU to be expanded and an expansion size are designated. This indication is sent to the storage <b>1</b> via the communication means <b>7</b> (step <b>801</b>).</p>
<p id="p-0060" num="0059">The LU control means <b>11</b> in the storage <b>1</b> receives the indication and determines whether the total size of the size of the designated inner LU and the expansion size can be assured from the free area or not (step <b>802</b>).</p>
<p id="p-0061" num="0060">When the area cannot be assured, the LU control means <b>11</b> sends an error signal to the control utility <b>41</b>, and the routine is finished (step <b>809</b>).</p>
<p id="p-0062" num="0061">When the area can be assured, the LU control means <b>11</b> assures the area and sends a copy instruction for copy to the copy means <b>13</b> (step <b>803</b>). The copy means <b>13</b> which has received the copy instruction copies the designated LU. After finishing the copying of the LU, the copy means <b>13</b> notifies a finish of copy to the LU control means <b>11</b> (step <b>804</b>).</p>
<p id="p-0063" num="0062">When the notification of copy end is received, the LU control means <b>11</b> rewrites the LUN map <b>111</b> and assigns a newly generated LU to the computer <b>2</b><i>x </i>(step <b>805</b>).</p>
<p id="p-0064" num="0063">The processes in step <b>806</b> and subsequent steps are similar to those in the first embodiment.</p>
<p id="p-0065" num="0064">An LU construction change will now be concretely described. <figref idref="DRAWINGS">FIG. 10</figref> is a diagram for explaining an example of the construction change of the embodiment. <figref idref="DRAWINGS">FIG. 10A</figref> shows a state of the inner LUs before a change. In a manner similar to the case of <figref idref="DRAWINGS">FIG. 4</figref>, a case of expanding the LU<b>0</b> area of the computer <b>2</b><i>a </i>will be taken as an example. In the physical disk area <b>12</b>, the LU<b>0</b> area <b>120</b><i>a </i>and LU<b>1</b> area <b>120</b><i>b </i>are continuously constructed, the LU<b>0</b> area <b>120</b><i>a </i>is assigned to the computer <b>2</b><i>a, </i>and the LU<b>1</b> area <b>120</b><i>b </i>is assigned to the computer <b>2</b><i>b. </i>In this example, it is assumed that the area other than those areas is a free area. In this example as well, although there is a sufficient free area, the LU<b>1</b> area <b>120</b><i>b </i>is formed continuously after the LU<b>0</b> area <b>120</b><i>a, </i>so that the LU<b>0</b> area <b>120</b><i>a </i>cannot be physically expanded. In a manner similar to the first embodiment, the computer <b>2</b><i>a </i>sees the LU<b>0</b> area <b>120</b><i>a </i>as its logical volume, and the computer <b>2</b><i>b </i>sees the LU<b>1</b> area <b>120</b><i>b </i>as its logical volume.</p>
<p id="p-0066" num="0065">A copying operation related to expansion of an LU will be described first. When the operator of the management console <b>4</b> sends an indication for an LU construction change in which an inner LUN of the LU to be expanded and the expansion size are designated via the control utility <b>41</b> to the LU control means <b>11</b>, the LU control means <b>11</b> assures an area of a new LU<b>2</b> in a total size of the area size of the inner LUN of the LU to be expanded and the expansion area size in the free area <b>123</b>. When the area cannot be assured, an error signal is sent to the control utility <b>41</b>. The LU control means <b>11</b> instructs the copy means <b>13</b> to copy the data of the LU<b>0</b> <b>120</b><i>a </i>to the assured area LU<b>2</b> <b>120</b><i>d </i>from the top position of the area LU<b>2</b> <b>120</b><i>d. </i><figref idref="DRAWINGS">FIG. 10B</figref> is a diagram for explaining a copying state by the copy means <b>13</b>. As shown by a broken line in the area LU<b>2</b> <b>120</b><i>d, </i>the data is copied from the LU<b>0</b> <b>120</b><i>a </i>to the LU<b>2</b> <b>120</b><i>d. </i>After copying all the data of the LU<b>0</b> <b>120</b><i>a </i>to the LU<b>2</b> <b>120</b><i>d, </i>the copy means <b>13</b> notifies an end of the copy to the LU control means <b>11</b>. <figref idref="DRAWINGS">FIG. 10C</figref> shows a state of the inner LUs after completion of the copying. The LU control means <b>11</b> which has received the copy end notification rewrites the LUN map <b>111</b> and assigns the LU<b>2</b> <b>120</b><i>d </i>to the computer <b>2</b><i>a</i>. The LU<b>0</b> <b>120</b><i>a </i>is not defined.</p>
<p id="p-0067" num="0066"><figref idref="DRAWINGS">FIG. 11</figref> shows an LUN map before updating, and <figref idref="DRAWINGS">FIG. 12</figref> shows an updated LUN map. It is understood that, in the LUN map before updating, the computer <b>2</b><i>a </i>is assigned to the inner LUN <b>0</b>. The computer <b>2</b><i>a </i>is assigned to the inner LUN <b>2</b> in the updated LUN map. Moreover, the number of blocks of the inner LUN <b>2</b> is larger than the initial number of blocks. It is therefore understood that the area enlargement has been realized by using a new area. By using the copy means as described above, a new inner LU is generated while holding the original data in the LU, so that the construction change such as LU expansion can be realized.</p>
<p id="p-0068" num="0067">There is a case of accessing an LU from a computer during copying operation for the LU area change. In this case, when an access is a read access, it is sufficient to read data from the original LU area. If it is the write access, however, there is the possibility that a data discrepancy occurs unless data is written in both the original LU area of the corresponding address and a new LU area. When the target of the write access is the original LU area on which the copying operation has not been completed by the copy means <b>13</b>, there is no problem. When the target of the write access is the original LU area on which the copying operation has already been finished, even if data of the address is updated, the new data is not read and copied to the new LU area. Consequently, if the copy end is notified in step <b>804</b>, a data discrepancy occurs. When there is the possibility of occurrence of such a data discrepancy, the LU control means <b>11</b> writes data to areas of both the addresses during a period from step <b>802</b> to step <b>805</b>. It is also possible to notify the address of the new area to the computer, and write the data to areas of both addresses by the computer.</p>
<p id="p-0069" num="0068">As described above, by copying the data of the existing LU into a newly assured area, while utilizing the existing data, an LU area expansion or the like can be performed. Since one inner LU is assigned to one outer LU, the management is facilitated. According to the embodiment, the same effects as those of the first embodiment are obtained. Moreover, since the logical volume area is assigned to the physically continuously area, an effect such that the management of the logical volume is facilitated is produced.</p>
<heading id="h-0007" level="1">Embodiment III</heading>
<p id="p-0070" num="0069">A third embodiment will be described. A computer system of the third embodiment is the same as that in the second embodiment. The third embodiment is realized by a combination of virtual combining of logical volumes in the first embodiment and expansion by the copying means in the second embodiment.</p>
<p id="p-0071" num="0070">The LU construction change will be described by referring to the flowchart of <figref idref="DRAWINGS">FIG. 13</figref>.</p>
<p id="p-0072" num="0071">The operator of the management console <b>4</b> sends an indication for LU construction change from the control utility <b>41</b>. In the case of expanding the LU, all the inner LUNs assigned to the outer LU to be expanded and an expansion size are designated. The instruction is sent via the communication means <b>7</b> to the storage <b>1</b> (step <b>901</b>).</p>
<p id="p-0073" num="0072">The LU control means <b>11</b> in the storage <b>1</b> receives the instruction and determines whether the total size of the size of all-the designated inner LUs and the expansion size can be assured in the free area or not (step <b>902</b>).</p>
<p id="p-0074" num="0073">If the area can be assured, all the designated LUs are copied by copy means and a new inner LU is generated. At this stage as well, a measure to avoid a data discrepancy described in the second embodiment is taken. The subsequent process is similar to that in the second embodiment (step <b>903</b>).</p>
<p id="p-0075" num="0074">When the area of the total size cannot be assured in the free area, the LU control means <b>11</b> determines whether virtual combination is possible or not. When the area of the expansion size can be assured, the virtual combination can be performed (step <b>904</b>).</p>
<p id="p-0076" num="0075">When the virtual combination can be performed, the assured area of the expansion size is virtually combined with the LU to be expanded (step <b>905</b>). The following process is similar to that of the first embodiment.</p>
<p id="p-0077" num="0076">If the virtual combination is impossible, the LU control means <b>11</b> returns an error signal to the control utility <b>41</b> and the routine is finished (step <b>906</b>).</p>
<p id="p-0078" num="0077">An example of the result of the LU construction change according to the third embodiment will be described with reference to <figref idref="DRAWINGS">FIGS. 14A and 14B</figref>. Reference numeral <b>12</b> denotes a physical disk area, and reference numerals <b>121</b><i>x </i>(<b>121</b><i>e </i>to <b>121</b><i>h</i>) indicate inner LUs. <figref idref="DRAWINGS">FIG. 14A</figref> shows a state where the logical volumes are virtually combined according to the first embodiment, thereby constructing the outer LU <b>122</b>. In this state, the computer sees the outer LU <b>122</b> as a single LU. In the storage, however, it is known that the inner LU<b>0</b> <b>121</b><i>e </i>and the inner LU<b>2</b> <b>121</b><i>g </i>are separated from each other. <figref idref="DRAWINGS">FIG. 14B</figref> shows a state where a new inner LU<b>3</b> <b>121</b><i>h </i>having an area to be enlarged like the second embodiment is constructed. The data in the inner LU<b>0</b> <b>121</b><i>e </i>and the inner LU<b>2</b> <b>121</b><i>g </i>which are separated from each other is copied in a physically continuous area and combined as a signal inner LU. In any of the cases, the LUN map <b>111</b> is updated in correspondence with the case.</p>
<p id="p-0079" num="0078">As described above, by combining the virtual combination of logical volumes in the first embodiment and expansion by the copy means in the second embodiment, a more flexible logical volume construction change can be realized. Particularly, since a plurality of separated LUs can be collected in a physically continuous area and integrated to a single LU, the management of the inner LUs can be facilitated.</p>
<p id="p-0080" num="0079">As understood also from the description of the embodiments, the logical volume number map <b>111</b> of the invention does not have to have all the port number, target ID, outer LUN, LUN combining information, inner LUN, top LBA, the number of blocks, WWN, S_ID, and property as in the embodiments. For example, as understood from <figref idref="DRAWINGS">FIG. 6</figref>, since the top LBA can be calculated as a cumulative total of the numbers of blocks of inner LUs including the immediately preceding LU, it is sufficient to calculate the top LBA as necessary. In short, it is sufficient that the combination of the outer LUN seen from the computer and the inner LUN of the storage is clearly defined, and the computer to which the combination is used is known.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A storage system coupled to a plurality of computers, comprising:
<claim-text>a plurality of inner logical volumes; and</claim-text>
<claim-text>a controller controlling the plurality of inner logical volumes and having an LUN map,</claim-text>
<claim-text>wherein the LUN map provides an association among a first outer LUN, a first computer ID, and a plurality of first inner LUNs, wherein the first outer LUN designates an outer logical volume, wherein the first computer ID identifies a computer which can access the outer logical volume by using the first outer LUN, wherein the outer logical volume comprises a first plurality of the inner logical volumes, wherein each of the first inner LUNs designates one of the first inner logical volumes, whereby one first inner logical volumes is accessed when the outer logical volume is accessed from the computer,</claim-text>
<claim-text>wherein the controller is configured to receive a configuration change instruction that designates the plurality of first inner LUNs,</claim-text>
<claim-text>wherein if there is a second inner logical volume having a storage capacity satisfying the received configuration change instruction, then the controller copies data stored on each of the first inner logical volumes to the second inner logical volume and modifies the LUN map so that the first outer LUN and the first computer ID are associated with a second inner LUN that designates the second inner logical volume,</claim-text>
<claim-text>wherein subsequent to the configuration change instruction, the second inner logical volume is accessed when the outer logical volume is accessed from the computer.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. A storage system according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein if there is a second inner logical volume having a storage capacity larger than a sum of a storage capacity of the first inner logical volumes, then the controller copies data stored on each of the first inner logical volumes to the second inner logical volume.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. A storage system according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the first inner logical volumes are not contiguous areas of storage in the storage system.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. A storage system coupled to a plurality of computers, comprising:
<claim-text>a plurality of inner logical volumes; and</claim-text>
<claim-text>a controller controlling the plurality of inner logical volumes and having an LUN map,</claim-text>
<claim-text>wherein the LUN map provides an association among a first outer LUN, a first computer ID, and a plurality of first inner LUNs, wherein the first outer LUN designates an outer logical volume, wherein the first computer ID identifies a computer which can access the outer logical volume by using the first outer LUN, wherein the outer logical volume comprises a first plurality of the inner logical volumes, wherein each of the first inner LUNs designates one of the first inner logical volumes, whereby one first inner logical volumes is accessed when the outer logical volume is accessed from the computer,</claim-text>
<claim-text>wherein the controller is configured to receive a configuration change instruction that designates the plurality of first inner LUNs,</claim-text>
<claim-text>wherein prior to said LUN map being modified, the first outer LUN and the first computer ID are associated with a first inner LUN,</claim-text>
<claim-text>wherein subsequent to said LUN map being modified, the first outer LUN and the first computer ID are associated with a second inner LUN different from the first inner LUN,</claim-text>
<claim-text>wherein the instruction to change a logical volume configuration includes information representative of the first inner LUN and of a requested size,</claim-text>
<claim-text>wherein the controller is configured such that if a free storage area exists which has a size that is larger than the requested size plus the size of the inner logical volume designated by the first inner LUN, then the controller copies data stored in the inner logical volume designated by the first inner LUN to the free storage area and rewrites the LUN map to correlate the free storage area with the first outer LUN, with the first computer ID, and with the second inner LUN, the second inner LUN being associated with the free storage area.</claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
