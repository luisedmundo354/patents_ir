<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07299315-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07299315</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>10815923</doc-number>
<date>20040402</date>
</document-id>
</application-reference>
<us-application-series-code>10</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>JP</country>
<doc-number>2003-099603</doc-number>
<date>20030402</date>
</priority-claim>
<priority-claim sequence="02" kind="national">
<country>JP</country>
<doc-number>2003-099604</doc-number>
<date>20030402</date>
</priority-claim>
</priority-claims>
<us-term-of-grant>
<us-term-extension>521</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>12</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>711103</main-classification>
<further-classification>711163</further-classification>
<further-classification>711154</further-classification>
</classification-national>
<invention-title id="d0e89">Control device including connecting device for rewriting memory region</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>6505280</doc-number>
<kind>B2</kind>
<name>Terada et al.</name>
<date>20030100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711164</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>2004/0015948</doc-number>
<kind>A1</kind>
<name>Sueyoshi et al.</name>
<date>20040100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>717170</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>JP</country>
<doc-number>08-030517</doc-number>
<date>19960200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>JP</country>
<doc-number>09-305394</doc-number>
<date>19971100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>JP</country>
<doc-number>10-333992</doc-number>
<date>19981200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>JP</country>
<doc-number>11-234491</doc-number>
<date>19990800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00007">
<othercit>“Information On Reprogramming Capability #73-65-13 (Mar. 6, 1997),” General Motors Corp., Doc. ID # 248550, 4 pgs.</othercit>
</nplcit>
<category>cited by examiner</category>
</citation>
</references-cited>
<number-of-claims>8</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>711103</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>711154</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>711163</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>711164</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>12</number-of-drawing-sheets>
<number-of-figures>12</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20050060484</doc-number>
<kind>A1</kind>
<date>20050317</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Ogino</last-name>
<first-name>Kouji</first-name>
<address>
<city>Minami-Alps</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Kubo</last-name>
<first-name>Eiichi</first-name>
<address>
<city>Yamanashi-ken</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<last-name>Kanesaka</last-name>
<first-name>Manabu</first-name>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Nisca Corporation</orgname>
<role>03</role>
<address>
<city>Minamikoma-Gun, Yamanashi-Ken</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Bataille</last-name>
<first-name>Pierre-Michel</first-name>
<department>2186</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A control device includes a connecting device for connecting an external memory medium; and a non-volatile memory device having at least one memory region in which data can be electrically rewritten. The memory device includes a first memory region for storing control program data; a second memory region for storing connection judgment program data; and a third memory region for storing writing program data. The connection judgment program is executed to determine whether the external memory medium is connected. The writing program is executed to rewrite the control program data stored in the first memory region with external memory medium data stored in the external memory medium.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="169.59mm" wi="233.00mm" file="US07299315-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="252.14mm" wi="128.52mm" orientation="landscape" file="US07299315-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="182.71mm" wi="162.22mm" file="US07299315-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="238.93mm" wi="170.26mm" orientation="landscape" file="US07299315-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="235.20mm" wi="167.72mm" orientation="landscape" file="US07299315-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="208.45mm" wi="138.51mm" file="US07299315-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="225.38mm" wi="152.82mm" file="US07299315-20071120-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="138.09mm" wi="136.06mm" file="US07299315-20071120-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="103.29mm" wi="131.40mm" file="US07299315-20071120-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="92.20mm" wi="70.44mm" file="US07299315-20071120-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="178.22mm" wi="144.78mm" file="US07299315-20071120-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="154.26mm" wi="145.80mm" file="US07299315-20071120-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="189.15mm" wi="128.52mm" file="US07299315-20071120-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND OF THE INVENTION AND RELATED ART STATEMENT</heading>
<p id="p-0002" num="0001">The present invention relates to a control device equipped with an electrically erasable programmable read only memory (EEPROM) or a flash memory capable of electronically writing and erasing a program and data for controlling an electronic device in commercial and industrial use.</p>
<p id="p-0003" num="0002">Conventionally, program data stored in an EPROM (electrically programmable read only memory) have been widely used for controlling an operation of an electronic device. The EPROM is a non-volatile type memory, and can store data even after the power is turned off. Therefore, the EPROM is suitable for a memory device for storing a program or reference data for executing a program. In the EPROM, it is not possible to electrically erase the stored content and to write a new program or data. Accordingly, when the program or data is changed, it is necessary to replace with the EPROM having the new program or data.</p>
<p id="p-0004" num="0003">For this reason, recently in the technical field of a control device for controlling an electronic device in commercial and industrial use, there has been widely used a single chip microcomputer (hereinafter referred to as single chip computer), in which a CPU and an EEPROM or a flash memory are arranged in an integrated circuit on one chip. In the single chip computer, it is not necessary to connect to an external RAM or ROM. Accordingly, it is possible to access to an internal memory at a high speed. The single chip computer also has superior resistance against a line noise from an external source and an irradiated noise.</p>
<p id="p-0005" num="0004">The EEPROM and flash memory, i.e. an improved EEPROM, (hereinafter, the EEPROM and flash memory are referred simply as EEPROM) are non-volatile memories capable of storing data even without electrical power similar to the EPROM described above. Accordingly, the EEPROM can store data that requires backup in case of power outage such as a program and function setting data of the CPU for controlling a device. Also, as opposed to the EPROM, the EEPROM is cable of electrically writing or erasing data. Accordingly, it is easy to write a program data when the program or setting data needs to correct a program bug or to upgrade.</p>
<p id="p-0006" num="0005">Therefore, in the control device, an external device with an external memory medium wherein a writing program is stored is connected to a control substrate provided with the single chip computer. Then, an operator manually operates a dipswitch to execute the writing program stored in the external memory medium to write a program and data.</p>
<p id="p-0007" num="0006">When a program in the EEPROM on the single chip computer is written, it is necessary to provide a dedicated apparatus for writing, thereby making it difficult to handle.</p>
<p id="p-0008" num="0007">In order to solve this problem, Japanese Patent Publication (Kokai) No. 11-234491 has disclosed a control device in which a socket is provided on a substrate for mounting an EPROM for storing a writing program, so that the writing program stored in the EPROM is executed manually through an external operation. In the conventional control device, it is necessary to select a mode switch through the manual operation to execute the writing operation using the CPU arranged in the single chip computer, thereby making the operation troublesome.</p>
<p id="p-0009" num="0008">When the single chip computer is not connected to a writing unit or the EPROM, an error may occur in executing the writing process through the manual operation, thereby making it troublesome to handle the writing unit or EPROM. In the EEPROM, when a new program and setting data are written, it is necessary to confirm whether the new program and setting data are written correctly through the writing process.</p>
<p id="p-0010" num="0009">Japanese Patent Publication (Kokai) No. 08-30517 has disclosed a method for verifying whether a new program, data and setting data for writing are correctly written to the EEPROM. According to the method, a data region for storing a program and data, and a check region corresponding to the data region for storing check data to check the program and data are formed in a memory area of the EEPROM. In the control program for controlling the writing process to the EEPROM, a step is provided for obtaining a sum of the new programs and data to be stored in the data region whenever the EEPROM data is changed. A result obtained in the step is compared to the check data stored in the check region, so that it is verified that the new program and data stored in the data region are written correctly.</p>
<p id="p-0011" num="0010">As disclosed in Japanese Patent Publication (Kokai) No. 10-333992, the EEPROM is provided therein with a data region for storing a program and data, a check region for storing check data for checking the program and data, and an adjusting data region for storing adjusting data preset such that the check data become specific values relative to a device. The specific values are compared to data obtained by adding the adjusting data to a sum of a first byte of the new program or data stored in the data region, so that it is verified whether the new program and data are suitable for the device.</p>
<p id="p-0012" num="0011">In the verification method described above, when the writing is interrupted, there is a problem that it is determined that the writing is conducted correctly despite the interruption depending on the new programs and data.</p>
<p id="p-0013" num="0012">In the verification method disclosed in Japanese Patent Publication (Kokai) No. 08-30517, when the writing suddenly stops during the writing process for the new program or data, the check data in the EEPROM is cleared, or FF is written in an 8-bit register. Accordingly, when the sum of the newly written program and data is FF, it is difficult to verify whether the writing is conducted correctly.</p>
<p id="p-0014" num="0013">In the verification method disclosed in Japanese Patent Publication (Kokai) No. 10-333992, when the sum of the data interrupted while writing and matches to sum of the data when written correctly, i.e. the adjusted value of FF, it is difficult to verify whether the writing is conducted correctly.</p>
<p id="p-0015" num="0014">An erroneous program or data due to the failed writing is executed as the correct program and data. In this case, the device may not operate correctly, or may operate in an uncontrolled state to cause damage, thereby causing a problem.</p>
<p id="p-0016" num="0015">In view of the problems described above, an object of the present invention is to provide a control device for writing a control program and data, in which it is automatically verified that the program and data in an EEPROM are in a state that the program and data can be rewritten.</p>
<p id="p-0017" num="0016">Another object of the present invention is to provide a control device capable of determining whether the program and data are written correctly and whether the writing operation is completed correctly when the program and data to be stored in EEPROM are rewritten.</p>
<p id="p-0018" num="0017">Further objects and advantages of the invention will be apparent from the following description of the invention.</p>
<heading id="h-0002" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0019" num="0018">In order to achieve the objects described above, a control device includes connecting means for connecting an external memory medium; and non-volatile memory means having at least one memory region in which data can be electrically rewritten. The memory means includes a first memory region for storing control program data; a second memory region for storing connection judgment program data; and a third memory region for storing writing program data. The connection judgment program is executed to determine whether the external memory medium is connected. The writing program is executed to rewrite the control program data stored in the first memory region with the external memory medium data stored in the external memory medium.</p>
<p id="p-0020" num="0019">Accordingly, it is possible to automatically detect that the external memory medium is connected. When it is detected that the external memory medium is connected, the control program data stored in the external memory medium is automatically written to the memory means in the control device, thereby making it easy to write data to the memory means on the control device.</p>
<p id="p-0021" num="0020">Further, a fourth memory region may be provided for storing compatibility judgment program data for determining whether the external memory medium data are correct and compatible to the device. The apparatus executes the connection judgment program to confirm that the external memory medium is connected, and executes the compatibility judgment program to confirm that the external memory medium data stored in the external memory means are correct. Then, the writing program is executed to write all or a portion of the operation control program data stored in the first memory region of the memory means according to the external memory medium data stored in the external memory medium.</p>
<p id="p-0022" num="0021">Accordingly, it is automatically determined that the external memory medium is connected and the external memory medium data stored in the external memory means are correct before the writing program is executed. The writing program is executed according to the result of the judgment. As a result, it is possible to write only the operation control program data compatible with the electronic device, and only the correct operation control program data to the memory means in the control device.</p>
<p id="p-0023" num="0022">Further, the control device may be provided with a first judging means for judging whether the data written to the memory means are correct, and a second judging means for judging whether the writing means writes the data to the memory means correctly. Accordingly, when the data in the memory region of the memory means are replaced with the data of the external memory medium, it is possible to confirm that the operation control program data are written correctly after the writing process and that the writing process is completed normally, thereby controlling the electronic device using only the correct operation control programs.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 1</figref> is a sectional view showing an automatic document feeder according to an embodiment of the present invention;</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 2</figref> is a plan view showing the automatic document feeder according to the embodiment of the present invention in a state that a portion of an external cover is removed from the automatic document feeder and a control substrate with a single chip computer (control unit) mounted thereupon is exposed;</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 3</figref> is a block diagram showing the control unit of the automatic document feeder and a surrounding structure thereof according to the embodiment of the present invention;</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 4</figref> is a view showing a control substrate with the single chip computer mounted thereon of the automatic document feeder according to the embodiment of the present invention;</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 5</figref> is a diagram showing an address map of a memory region to which a CPU of the control unit accesses in the automatic document feeder according to the embodiment of the present invention;</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. 6</figref> is a flow chart showing a writing operation using a control program in the automatic document feeder according to the embodiment of the present invention;</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 7</figref> is a flow chart showing the writing operation using the control program in the automatic document feeder according to the embodiment of the present invention;</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 8</figref> is a flow chart showing the writing operation using the control program in the automatic document feeder according to the embodiment of the present invention;</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. 9</figref> is a flow chart showing the writing operation using the control program in the automatic document feeder according to the embodiment of the present invention;</p>
<p id="p-0033" num="0032"><figref idref="DRAWINGS">FIG. 10</figref> is a flow chart showing the writing operation using the control program in the automatic document feeder according to the embodiment of the present invention;</p>
<p id="p-0034" num="0033"><figref idref="DRAWINGS">FIG. 11</figref> is a flow chart showing the writing operation using the control program in the automatic document feeder according to the embodiment of the present invention; and</p>
<p id="p-0035" num="0034"><figref idref="DRAWINGS">FIG. 12</figref> is a data map for explaining check data for checking the writing operation in the control unit of the automatic document feeder according to the embodiment of the present invention.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DETAILED DESCRIPTION OF PREFERRED EMBODIMENTS</heading>
<p id="p-0036" num="0035">Hereunder, embodiments of the present invention will be explained with reference to the accompanying drawings. An automatic document feeder is an example of an electronic device with an EEPROM. <figref idref="DRAWINGS">FIG. 1</figref> is a sectional view of the automatic document feeder according to the embodiment of the present invention. <figref idref="DRAWINGS">FIG. 2</figref> is a plan view showing the automatic document feeder according to the embodiment of the present invention in a state that a portion of an external cover is removed from the automatic document feeder and a control substrate with a single chip computer (control unit) mounted thereupon is exposed.</p>
<p id="p-0037" num="0036">As shown in <figref idref="DRAWINGS">FIG. 1</figref>, an automatic document feeder <b>100</b> picks up an original stacked on a sheet stacking tray <b>110</b> using a kick roller <b>120</b>. The paper feed roller <b>121</b> and separating member <b>122</b> separate the originals into a single sheet. After the original is aligned with a pair of register rollers <b>123</b>, the original is transported to a platen glass <b>201</b>, and is read at a reading position on the platen glass <b>201</b>. The original is discharged to a discharge tray <b>111</b> with a pair of discharge rollers <b>124</b>. A pair of transport rollers <b>125</b> transports the original to the platen glass <b>201</b>. A pair of transport rollers <b>126</b> transports the original from the platen glass <b>201</b>.</p>
<p id="p-0038" num="0037">As shown in <figref idref="DRAWINGS">FIG. 2</figref>, the automatic document feeder <b>100</b> is equipped with a control substrate <b>40</b> on an outer cover <b>101</b> thereof. The control substrate <b>40</b> is mounted with a single chip computer (control unit <b>30</b>), an electrical circuit (not shown) such as a drive circuit for operating a motor to drive the rollers, and an IC socket <b>41</b> to which an EPROM <b>34</b> is mounted as an external memory medium. The EPROM <b>34</b> (described later) is easily mounted to or dismounted from the IC socket <b>41</b> on the control substrate <b>40</b> by removing a portion of the external cover <b>101</b>.</p>
<p id="p-0039" num="0038"><figref idref="DRAWINGS">FIG. 3</figref> is a block diagram showing the control unit of the automatic document feeder and a surrounding structure thereof according to the embodiment of the present invention. <figref idref="DRAWINGS">FIG. 4</figref> is a view showing a control substrate with the single chip computer mounted thereon of the automatic document feeder according to the embodiment of the present invention. The control unit <b>30</b> and the surrounding structure will be explained in detail with reference to <figref idref="DRAWINGS">FIG. 3</figref> and <figref idref="DRAWINGS">FIG. 4</figref>.</p>
<p id="p-0040" num="0039">The control unit <b>30</b> is formed of a single chip computer with a peripheral LSI and a memory formed therein. The control unit <b>30</b> is equipped with a CPU <b>31</b> for controlling the device to be controlled; an EEPROM <b>32</b> (memory that electrically writes a control program) for storing various control programs for executing operations; and a RAM <b>33</b> for temporarily storing data generated during a process in the CPU <b>31</b> and a signal from a plurality of sensors <b>38</b> or an image reading apparatus. The single chip computer <b>30</b> is mounted on a printed circuit board <b>40</b> as shown in <figref idref="DRAWINGS">FIG. 4</figref>.</p>
<p id="p-0041" num="0040">An EPROM <b>34</b> is provided for storing a new control program to be written to the control program in the EEPROM <b>32</b>. Specifically, the EPROM <b>34</b> is an external memory medium for storing data for writing. When it is necessary to write the new program to the EEPROM <b>32</b>, the EPROM <b>34</b> is mounted on the IC socket <b>41</b> on the printed circuit board <b>40</b> shown in <figref idref="DRAWINGS">FIG. 4</figref>. The CPU<b>31</b> is configured to access to the EPROM <b>34</b> via an address bus and data bus. The CPU <b>31</b> executes the control program stored in the EEPROM <b>32</b> based on information from each of the sensors <b>38</b> or an external device (not shown) to control a display apparatus <b>39</b> for displaying a status of an actuator <b>37</b> such as a motor and the device.</p>
<p id="p-0042" num="0041">The EEPROM <b>32</b> and the EPROM <b>34</b> will be explained next in detail. The EEPROM <b>32</b> is a flash memory capable of electrically writing a program and data as described above. As shown in <figref idref="DRAWINGS">FIG. 3</figref>, the EEPROM <b>32</b> is provided with storage areas, i.e. an area A for storing initial data, an area B for storing a control program, and an area C for storing various check data. The area A is a protected area, and stores various programs to be executed when the power is turned on and not to be rewritten. The startup program stored in area A includes an initial program for initial processing; a connection judgment processing program for determining whether the EPROM <b>34</b> is mounted on the IC socket <b>41</b>; a writing data check processing program for checking whether the new data stored in EPROM <b>34</b> is compatible when the control program is written; a delete processing program for deleting the control program stored in the EEPROM <b>32</b>; a writing program for writing the data of the new control program stored in an area E in the EPROM <b>34</b> to the area B in the EEPROM <b>32</b>; a first writing data check processing program for checking whether the data is written correctly after the control program is written; and a second writing data check processing program for checking the control program when the power is turned on. An error-processing program is also stored for displaying an error when the error occurs in the programs.</p>
<p id="p-0043" num="0042">The EEPROM <b>32</b> stores check data <b>1</b> in the area A for verifying the control program data using the first writing data check processing program and the second writing data check processing program. A variety of other programs and data are stored in the area A to operate the device without hindrance. A variety of control programs and data are stored in the area B of EEPROM <b>32</b> for executing operations. An erase processing program and a write processing program are executed to erase content of the control programs in a state that the EPROM <b>34</b> is mounted in the IC socket <b>41</b> on the printed circuit board, and the new control program stored in the area E in the EPROM is written to the area B.</p>
<p id="p-0044" num="0043">The area C in the EEPROM <b>32</b> is a memory region for storing the check data for determining whether the written control program is correct, i.e. check data <b>2</b> for adjusting the check data <b>1</b> described above, and check data <b>3</b> for determining whether the check data <b>2</b> are correct. The check data stored in the area C are written every time when the area B control program is written.</p>
<p id="p-0045" num="0044">As shown in <figref idref="DRAWINGS">FIG. 3</figref>, the EPROM <b>34</b> has three memory regions, i.e. area D, area E and area F, similar to the EEPROM <b>32</b>. The area D is a memory region for storing the same type of data as in the area A in the EEPROM <b>32</b>. The data are used for determining the connection of the EEPROM <b>32</b> (described later) and the compatibility of the apparatus to the control program for writing stored in the area E.</p>
<p id="p-0046" num="0045">A control program (new control program) for writing is stored in the area E. Note that various other data for operating the device are included along with the programs for executions of the device. The programs and data are written to the area B in the EEPROM <b>32</b>.</p>
<p id="p-0047" num="0046">The area F stores the check data such as the new check data <b>2</b> and check data <b>3</b> corresponding to the control program for writing in the area E. The check data are used for checking the control program in the area B in the EEPROM <b>32</b> written with the contents in the area E in the EPROM <b>34</b>. Note that the check data are set when the control program for writing is created.</p>
<p id="p-0048" num="0047">In the embodiment of the invention, the printed circuit board is provided with circuits for starting up the IC socket <b>41</b> and the EPROM <b>34</b>. The EPROM <b>34</b> is mounted on the IC socket <b>41</b>, so that it is easy to write to the EEPROM <b>32</b>. A writing unit with the EPROM <b>34</b> mounted thereon may be connected to the single chip computer <b>30</b> on the print circuit board through a connecting member such as a connector from outside. The EPROM <b>34</b> is provided for storing the programs and writing data as the external memory medium. Alternatively, it is possible to use other storage media such as a memory card, a memory stick, or a storage apparatus such as a personal computer.</p>
<p id="p-0049" num="0048">An address map allocated by the CPU <b>31</b> will be explained next. <figref idref="DRAWINGS">FIG. 5</figref> is a diagram showing an address map of a memory region to which a CPU of the control unit accesses in the automatic document feeder according to the embodiment of the present invention. Addresses 0000h to 00FFh are assigned to a function register region. Addresses 0100h to 02FFh are assigned to the RAM <b>33</b>. Addresses 0300h to 0FFFh are assigned to the EEPROM <b>32</b>. Addresses 1300h to 1FFFh are assigned to the EPROM <b>34</b>.</p>
<p id="p-0050" num="0049"><figref idref="DRAWINGS">FIG. 6</figref> to <figref idref="DRAWINGS">FIG. 11</figref> are flow charts showing a writing operation using a control program in the automatic document feeder according to the embodiment of the present invention. A process of writing with the control program in the automatic document feeder according to the embodiment of the present invention will be described with reference to <figref idref="DRAWINGS">FIG. 6</figref> to <figref idref="DRAWINGS">FIG. 11</figref>.</p>
<p id="p-0051" num="0050">When the power is turned on, an I/O board is initialized (ST<b>100</b>). The connection judgment processing program is executed to determine whether the writing data storage device EPROM <b>34</b> is connected to the I/O board (ST<b>101</b>). At this time, the connection judgment processing program stored in the area A is read out and temporarily stored in the RAM <b>33</b>.</p>
<p id="p-0052" num="0051">As shown in <figref idref="DRAWINGS">FIG. 7</figref>, in the connection judgment process, the area D in the EPROM <b>34</b>, specifically a plurality of specific addresses in the region assigned to the addresses of 1900 h to 1FFF, is accessed to determine whether the data of the specified addresses match the predetermined connection judgment values (ST<b>200</b> to ST<b>201</b>). When the EPROM <b>34</b> is mounted on the IC socket <b>41</b>, data matching the predetermined values are read. When the EPROM <b>34</b> is not mounted on the IC socket <b>41</b>, data different from the predetermined values are read. In the embodiment, when the EPROM <b>34</b> is not mounted, the single chip computer input port is pulled up, so that FFFF is read.</p>
<p id="p-0053" num="0052">The same data are stored in the area D in the EPROM <b>34</b> and the area A in the EEPROM <b>32</b>. Accordingly, the data in the EEPROM <b>32</b> at addresses thereof corresponding to the specified addresses in the EPROM <b>34</b> are used as the connection judgment values. The data at the corresponding addresses in the EEPROM <b>32</b> are compared with the data at the specified addresses in the EPROM <b>34</b> to determine whether the EPROM <b>34</b> is mounted on the IC socket <b>41</b>. When the data at the specified addresses in the EPROM <b>34</b> match the predetermined values, it is determined that the EPROM <b>34</b> is connected (ST<b>202</b>). When not match, it is determined that the EPROM <b>34</b> is not connected (ST<b>203</b>).</p>
<p id="p-0054" num="0053">Accordingly, it is determined whether the ERROM <b>34</b> is connected. When it is determined that the EPROM <b>34</b> is connected, the writing mode is operated to write the control program. When it is determined that the EPROM <b>34</b> is not connected, the normal mode is operated to operate the device using the normal control program (ST<b>102</b>). In other words, depending on whether the EPROM <b>34</b> is mounted on the IC socket <b>41</b>, it is automatically determined whether the writing mode is operated, and the program is automatically written.</p>
<p id="p-0055" num="0054">In the writing mode, the display apparatus <b>39</b> displays that the program is writing (ST<b>103</b>). The apparatus compatibility judgment process is operated to verify that the control program stored in the area E in the EPROM <b>34</b> is compatible with the main apparatus and is a correct control program (ST<b>104</b>). As shown in <figref idref="DRAWINGS">FIG. 8</figref>, the apparatus compatibility judgment process determines whether the data in the area D in the EPROM <b>34</b> match that in the area A in the EEPRM <b>32</b> (ST<b>301</b>). When the data match, it is determined that the control program in the area E in the EPROM <b>34</b> is compatible with the apparatus (ST<b>302</b>). When the data do not match, it is determined that the control program in the area E in the EPROM <b>34</b> is incompatible with the apparatus (ST<b>303</b>).</p>
<p id="p-0056" num="0055">When the apparatus is different from a normal apparatus, at least one of the actuator such as the motor to drive the apparatus, the sensors, the control circuits and the single chip computer is different. Accordingly, all the data in the area D in the EPROM <b>34</b> do not match that in the area A in the EEPRM <b>32</b>. Therefore, by comparing all the data in the area D in the EPROM <b>34</b> to that in the area A in the EEPRM <b>32</b>, it is possible to determine whether the control program stored in the area E in the EPROM <b>34</b> is compatible with the apparatus.</p>
<p id="p-0057" num="0056">When the control program is determined to be incompatible with the apparatus at ST<b>105</b>, an error is displayed (ST<b>180</b>) and the writing operation stops. When it is determined that the control program is compatible at ST<b>105</b>, the content in the area A in the EEPROM <b>32</b> is read and temporarily stored in the RAM <b>33</b> (ST<b>106</b>). The program stored in the RAM <b>33</b> is executed to perform the writing operation.</p>
<p id="p-0058" num="0057">In the writing operation, the erasing process is executed to erase the data in the area B and area C in the EEPROM <b>32</b> (ST<b>107</b>). The erasing process is executed to erase the content of the area B first, then that of the area C as shown in <figref idref="DRAWINGS">FIG. 9</figref> (ST<b>401</b> to ST<b>402</b>). The content of the area B is erased after that of the area C is erased. Accordingly, it is possible to securely determine whether the program is written correctly after the power is restored, if there is power outage during the erasing process. In the erasing process in the embodiment, all data in the areas B and C is written as FFFFh.</p>
<p id="p-0059" num="0058">Next, the new control program data in the area E in the EPROM <b>34</b> is read according to the address and written to the area B in the EEPROM <b>32</b> (ST<b>108</b>). Accordingly, the control program data are written to the area B in the EEPROM <b>32</b>. When the writing of the control program data to EEPROM <b>32</b> is completed, the writing data check <b>1</b> process is executed (ST<b>109</b>). In the writing data check <b>1</b> process, it is determined whether the control program is correctly written to the area B in the EEPROM <b>32</b>.</p>
<p id="p-0060" num="0059">As shown in <figref idref="DRAWINGS">FIG. 10</figref>, the stored control program data are added to the content written to the area B per 16 bits, and the sum of the area B per 16 bits is calculated (ST<b>501</b>). The 16 bits sum value is subtracted from the check data <b>1</b> in the area A (ST<b>502</b>). The subtracted value is compared with the check data <b>2</b> in the area F in the EPROM <b>34</b> (ST<b>503</b>). When the subtracted value does not match, it is determined that the control program is not written correctly and there is a writing error (ST<b>506</b>). When the subtracted value matches, the subtracted value is processed through bit conversion to obtain converted data, and the check data <b>3</b> in the area F in the EPROM <b>34</b> are compared to the converted date (ST<b>504</b>). When the check data <b>3</b> match, it is determined that the control program is written correctly (ST<b>505</b>) When the check data <b>3</b> in the EPROM <b>34</b> do not match, it is determined that the writing of the control program is erroneous (ST<b>506</b>).</p>
<p id="p-0061" num="0060">When it is determined that the control program is written correctly to the area B in the EEPROM <b>32</b>, the check data <b>2</b> and check data <b>3</b> in the area F in the EPROM <b>34</b> are written to the area C in the EEPROM <b>32</b> (ST<b>110</b>). It is displayed that the writing operation is completed (ST<b>112</b>). When the control program is not correctly written to the area B in the EEPROM <b>32</b>, an error is displayed (ST<b>113</b>).</p>
<p id="p-0062" num="0061">The check data <b>1</b> are specific values stored in the area A, i.e. a write protected area. The check data <b>2</b> are adjustment values for adjusting the check data <b>1</b> by adding the check data <b>2</b> to the sum value of all data in the area B. The check data <b>3</b> are the converted data in the check data <b>2</b>.</p>
<p id="p-0063" num="0062">When it is determined that the EPROM <b>34</b> is not connected and the normal mode is operated at ST<b>102</b>, as shown in <figref idref="DRAWINGS">FIG. 6</figref>, the writing data check <b>2</b> process is executed (ST<b>120</b>). In the writing data check <b>2</b> process at ST<b>120</b>, the converted data in the check data <b>2</b> are compared to the check data <b>3</b> to determine whether the check data <b>2</b> are correct. Accordingly, it is possible to determine that the erasing and writing processes are completed normally and the data is written correctly.</p>
<p id="p-0064" num="0063">When it is determined that the converted data of the check data <b>2</b> match the check data <b>3</b> at ST<b>601</b>, it is determined that the check data <b>2</b> are correct, and the process moves to ST<b>602</b>. When the converted data of the check data <b>2</b> do not match, it is determined that the check data <b>2</b> are incorrect and the written data are erroneous (ST<b>605</b>). Accordingly, when the writing operation is interrupted while the new program or data is written and the power is supplied after removing the EPROM <b>34</b>, the sum of the data when the writing operation is interrupted matches the sum of the data written normally. Even when the check data <b>2</b> are FFFF, the check data <b>3</b> are different from FFFF, so that it is possible to securely determine whether the data are written correctly all the way to the end.</p>
<p id="p-0065" num="0064">When it is determined that the check data <b>2</b> are correct at ST<b>601</b>, the data in the area B and the check data <b>2</b> in the area C are added every 16 bits (ST<b>602</b>). The added data are compared to the check data <b>1</b> in the area A (ST<b>603</b>). When both values match, it is determined that the written data is correct (ST<b>604</b>). When they do not match, it is determined that the written data are erroneous (ST<b>605</b>). In other words, in the writing data check <b>2</b> process, the check data <b>2</b> and the sum data of the check data <b>2</b> and the control program data are checked to determine whether the control program is written correctly.</p>
<p id="p-0066" num="0065">When it is determined that the control program and data are written correctly in the writing data check <b>2</b> at ST<b>120</b>, the control program is executed to startup the apparatus (ST<b>122</b>) When it is determined that the control program and data are not written correctly, an error is displayed and processing is stopped (ST<b>123</b>). Specifically, the first judging means is executed in the writing data check <b>2</b> process, in which it is determined whether the correct control program and data are stored in the EEPROM <b>32</b>. The second judging means is executed in the process in which it is determined whether the erasing and writing processes of the control program and data in the EEPROM <b>32</b> are performed normally.</p>
<p id="p-0067" num="0066">With reference to <figref idref="DRAWINGS">FIG. 12</figref>, the check data <b>1</b> to <b>3</b> will be explained. The control unit of the automatic document feeder uses the check data <b>1</b> to <b>3</b> for checking the writing operation. <figref idref="DRAWINGS">FIG. 12</figref> is a data map to explain the check data. In the embodiment, among the storage areas in the EEPROM <b>32</b>, the area A is assigned addresses of 00 to 0F; the area B is assigned addresses of 10 to 1F; and the area C is assigned addresses of 20 to 2F.</p>
<p id="p-0068" num="0067">A value of FFFh is stored at the addresses of 00 to 0D in the area A as the check data <b>1</b>. The data at the addresses 10 to 1F in the area B are added every 16 bits (2 bytes) to obtain the sum value equal to 2AD3Fh as data. Since the data are expressed in 16 bits, the highest position value ‘2’ of the data is deleted, so that the sum value of the data in the area B is AD3Fh. The sum value (AD3Fh) is subtracted from the value of FFFFh stored in the area A as the check data <b>1</b> to obtain 52C0h, and 52C0h is stored at the addresses 20 to 21 in the area C as the check data <b>2</b>.</p>
<p id="p-0069" num="0068">When the power is turned on to execute the check data <b>2</b> process, and the check data <b>2</b> (52C0h) are added to the sum of the data in the area B (AD3Fh), the check data <b>2</b> return to the original FFFFh (stored in the area A as the check data <b>1</b>). In other words, the check data <b>2</b> have a function of an adjustment value for verifying results of the calculations.</p>
<p id="p-0070" num="0069">The check data <b>3</b> are stored at the addresses 22 to 23 in the area C and are AD3Fh, i.e. a converted value of the check data <b>2</b> (52C0h). The check data <b>3</b> (AD3Fh) check the check data <b>2</b>.</p>
<p id="p-0071" num="0070">According to the embodiment of the present invention, the predetermined connection judgment value to be compared to the data at a specified address in the connection judgment process is set as the prearranged data stored in the area A in the EEPROM. It is also possible to set the connection judgment check regions in the area A in the EEPROM and to the area D in the EPROM, and to access the connection judgment check region in the EPROM and read out the data. By comparing the data to the data in the connection judgment check region in the EEPROM, it can be determined whether the EPROM is connected to the IC socket <b>41</b>.</p>
<p id="p-0072" num="0071">According to the embodiment of the present invention, the check data <b>3</b> are the converted data of each bit of the check data <b>2</b>. The system compares the data converted from each bit of the check data <b>2</b> and the check data <b>3</b> to determine whether the erasing and writing processes are completed normally when the power is turned on. When they match, the writing is completed normally. When they do not match, it is determined that there is an error in the writing process. It is also acceptable to write specific data in the area C, specifically data different from FFFFh, when the check data <b>3</b> are erased. Accordingly, it can be determined whether the writing is completed normally by determining whether the specific data written in the writing data check <b>2</b> process executed when the power is turned on match the predetermined data. Note that in this case, when executing the erasing process, the check data <b>2</b> are erased before erasing the check data <b>2</b> in the area C and area B. The writing is executed after writing the check data <b>2</b> to the area B and area C, when executing the writing process. Accordingly, it is possible to accurately determine whether the writing process is completed normally.</p>
<p id="p-0073" num="0072">According to the embodiment of the present invention, the check data <b>1</b> specific to the device are preset in the area A in the EEPROM <b>32</b>. The check data <b>2</b> are adjusted so that the sum of the control program data written to the area B matches the check data <b>1</b>. The data written to the area B are checked. As shown in <figref idref="DRAWINGS">FIG. 12</figref>, while storing the sum value that operates the sum of the data written to the area C′, the converted value of each bit of the sum value data is stored. Each time the power is turned on, it is determined whether the converted value of each bit of the sum value data and the sum value check data match. When they match, it is possible to determine whether the sum of the data stored in the area B and the sum value match. In this case, when the converted value for each bit of the sum value data and the sum value check data match, and the data sum stored in the area B and the sum value match, it is determined that the data are correctly written to the area B′. Note that in this case, the converted data for each bit of the check data <b>2</b> and the check data <b>3</b> are compared when determining whether the check data <b>2</b> are correct. It is also perfectly acceptable to add the check data <b>2</b> and the check data <b>3</b>. When the result is FFFFh, it is determined that the check data <b>2</b> is correct, since the converted data for each bit of the check data <b>2</b> are the check data <b>3</b>. When it is not FFFFh, the check data <b>2</b> are incorrect.</p>
<p id="p-0074" num="0073">According to the embodiment, the converted data for each bit of the check data <b>2</b> are the check data <b>3</b>. It is also acceptable to add or subtract a constant predetermined value to or from the check data <b>2</b> to obtain values as the check data <b>3</b>. It is also acceptable to add a constant predetermined value to the sum value, in the same way as the sum value check data described above, or to use a value subtracted for the sum value check data. Specifically, it is preferable that the check data <b>3</b> be different from the check data <b>2</b> and have a specific relationship with the check data <b>2</b>.</p>
<p id="p-0075" num="0074">According to the embodiment of the present invention, the connection judgment processing program, the erasing process program and the writing process program are stored in the startup program area (area A) in the EEPROM <b>32</b> in the control unit <b>31</b> of the automatic document feeder <b>100</b>. It is determined whether the EPROM <b>34</b> is mounted on the IC socket <b>41</b> when the power is turned on. When the EPROM <b>34</b> is connected, the erasing and writing operations are automatically performed on the writing area (area B) in the EEPROM <b>32</b>, so that there is no need for a dedicated apparatus or operating means for specifying the writing operation when writing the EEPROM <b>32</b>. The writing operation to the EEPROM <b>32</b> is performed automatically simply by mounting the EPROM <b>34</b> on the IC socket <b>41</b>.</p>
<p id="p-0076" num="0075">According to the embodiment of the present invention, in the check area in the EEPROM, the data for the first check for determining whether the written control program is correct, and the data for the second check used for determining whether the erasing and writing processes are completed normally are written when writing the control program. Based on the data for the second check, it is determined that the erasing and writing processes are completed normally and the data are written correctly. Then, it is determined whether the program written by the data of the first check stored in the first memory region is correct. Accordingly, it is possible to check whether the correct control program is written normally. Particularly, like the automatic document feeder <b>100</b>, when a device is used as an option for other devices (such as a copier), it is easy to upgrade such as adding a new function according to an apparatus with the device, and it is possible to confirm an update of a control program.</p>
<p id="p-0077" num="0076">While the invention has been explained with reference to the specific embodiments of the invention, the explanation is illustrative and the invention is limited only by the appended claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A control device for controlling an
<claim-text>electronic device, comprising:</claim-text>
<claim-text>a socket to be connected to an external memory,</claim-text>
<claim-text>non-volatile storage memory means having a memory region with a portion where data can be electrically rewritten, said memory means having a first memory region for storing control program data for operating the electronic device, a second memory region for storing connection judgment program data to determine whether the external memory is connected to the socket, and a third memory region for storing writing program data to rewrite the control program data stored in the first memory region, and</claim-text>
<claim-text>control means electrically connected to the socket and memory means for executing a control program to control an operation of the electronic device, said control means initially executing the connection judgment program data, and when it is determined that the external memory is connected to the socket, the control means executing the writing program data so that at least a portion of the control program data stored in the first memory region of the memory means is rewritten to external memory medium data stored in the external memory.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. A control device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said control means executes the writing program when data stored in the external memory at a predetermined address thereof is read through executing the connection judgment program and the data matches predetermined data stored in the memory means.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. A control device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said control means executes operation control program based on the operation control program data stored in the first memory region when data stored in the external memory at a predetermined address thereof is read through executing the connection judgment program and the data does not match predetermined data stored in the memory means.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. A control device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said control means executes the connection judgment program when the control device is turned on.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. A control device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said memory means further includes a fourth memory region for storing compatibility judgment program data for determining whether the external memory medium data stored in the external memory means is compatible and correct, said control means executing the writing program so that at least a portion of the control program data stored in the first memory region in the memory means is rewritten based on the external memory medium data stored in the external memory medium when it is determined that the external memory is connected to the control device through executing the connection judgment program and that the external memory medium data stored in the external memory medium is correct through executing the compatibility judgment program.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. A control device according to <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein said control means outputs an error signal when it is determined that the external memory medium data stored in the external memory is incorrect through executing the compatibility judgment program.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. An automatic document feeder comprising: feeding means for feeding original onto a platen, discharging means for discharging the original on the platen, and a control board for controlling the feeding means and the discharging means, said control board including the control device according to <claim-ref idref="CLM-00001">claim 1</claim-ref> and executing the connection judgment program when the control device is turned on.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. A control device for controlling an operation of an electronic device, comprising:
<claim-text>a single chip computer having an EEPROM capable of electrically rewriting data therein,</claim-text>
<claim-text>a control board having said single chip computer thereon,</claim-text>
<claim-text>a socket mounted on the control board, to which an EPROM having a memory area with predetermined addresses assigned thereto is attached,</claim-text>
<claim-text>a bus for connecting the single chip computer and the EPROM through the socket,</claim-text>
<claim-text>rewriting means memorized in a boost area of the EEPROM and writing data memorized in the EPROM to a predetermined area of the EEPROM,</claim-text>
<claim-text>judgment means memorized in the boost area of the EEPROM and judging whether the EPROM is connected to the socket, and control means for executing the judgment means when the control device is turned on, said control means executing the rewriting means when it is judged that the EPROM is connected to the socket.</claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
