<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07298649-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07298649</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>11282746</doc-number>
<date>20051121</date>
</document-id>
</application-reference>
<us-application-series-code>11</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>JP</country>
<doc-number>2003-048498</doc-number>
<date>20030226</date>
</priority-claim>
</priority-claims>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>11</class>
<subclass>C</subclass>
<main-group>11</main-group>
<subgroup>34</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>36518504</main-classification>
<further-classification>36518533</further-classification>
<further-classification>36518511</further-classification>
<further-classification>711150</further-classification>
<further-classification>711155</further-classification>
<further-classification>711164</further-classification>
</classification-national>
<invention-title id="d0e61">Nonvolatile memory card</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5592619</doc-number>
<kind>A</kind>
<name>Shona</name>
<date>19970100</date>
</document-id>
</patcit>
<category>cited by other</category>
<classification-national><country>US</country><main-classification>395186</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5606660</doc-number>
<kind>A</kind>
<name>Estakhri et al.</name>
<date>19970200</date>
</document-id>
</patcit>
<category>cited by other</category>
<classification-national><country>US</country><main-classification>39518314</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>5727232</doc-number>
<kind>A</kind>
<name>Iida et al.</name>
<date>19980300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710 56</main-classification></classification-national>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>6182240</doc-number>
<kind>B1</kind>
<name>Mine</name>
<date>20010100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>714  5</main-classification></classification-national>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>6301366</doc-number>
<kind>B1</kind>
<name>Malcolm et al.</name>
<date>20011000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>381119</main-classification></classification-national>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>6301644</doc-number>
<kind>B1</kind>
<name>Andoh et al.</name>
<date>20011000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711201</main-classification></classification-national>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>6377500</doc-number>
<kind>B1</kind>
<name>Fujimoto et al.</name>
<date>20020400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>36523001</main-classification></classification-national>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>6405093</doc-number>
<kind>B1</kind>
<name>Malcolm et al.</name>
<date>20020600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>700 94</main-classification></classification-national>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>6628999</doc-number>
<kind>B1</kind>
<name>Klaas et al.</name>
<date>20030900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>700 94</main-classification></classification-national>
</citation>
<citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>6687784</doc-number>
<kind>B2</kind>
<name>Douniwa et al.</name>
<date>20040200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711103</main-classification></classification-national>
</citation>
<citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>6783913</doc-number>
<kind>B2</kind>
<name>Glatt et al.</name>
<date>20040800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>430175</main-classification></classification-national>
</citation>
<citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>6996005</doc-number>
<kind>B2</kind>
<name>Mori et al.</name>
<date>20060200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>36518504</main-classification></classification-national>
</citation>
<citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>7111142</doc-number>
<kind>B2</kind>
<name>Spencer et al.</name>
<date>20060900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711170</main-classification></classification-national>
</citation>
<citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>2004/0054847</doc-number>
<kind>A1</kind>
<name>Spencer et al.</name>
<date>20040300</date>
</document-id>
</patcit>
<category>cited by other</category>
<classification-national><country>US</country><main-classification>711104</main-classification></classification-national>
</citation>
<citation>
<patcit num="00015">
<document-id>
<country>JP</country>
<doc-number>63-244231</doc-number>
<date>19881000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00016">
<document-id>
<country>JP</country>
<doc-number>363244231</doc-number>
<kind>A</kind>
<date>19881000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
</citation>
<citation>
<patcit num="00017">
<document-id>
<country>JP</country>
<doc-number>5-143315</doc-number>
<date>19930600</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00018">
<document-id>
<country>JP</country>
<doc-number>405143315</doc-number>
<kind>A</kind>
<date>19930600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
</citation>
<citation>
<patcit num="00019">
<document-id>
<country>JP</country>
<doc-number>7-44672</doc-number>
<date>19950200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00020">
<document-id>
<country>JP</country>
<doc-number>11-265283</doc-number>
<date>19990900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00021">
<document-id>
<country>JP</country>
<doc-number>2000-082122</doc-number>
<date>20000300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00022">
<document-id>
<country>JP</country>
<doc-number>02000082122</doc-number>
<kind>A</kind>
<date>20000300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
</citation>
<citation>
<patcit num="00023">
<document-id>
<country>JP</country>
<doc-number>2002-251595</doc-number>
<date>20020900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00024">
<document-id>
<country>JP</country>
<doc-number>2003-085509</doc-number>
<date>20030300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>4</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>36518504</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>36518533</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>36518511</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>6</number-of-drawing-sheets>
<number-of-figures>8</number-of-figures>
</figures>
<us-related-documents>
<continuation>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>10721873</doc-number>
<kind>00</kind>
<date>20031126</date>
</document-id>
<parent-grant-document>
<document-id>
<country>US</country>
<doc-number>6996005</doc-number>
<kind>A </kind>
</document-id>
</parent-grant-document>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>11282746</doc-number>
</document-id>
</child-doc>
</relation>
</continuation>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20060106973</doc-number>
<kind>A1</kind>
<date>20060518</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Mori</last-name>
<first-name>Makoto</first-name>
<address>
<city>Kodaira</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Hirosawa</last-name>
<first-name>Seisuke</first-name>
<address>
<city>Kodaira</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="003" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Shikata</last-name>
<first-name>Atsushi</first-name>
<address>
<city>Higashimurayama</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Miles &amp; Stockbridge P.C.</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Renesas Technology Corp.</orgname>
<role>03</role>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Nguyen</last-name>
<first-name>Viet Q.</first-name>
<department>2827</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">The present invention provides a nonvolatile memory card in which a program is added, modified, changed, or the like by selecting arbitrary firmware on a flash memory from a plurality of pieces of firmware on flash memories. In a memory card, in addition to a program stored in a built-in ROM, firmware on flash memories as programs for adding, changing, modifying, or the like of a function such as a patch program are stored. Firmware on a flash memory which is desired to be made valid is set in a parameter sector or the like and is loaded into an external RAM, and the CPU of a control logic executes a process.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="195.16mm" wi="164.93mm" file="US07298649-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="242.32mm" wi="173.06mm" orientation="landscape" file="US07298649-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="218.78mm" wi="165.86mm" file="US07298649-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="233.00mm" wi="179.24mm" file="US07298649-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="255.69mm" wi="172.30mm" file="US07298649-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="205.06mm" wi="180.00mm" file="US07298649-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="210.48mm" wi="193.55mm" file="US07298649-20071120-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATION</heading>
<p id="p-0002" num="0001">This application is a continuation of application Ser. No. 10/721,873 filed Nov. 26, 2003 now U.S. Pat. No. 6,996,005.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0003" num="0002">The present invention relates to a memory card and, more particularly, to a technique effectively applied to realization of multiple functions of a memory card using a nonvolatile memory.</p>
<p id="p-0004" num="0003">As a storage device of a personal computer, a multifunctional peripheral, or the like, a memory card is being rapidly spread. In association with a request for higher performance in recent years, as a semiconductor memory to be mounted on a memory card, for example, a nonvolatile memory such as a flash memory which can be electrically erased and rewritten in a lump and can hold a large amount of data is used.</p>
<p id="p-0005" num="0004">In such a memory card, a control program is stored in a ROM (Read Only Memory) or the like provided in the memory card. In some cases, firmware such as a patch program for a control program and an addition control program for extending the function of a control program stored in a ROM is stored in a flash memory.</p>
<p id="p-0006" num="0005">Firmware (hereinbelow, also called firmware on a flash memory) can be rewritten freely many times. A change, addition of a function, and the like can be easily freely made on firmware on a flash memory even assembled in a product.</p>
<p id="p-0007" num="0006">In some multimedia cards, validity or invalidity of a command and a data format is set by firmware (for example, Japanese Unexamined Patent Publication No. 2003-085509).</p>
<p id="p-0008" num="0007">Further, in some IC cards, a command table is provided in a nonvolatile memory such as an EEPROM (Electrically Erasable and Programmable ROM) in addition to a command table in a ROM. In the case where the command table in the ROM is known or may be known by a third party, the command table in the nonvolatile memory is used (for example, Japanese Unexamined Patent Publication No. Hei 7 (1995)-44672).</p>
<heading id="h-0003" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0009" num="0008">The inventor herein, however, has found that the memory card as described above has the following problems.</p>
<p id="p-0010" num="0009">Since firmware on a flash memory is developed in a RAM (Random Access Memory) used as a work area of the CPU provided for a controller at the time of start-up or the like of a memory card, the data capacity of the firmware on a flash memory which can be developed in the RAM is limited. Consequently, only one firmware on a flash memory is provided.</p>
<p id="p-0011" num="0010">Therefore, an addition function, a program correction, and the like performed by the firmware on a flash memory are also limited, and it is feared that convenience of the memory card deteriorates.</p>
<p id="p-0012" num="0011">In an IC card having a command table in a nonvolatile memory, the nonvolatile memory and a controller are formed in a single semiconductor chip. Further, although an EEPROM can be usually accessed at random on a byte unit basis, in a memory card in which a nonvolatile memory and a controller are formed in different semiconductor chips, an access to the nonvolatile memory is, for example, a sequentially access in a 512-byte unit.</p>
<p id="p-0013" num="0012">Therefore, in the case of a memory card, in a configuration of storing firmware on a flash memory in a nonvolatile memory and reading the firmware on the flash memory by the controller, the reading speed is different from the operation speed of the controller. It causes a problem of a large overhead in data reading speed and data transferring speed.</p>
<p id="p-0014" num="0013">An object of the invention is to provide a memory card having a plurality of pieces of firmware on flash memories, in which a program can be added, modified, changed or the like by selecting arbitrary firmware on a flash memory.</p>
<p id="p-0015" num="0014">The above and other objects and novel features of the invention will become apparent from the description of the specification and the appended drawings.</p>
<p id="p-0016" num="0015">An outline of representative one of inventions disclosed in the specification will be briefly described as follows.</p>
<p id="p-0017" num="0016">The invention provides a nonvolatile memory card including: a nonvolatile semiconductor memory having a plurality of nonvolatile memory cells and capable of storing predetermined information; and a controller for giving an instruction of operation of the nonvolatile semiconductor memory on the basis of a command issued from the outside, wherein: the nonvolatile semiconductor memory can store two or more pieces of firmware; and the controller has a volatile semiconductor memory for storing the firmware, when a firmware selecting instruction is made valid, the controller selects one arbitrary firmware from two or more pieces of firmware which can be stored in the volatile semiconductor memory, stores it in the volatile semiconductor memory, accesses the volatile semiconductor memory and executes a process by the firmware.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram of a memory card according to an embodiment of the invention.</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 2</figref> is a diagram illustrating the internal configuration of a flash memory provided for the memory card of <figref idref="DRAWINGS">FIG. 1</figref>.</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 3</figref> is a diagram showing the configuration of a management area provided for the flash memory of <figref idref="DRAWINGS">FIG. 2</figref>.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 4</figref> is a flowchart of a process of selecting firmware on a flash memory in accordance with a parameter of the memory card of <figref idref="DRAWINGS">FIG. 1</figref>.</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 5</figref> is a flowchart of a process of selecting firmware on a flash memory by using a firmware-on-flash-memory selecting command according to the memory card of <figref idref="DRAWINGS">FIG. 1</figref> and loading the firmware.</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 6</figref> is a flowchart of a process of selecting firmware on a flash memory during execution of a program in the memory card of <figref idref="DRAWINGS">FIG. 1</figref>.</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 7</figref> is a flowchart of retrieving the selected firmware on the flash memory by the memory card of <figref idref="DRAWINGS">FIG. 1</figref> by using an identification code.</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 8</figref> is a flowchart of designating a search range and retrieving the selected firmware on the flash memory by the memory card of <figref idref="DRAWINGS">FIG. 1</figref>.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DESCRIPTION OF THE PREFERRED EMBODIMENTS OF THE INVENTION</heading>
<p id="p-0026" num="0025">Embodiments of the invention will be described in detail hereinbelow with reference to the drawings.</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram of a memory card according to an embodiment of the invention. <figref idref="DRAWINGS">FIG. 2</figref> is a diagram illustrating the internal configuration of a flash memory provided for the memory card of <figref idref="DRAWINGS">FIG. 1</figref>. <figref idref="DRAWINGS">FIG. 3</figref> is a diagram showing the configuration of a management area provided for the flash memory of <figref idref="DRAWINGS">FIG. 2</figref>. <figref idref="DRAWINGS">FIG. 4</figref> is a flowchart of a process of selecting firmware on a flash memory in accordance with a parameter of the memory card of <figref idref="DRAWINGS">FIG. 1</figref>. <figref idref="DRAWINGS">FIG. 5</figref> is a flowchart of a process of selecting firmware on a flash memory by using a firmware-on-flash-memory selecting command according to the memory card of <figref idref="DRAWINGS">FIG. 1</figref> and loading the firmware. <figref idref="DRAWINGS">FIG. 6</figref> is a flowchart of a process of selecting firmware on a flash memory during execution of a program in the memory card of <figref idref="DRAWINGS">FIG. 1</figref>. <figref idref="DRAWINGS">FIG. 7</figref> is a flowchart of retrieving the selected firmware on the flash memory by the memory card of <figref idref="DRAWINGS">FIG. 1</figref> by using an identification code. <figref idref="DRAWINGS">FIG. 8</figref> is a flowchart of designating a search range and retrieving the selected firmware on the flash memory by the memory card of <figref idref="DRAWINGS">FIG. 1</figref>.</p>
<p id="p-0028" num="0027">In the embodiment, a memory card <b>1</b> is used as an external storage medium of a host device HT in a digital video camera, a portable telephone, a portable music player, a personal computer, or the like.</p>
<p id="p-0029" num="0028">The memory card <b>1</b> is constructed by, as shown in <figref idref="DRAWINGS">FIG. 1</figref>, a plurality of flash memories (nonvolatile semiconductor memories) <b>2</b>, and a controller <b>3</b>. The flash memory <b>2</b> is an electrically erasable and programmable nonvolatile semiconductor memory. Although a plurality of flash memories <b>2</b> is provided here, the number of the flash memories <b>2</b> may be at least one.</p>
<p id="p-0030" num="0029">In the flash memory <b>2</b>, firmware FOF<b>1</b> to FOF<b>3</b> on flash memories as programs for adding, changing, and modifying a function such as a patch program are provided separately from a program stored in a built-in ROM <b>6</b>.</p>
<p id="p-0031" num="0030">It is assumed here that the three pieces of firmware FOF<b>1</b> to FOF<b>3</b> on flash memories are stored in the flash memory <b>2</b>. The number of pieces of firmware on flash memories stored in the flash memory <b>2</b> may be more than or less than three.</p>
<p id="p-0032" num="0031">The controller <b>3</b> is connected to the host device HT, controls the flash memory <b>2</b>, reads a program, data, or the like stored in the flash memory <b>2</b> and outputs it to the host device HT. The controller <b>3</b> performs an instruction of writing a program or data supplied from the host HT into the flash memory <b>2</b>.</p>
<p id="p-0033" num="0032">The controller <b>3</b> is constructed by a control logic <b>4</b>, a built-in RAM (volatile semiconductor memory) <b>5</b>, the built-in ROM <b>6</b>, an external RAM <b>7</b>, and the like. The control logic <b>4</b> performs all of controls in the controller <b>3</b>.</p>
<p id="p-0034" num="0033">The built-in RAM <b>5</b> is a volatile memory such as an SRAM (Static RAM) and is used as a work area of a CPU provided for the control logic <b>4</b>. In the built-in ROM <b>6</b>, a control program for operating the control logic <b>4</b> and the like is stored. The external RAM <b>7</b> is a memory into which one of the firmware FOF<b>1</b> to FOF<b>3</b> on flash memories stored in the flash memory <b>2</b> is loaded.</p>
<p id="p-0035" num="0034"><figref idref="DRAWINGS">FIG. 2</figref> is a diagram illustrating the internal configuration of the flash memory <b>2</b>.</p>
<p id="p-0036" num="0035">The flash memory <b>2</b> is constructed by a user access region A<b>1</b> and a user access impossible region A<b>2</b>.</p>
<p id="p-0037" num="0036">The user access region A<b>1</b> consists of a data block region R<b>1</b> which can be used by the user and a management region K<b>1</b> in which data for managing the data block region is stored.</p>
<p id="p-0038" num="0037">The user access impossible region A<b>2</b> is a region which cannot be accessed by the user and is constructed by a data block spare region R<b>2</b>, an FOF region R<b>3</b>, a CIS/ID/parameter region R<b>4</b>, and a spare table region R<b>5</b>.</p>
<p id="p-0039" num="0038">In the data block spare region R<b>2</b>, FOF region R<b>3</b>, CIS/ID/parameter region R<b>4</b>, and spare table region R<b>5</b>, management regions K<b>2</b> to K<b>5</b> are provided, respectively.</p>
<p id="p-0040" num="0039">The data block spare region R<b>2</b> is a region with which the data block region in which a failure occurs is replaced. The management region K<b>2</b> stores information for managing the data block spare region R<b>2</b>.</p>
<p id="p-0041" num="0040">The FOF region R<b>3</b> is a region in which the firmware FOF<b>1</b> to FOF<b>3</b> on flash memories is stored. In the management region (firmware management region) K<b>3</b>, information for managing the FOF region R<b>3</b> is stored.</p>
<p id="p-0042" num="0041">The CIS/ID/parameter region R<b>4</b> is a region in which the drive information ID (Identify Drive Information) of the memory card <b>1</b>, information such as the name, kind, function, and the like of the memory card <b>1</b>, CIS (Card Information Structure), various parameters, and the like are stored. The management region K<b>4</b> stores information for managing the CIS/ID/parameter region R<b>4</b>. The spare table region R<b>5</b> is a region for storing area spare region information. The management region K<b>5</b> stores information for managing the spare table region R<b>5</b>.</p>
<p id="p-0043" num="0042">The configuration of the management region K<b>3</b> will be described by using the configuration diagram of <figref idref="DRAWINGS">FIG. 3</figref>.</p>
<p id="p-0044" num="0043">As shown in the diagram, in the management region K<b>3</b>, a good sector code, FOF (firmware on flash memory) No., an identification code (firmware identification information), management ECC information, and the like are stored.</p>
<p id="p-0045" num="0044">The good sector code is a code indicating whether each of the sectors in the FOF region R<b>3</b> is normal or abnormal. The FOF (firmware on flash memory) No. is a number assigned to each of the firmware FOF<b>1</b> to FOF<b>3</b> on flash memories.</p>
<p id="p-0046" num="0045">The identification code is a code indicative of a block (hereinbelow, called an FOF block) of each of the firmware FOF<b>1</b> to FOF<b>3</b> on flash memories stored in the FOF region R<b>3</b> and is used for retrieving the FOF block. The management ECC information is ECC (Error Correcting Code) information used for making a data correction.</p>
<p id="p-0047" num="0046">The action in the memory card <b>1</b> of the embodiment will now be described.</p>
<p id="p-0048" num="0047">First, the operation of the memory card <b>1</b> in the case where an instruction of selecting the firmware FOF<b>1</b> to FOF<b>3</b> on flash memories (firmware selecting instruction) is given according to a parameter will be described with reference to the flowchart of <figref idref="DRAWINGS">FIG. 4</figref>.</p>
<p id="p-0049" num="0048">In this case, a bit for selecting the firmware FOF<b>1</b> to FOF<b>3</b> on flash memories is provided for a parameter sector, and firmware on a flash memory selected by the selection bit is loaded by a resetting sequence performed at the time of power-on or the like.</p>
<p id="p-0050" num="0049">First, in the resetting sequence, the CPU of the controller <b>3</b> reads a necessary parameter sector from the CIS/ID/parameter region R<b>4</b> in the flash memory <b>2</b> and stores it into the external RAM <b>7</b> (step S<b>101</b>).</p>
<p id="p-0051" num="0050">After that, the firmware on flash memory No. is obtained from the read parameter sector (step S<b>102</b>). By referring to the identification code in the management region K<b>3</b> in the flash memory <b>2</b>, whether the FOF region R<b>3</b> exists in the flash memory <b>2</b> or not is checked (step S<b>103</b>)</p>
<p id="p-0052" num="0051">If the FOF region R<b>3</b> exists in the process of step S<b>103</b>, a process of retrieving an FOF block in the FOF region R<b>3</b> is performed (step S<b>104</b>).</p>
<p id="p-0053" num="0052">In the case where the FOF region R<b>3</b> does not exist, the CPU accesses the built-in ROM <b>6</b> and makes the memory card <b>1</b> operate on the basis of a program stored in the built-in ROM <b>6</b>.</p>
<p id="p-0054" num="0053">The operation of the memory card <b>1</b> in the case where a firmware-on-flash-memory selecting instruction is given by using a command for selecting firmware on a flash memory will now be described by using the flowchart of <figref idref="DRAWINGS">FIG. 5</figref>.</p>
<p id="p-0055" num="0054">First, when receiving a command for selecting firmware on a flash memory from the host device HT or the like, the CPU sets the command for selecting firmware on a flash memory into a task file register provided for the control logic <b>4</b> (step S<b>201</b>). The task file register is a register for transferring data to/from the host device HT by a normal command.</p>
<p id="p-0056" num="0055">After that, a firmware on flash memory No. desired to be validated is set in the task file register (step S<b>202</b>). By referring to the identification code in the management region K<b>3</b> in the flash memory <b>2</b>, whether the FOF region R<b>3</b> exists in the flash memory <b>2</b> or not is checked (step S<b>203</b>).</p>
<p id="p-0057" num="0056">If the FOF region R<b>3</b> exists in the process of step S<b>203</b>, a process for retrieving an FOF block in the FOF region R<b>3</b> is performed (step S<b>204</b>). If the FOF region R<b>3</b> does not exist, the CPU accesses the built-in ROM <b>6</b> and operates the memory card <b>1</b> on the basis of a program stored in the built-in ROM <b>6</b>.</p>
<p id="p-0058" num="0057">The operation of the memory card <b>1</b> in the case of an instruction for selecting arbitrary firmware on a flash memory during execution of a program will now be described with reference to the flowchart of <figref idref="DRAWINGS">FIG. 6</figref>.</p>
<p id="p-0059" num="0058">As an example, the case of newly selecting and executing the firmware FOF <b>2</b> on a flash memory during the process of the firmware FOF<b>1</b> on a flash memory will be described. A process of newly selecting and executing any of the firmware FOF<b>1</b> to FOF<b>3</b> on flash memories during the process of a program in the built-in ROM <b>6</b> is similar to the example.</p>
<p id="p-0060" num="0059">In the case where an arbitrary process is being executed on the basis of the firmware FOF<b>1</b> on the flash memory (step S<b>301</b>), the CPU determines whether or not any of the other firmware FOF<b>2</b> and FOF<b>3</b> on flash memories which are not selected has to be processed due to occurrence of an interrupting process, an error process, or the like (step S<b>302</b>).</p>
<p id="p-0061" num="0060">If any of the other firmware FOF<b>2</b> and FOF<b>3</b> on flash memories which are not selected has to be processed, the firmware-on-flash-memory No. to be selected is set (step S<b>303</b>).</p>
<p id="p-0062" num="0061">By referring to an identification code in the management region K<b>3</b> in the flash memory <b>2</b>, whether the FOF region R<b>3</b> exists in the flash memory <b>2</b> or not is detected (step S<b>304</b>).</p>
<p id="p-0063" num="0062">In the case where the FOF region R<b>3</b> exists in the process of step S<b>304</b>, the process of retrieving the FOF block in the FOF region R<b>3</b> is performed (step S<b>305</b>).</p>
<p id="p-0064" num="0063">In the case where the FOF region R<b>3</b> does not exist, the CPU accesses the built-in ROM <b>6</b> and operates the memory card <b>1</b> on the basis of a program stored in the built-in ROM <b>6</b>.</p>
<p id="p-0065" num="0064">The process of retrieving the selected firmware on a flash memory in <figref idref="DRAWINGS">FIGS. 4 and 6</figref> will now be described.</p>
<p id="p-0066" num="0065">The process of retrieving the selected firmware on flash memory by using the identification code of the management region K<b>3</b> will now be described with reference to the flowchart of <figref idref="DRAWINGS">FIG. 7</figref>.</p>
<p id="p-0067" num="0066">First, the CPU reads the management region K<b>3</b> from the head address of the FOF region R<b>3</b> (step S<b>401</b>) and checks the identification code in the management region K<b>3</b> (step S<b>402</b>). The CPU determines whether the identification code indicates an FOF block or not (step S<b>403</b>). If the checked identification code is a block code which does not indicate an FOF block in the process of step S<b>403</b>, the process is finished.</p>
<p id="p-0068" num="0067">If YES in step S<b>403</b>, the firmware-on-flash-memory No. in the management region K<b>3</b> is checked (step S<b>404</b>). On the basis of the firmware-on-flash-memory No., whether the FOF block in the process of step S<b>403</b> corresponds to the firmware on a flash memory or not is determined (step S<b>405</b>).</p>
<p id="p-0069" num="0068">If NO in step S<b>405</b>, the address of the FOF block is incremented (in the case of inverse-order search, the address of the FOF block is decremented) (step S<b>406</b>), and the processes in steps S<b>402</b> to S<b>405</b> are repeatedly executed.</p>
<p id="p-0070" num="0069">When the corresponding FOF block is retrieved in the process of step S<b>405</b>, the firmware on the flash memory is loaded into the built-in RAM <b>5</b> (step S<b>407</b>) and the process by the firmware is executed.</p>
<p id="p-0071" num="0070">By loading the firmware on the flash memory into the built-in RAM <b>5</b> which can be accessed at random, the CPU can execute a high-speed process.</p>
<p id="p-0072" num="0071">The case of retrieving an FOF block while limiting the search range will now be described by using the flowchart of <figref idref="DRAWINGS">FIG. 8</figref>. In this case, an address value indicative of the range of an FOF block (FOF region R<b>3</b>) is set in a parameter sector.</p>
<p id="p-0073" num="0072">First, from the parameter sector of the CIS/ID/parameter region R<b>4</b>, an FOF block search range is obtained (step S<b>501</b>).</p>
<p id="p-0074" num="0073">Whether the head address of the FOF region R<b>3</b> lies within the search range obtained from the parameter sector or not is determined (step S<b>502</b>). If NO, the process is finished.</p>
<p id="p-0075" num="0074">If YES, the management region K<b>3</b> is read (step S<b>503</b>) and the firmware-on-flash-memory No. in the management region K<b>3</b> is checked (step S<b>504</b>).</p>
<p id="p-0076" num="0075">Whether the FOF block corresponds to the firmware on a flash memory or not is determined from the checked firmware-on-flash-memory No. (step S<b>505</b>).</p>
<p id="p-0077" num="0076">If NO in step S<b>505</b>, the address of the FOF block is incremented (in the case of inverse-order search, the address of the FOF block is decremented) (step S<b>506</b>), and the processes in steps S<b>502</b> to S<b>505</b> are repeatedly executed.</p>
<p id="p-0078" num="0077">When the corresponding FOF block is retrieved in the process of step S<b>505</b>, the firmware on a flash memory is loaded into the built-in RAM <b>5</b> (step S<b>507</b>) and a process by the firmware is performed.</p>
<p id="p-0079" num="0078">According to the embodiment, therefore, by setting a plurality of firmware on flash memories into the flash memory <b>2</b>, multiple functions in the memory card <b>1</b> can be realized.</p>
<p id="p-0080" num="0079">By the plurality of pieces of firmware on flash memories, without changing a program stored in the built-in ROM <b>6</b>, a program can be easily, flexibly modified, changed, added, or the like.</p>
<p id="p-0081" num="0080">Further, in the embodiment, each of firmware FOF<b>1</b> to FOF<b>3</b> on flash memories may be a program having an option function such as a program having a security function or the like.</p>
<p id="p-0082" num="0081">Consequently, in the memory card <b>1</b>, a program in the built-in ROM <b>6</b> can be commonly used irrespective of necessity of the security function, so that the cost of product management can be largely reduced.</p>
<p id="p-0083" num="0082">Although the invention achieved by the inventor herein has been concretely described above on the basis of the embodiments of the invention, obviously, the invention is not limited to the foregoing embodiments but can be variously modified without departing from the gist.</p>
<p id="p-0084" num="0083">For example, in the embodiment, the memory card has a configuration such that a plurality of pieces of firmware on flash memories is prestored in a flash memory. Alternately, new firmware on a flash memory may be added or firmware on a flash memory may be rewritten by an updating program or the like executed by the host device.</p>
<p id="p-0085" num="0084">In the case of adding new firmware on a flash memory, for example, a spare region is provided in the FOF region in the flash memory and firmware on a flash memory to be added is stored in the spare region or firmware on a flash memory to be added is stored in another region such as a data block spare region.</p>
<p id="p-0086" num="0085">With the configuration, the invention can address to modification, change, addition, or the like of a program more flexibly.</p>
<p id="p-0087" num="0086">The flash memory in the foregoing embodiments may be a multivalue flash memory in which a plurality of threshold values of voltage levels is set and data of one bit or larger is stored in a single nonvolatile memory cell.</p>
<p id="p-0088" num="0087">Effects obtained by representative ones of the inventions disclosed in the specification will be briefly described as follows.</p>
<p id="h-0006" num="0000">(1) Multiple functions of a memory card can be realized and the invention can promptly address modification, addition, and the like of a program.</p>
<p id="h-0007" num="0000">(2) By the effect (1), the invention can provide a low-cost memory card which can flexibly follow a change in market.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A nonvolatile memory apparatus comprising:
<claim-text>a control circuit having a volatile memory; and</claim-text>
<claim-text>a nonvolatile memory including a first memory area and a second memory area,</claim-text>
<claim-text>wherein said first memory area is capable of being accessed by a host system connectable to said nonvolatile memory apparatus,</claim-text>
<claim-text>wherein said second memory area is capable of storing one or more pieces of firmware therein,</claim-text>
<claim-text>wherein said control circuit is capable of receiving a first command, which is issued from said host system, for selecting from said one or more pieces of firmware in accordance with information included said first command, and is capable of reading the selected piece of firmware from said second memory area to said volatile memory,</claim-text>
<claim-text>wherein each of said first memory area and said second memory area includes a management area,</claim-text>
<claim-text>wherein said management area of said first memory area stores first information indicating a data storing area,</claim-text>
<claim-text>wherein said management area of said second memory area stores second information indicating a firmware storing area,</claim-text>
<claim-text>wherein said control circuit further includes a second nonvolatile memory for storing first operation steps of a basic function of said nonvolatile memory apparatus, and</claim-text>
<claim-text>wherein said firmware stored in said second memory area includes second operation steps of an additional function of said nonvolatile memory apparatus.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. A nonvolatile memory apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, and which is capable of performing said additional function after reading said firmware from said second memory area to said volatile memory.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. A nonvolatile memory apparatus comprising:
<claim-text>a control circuit having a volatile memory and a first nonvolatile memory, in which a first program is stored; and</claim-text>
<claim-text>a second nonvolatile memory including a first memory area and a second memory area,</claim-text>
<claim-text>wherein said first memory area is capable of storing data,</claim-text>
<claim-text>wherein said second memory area is capable of storing one or more programs therein,</claim-text>
<claim-text>wherein said control circuit is capable of carrying out either first operation steps stored in said volatile memory or second operation steps stored in said first nonvolatile memory, is capable of reading a selection from said one or more programs stored in said second memory area to said volatile memory in accordance with an interruption, and is capable of executing the selected program read from said volatile memory.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. A nonvolatile memory apparatus according to <claim-ref idref="CLM-00003">claim 3</claim-ref>,
<claim-text>wherein said first operation steps stored in said volatile memory are for a program that has been read out from said second memory area, and</claim-text>
<claim-text>wherein said second operation steps stored in said first nonvolatile memory are for performing a basic function of said nonvolatile memory apparatus.</claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
