<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07299098-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07299098</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>10283595</doc-number>
<date>20021030</date>
</document-id>
</application-reference>
<us-application-series-code>10</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>DE</country>
<doc-number>101 53 085</doc-number>
<date>20011030</date>
</priority-claim>
</priority-claims>
<us-term-of-grant>
<us-term-extension>978</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>05</class>
<subclass>B</subclass>
<main-group>11</main-group>
<subgroup>01</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>3</main-group>
<subgroup>00</subgroup>
<symbol-position>L</symbol-position>
<classification-value>N</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>700 18</main-classification>
<further-classification>710 14</further-classification>
<further-classification>710  5</further-classification>
</classification-national>
<invention-title id="d0e71">Method and device for programming a control unit</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>4977394</doc-number>
<kind>A</kind>
<name>Manson et al.</name>
<date>19901200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>340679</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>6502265</doc-number>
<kind>B2</kind>
<name>Blair et al.</name>
<date>20030100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>  8159</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6760688</doc-number>
<kind>B2</kind>
<name>Suzuki et al.</name>
<date>20040700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>702188</main-classification></classification-national>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>6912428</doc-number>
<kind>B2</kind>
<name>Nakai et al.</name>
<date>20050600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>700 18</main-classification></classification-national>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>2002/0128729</doc-number>
<kind>A1</kind>
<name>Blair et al.</name>
<date>20020900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>700 19</main-classification></classification-national>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>2002/0161488</doc-number>
<kind>A1</kind>
<name>Guillemin et al.</name>
<date>20021000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>701  3</main-classification></classification-national>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>DE</country>
<doc-number>43 32 499</doc-number>
<date>19950300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>9</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>700 18</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>700 23</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>700 86</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>700 26</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>710 14</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>710  5</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709223</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709224</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>1</number-of-drawing-sheets>
<number-of-figures>1</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20030100980</doc-number>
<kind>A1</kind>
<date>20030529</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Gruenewald</last-name>
<first-name>Martin</first-name>
<address>
<city>Brakenheim</city>
<country>DE</country>
</address>
</addressbook>
<nationality>
<country>DE</country>
</nationality>
<residence>
<country>DE</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Aue</last-name>
<first-name>Axel</first-name>
<address>
<city>Korntal-Muenchingen</city>
<country>DE</country>
</address>
</addressbook>
<nationality>
<country>DE</country>
</nationality>
<residence>
<country>DE</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Kenyon &amp; Kenyon LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Robert Bosch GmbH</orgname>
<role>03</role>
<address>
<city>Stuggart</city>
<country>DE</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Pham</last-name>
<first-name>Thomas K.</first-name>
<department>2121</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">In a device and method for programming a control unit, the control unit is connectable to an external programming unit via a communications interface, an internal communications link connecting the communications interface to a monitoring unit, and the monitoring unit having a programming element and a communications element, a switching arrangement being provided for switching the communications link between the programming element and the communications element.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="123.11mm" wi="257.05mm" file="US07299098-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="261.03mm" wi="136.48mm" orientation="landscape" file="US07299098-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATIONS</heading>
<p id="p-0002" num="0001">The present application claims priority to Application No. 101 53 085.4, filed on Oct. 30, 2001 in the Federal Republic of Germany, which is expressly incorporated herein in its entirety by reference thereto.</p>
<heading id="h-0002" level="1">FIELD OF THE INVENTION</heading>
<p id="p-0003" num="0002">The present invention relates to a method and a device for programming a control unit, the control unit being connectable to an external programming unit via a communications interface as well as a switching arrangement having terminals for connection to a communications link.</p>
<heading id="h-0003" level="1">BACKGROUND INFORMATION</heading>
<p id="p-0004" num="0003">Because of their increasing number of functions, modern controllers and control units, in particular those in a vehicle, for example engine controllers, transmission controllers, brake controllers, etc., need ever larger memory elements, in particular flash memories, for programs and data. These memories need to be programmed during manufacturing in the factory as well as undergo end-of-line programming by vehicle manufacturers and possibly also programming in repair shops in the field. The data to be programmed is usually transmitted to the controller via a serial interface that is otherwise used to transmit diagnostic information.</p>
<p id="p-0005" num="0004">For this purpose, German Published Patent Application No. 43 32 499 describes a method for programming a memory in a control unit. According to this method, the data to be programmed is transmitted from an external electronic device, for example a personal computer, to the control unit. The serial interface used to transmit the data to be programmed is the existing serial diagnostic interface connecting the external electronic device to the control unit. The limited transmission rates achievable in this case, a maximum of 250 kbaud, result in ever longer transmission times, for example around 320 seconds for 8 MB.</p>
<p id="p-0006" num="0005">It is an object of the present invention to shorten transmission times during programming while keeping costs low.</p>
<p id="p-0007" num="0006">In recent years, the practice of networking controllers, sensors, and actuators using a communications system or bus system has increased dramatically in the manufacture of modern motor vehicles as well as the construction of machines, particularly in the machine-tool segment and in automation. It is therefore possible to utilize synergy effects by distributing functions among multiple controllers. This arrangement involves distributed systems or a controller network. Communication between different stations increasingly takes place via a bus or a bus system. Communications traffic on the bus system—access and receiving mechanisms—are controlled by a protocol.</p>
<p id="p-0008" num="0007">A protocol that has been widely accepted in automotive applications is CAN (controller area network). It is an event-controlled protocol, i.e., protocol activities such as transmitting messages are initiated by events originating outside the communications system. Clear access to the communications system, i.e., bus system, is triggered by priority-based bit arbitration. To do this, each message must be assigned a clear priority. The CAN protocol is extremely flexible in that it allows additional nodes and messages to be added without problems.</p>
<heading id="h-0004" level="1">SUMMARY</heading>
<p id="p-0009" num="0008">The above and other beneficial objects of the present invention are achieved by providing a method, a device and a switching arrangement as described herein.</p>
<p id="p-0010" num="0009">To achieve shortened transmission times during programming while keeping costs low, a device and a method for programming a control unit are described, the control unit being connectable to an external programming unit via a communications interface, an internal communications link connecting the communications interface to a control unit, and the control unit having a programming element and a communications element.</p>
<p id="p-0011" num="0010">A switching arrangement may be provided and used to switch the communications link between the programming element and the communications element so that both programming and communication of the control unit occur via the same communications interface.</p>
<p id="p-0012" num="0011">Today's controllers, in particular engine controllers, have at least one bus interface for communicating with other control units or sensors and/or actuators. The CAN (controller area network) bus serves as an example of a bus interface of this type, i.e., a corresponding communications link. When programming the memory, in particular the flash memory, a CAN link may be used, according to the present invention, for programming instead of for its actual purpose of communication.</p>
<p id="p-0013" num="0012">A CAN system of this type in the control unit includes a communications link, i.e., the CAN transmission lines, a communications element, i.e., the CAN controller, a communications interface from the control unit to the outside and a driver block or driver element, i.e., a CAN driver in the special situation of a controller area network. However, only the CAN interface driver included in the control unit, the corresponding CAN line, i.e., the communications link, and the external CAN communications interface are used for programming.</p>
<p id="p-0014" num="0013">The exemplary use of a CAN bus system as a communications system of the control unit should not be viewed as a restriction in the context of the present invention. According to the present invention, a different bus system, for example a TTCAN or other system, may be used for controller communication and thus for achieving the object of the present invention.</p>
<p id="p-0015" num="0014">A switching arrangement that switches between the communications element and a programming element, for example, a serial interface chip, is provided in the communications link. In this case, the data is suitably transmitted via the communications link in communications mode, using a first protocol—a communications protocol, in particular a CAN protocol—while a second bus protocol, in particular an ordinary standard protocol of a serial interface, is used for programming after the switching arrangement has switched the communications link to the programming element.</p>
<p id="p-0016" num="0015">The control unit includes a monitoring unit or processing unit, in particular a microprocessor, which includes the programming element and the communications element, the monitoring unit being suitably configured so that internal program-based reconfiguration operations at the terminals of its internal communications element, in particular the CAN controller, may be used to optionally switch to the terminals of its internal programming element, in particular the internal serial interface.</p>
<p id="p-0017" num="0016">In addition to the programming element and the communications element, the switching arrangement may also be integrated into the monitoring unit according to an exemplary embodiment.</p>
<p id="p-0018" num="0017">The communications link, communications interface, and driver element provided in the control unit for communication between the control unit and the vehicle controller network may thus be simultaneously used for programming the control unit, thereby avoiding the added expense of providing additional components.</p>
<p id="p-0019" num="0018">The serial interface unit, i.e., the programming element, is generally included in the monitoring unit, once again avoiding added costs. The internal switching arrangement, for example, a multiplexer for switching the interfaces, is implemented in a manner that may only slightly increase the complexity of the functional range of the monitoring unit, i.e., the microprocessor chip, so that almost no additional expense is incurred. This may achieve a very simple, economical capability, which supports a much higher transmission rate and thus significantly shortens transmission times when programming the control units.</p>
<p id="p-0020" num="0019">Significant advantages, particularly in relation to the transmission rate and the shorter transmission times, may also be achieved by having an external switching arrangement perform the switching operation outside the monitoring unit.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0005" level="1">BRIEF DESCRIPTION OF THE DRAWING</heading>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 1</figref> is a schematic view of a controller, in particular in a vehicle, which includes a CAN communications link along with all the necessary components and elements, and also a switching arrangement for switching to a programming element.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0006" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0022" num="0021">Because practically all modern engine controllers today have one or more CAN interfaces, they may be used, contrary to their actual purpose, to transmit data during flash programming. However, only a CAN interface driver included in the controller and the corresponding external lines are used for this purpose. The microprocessor used in the controller is configured so that a processor-internal, program-based reconfiguration operation at the input/output pins, i.e., terminals, of an internal CAN controller may also be used to optionally switch the input/output pins, i.e., terminals, of an internal serial interface.</p>
<p id="p-0023" num="0022">Important advantages (with the exception of the general cost neutrality) are also achieved by using additional switching elements for switching outside the microprocessor.</p>
<p id="p-0024" num="0023">For this purpose, <figref idref="DRAWINGS">FIG. 1</figref> illustrates a controller, i.e., a control unit <b>100</b>, and a programming device, i.e., a programming unit <b>101</b>. The controller has an external communications interface <b>110</b> that internally connects a communications link <b>104</b> to lines TX and RX. A driver element, in particular a CAN driver <b>102</b> that makes it possible to connect to communications interface <b>110</b> bidirectionally and at a required level is connected in this communications link <b>104</b>, i.e., the two lines TX and RX. The external lines, i.e., external communications link <b>104</b><i>a</i>, are identified by CH and CL for the CAN example, i.e., CAN High and CAN Low. Programming device <b>101</b> is connectable to control unit <b>100</b> via this external communications link <b>104</b><i>a. </i></p>
<p id="p-0025" num="0024">Control unit <b>100</b>, i.e., the controller, includes a monitoring unit <b>103</b>, in particular a microprocessor, microcomputer, or similar device, etc. The latter includes a communications unit, i.e., a communications element <b>107</b>, which in this example corresponds to a CAN controller. Microprocessor <b>103</b> also includes a programming element <b>108</b>, in particular a serial interface chip (e.g., an asynchronous serial communications interface, ASC) to transmit and receive data for programming memory <b>109</b>, which is, in particular, also integrated into the microprocessor. The memory may also be located outside monitoring unit <b>103</b> and may be configured as a flash memory.</p>
<p id="p-0026" num="0025">According to the present invention, a switching arrangement <b>105</b>, in particular a program-controlled interface switch or even a multiplexer, is provided for switching the communications link from communications element <b>107</b> to programming element <b>108</b>. An interface switch of this type may be provided inside or outside the microprocessor, i.e., monitoring unit <b>103</b>.</p>
<p id="p-0027" num="0026">For this purpose, communications element <b>107</b> is connected to switching arrangement <b>105</b> via a link section <b>104</b><i>b</i>. Lines TX<b>0</b> and RX<b>0</b> of <b>104</b><i>b </i>are connected to terminals ATX<b>0</b> and ARX<b>0</b>. Programming chip <b>108</b> is also connected to switching arrangement <b>105</b> via a link section <b>106</b>. For this purpose, lines TX<b>1</b> and RX<b>1</b> of <b>106</b> are connected to terminals ATX<b>1</b> and ARX<b>1</b>. In the direction of driver element <b>102</b>, lines TX and RX of communications link <b>104</b> are contacted to switching arrangement <b>105</b> via terminals ATX and ARX.</p>
<p id="p-0028" num="0027">During normal communication, in particular in the vehicle controller network, the link is established from CAN controller <b>107</b> via communications link section <b>104</b><i>b</i>, interface switch <b>105</b> and communications link <b>104</b> to CAN driver <b>102</b> and CAN interface <b>110</b>, and data is transmitted as usual by CAN communication. As a result, a first bus protocol, in particular the CAN bus protocol, is used in this case.</p>
<p id="p-0029" num="0028">To program the control unit, control unit <b>100</b> is connected to programming device <b>101</b> via <b>104</b><i>a</i>. Interface switch <b>105</b> then contacts the link to element <b>108</b> via link section <b>106</b>. Communications interface <b>110</b>, CAN driver <b>102</b>, and communications link <b>104</b> to the microprocessor may thus also be used for programming purposes. According to the present invention, however, a second bus protocol is used for programming, in particular, a standard protocol of a serial interface such as RS232, etc.</p>
<p id="p-0030" num="0029">As a result, the data for programming flash chips in a controller is sent via a fast driver for a standard CAN interface instead of via a slow driver for a standard serial ASC interface. However, the standard serial protocol, for example, may continue to be used. To make this possible, the processor may internally switch the lines of its serial ASC interface to the lines of the CAN interface. Another advantage of this arrangement may be that the CAN driver block, which is located outside the CPU, i.e., microprocessor <b>103</b>, is provided in controller <b>100</b> and has no other functions to perform during controller programming, may be used for this purpose, thus avoiding the expense of additional hardware.</p>
<p id="p-0031" num="0030">The processor pins, i.e., ATX and ARX, which lead to external CAN driver <b>102</b>, are therefore optionally connected to the processor-internal ASC (<b>108</b>) or CAN (<b>107</b>) units. The data transmission rates thus achievable are many times higher than those of conventional serial interface drivers. Data rates of, for example, 1 Mbaud are therefore possible in normal CAN mode. This alone boosts the speed by a factor of 4. As a result, the CAN protocol may be used for programming as well. If the CAN protocol is not implemented via the CAN driver, but rather a normal serial protocol, and if short line lengths, i.e., line capacities, compared to the vehicle CAN network, are used for programming, much higher transmission rates are still also achievable, for example, up to 8 Mbaud, i.e., with different protocols for communication and programming. For example, the transmission time for 8 MB of data is thus reduced from 320 seconds to 10 seconds.</p>
<p id="p-0032" num="0031">Shortening the transmission times in this example by a factor of 32 may reduce the outlay, i.e., time, cost, and number of programming stations, whenever larger numbers of controllers are programmed. The controllers may not have to be opened for programming, since the necessary connector pins remain accessible from the outside even when the housing is closed.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A device for programming a control unit connectable to an external programming unit via a communications interface, comprising:
<claim-text>a monitoring unit including a programming element and a communications element;</claim-text>
<claim-text>an internal communications link configured to connect the communications interface to the monitoring unit; and</claim-text>
<claim-text>a switching arrangement configured to switch the communications link between the programming element and the communications element.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the communications link includes a single driver element arranged between the communications interface and the switching arrangement.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the communications link includes a CAN link having a CAN driver circuit connected between the communications interface and the monitoring unit in the communications link.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>a first arrangement configured to transmit data via the communications link between the communications interface and the communications element in accordance with a first bus protocol; and</claim-text>
<claim-text>a second arrangement configured to transmit data in accordance with a second bus protocol when the communications link switches to the programming element.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The device according to <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the first bus protocol includes a CAN protocol.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the switching arrangement, the programming element and the communications element are integrated into the monitoring unit.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the programming element and the communications element are integrated into the monitoring unit, the switching arrangement arranged outside the monitoring unit.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. A switching arrangement, comprising:
<claim-text>first terminals configured to connect to a communications link, the switching arrangement insertable into the communications link such that the first terminals are provided to connect to a communications interface;</claim-text>
<claim-text>second terminals configured to connect to a communications element; and</claim-text>
<claim-text>third terminals configured to connect to a programming element.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. A method of programming a control unit, including a communications link, a programming element, and a communications element, comprising:
<claim-text>transmitting data for communication with a first bus protocol to and from the communications element via the communications link; and</claim-text>
<claim-text>transmitting data for programming via a second bus protocol over the same communications link; and</claim-text>
<claim-text>switching from the communications element to the programming element.</claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
