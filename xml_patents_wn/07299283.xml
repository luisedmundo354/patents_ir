<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07299283-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07299283</doc-number>
<kind>B1</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>11478960</doc-number>
<date>20060627</date>
</document-id>
</application-reference>
<us-application-series-code>11</us-application-series-code>
<us-term-of-grant>
<disclaimer>
<text>This patent is subject to a terminal disclaimer.</text>
</disclaimer>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>15</main-group>
<subgroup>16</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>709224</main-classification>
</classification-national>
<invention-title id="d0e51">Apparatus for size-dependent sampling for managing a data network</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5197002</doc-number>
<kind>A</kind>
<name>Spencer</name>
<date>19930300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>705 34</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>6061331</doc-number>
<kind>A</kind>
<name>Conway et al.</name>
<date>20000500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6119109</doc-number>
<kind>A</kind>
<name>Muratani et al.</name>
<date>20000900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>6330008</doc-number>
<kind>B1</kind>
<name>Razdow et al.</name>
<date>20011200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>715772</main-classification></classification-national>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>6347224</doc-number>
<kind>B1</kind>
<name>Smyth et al.</name>
<date>20020200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>6360261</doc-number>
<kind>B1</kind>
<name>Boyd et al.</name>
<date>20020300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>6421435</doc-number>
<kind>B1</kind>
<name>Bastien et al.</name>
<date>20020700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>6725263</doc-number>
<kind>B1</kind>
<name>Torres</name>
<date>20040400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709223</main-classification></classification-national>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>6735553</doc-number>
<kind>B1</kind>
<name>Frogner et al.</name>
<date>20040500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>6738349</doc-number>
<kind>B1</kind>
<name>Cen</name>
<date>20040500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>6775267</doc-number>
<kind>B1</kind>
<name>Kung et al.</name>
<date>20040800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>6823225</doc-number>
<kind>B1</kind>
<name>Sass</name>
<date>20041100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>700 94</main-classification></classification-national>
</citation>
<citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>6920112</doc-number>
<kind>B1</kind>
<name>McCloghrie et al.</name>
<date>20050700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>6947723</doc-number>
<kind>B1</kind>
<name>Gurnani et al.</name>
<date>20050900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>2002/0165958</doc-number>
<kind>A1</kind>
<name>Duffield et al.</name>
<date>20021100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00016">
<othercit>Claffy, Kimberly C., et al., “Application of Sampling Methodologies to Network Traffic.Characterization”, Association for Computing Machinery SIGCOMM '93, Sep. 1993, vol. 9, pp. 194-203.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>9</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>709224</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709206</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>705 30</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>13</number-of-drawing-sheets>
<number-of-figures>13</number-of-figures>
</figures>
<us-related-documents>
<continuation>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>10056683</doc-number>
<kind>00</kind>
<date>20020124</date>
</document-id>
<parent-grant-document>
<document-id>
<country>US</country>
<doc-number>7080136</doc-number>
<kind>A </kind>
</document-id>
</parent-grant-document>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>11478960</doc-number>
</document-id>
</child-doc>
</relation>
</continuation>
<us-provisional-application>
<document-id>
<country>US</country>
<doc-number>60277123</doc-number>
<kind>00</kind>
<date>20010318</date>
</document-id>
</us-provisional-application>
<us-provisional-application>
<document-id>
<country>US</country>
<doc-number>60300587</doc-number>
<kind>00</kind>
<date>20010622</date>
</document-id>
</us-provisional-application>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Duffield</last-name>
<first-name>Nicholas G.</first-name>
<address>
<city>New York</city>
<state>NY</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Lund</last-name>
<first-name>Carsten</first-name>
<address>
<city>Berkeley Heights</city>
<state>NJ</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="003" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Thorup</last-name>
<first-name>Mikkel</first-name>
<address>
<city>Florence</city>
<state>MA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
</applicants>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>AT&amp;T Corp.</orgname>
<role>02</role>
<address>
<city>New York</city>
<state>NY</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Eng</last-name>
<first-name>David Y.</first-name>
<department>2155</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">The present invention provides apparatus for sampling data flows in a data network in order to estimate a total data volume in the network. Sampling the data flows in the data network reduces the network resources that must be expended by the network to support the associated activity. The present invention enables the service provider of the data network to control sampled volumes in relation to the desired accuracy. The control can be either static or can be dynamic for cases in which the data volumes are changing as a function of time.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="177.29mm" wi="98.47mm" file="US07299283-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="126.15mm" wi="136.14mm" file="US07299283-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="139.53mm" wi="144.44mm" file="US07299283-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="110.57mm" wi="131.83mm" file="US07299283-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="126.15mm" wi="144.44mm" file="US07299283-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="114.72mm" wi="138.94mm" file="US07299283-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="119.63mm" wi="143.93mm" file="US07299283-20071120-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="177.88mm" wi="99.06mm" file="US07299283-20071120-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="121.16mm" wi="151.89mm" file="US07299283-20071120-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="121.58mm" wi="142.07mm" file="US07299283-20071120-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="204.47mm" wi="132.08mm" file="US07299283-20071120-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="164.93mm" wi="124.88mm" file="US07299283-20071120-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="183.05mm" wi="145.54mm" file="US07299283-20071120-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="173.65mm" wi="124.80mm" file="US07299283-20071120-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<p id="p-0002" num="0001">This application is a continuation of prior application Ser. No. 10/056,683, filed Jan. 24, 2002 now U.S. Pat. No. 7,080,136, which claims priority to provisional U.S. Application No. 60/277,123 (“Control Of Volume And Variance In Network Management”), filed Mar. 18, 2001 and provisional U.S. Application No. 60/300,587 (“Charging from Sampled Network Usage”), filed Jun. 22, 2001. Each of the above cited applications is herein incorporated by reference in its entirety.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">FIELD OF THE INVENTION</heading>
<p id="p-0003" num="0002">The present invention provides apparatus for sampling data flows in a data network.</p>
<heading id="h-0002" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0004" num="0003">Service providers of data networks are increasingly employing usage measurements as a component in customer charges. One motivation stems from the coarse granularity in the available sizes of access ports into the network. For example, in the sequence of optical carrier transmission facilities OC-3 to OC-12 to OC-48 to OC-192, each port has a factor 4 greater capacity than the next smallest. Consider a customer charged only according to the access port size. If customer's demand is at the upper end of the capacity of its current port, the customer will experience a sharp increase in charges on moving to the next size up. Moreover, much of the additional resources will not be used, at least initially. Usage based charging can avoid such sharp increases by charging customers for the bandwidth resources that they consume. Another motivation for usage-based charging stems from the fact that in IP networks the bandwidth beyond the access point is typically a shared resource. Customers who are aware of the charges incurred by bandwidth usage have a greater incentive to moderate that usage. Thus, charging can act as a feedback mechanism that discourages customers from attempting to fill the network with their own traffic to the detriment of other customers. Finally, differentiated service quality requires correspondingly differentiated charges. In particular, it is expected that premium services will be charged on a per use basis, even if best effort services remain on a flat (i.e. usage insensitive) fee.</p>
<p id="p-0005" num="0004">In order to manage a date network, the service provider typically determines customer usage at routers and other network elements in order to properly bill the customer. One approach is to maintain byte or packet counters at a customer's access port(s). Such counters are currently very coarsely grained, giving aggregate counts in each direction across an interface over periods of a few minutes. However, even separate counters differentiated by service quality would not suffice for all charging schemes. This is because service quality may not be the sole determinant of customer charges. These could also depend, for example, on the remote (i.e. non-customer) IP address involved. This illustrates a broader point that the determinants of a charging scheme may be both numerous and also relatively dynamic. This observation may preclude using counts arising from a set of traffic filters, due to the requirement to have potentially a large number of such filters, and the administrative cost of configuring or reconfiguring such filters.</p>
<p id="p-0006" num="0005">A complementary approach is to measure (or at least summarize) all traffic, and then transmit the measurements to a back-office system for interpretation according to the charging policy. In principle, this could be done by gathering packet headers, or by forming flow statistics. An IP flow is a sequence of IP packets that shares a common property, as source or destination IP address or port number or combinations thereof. A flow may be terminated by a timeout criterion, so that the interpacket time within the flow does not exceed some threshold, or a protocol-based criterion, e.g., by TCP FIN packet. Flow collection schemes have been developed in research environments and have been the subject of standardization efforts. Cisco NetFlow is an operating system feature for the collection and export of flow statistics. These include the identifying property of the flow, its start and end time, the number of packets in the flow, and the total number of bytes of all packets in the flow.</p>
<p id="p-0007" num="0006">The service provider of a data network also typically collects data regarding data usage over the data network as well as parts of the data network. The collection of network usage data is essential for the engineering and management of communications networks. Until recently, the usage data provided by network elements has been coarse-grained, typically comprising aggregate byte and packet counts in each direction at a given interface, aggregated over time windows of a few minutes. However, these data are no longer sufficient to engineer and manage networks that are moving beyond the undifferentiated service model of the best-effort Internet. Network operators need more finely differentiated information on the usage of their network. Examples of such information include (i) the relative volumes of traffic using different protocols or applications; (ii) traffic matrices, i.e., the volumes of traffic originating from and/or destined to given ranges of Internet Protocol (IP) addresses or Autonomous Systems (AS); (iii) the time series of packet arrivals together with their IP headers; (iv) the durations of dial-user sessions at modem banks. Such information can be used to support traffic engineering, network planning, peering policy, customer acquisition, marketing and network security. An important application of traffic matrix estimation is to efficiently redirect traffic from overloaded links. Using this to tune OSPF/IS-IS routing one can typically accommodate 50% more demand.</p>
<p id="p-0008" num="0007">Concomitant with the increase in detail in the information to be gathered is an increase in its traffic volume. This is most noticeable for traffic data gathered passively, either by packet monitors gathering IP packet header traces or IP flow statistics. As an example, a single OC-48 at full utilization may yield as much as 70 GB of IP packet headers or 3 GB of flow statistics per hour. The volume of data exported for further analysis may be potentially decreased at the measurement point through either filtering or aggregation. Neither of these approaches may be appropriate for all purposes. Filtering allows us to restrict attention to a particular subset of data, e.g., all traffic to or from a pre-determined range of IP addresses of interest. However, not all questions can be answered in such a manner. For example, in determining the most popular destination web site for traffic on a given link, one generally does not know in advance which address or address ranges to look for. On the other hand, aggregation and other forms of analysis at the measurement site have two disadvantages. First, the time-scale to implement and modify such features in network elements are very long, typically a small number of years. Second, the absence of raw measured data would limit exploratory studies of network traffic.</p>
<p id="p-0009" num="0008">With increasing data usage that is driven for the explosive demand for data services, a data network must support greater data traffic. Consequently, the data network must generate more data and associated messaging for managing the data network. A method that ameliorates the generation of management-related messaging and data while preserving the capabilities of managing the data network is therefore of great benefit to the industry.</p>
<heading id="h-0003" level="1">BRIEF SUMMARY OF THE INVENTION</heading>
<p id="p-0010" num="0009">The present invention provides apparatus for sampling data flows in a data network in order to estimate a total data volume in the data network. Sampling the data flows in the data network reduces the network resources that must be expended by the network in order to support the associated activities. The present invention enables the service provider of the data network to control sampling volumes in relation to the desired accuracy. (In the disclosure “sampling volume” is defined as a number of objects selected as the result of sampling, e.g. during a sampling window. It may be a pure number, or may be expressed as a rate, i.e. number of objects per unit time.) The control can be either static or can be dynamic for cases in which the data volumes are changing as a function of time. Moreover, the present invention is not dependent upon the underlying statistical characteristics of the data flows.</p>
<p id="p-0011" num="0010">The disclosure presents an exemplary embodiment with two variations. The exemplary embodiment comprises a data network with a network of routers and dedicated hosts for managing the data network. The first variation enables the service provider to charge a customer for usage of a data network. The method utilizes the sampling of flows that are associated with the customer. The contribution to the usage by a sampled flow is normalized by a number that reflects the probability of sampling. The usage can be adjusted by the service provider in order to compensate for a possibility of overcharging. In addition, the method enables the service provider to adjust the sampling rate and the billing period to reduce undercharging in accordance with the goals of the service provider. The second variation enables the service provider to manage a data network in accordance with the measured traffic volume. The service provider can adjust the sampling volume in accordance with the measured sampling volume and with the desired accuracy for both static and dynamic situations.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 1</figref> illustrates a data network utilizing size-dependent sampling, in accordance with the present invention;</p>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 2</figref> shows a sampling probability function;</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. 3</figref> shows a complementary cumulative distribution (CCDF) of flow byte sizes;</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 4</figref> shows a complementary cumulative distribution (CCDF) of bytes per customer-side IP addresses;</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 5</figref> shows an example of weighted mean relative error vs. an effective sampling period;</p>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 6</figref> shows an example of weighted mean relative error vs. an effective sampling period for different flow sizes;</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 7</figref> is a flow diagram for charging with sampled network usage;</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 8</figref> shows an example of traffic flow volumes in a data network;</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 9</figref> shows static and dynamic controlled sampling volumes in relation to <figref idref="DRAWINGS">FIG. 8</figref>;</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 10</figref> is a flow diagram for controlling the sampling volume in a data network;</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 11</figref> is a flow diagram for a quasi-random data sampling algorithm;</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 12</figref> is a flow diagram for root finding algorithm; and</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 13</figref> shows an apparatus for managing a data network in accordance with the present invention.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DETAILED DESCRIPTION OF THE INVENTION</heading>
<p id="p-0025" num="0024">One limitation to comprehensive direct measurement of traffic stems from the immense amounts of measurement data generated. For example, a single optical carrier transmission facility OC-48 at full utilization could generate about 100 GB of packet headers, or several GB of (raw) flow statistics each hour. The demands on computational resources at the measurement point, transmission bandwidth for measured data, and back-end systems for storage and analysis of data, all increase costs for the service provider.</p>
<p id="p-0026" num="0025">A common approach to dealing with large data volumes is to sample. A common objection to sampling has been the potential for inaccuracy; customers can be expected to be resistant to being overcharged due to overestimation of the resources that they use.</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 1</figref> illustrates data network <b>100</b> that utilizes size-dependent sampling in accordance with the present invention. In the exemplary embodiment of the invention, data network <b>100</b> supports Internet Protocol (IP) messaging for the users (customers) of host <b>107</b>, <b>109</b>, <b>111</b>, <b>113</b>, <b>115</b>, <b>117</b>, and <b>119</b>. (However, variations of the embodiment can support other data protocols.) A host includes PCs, workstations, mainframes, file servers, and other types of computers. Hosts <b>107</b>, <b>109</b>, and <b>111</b> are configured on data link <b>121</b>; hosts <b>113</b> and <b>115</b> are on data link <b>123</b>; and hosts <b>117</b> and <b>119</b> are configured on data link <b>125</b>. In order for a host (e.g. host <b>111</b>) to communicate to another host (e.g. host <b>119</b>) on a different data link, IP messaging is routed through routers <b>101</b>, <b>103</b>, and <b>105</b> and data links <b>151</b>, <b>153</b>, and <b>155</b>. A router forwards packets between hosts and other routers in order to enable hosts not connected to the same link to communicate. Each router has a port (e.g. <b>127</b>, <b>129</b>, and <b>131</b> for router <b>101</b> that connects to a data link. Similarly, ports <b>133</b>, <b>135</b>, and <b>137</b> correspond to router <b>103</b>, and ports <b>137</b>, <b>139</b>, and <b>141</b> correspond to router <b>105</b>.</p>
<p id="p-0028" num="0027">In the exemplary embodiment, host <b>113</b> supports the billing (charging) of customers and host <b>115</b> supports the collection and the utilization of data traffic information regarding data transmission for data network <b>100</b>. Hosts <b>107</b>, <b>109</b>, <b>111</b>, <b>117</b>, and <b>119</b> correspond to users who are the customers for the service provider operating data network <b>100</b>. Managing functions that are associated with the billing of customers and the traffic management support the collection of relevant information for the management of data network <b>100</b>. (In the disclosure, “managing a network” denotes the determination of one or more characteristics of the configuration, state, and/or usage of the network and its management subsystems. The characteristics are then reported for subsequent activities such as billing or marketing, and/or using them to assist reconfigure and/or reengineer the network and its management subsystems.) Host <b>113</b> collects information from routers <b>101</b>, <b>103</b>, and <b>105</b> about customer usage. Host <b>115</b> collects information about data traffic over the data links. With a typical data network, many flows are transported over the data network. Generating management-related messages to hosts <b>113</b> and <b>115</b> can be very detrimental to the performance of data network <b>100</b> if the number of messages is large. Thus, sampling is supported by data network <b>100</b> in order to reduce the number of management-related messages to reduce any associated performance degradations.</p>
<p id="p-0029" num="0028">With alternative embodiments, a router (e.g. <b>101</b>, <b>103</b>, and <b>105</b>) collects information about data traffic over data links through the router. Utilizing the information, the router can adjust its configuration for the current data traffic.</p>
<p id="p-0030" num="0029">The present invention provides a sampling mechanism that specifically addresses concerns of sampling error. Total customer usage is the sum of a number of components, some large, some small. Sampling errors arise predominantly from omission of the larger components, whereas accuracy is less sensitive to omission of the smaller components. For example, consider a simple sampling scheme in which one estimates the total bytes of usage by sampling 1 in every N flows, and then adds together N times the total bytes reported in each sampled flow. The underlying distribution of flow bytes sizes has been found to follow a heavy tailed distribution. In this case, the estimate can be extremely sensitive to the omission or inclusion of the larger flows. Generally, such an estimator can have high variance due to the sampling procedure itself. (In the disclosure, the term “flow” is used synonymously with the term “object.”)</p>
<p id="p-0031" num="0030">The present invention does not require any knowledge of the underlying statistical information of the data traffic for data network <b>100</b>. For example, the associated probability relating to the size of a flow can assume any form, including a heavy-tailed probability distribution. A flow (object) comprises at least one unit of data (e.g. packet, byte, octet, and ATM cell).</p>
<p id="p-0032" num="0031">Additionally, the present invention reduces sampling volumes for data network <b>100</b>. A heavy-tailed distribution of flow sizes can be turned to an advantage for sampling provided an appropriate sampling algorithm is used. The present invention utilizes size-dependent sampling, in which an object of size x is selected with some size dependent probability p(x). The probability p(x) is 1 for large x. In the case of flows, all sufficiently large flows will always be selected; there is no sampling error for such flows. On the other hand one can have p(x)&lt;1 for smaller flows; this reduces the number of samples, but the error involved is small since the underlying flows are small. To estimate the total bytes represented in the original set of flows, one sums the quantities x/p(x) over only the sampled flows. Applying the renormalization factor 1/p(x) to the small flows compensates for the fact that that might have been omitted. In fact, it can be shown that this sum is an unbiased estimator of the actual total bytes (i.e. its average value over all possible random samplings is equal to the actual total bytes. Moreover, uniform sampling is a special case of this scheme with p(x) constant and equal to 1/N.)</p>
<p id="p-0033" num="0032">With the exemplary embodiment of the invention (as shown as data network <b>100</b> in <figref idref="DRAWINGS">FIG. 1</figref>), routers <b>101</b>, <b>103</b>, and <b>105</b> sample objects (flows). Consequently, routers <b>101</b>, <b>103</b>, and <b>105</b> send messages (“samples”) to host <b>113</b> (corresponding to charging the customer for usage) and to host <b>115</b> (corresponding to determining traffic volume) comprising attributes of the sampled object (e.g. the customer's identification) and the size of the object. Alternative embodiments may store corresponding data at routers <b>101</b>, <b>103</b>, and <b>105</b> for later processing or may utilize intervening processors between routers <b>101</b>, <b>103</b>, and <b>105</b>.</p>
<p id="p-0034" num="0033">Size-dependent sampling has a number of advantages. First, the sampling probabilities p(x) can be chosen to satisfy a certain optimality criterion for estimator variance as described later. Second, a simple adaptive scheme allows dynamic tuning of p(x) in order to keep the total number of samples within a given bound. Thus, in the context of flow measurement, the number of flow statistics that are transmitted to the back-end system (host <b>113</b> and host <b>115</b>) can be controlled by the service provider. Third, on binding the sampling parameters (i.e. p(x)) to the data x in constructing the rescaled size x/p(x), the need to keep independent track of p(x) (or even the original flow sizes x) is obviated. Thus, p(x) can vary at different times and across different regions of the network (as needed), but estimation remains unbiased. Fourth, sampling is composable in the sense that the first three properties above are preserved under successive resampling. Thus, one could progressively resample at different points in the measurement system in order to limit sample volumes. Also, size-dependent sampling is applicable to packet sampling as well. However, one expects the performance benefit over 1 in N sampling to be smaller in this case, since packet sizes do not have a heavy-tailed distribution.</p>
<p id="p-0035" num="0034">The present invention utilizes an approach to usage-sensitive charging that mirrors the foregoing approach to sampling. The sampling scheme determines the size of the larger flows with no error. Estimation error arises entirely from sampling smaller flows. For billing purposes we wish to measure the total bytes for each billed entity (e.g. for each customer at a given service level) over each billing cycle. Larger totals have a smaller associated sampling error, whereas estimation of total bytes for the smallest customers may be subject to greater error. Therefore, the service provider sets a level L on the total bytes, with a fixed charge for all usage up to L, then a usage sensitive charge for all usage above L. Thus, the service provider only needs to tune the sampling scheme for estimating the usage above L within the desired accuracy.</p>
<p id="p-0036" num="0035">Moreover, the potentially massive volumes of data to be gathered have important consequences for resource usage at each stage in the chain leading from data collection to data analysis. First, computational resources on network elements are scarce, and hence measurement functions may need to be de-prioritized in favor of basic packet forwarding and routing operations, particularly under heavy loads. Second, the transmission of raw measurement data to collection points can consume significant amounts of network bandwidth. Third, sophisticated and costly computing platforms are required for the storage and analysis of large volume of raw measurement data.</p>
<p id="p-0037" num="0036">The present invention utilizes sampling as a means to reduce data volume while at the same time obtaining a representative view of the raw data. An elementary way to do this is to sample 1 in N raw data objects, either independently (i.e. each object is selected independently with probability 1/N) or deterministically (objects N, <b>2</b>N, <b>3</b>N, . . . are selected and all others are discarded). Only those selected objects are used further for analysis. This sampling strategy clearly reduces the load associated with the subsequent transmission, storage, and analysis of the data by a factor N.</p>
<p id="p-0038" num="0037">However, besides the ability to reduce data volumes, the statistical properties of any proposed sampling scheme must be evaluated. The sampling parameters (N in the above example) need to be bounded to the sampled data in order that extensive properties of the original data stream can be estimated. For example, to estimate the bytes rate in a raw packet stream from samples gathered through 1 in N sampling, one needs to multiply the byte rate of the sampled stream by N. Under a given constraint on resources available for measurement transmission or processing of data, N may vary both temporally and spatially according to traffic volumes. Hence, N is not typically a global variable independent of the raw data.</p>
<p id="p-0039" num="0038">Although one expects random sampling to yield unbiased estimates of properties of the typical raw data objects, there may be a significant impact of the variance of such estimates. A striking feature of flow statistics is that the distributions of the number of packet and bytes in flows are heavy-tailed. Consider the problem of reducing reported flow export volumes by sampling 1 in every N flow statistics. Sampling from heavy tailed distributions is particularly problematic, since the inclusion or exclusion of a small number of data points can lead to large changes in estimates of the mean. This has the consequence that estimates of the total byte rates on a link using a subset of flows selected by 1 in N sampling can be subject to high variance due to the sampling procedure itself. A sampling strategy that samples all big flows and a sufficient fraction of the smaller flows may reduce the estimator variance.</p>
<p id="p-0040" num="0039">The basis of the sampling scheme is that sufficiently large objects (that may comprise packets or asynchronous transfer mode cells) are always sampled, while smaller objects are sampled with progressively smaller probability. A set of objects (flows) are labeled by i=1, 2, . . . , n corresponding to summaries generated by measurements in the network during some time period. Let x<sub>i </sub>be the size attribute of interest from the flow i, e.g., the number of packets in the flow, or the total number of bytes in the flow, or any other positive quantity of interest. Each packet in a flow possesses a common attribute, such as IP address (or net), port number, or Type of Service (ToS) field. Each combination of interest corresponds to attributes as referred by a “color”; c<sub>i </sub>will be the color of flow i. In the context of billing, a color might correspond to a customer address, or this plus a remote network, and possibly a ToS specification. The mapping that associates a particular customer with a set of packet attributes may be relatively complex. This to be performed by the subsystem that collects and interprets the measurements (e.g. hosts <b>113</b> and <b>115</b> in the exemplary embodiment). The objective is to estimate the totals for each color c of interest as follows.</p>
<p id="p-0041" num="0040">
<maths id="MATH-US-00001" num="00001">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mi>x</mi>
          <mo>⁡</mo>
          <mrow>
            <mo>(</mo>
            <mi>c</mi>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>=</mo>
        <mrow>
          <munder>
            <mo>∑</mo>
            <mi>c</mi>
          </munder>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.3em" height="0.3ex"/>
          </mstyle>
          <mo>⁢</mo>
          <msub>
            <mi>x</mi>
            <mi>i</mi>
          </msub>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>1</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0042" num="0041">The present invention supports the sampling of raw packet headers, the set of flow statistics formed from the sampled packets, the stream of flow statistics at some intermediate aggregation point, and the set of aggregate flows at the collection point. The knowledge of the number n of original objects in not required. Furthermore, sampling itself need not make reference to the object color c. This reflects the fact that the colors of interest may not be known at the time of sampling and that it is infeasible to simply accumulate sizes from the original stream for all possible colors.</p>
<p id="p-0043" num="0042">For each positive number z, one defines the sampling probability function p<sub>z</sub>(x)=min{1,x/z}. In the sampling scheme, a flow with size x is sampled with probability p<sub>z</sub>(x). The parameter z acts as a threshold: flow of size z or above are always sampled as shown in <figref idref="DRAWINGS">FIG. 2</figref>. The horizontal axis corresponds to x<sub>i </sub>(the size of an object <b>201</b>). (In the disclosure, the parameter z is an example of a “probabilistic parameter.”) Each independent random variable w<sub>i </sub>has the values 1 with probability p<sub>z</sub>(x<sub>i</sub>) and 0 otherwise. Thus w<sub>i </sub>indicates whether flow i is to be sampled (w<sub>i</sub>=1) or not (w<sub>i</sub>=0). Each sampled value x<sub>i </sub>is renormalized by division by p<sub>z</sub>(x<sub>i</sub>). Thus, the estimate of the X (c) is given by:</p>
<p id="p-0044" num="0043">
<maths id="MATH-US-00002" num="00002">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mover>
            <mi>X</mi>
            <mo>^</mo>
          </mover>
          <mo>⁡</mo>
          <mrow>
            <mo>(</mo>
            <mi>c</mi>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>=</mo>
        <mrow>
          <munder>
            <mo>∑</mo>
            <mi>c</mi>
          </munder>
          <mo>⁢</mo>
          <mrow>
            <msub>
              <mi>w</mi>
              <mi>i</mi>
            </msub>
            <mo>⁢</mo>
            <mrow>
              <msub>
                <mi>x</mi>
                <mi>i</mi>
              </msub>
              <mo>/</mo>
              <mrow>
                <msub>
                  <mi>p</mi>
                  <mi>z</mi>
                </msub>
                <mo>⁡</mo>
                <mrow>
                  <mo>(</mo>
                  <msub>
                    <mi>x</mi>
                    <mi>i</mi>
                  </msub>
                  <mo>)</mo>
                </mrow>
              </mrow>
            </mrow>
          </mrow>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>2</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0045" num="0044">In order to manage data network <b>100</b>, the statistical variability of the estimate of X(c) provides a measure of confidence of the estimate. Moreover, the present invention enables the service provider to “tune” the operation of data network <b>100</b> in order to achieve the desired accuracy. In fact, p<sub>z</sub>(x<sub>i</sub>) is optimal in the sense that Var{circumflex over (X)}(c)+z<sup>2</sup>E(N(c)) is minimized with p<sub>z</sub>(x<sub>i</sub>), where E(N(c)) is the expected value of N(c). As will be explained later, the disclosure provides a method for controlling the statistical variance based upon operating parameters that the service provider can control. Parameter z is the size threshold above which flows are always sampled. The larger the value of z, the less likely that a given flow will be sampled and consequently the greater the variance associated with sampling it. If z is small, then Var{circumflex over (X)}(c)+z<sup>2</sup>E(N(c)) is more easily minimized by making Var{circumflex over (X)}(c) small, which occurs if one samples more of the flows. Conversely, if z is large, then Var{circumflex over (X)}(c)+z<sup>2</sup>E(N(c)) is more easily minimized by making E(N(c)) small, which occurs if one samples less of the flows.</p>
<p id="p-0046" num="0045">Data networks supporting IP (as in data network <b>100</b>) typically encounter heavy-tailed distributions of byte and packet sizes of IP. <figref idref="DRAWINGS">FIG. 3</figref> displays an exemplary complementary cumulative distribution function (CCDF), i.e. the proportion of flows with bytes greater than a given level, of the flow sizes encountered by data network <b>100</b>. The approximate linearity on the log-log scale is indicative of a heavy tailed distribution. The distribution of total bytes per customer-side IP address over a given period shares the heavy tailed property as shown in <figref idref="DRAWINGS">FIG. 4</figref>.</p>
<p id="p-0047" num="0046">A statistic for comparing estimated usage with its actual usage is quantified by the Weighted Mean Relative Error (WMRE).</p>
<p id="p-0048" num="0047">
<maths id="MATH-US-00003" num="00003">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mi>WMRE</mi>
        <mo>=</mo>
        <mfrac>
          <mrow>
            <munder>
              <mo>∑</mo>
              <mi>c</mi>
            </munder>
            <mo>⁢</mo>
            <mrow>
              <mo></mo>
              <mrow>
                <mrow>
                  <mover>
                    <mi>X</mi>
                    <mo>^</mo>
                  </mover>
                  <mo>⁡</mo>
                  <mrow>
                    <mo>(</mo>
                    <mi>c</mi>
                    <mo>)</mo>
                  </mrow>
                </mrow>
                <mo>-</mo>
                <mrow>
                  <mi>X</mi>
                  <mo>⁡</mo>
                  <mrow>
                    <mo>(</mo>
                    <mi>c</mi>
                    <mo>)</mo>
                  </mrow>
                </mrow>
              </mrow>
              <mo></mo>
            </mrow>
          </mrow>
          <mrow>
            <munder>
              <mo>∑</mo>
              <mi>c</mi>
            </munder>
            <mo>⁢</mo>
            <mrow>
              <mi>X</mi>
              <mo>⁡</mo>
              <mrow>
                <mo>(</mo>
                <mi>c</mi>
                <mo>)</mo>
              </mrow>
            </mrow>
          </mrow>
        </mfrac>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>3</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0049" num="0048">The WMRE averages the per-color absolute relative errors. WMRE gives greater weight to relative errors for large volume colors than for those with small volumes.</p>
<p id="p-0050" num="0049"><figref idref="DRAWINGS">FIG. 5</figref> illustrates an example of substantially better accuracy (smaller WMRE) of optimal sampling as compared with 1 in N sampling, over 4 orders of magnitude of the sampling period. Curve <b>501</b> illustrates the relationship for WMRE as a function of the effective sampling period, while curve <b>503</b> shows the corresponding relationship with sampling as described in the disclosure. With an effective sampling period of 100, the WMRE for optimal sampling is about only 1%, while for 1 in N sampling it is around 50%. The irregularity of the upper line reflects the sensitivity of the estimates from 1 in N sampling to random inclusion or exclusion of the largest flows during sampling. These features demonstrate the potential for inaccuracy arising from naive sampling from heavy-tailed distributions.</p>
<p id="p-0051" num="0050"><figref idref="DRAWINGS">FIG. 6</figref> displays with WMRE vs. sampling period for a trace of 10<sup>7 </sup>flows (corresponding to curve <b>605</b>), as compared with subportions contain 10<sup>6 </sup>(corresponding to curve <b>603</b>) and 10<sup>5 </sup>(corresponding to curve <b>601</b>) flows. The relative error decrease as the trace length increases, since the byte total for a given IP address is composed of a greater number of contributions. It may be desirable to place lower bounds on z in order to fulfill other objectives, such as limiting the rate at which samples are generated. The behavior from <figref idref="DRAWINGS">FIG. 6</figref> suggests that is possible to simultaneously fulfill the goal of low relative error provided that the length of the period of observation (e.g. the billing period) is sufficiently long.</p>
<p id="p-0052" num="0051">The exemplary embodiment utilizes the disclosed sampling techniques for charging the customer of data network <b>100</b> for usage. Fair charging requires that the deviation between the traffic charged to a customer and the actual traffic be kept to a minimum. The scheme is essentially the best possible, in the sense that variance of {circumflex over (X)} is minimized for a given threshold z. However, the relative estimation error can be relatively large for colors with small amounts of traffic. As an extreme example, suppose the traffic associated with color c has total size X(c)&lt;z. Each flow in that traffic thus has size less than z and will hence have a contribution to the estimate {circumflex over (X)}(c) that is either 0 (if the flow is not sampled), or z (if it is sampled, wherein the sample is normalized by p<sub>z</sub>(x)). Hence, {circumflex over (X)}(c) will be either 0, or at least z.</p>
<p id="p-0053" num="0052">As a simple solution to the problem of estimating the small traffic volumes, the service provider can charge the traffic of a given color at a fixed fee, plus a usage-sensitive charge only for traffic volumes that exceed a certain level L. (L may depend on the color in question). The idea is to tune the sampling algorithms so that any usage X(c) that exceeds L can be reliably estimated. Usage X(c) that falls below L does not need to be reliably estimated, since the associated charge is usage-insensitive, i.e., independent of {circumflex over (X)}(c)&lt;L.</p>
<p id="p-0054" num="0053">Generally, one can consider traffic to be charged according to some function f<sub>c</sub>({circumflex over (X)}(c)) which depends on {circumflex over (X)}(c) only through the quantity max{{circumflex over (X)}(c), L}, i.e., it is independent of any usage below L. The subscript of f<sub>c </sub>indicates that the charge may depend on the color c, e.g., through the type of service, or foreign IP address. In the exemplary embodiment, the service charges the customer according to:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>f</i><sub>c</sub>(<i>{circumflex over (X)}</i>(<i>c</i>))=<i>a</i><sub>c</sub><i>+b</i><sub>c </sub>max {<i>{circumflex over (X)}</i>(<i>c</i>),<i>L}</i>  (4)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where “a<sub>c</sub>” is a fixed charge, than can encompass, e.g., port charges and administrative charges, “b<sub>c</sub>” is a per byte charge on traffic transmitted during the billing cycle, and “L” is the minimum usage. Equation 4 can also express pricing models in which there is a fixed administrative charge for small customers, whose usage doesn't warrant accurate measurement. Both a<sub>c </sub>and b<sub>c </sub>are allowed to depend on the color c in question.
</p>
<p id="p-0055" num="0054">Reliable estimation of the volumes X(c) is determined by choosing the sampling threshold z appropriately high for level L in question. The larger the level L and the larger the deviation of {circumflex over (X)}(c) from X(c) that can be tolerated, the higher a sampling level z one can allow.</p>
<p id="p-0056" num="0055">The variance of all estimates for {circumflex over (X)}(c) greater than the level L can be controlled. This corresponds as a condition on the standard error, i.e., the ratio of standard deviation σ({circumflex over (X)}(c))=sqrt(Var{circumflex over (X)}(c)) to the mean X(c). In the exemplary embodiment, the typical estimation error is no more than about ε times X, for some target ε&gt;0. This can be expressed this as the following standard error condition:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>σ(<i>{circumflex over (X)}</i>(<i>c</i>))&lt;ε<i>X</i>(<i>c</i>) if <i>X</i>(<i>c</i>)&gt;<i>L</i>  (5)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0057" num="0056">For example, with ε=0.05 the standard deviation cannot be more than 5% of the mean.</p>
<p id="p-0058" num="0057">If {circumflex over (X)}(c) is derived from a large number of flows of independent sizes then {circumflex over (X)}(c) is roughly normally distributed. From Equation 5, the probability of overestimating {circumflex over (X)}(c)&gt;L by an amount δX(c) (i.e., by δ/ε standard deviations) is no more than φ(−δ/ε), where φ is the standard normal distribution function. Thus, with ε=0.05, the probability of overestimating {circumflex over (X)}(c) by more than 10% (corresponding to δ) is approximately equal to φ(−2)=2.23% (since 10%=2×5%).</p>
<p id="p-0059" num="0058">The above approach sets limits on the chance that the deviation of the estimated usage above the actual usage exceeds a given amount. A refinement allows the service provider to set a limit on the chance that overcharging occurs. This should be more attractive from the customer's point of view since the chance of the customer being over billed at all can be small. Conversely, the service provider has to accept a small persistent under billing in order to accommodate the potential sampling error.</p>
<p id="p-0060" num="0059">The distribution of {circumflex over (X)}(c) can be well approximated by a normal distribution when it is derived from a large number of constituent samples. If the probability of {circumflex over (X)}(c) being at least s standard deviations above the expected value X(c) is sufficiently small, then the calculated usage can be adjusted as follows:</p>
<p id="p-0061" num="0060">
<maths id="MATH-US-00004" num="00004">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <msup>
            <mover>
              <mi>X</mi>
              <mo>^</mo>
            </mover>
            <mi>′</mi>
          </msup>
          <mo>⁡</mo>
          <mrow>
            <mo>(</mo>
            <mi>c</mi>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>=</mo>
        <mrow>
          <mrow>
            <mover>
              <mi>X</mi>
              <mo>^</mo>
            </mover>
            <mo>⁡</mo>
            <mrow>
              <mo>(</mo>
              <mi>c</mi>
              <mo>)</mo>
            </mrow>
          </mrow>
          <mo>-</mo>
          <mrow>
            <mi>s</mi>
            <mo>⁢</mo>
            <msqrt>
              <mrow>
                <mi>z</mi>
                <mo>⁢</mo>
                <mrow>
                  <mover>
                    <mi>X</mi>
                    <mo>^</mo>
                  </mover>
                  <mo>⁡</mo>
                  <mrow>
                    <mo>(</mo>
                    <mi>c</mi>
                    <mo>)</mo>
                  </mrow>
                </mrow>
              </mrow>
            </msqrt>
          </mrow>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>6</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
“s” is the number of standard deviations away from X(c) above which over-estimation is sufficiently rare. As an example, with s=3, φ(−s) is about 0.13%, i.e. about 1 in 740 traffic volumes will be overestimated. The service provider may charge according to {circumflex over (X)}′(c) rather than {circumflex over (X)}(c). In such a case, the customer is billed f<sub>c</sub>({circumflex over (X)}′(c)). Thus, the chance that the customer is over billed is approximately equal to φ(−s).
</p>
<p id="p-0062" num="0061">For the service provider, the difference</p>
<p id="p-0063" num="0062">
<maths id="MATH-US-00005" num="00005">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mrow>
            <mover>
              <mi>X</mi>
              <mo>^</mo>
            </mover>
            <mo>⁡</mo>
            <mrow>
              <mo>(</mo>
              <mi>c</mi>
              <mo>)</mo>
            </mrow>
          </mrow>
          <mo>-</mo>
          <mrow>
            <msup>
              <mover>
                <mi>X</mi>
                <mo>^</mo>
              </mover>
              <mi>′</mi>
            </msup>
            <mo>⁡</mo>
            <mrow>
              <mo>(</mo>
              <mi>c</mi>
              <mo>)</mo>
            </mrow>
          </mrow>
        </mrow>
        <mo>=</mo>
        <mrow>
          <mi>s</mi>
          <mo>⁢</mo>
          <msqrt>
            <mrow>
              <mi>z</mi>
              <mo>⁢</mo>
              <mrow>
                <mover>
                  <mi>X</mi>
                  <mo>^</mo>
                </mover>
                <mo>⁡</mo>
                <mrow>
                  <mo>(</mo>
                  <mi>c</mi>
                  <mo>)</mo>
                </mrow>
              </mrow>
            </mrow>
          </msqrt>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mstyle>
        <mspace width="0.3em" height="0.3ex"/>
      </mstyle>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
represents unbillable revenue. In the charging scheme (as in Equation 4), this leads to under billing by a fraction roughly
</p>
<p id="p-0064" num="0063">
<maths id="MATH-US-00006" num="00006">
<math overflow="scroll">
<mrow>
  <mi>s</mi>
  <mo>⁢</mo>
  <mrow>
    <msqrt>
      <mfrac>
        <mi>z</mi>
        <mrow>
          <mi>X</mi>
          <mo>⁡</mo>
          <mrow>
            <mo>(</mo>
            <mi>c</mi>
            <mo>)</mo>
          </mrow>
        </mrow>
      </mfrac>
    </msqrt>
    <mo>.</mo>
  </mrow>
</mrow>
</math>
</maths>
<br/>
Given the minimum billed volume L, the fraction of underbilling is no more than s√{square root over (z/L)}. (In variations of the exemplary embodiment, underbilling can be systematically compensated for in the charging rate b<sub>c</sub>). Thus, in order to limit potential undercharging to a fraction of no more than about η, the service provider determines s<sup>2</sup>z&lt;η<sup>2</sup>L. In the example of s=3, underbilling by a fraction of no more than η=10% then requires selecting z and L such that z is less than about L/1000.
</p>
<p id="p-0065" num="0064">Table 1 shows the tradeoff of overcharging and unbillable usage.</p>
<p id="p-0066" num="0065">
<tables id="TABLE-US-00001" num="00001">
<table frame="none" colsep="0" rowsep="0">
<tgroup align="left" colsep="0" rowsep="0" cols="1">
<colspec colname="1" colwidth="217pt" align="center"/>
<thead>
<row>
<entry namest="1" nameend="1" rowsep="1">TABLE 1</entry>
</row>
</thead>
<tbody valign="top">
<row>
<entry namest="1" nameend="1" align="center" rowsep="1"/>
</row>
<row>
<entry>TRADE-OFF BETWEEN OVERCHARGING</entry>
</row>
<row>
<entry>AND UNBILLABLE TRAFFIC</entry>
</row>
</tbody>
</tgroup>
<tgroup align="left" colsep="0" rowsep="0" cols="3">
<colspec colname="offset" colwidth="70pt" align="left"/>
<colspec colname="1" colwidth="56pt" align="center"/>
<colspec colname="2" colwidth="91pt" align="center"/>
<tbody valign="top">
<row>
<entry/>
<entry/>
<entry>overcharged</entry>
</row>
<row>
<entry/>
<entry>Unbillable usage</entry>
<entry>customers</entry>
</row>
<row>
<entry/>
<entry namest="offset" nameend="2" align="center" rowsep="1"/>
</row>
</tbody>
</tgroup>
<tgroup align="left" colsep="0" rowsep="0" cols="4">
<colspec colname="offset" colwidth="28pt" align="left"/>
<colspec colname="1" colwidth="42pt" align="left"/>
<colspec colname="2" colwidth="56pt" align="char" char="."/>
<colspec colname="3" colwidth="91pt" align="center"/>
<tbody valign="top">
<row>
<entry/>
<entry>s = 0</entry>
<entry>−.1%</entry>
<entry>50%</entry>
</row>
<row>
<entry/>
<entry>s = 1</entry>
<entry>3.1%</entry>
<entry> 3%</entry>
</row>
<row>
<entry/>
<entry>s = 2</entry>
<entry>6.2%</entry>
<entry> 0   </entry>
</row>
<row>
<entry/>
<entry namest="offset" nameend="3" align="center" rowsep="1"/>
</row>
</tbody>
</tgroup>
</table>
</tables>
</p>
<p id="p-0067" num="0066">Consider flows that present themselves for sampling at a rate ρ, in which the flow sizes have a distribution function F, i.e., F(x) is the proportion of flows that have size less than or equal to x. With a sampling threshold z, samples are produced at an average rate r=ρ∫F(dx)p<sub>z</sub>(x). Suppose there is a target maximum rate of samples r *&lt;ρ. Then the service provider determines the sampling threshold z such that ρ∫F(dx)p<sub>z</sub>(x)&lt;r*. Using the fact that p<sub>z</sub>(x) is a decreasing function in z, it can be shown that this observation requires z≧z*, where z* is the unique solution z to the equation ρ∫F(dx)p<sub>z</sub>(x)=r*.</p>
<p id="p-0068" num="0067">Let z<sub>o </sub>denote the maximum sampling threshold allowed in order to control sampling variance, e.g., z≦z<sub>o</sub>=ε<sup>2</sup>L. The goals of controlling sample volume and variance are compatible provided that z*&lt;=z<sub>o</sub>, for then any sampling threshold z in the interval [z*, z<sub>o</sub>] has the property of being sufficiently small to yield small sampling variance, and sufficiently large to restrict the average sampling rate no greater than the desired rate r*.</p>
<p id="p-0069" num="0068">The condition z*≦z<sub>o </sub>can be realized by increasing the length of the billing cycle. The thresholds z<sub>o </sub>and z* control phenomena at different timescales. z* controls the average rate at which samples are taken. On the other hand, z<sub>o </sub>controls the sampling variance of the estimates {circumflex over (X)}(c) of total bytes over the billing timescale, potentially over days, weeks, or even months. The level byte L (under which accurate measurements are not needed) can be chosen to increase with the billing timescale. For example, the service provider may choose L to correspond to a particular quartile of the distribution of byte size, so that only a given proportion of the total bytes transmitted on the network are generated by customers whose total usage does not exceed L during the billing cycle. Increasing the length of the billing cycle will increase the corresponding quartile L, and hence also z<sub>o </sub>since is proportional to L. Support for this approach is provided by <figref idref="DRAWINGS">FIG. 6</figref>, which shows that the relative error in estimation decreases as the duration of collection of the flow trace increases.</p>
<p id="p-0070" num="0069"><figref idref="DRAWINGS">FIG. 7</figref> is a flow diagram for charging with sampled network usage in accordance with the exemplary embodiment. In step <b>701</b>, threshold z is determined according to the relative error and the unbillable usage. In step <b>703</b>, it is determined whether to sample an object that is associated with the customer in accordance with the size of the object and the probabilistic function p<sub>z</sub>(x). (The discussion with respect to <figref idref="DRAWINGS">FIG. 11</figref> presents a method for determining whether to sample the objects based upon the size.) The associated usage is determined from the size of the sampled object by dividing the size by the p<sub>z</sub>(x<sub>i</sub>) in step <b>705</b>. At the end of the billing in step <b>707</b>, the usage sensitive pricing for the customer is calculated in step <b>709</b> in accordance with Equation 4 and adjustments by the service provider. In step <b>711</b>, the usage is reset to 0 so that the usage for the next billing period can be calculated.</p>
<p id="p-0071" num="0070">The present invention, as disclosed by the exemplary embodiment, also enables the service provider to control the sample volume that is generated by data network <b>100</b>. Moreover, in data network <b>100</b>, the amount of data is dynamic with time, and consequently the sampling rate needs to adjust accordingly. In other words, dynamic control of the mean sample volume may be needed.</p>
<p id="p-0072" num="0071">An object (flow) may be distinguishable by an attribute. (Each object is characterized by a size that may be expressed in a number of packets, bytes (octets), or ATM cells contained in the object. The number is equal to at least one.) In such a case, the object is characterized as being colored. The present invention allows the service provider to estimate the total size of the objects in each color class c. If c<sub>i </sub>is the color of packet i, then</p>
<p id="p-0073" num="0072">
<maths id="MATH-US-00007" num="00007">
<math overflow="scroll">
<mrow>
  <mrow>
    <mi>X</mi>
    <mo>⁡</mo>
    <mrow>
      <mo>(</mo>
      <mi>c</mi>
      <mo>)</mo>
    </mrow>
  </mrow>
  <mo>=</mo>
  <mrow>
    <munder>
      <mo>∑</mo>
      <mi>c</mi>
    </munder>
    <mo>⁢</mo>
    <msub>
      <mi>x</mi>
      <mi>i</mi>
    </msub>
  </mrow>
</mrow>
</math>
</maths>
<br/>
is the of the objects with color c, and the unbiased estimator is then {circumflex over (X)}=Σw<sub>i</sub>r(x<sub>i</sub>), in which {circumflex over (X)}(c) is obtained simply by summing the sampled normalized sizes of color c. Let
</p>
<p id="p-0074" num="0073">
<maths id="MATH-US-00008" num="00008">
<math overflow="scroll">
<mrow>
  <mrow>
    <mover>
      <mi>X</mi>
      <mo>^</mo>
    </mover>
    <mo>⁡</mo>
    <mrow>
      <mo>(</mo>
      <mi>c</mi>
      <mo>)</mo>
    </mrow>
  </mrow>
  <mo>=</mo>
  <mrow>
    <munder>
      <mo>∑</mo>
      <mi>c</mi>
    </munder>
    <mo>⁢</mo>
    <msub>
      <mi>w</mi>
      <mi>i</mi>
    </msub>
  </mrow>
</mrow>
</math>
</maths>
<br/>
be the number of sampled objects with color c. By the linearity of expectation, E(N)=Σ({circumflex over (N)}(c)). Also, since each x<sub>i </sub>is picked independently, {circumflex over (X)}(c) is independent for each c, and hence
</p>
<p id="p-0075" num="0074">
<maths id="MATH-US-00009" num="00009">
<math overflow="scroll">
<mrow>
  <mrow>
    <mi>Var</mi>
    <mo>⁢</mo>
    <mstyle>
      <mspace width="0.8em" height="0.8ex"/>
    </mstyle>
    <mo>⁢</mo>
    <mi>X</mi>
  </mrow>
  <mo>=</mo>
  <mrow>
    <munder>
      <mo>∑</mo>
      <mi>c</mi>
    </munder>
    <mo>⁢</mo>
    <mrow>
      <mi>Var</mi>
      <mo>⁢</mo>
      <mstyle>
        <mspace width="0.8em" height="0.8ex"/>
      </mstyle>
      <mo>⁢</mo>
      <mrow>
        <mrow>
          <mover>
            <mi>X</mi>
            <mo>^</mo>
          </mover>
          <mo>⁡</mo>
          <mrow>
            <mo>(</mo>
            <mi>c</mi>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>.</mo>
      </mrow>
    </mrow>
  </mrow>
</mrow>
</math>
</maths>
</p>
<p id="p-0076" num="0075">Thus,
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>C</i><sub>z</sub>(<i>p</i>)=Var <i>{circumflex over (X)}+z</i><sup>2</sup><i>E</i>(<i>{circumflex over (N)}</i>)  (7)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where p is a probability function that is utilized for determining if an object is to be sampled.
</p>
<p id="p-0077" num="0076">The objective (cost) function C<sub>z</sub>(p) is minimized locally over each color class. With variations of the exemplary embodiment, there may be scenarios in which there are different objectives for different colors. However, in the exemplary embodiment, the sampling device does not distinguish colors; however, samples can be later analyzed with respect to any combination of colors.</p>
<p id="p-0078" num="0077">Finer control of sampling by color, within a given volume constraint, can only increase estimator variance. By applying a different threshold z<sub>c </sub>to the sampling of packets for each color, the service provider can control the sampling volume for each color. However, this approach increases the aggregate variance of {circumflex over (X)}(c).</p>
<p id="p-0079" num="0078">In a dynamic context the volume of objects presented for sampling will generally vary with time. Thus, in order to be useful, a mechanism to control the number of samples must be able to adapt to temporal variations in the rate at which objects are offered for sampling. This is already an issue for the 1 in N sampling algorithm, since it may be necessary to adjust N, both between devices and at different times in a single device, in order to control the sampled volumes. For the optimal algorithm, the service provider can control the volume by an appropriate choice of the threshold z. Moreover, one can dynamically adapt (i.e. updating) z knowing only the target and current sample volumes.</p>
<p id="p-0080" num="0079">Consider the case in which the targeted sampling volume M is less than n, which is the total number of objects from which to sample.</p>
<p id="p-0081" num="0080">
<maths id="MATH-US-00010" num="00010">
<math overflow="scroll">
<mrow>
  <msub>
    <mover>
      <mi>N</mi>
      <mo>^</mo>
    </mover>
    <mi>z</mi>
  </msub>
  <mo>=</mo>
  <mrow>
    <munder>
      <mo>∑</mo>
      <mi>i</mi>
    </munder>
    <mo>⁢</mo>
    <msub>
      <mi>w</mi>
      <mi>i</mi>
    </msub>
  </mrow>
</mrow>
</math>
</maths>
<br/>
is the total number of samples obtained using the sampling function p<sub>z</sub>. The expected number of samples
</p>
<p id="p-0082" num="0081">
<maths id="MATH-US-00011" num="00011">
<math overflow="scroll">
<mrow>
  <msub>
    <mi>N</mi>
    <mi>z</mi>
  </msub>
  <mo>=</mo>
  <mrow>
    <mrow>
      <mi>E</mi>
      <mo>⁡</mo>
      <mrow>
        <mo>(</mo>
        <msub>
          <mover>
            <mi>N</mi>
            <mo>^</mo>
          </mover>
          <mi>z</mi>
        </msub>
        <mo>)</mo>
      </mrow>
    </mrow>
    <mo>=</mo>
    <mrow>
      <munder>
        <mo>∑</mo>
        <mi>i</mi>
      </munder>
      <mo>⁢</mo>
      <mrow>
        <msub>
          <mi>p</mi>
          <mi>z</mi>
        </msub>
        <mo>⁡</mo>
        <mrow>
          <mo>(</mo>
          <msub>
            <mi>x</mi>
            <mi>i</mi>
          </msub>
          <mo>)</mo>
        </mrow>
      </mrow>
    </mrow>
  </mrow>
</mrow>
</math>
</maths>
<br/>
is a non-increasing function of z. A direct approach to finding z* is to construct an algorithm to find the root, utilizing a set of x<sub>i </sub>(sizes of the sampled objects). <figref idref="DRAWINGS">FIG. 12</figref>, which is discussed later, illustrates the approach utilized in the exemplary embodiment.
</p>
<p id="p-0083" num="0082">Alternatively, the service provider can dynamically adapt (i.e. updating) z knowing only the target and current sample volumes. One approach is update z by:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>z</i><sub>k+1</sub><i>=z</i><sub>k</sub><i>{circumflex over (N)}/M</i>  (8)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where M is the target sampling volume and {circumflex over (N)} is the measured sampling volume and where both correspond to the kth sampling window. As another alternative for dynamically updating z, the service provider can utilize the following:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>z</i><sub>k+1</sub><i>=z</i><sub>k</sub>(<i>{circumflex over (N)}−{circumflex over (R)}</i>(<i>M−{circumflex over (R)}</i>)  (9)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where M is the target sampling volume, {circumflex over (N)} is the measured sampling volume, and {circumflex over (R)} is the measured sampling volume for objects having a size greater than z<sub>k</sub>, and where all correspond to the kth sampling window. (In the disclosure, “sampling window” is defined as being an interval during which objects are presented for sampling. The interval may be measured in time, e.g., in online applications where each object occurs at some time during the window. In offline applications, the objects have already been collected, and are then sampled offline. In this case, the interval might be measured in time, i.e. objects collected in a particular time window are presented for sampling, or in number where a certain number of objects are presented for sampling. The endpoint of the window may be determined prior to sampling, or it may depend on the objects, e.g. through the number that are sampled and/or their sizes.)
</p>
<p id="p-0084" num="0083"><figref idref="DRAWINGS">FIG. 8</figref> shows an example of traffic flow volumes in data network <b>100</b>. At approximately 100 seconds, data network <b>100</b> incurs a sudden increase of the traffic volume. <figref idref="DRAWINGS">FIG. 9</figref> shows static (curve <b>901</b>) and dynamic controlled (curve <b>903</b>) sampling volumes in relation to <figref idref="DRAWINGS">FIG. 8</figref>. By adjusting threshold z, the sampling volume remains substantially constant relative to the sampling volume corresponding to a fixed threshold z.</p>
<p id="p-0085" num="0084">If the arrival rate of objects to be sampled grows noticeably over a time scale shorter than the time duration (window width) of a sampling window, the exemplary embodiment enables the service provider to execute immediate corrective measures. The measured sampling volume {circumflex over (N)} may significantly exceed the target M before the end of the sampling window. In the exemplary embodiment, if a target sample volume is already exceeded before the end of a window, the service provider should immediately change the threshold z. In this context, the windowing mechanism is a timeout that takes effect if N has not exceeded M by the end of the window. There are several variations of the exemplary embodiment. The corresponding emergency control can use timing information. If N already exceeds M at time t from a start of a window of length T, z is immediately replace by zT/t. Furthermore, if data network <b>100</b> provides control over the window boundaries, the a new sampling window can be started at that time. Otherwise, from time t one can reaccumulate the sample count N from zero, and the test and remedy procedure is repeated as needed for the remainder of the sampling window.</p>
<p id="p-0086" num="0085">The target sampling volume M can be reduced to compensate for sampling variability. With a target sampling volume M, one can expect a relative error on {circumflex over (N)} of about 1/√{square root over (M)}. In order to guard against statistical fluctuations of up to s standard deviations from a target sampling volume M, the target sampling volume can be adjusted by:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>M</i><sub>s</sub><i>=M−s√{square root over (M)}</i>  (10)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where M<sub>s </sub>is the compensated target sampling volume.
</p>
<p id="p-0087" num="0086"><figref idref="DRAWINGS">FIG. 10</figref> is a flow diagram for controlling the sampling volume in data network <b>100</b>. The value of z is determined in accordance with a targeted sample volume. (<figref idref="DRAWINGS">FIG. 12</figref> provides a method for determining z.) In step <b>1003</b>, it is determined whether to sample the ith object having a size x<sub>i</sub>. (<figref idref="DRAWINGS">FIG. 11</figref> provides a method for determining whether to sample the ith object.) If the object is sampled, then the corresponding traffic volume is estimated by normalizing x<sub>i </sub>by p<sub>z</sub>(x<sub>i</sub>) and accumulated to the estimated traffic volume in step <b>1005</b>. At the end of the sampling window as determined by step <b>1007</b>, the sampling volume is estimated in step <b>1009</b> for data network <b>100</b>. If the sampling window is not completed, then step <b>1003</b> is repeated. In step <b>1011</b>, the estimated sampling volume is utilized by the service provider in maintaining data network <b>100</b>. There are a spectrum of associated activities, including traffic engineering studies, network planning, peering policy, customer acquisition, marketing, and network security. As part of the network planning activity, the service provider can reconfigure the data network to be better matched to the traffic volume.</p>
<p id="p-0088" num="0087"><figref idref="DRAWINGS">FIG. 11</figref> is a flow diagram for a quasi-random data sampling algorithm. The process shown in <figref idref="DRAWINGS">FIG. 11</figref> can be utilized by step <b>703</b> or by step <b>1003</b> in determining whether to sample an object (flow). In the exemplary embodiment as shown in <figref idref="DRAWINGS">FIG. 11</figref>, it is assumed that the variable “count” has a uniformly distributed value between 0 and z−1. In step <b>1101</b>, count is reset to zero. In step <b>1103</b>, the size of the object x<sub>i </sub>is compared to z. If x<sub>i </sub>is greater or equal to z, then the ith object is sampled in sample <b>1105</b>. The index i is incremented by 1 in step <b>1107</b> so that the next object is considered in the next execution of step <b>1103</b>. However, if x<sub>i </sub>is less than z in step <b>1103</b>, then count is incremented by x<sub>i </sub>in step <b>1109</b>. If count is greater than or equal to z in step <b>1111</b>, count is decremented by z in step <b>1113</b> and the ith object is sampled in step <b>1115</b>. However, if count is less than z in step <b>1111</b>, index i is incremented by 1 in step <b>1107</b> so that the next object is considered for the next execution of step <b>1103</b>.</p>
<p id="p-0089" num="0088"><figref idref="DRAWINGS">FIG. 11</figref> is one embodiment of a quasi-random data sampling algorithm. One skilled in the art appreciates that other quasi-random embodiments can be utilized in order to determine whether to sample an object.</p>
<p id="p-0090" num="0089"><figref idref="DRAWINGS">FIG. 12</figref> is a flow diagram for root finding algorithm that may be utilized in determining or updating z in step <b>701</b> (<figref idref="DRAWINGS">FIG. 7</figref>) or step <b>1001</b> (<figref idref="DRAWINGS">FIG. 10</figref>). Discussion of <figref idref="DRAWINGS">FIG. 12</figref> is facilitated with specific notations as follow.
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0000">
    <ul id="ul0002" list-style="none">
        <li id="ul0002-0001" num="0090">{X} is a set {x<sub>i</sub>}, where each x<sub>i </sub>is the size of the ith object</li>
        <li id="ul0002-0002" num="0091">{X|condition} is a subset of {X}, where each member satisfies the given condition</li>
        <li id="ul0002-0003" num="0092">|X| is a number that is equal to the number of members in the set {X}</li>
        <li id="ul0002-0004" num="0093">sum {Y} is a number equal to the sum of the members of {Y}</li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0091" num="0094">The approach of the process shown in <figref idref="DRAWINGS">FIG. 12</figref> is to select a candidate z and to determine if the candidate z is satisfactory, too large, or too small. The process utilizes a collection of numbers corresponding to the sizes of previously sampled objects and the target sampling volume M. However, the process as illustrated in <figref idref="DRAWINGS">FIG. 12</figref> does not change the value of M. Rather, variables M, B, and C are internal variables that are used for calculations. The process only returns the appropriate value of z in steps <b>1205</b> and <b>1219</b>.</p>
<p id="p-0092" num="0095">In step <b>1201</b>, M and {X} are inputted. Internal variable B is reset to zero. In step <b>1203</b>, the number of members in {X} is compared to zero. If so, z=B/M is returned in step <b>1205</b> and the routine is exited. In step <b>1209</b>, z is randomly selected from {X}. An efficient implementation may require that z be picked randomly from {X} so that the expectation is somewhere in the middle with respect to size. However, assuming that the order of the members from {X} is independent of size, one can let z be equal to the first member in {X}. In step <b>1211</b>, set {Y} consists of the members of {X} whose values are less than z. In step <b>1213</b>, C=sum{Y}, where C is an internal variable that is used for calculations. In step <b>1215</b>, N=(B+C)/z+|X|−|Y|. |X| and |Y| are equal to the number of elements contained in {X} and {Y}, respectively. In step <b>1217</b>, N is compared to M. If so, z is equal to x<sub>i </sub>that was selected in step <b>1209</b>. If N is not equal to M, then step <b>1221</b> determines if N is greater than M. If so, {X}={X|x&gt;z} in step <b>1223</b>. In other words, members of set {X} are removed from the set whose values that are smaller or equal to z. Also, B=B+sum {X|x&lt;=z}. In other words, B is incremented by the sum of the members that are removed from the set {X}. Step <b>1203</b> is then repeated. If step <b>1221</b> determines that N is not greater than M, then N is less than M. In that case, step <b>1225</b> is executed. In step <b>1225</b>, set {X} is equal to set {Y}, where {Y} consists of the members of the previous set {X} that are less than z (as determined by step <b>1211</b>). Also, M=M−(|X|−|Y|). In other words, M is reduced by |X|−|Y|. Step <b>1203</b> is then repeated.</p>
<p id="p-0093" num="0096"><figref idref="DRAWINGS">FIG. 13</figref> shows an apparatus <b>1300</b> for managing a data network in accordance with the present invention. Apparatus <b>1300</b> receives and sends packets that are transported by a data network through packet interface <b>1303</b>. Processor <b>1301</b> receives packets containing traffic information through link <b>1302</b> from packet interface <b>1303</b>. In a variation of the embodiment, apparatus <b>1300</b> provides router functionality with routing module <b>1305</b>. Routing module <b>1305</b> directs packets between packet interface <b>1303</b> and packet interface <b>1307</b> through links <b>1304</b> and <b>1306</b> and between packet interface <b>1303</b> and packet interface <b>1309</b> through links <b>1304</b> and <b>1308</b>. Processor <b>1301</b> configures routing module <b>1305</b> through link <b>1310</b> in accordance with the traffic information that is received through link <b>1302</b>. Processor <b>1301</b> executes computer instructions corresponding to the flow diagrams shown in <figref idref="DRAWINGS">FIGS. 7</figref>, <b>10</b>, <b>11</b>, and <b>12</b>.</p>
<p id="p-0094" num="0097">In another variation of the embodiment, processor <b>1301</b> stores traffic information (that is received through link <b>1302</b>) to storage device <b>1311</b> through link <b>1312</b> for later retrieval (e.g. billing information for charging a customer).</p>
<p id="p-0095" num="0098">As can be appreciated by one skilled in the art, a computer system with an associated computer-readable medium containing instructions for controlling the computer system can be utilized to implement the exemplary embodiments that are disclosed herein. The computer system may include at least one computer such as a microprocessor, digital signal processor, and associated peripheral electronic circuitry.</p>
<p id="p-0096" num="0099">It is to be understood that the above-described embodiment is merely an illustrative principle of the invention and that many variations may be devised by those skilled in the art without departing from the scope of the invention. It is, therefore, intended that such variations be included with the scope of the claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-math idrefs="MATH-US-00001" nb-file="US07299283-20071120-M00001.NB">
<img id="EMI-M00001" he="7.03mm" wi="76.20mm" file="US07299283-20071120-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00002" nb-file="US07299283-20071120-M00002.NB">
<img id="EMI-M00002" he="7.03mm" wi="76.20mm" file="US07299283-20071120-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00003" nb-file="US07299283-20071120-M00003.NB">
<img id="EMI-M00003" he="12.02mm" wi="76.20mm" file="US07299283-20071120-M00003.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00004" nb-file="US07299283-20071120-M00004.NB">
<img id="EMI-M00004" he="5.33mm" wi="76.20mm" file="US07299283-20071120-M00004.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00005" nb-file="US07299283-20071120-M00005.NB">
<img id="EMI-M00005" he="5.33mm" wi="76.20mm" file="US07299283-20071120-M00005.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00006" nb-file="US07299283-20071120-M00006.NB">
<img id="EMI-M00006" he="8.47mm" wi="76.20mm" file="US07299283-20071120-M00006.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00007" nb-file="US07299283-20071120-M00007.NB">
<img id="EMI-M00007" he="7.03mm" wi="76.20mm" file="US07299283-20071120-M00007.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00008" nb-file="US07299283-20071120-M00008.NB">
<img id="EMI-M00008" he="7.03mm" wi="76.20mm" file="US07299283-20071120-M00008.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00009" nb-file="US07299283-20071120-M00009.NB">
<img id="EMI-M00009" he="7.03mm" wi="76.20mm" file="US07299283-20071120-M00009.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00010" nb-file="US07299283-20071120-M00010.NB">
<img id="EMI-M00010" he="7.03mm" wi="76.20mm" file="US07299283-20071120-M00010.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00011" nb-file="US07299283-20071120-M00011.NB">
<img id="EMI-M00011" he="7.03mm" wi="76.20mm" file="US07299283-20071120-M00011.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-claim-statement>We claim:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. An apparatus for managing a data network, comprising:
<claim-text>means for receiving an object, wherein the object is characterized by at least one attribute and wherein the object comprises at least one data element;</claim-text>
<claim-text>means for determining whether to sample the object in accordance with a probabilistic parameter, wherein said means for determining utilizes one of the at least one attribute to determine whether to sample the object, wherein said one of the at least one attribute comprises a size of the object, wherein the size includes a contribution of the at least one data element;</claim-text>
<claim-text>means for sampling the object if it is determined that sampling is required; and</claim-text>
<claim-text>means for normalizing the size of the object.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. An apparatus for managing a data network, comprising:
<claim-text>means for receiving an object, wherein the object is characterized by at least one attribute and wherein the object comprises at least one data element;</claim-text>
<claim-text>means for determining whether to sample the object in accordance with a probabilistic parameter;</claim-text>
<claim-text>means for sampling the object if it is determined that sampling is required;</claim-text>
<claim-text>means for determining a measured usage of the data network in accordance with the at least one attribute;</claim-text>
<claim-text>means for charging a customer for the measured usage in accordance with a charging function, wherein the customer is associated with the at least one attribute and wherein the customer is presented a bill for a billing period and wherein a charging accuracy is related to the charging function and an accuracy of the measured usage; and</claim-text>
<claim-text>means for adjusting the measured usage in order to control possible overcharging to the customer.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. An apparatus for managing a data network, comprising:
<claim-text>means for receiving an object, wherein the object is characterized by at least one attribute and wherein the object comprises at least one data element;</claim-text>
<claim-text>means for determining whether to sample the object in accordance with a probabilistic parameter;</claim-text>
<claim-text>means for sampling the object if it is determined that sampling is required;</claim-text>
<claim-text>means for determining a measured usage of the data network in accordance with the at least one attribute;</claim-text>
<claim-text>means for charging a customer for the measured usage in accordance with a charging function, wherein the customer is associated with the at least one attribute and wherein the customer is presented a bill for a billing period and wherein a charging accuracy is related to the charging function and an accuracy of the measured usage; and</claim-text>
<claim-text>means for adjusting the probabilistic parameter in order to achieve a predetermined degree of accuracy of charging the customer, wherein a sampling volume is related to the probabilistic parameter.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The apparatus of <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein the probabilistic parameter is adjusted.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. An apparatus for managing a data network, comprising:
<claim-text>means for receiving an object, wherein the object is characterized by at least one attribute and wherein the object comprises at least one data element;</claim-text>
<claim-text>means for determining whether to sample the object in accordance with a probabilistic parameter;</claim-text>
<claim-text>means for sampling the object if it is determined that sampling is required;</claim-text>
<claim-text>means for determining a measured usage of the data network in accordance with the at least one attribute;</claim-text>
<claim-text>means for charging a customer for the measured usage in accordance with a charging function, wherein the customer is associated with the at least one attribute and wherein the customer is presented a bill for a billing period and wherein a charging accuracy is related to the charging function and an accuracy of the measured usage; and</claim-text>
<claim-text>means for adjusting the probabilistic parameter in order to reduce unbillable usage within a predetermined percentage of the measured usage, wherein a sampling volume is related to the probabilistic parameter.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. An apparatus for managing a data network, comprising:
<claim-text>means for receiving an object, wherein the object is characterized by at least one attribute and wherein the object comprises at least one data element;</claim-text>
<claim-text>means for determining whether to sample the object in accordance with a probabilistic parameter;</claim-text>
<claim-text>means for sampling the object if it is determined that sampling is required;</claim-text>
<claim-text>means for determining a measured usage of the data network in accordance with the at least one attribute;</claim-text>
<claim-text>means for charging a customer for the measured usage in accordance with a charging function, wherein the customer is associated with the at least one attribute and wherein the customer is presented a bill for a billing period and wherein a charging accuracy is related to the charging function and an accuracy of the measured usage; and</claim-text>
<claim-text>means for adjusting the billing period in order to control a degree of accuracy for charging the customer.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. An apparatus for managing a data network, comprising:
<claim-text>means for receiving an object, wherein the object is characterized by at least one attribute and wherein the object comprises at least one data element;</claim-text>
<claim-text>means for determining whether to sample the object in accordance with a probabilistic parameter;</claim-text>
<claim-text>means for sampling the object if it is determined that sampling is required;</claim-text>
<claim-text>means for calculating an estimated sampling volume; and</claim-text>
<claim-text>means for reconfiguring the data network in accordance with the estimated sampling volume.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. An apparatus for managing a data network, comprising:
<claim-text>means for receiving an object, wherein the object is characterized by at least one attribute and wherein the object comprises at least one data element;</claim-text>
<claim-text>means for determining whether to sample the object in accordance with a probabilistic parameter;</claim-text>
<claim-text>means for sampling the object if it is determined that sampling is required;</claim-text>
<claim-text>means for calculating an estimated sampling volume; and</claim-text>
<claim-text>means for adjusting the probabilistic parameter in order that the measured sampling volume approximates a targeted sampling volume.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The apparatus of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein said means for adjusting updates a value of the probabilistic parameter corresponding to a sampling window.</claim-text>
</claim>
</claims>
</us-patent-grant>
