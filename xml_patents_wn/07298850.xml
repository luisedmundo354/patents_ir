<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07298850-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07298850</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>10004132</doc-number>
<date>20011023</date>
</document-id>
</application-reference>
<us-application-series-code>10</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>GB</country>
<doc-number>0027327.6</doc-number>
<date>20001109</date>
</priority-claim>
</priority-claims>
<us-term-of-grant>
<us-term-extension>815</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>L</subclass>
<main-group>9</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>380277</main-classification>
<further-classification>713190</further-classification>
<further-classification>713191</further-classification>
<further-classification>713192</further-classification>
<further-classification>713171</further-classification>
<further-classification>713182</further-classification>
<further-classification>713183</further-classification>
<further-classification>380273</further-classification>
<further-classification>380277</further-classification>
<further-classification>380 43</further-classification>
<further-classification>380264</further-classification>
<further-classification>380260</further-classification>
<further-classification>380226</further-classification>
</classification-national>
<invention-title id="d0e71">Encrypting keypad module</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>4578530</doc-number>
<kind>A</kind>
<name>Zeidler</name>
<date>19860300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>705 71</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>4941176</doc-number>
<kind>A</kind>
<name>Matyas et al.</name>
<date>19900700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>380280</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>5142578</doc-number>
<kind>A</kind>
<name>Matyas et al.</name>
<date>19920800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>380280</main-classification></classification-national>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>5404403</doc-number>
<kind>A</kind>
<name>Bright et al.</name>
<date>19950400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>380277</main-classification></classification-national>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>5448638</doc-number>
<kind>A</kind>
<name>Johnson et al.</name>
<date>19950900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>705 72</main-classification></classification-national>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>5539400</doc-number>
<kind>A</kind>
<name>Mears</name>
<date>19960700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>341 22</main-classification></classification-national>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>5592552</doc-number>
<kind>A</kind>
<name>Fiat</name>
<date>19970100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713163</main-classification></classification-national>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>5745576</doc-number>
<kind>A</kind>
<name>Abraham et al.</name>
<date>19980400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>705 73</main-classification></classification-national>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>5768386</doc-number>
<kind>A</kind>
<name>Yokomoto et al.</name>
<date>19980600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713183</main-classification></classification-national>
</citation>
<citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>5970146</doc-number>
<kind>A</kind>
<name>McCall et al.</name>
<date>19991000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713194</main-classification></classification-national>
</citation>
<citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>6044155</doc-number>
<kind>A</kind>
<name>Thomlinson et al.</name>
<date>20000300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713155</main-classification></classification-national>
</citation>
<citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>6049790</doc-number>
<kind>A</kind>
<name>Rhelimi</name>
<date>20000400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>705 73</main-classification></classification-national>
</citation>
<citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>6167137</doc-number>
<kind>A</kind>
<name>Marino et al.</name>
<date>20001200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>380255</main-classification></classification-national>
</citation>
<citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>6226749</doc-number>
<kind>B1</kind>
<name>Carloganu et al.</name>
<date>20010500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713201</main-classification></classification-national>
</citation>
<citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>6470449</doc-number>
<kind>B1</kind>
<name>Blandford</name>
<date>20021000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713178</main-classification></classification-national>
</citation>
<citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>6578145</doc-number>
<kind>B1</kind>
<name>Greene</name>
<date>20030600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713182</main-classification></classification-national>
</citation>
<citation>
<patcit num="00017">
<document-id>
<country>US</country>
<doc-number>6598023</doc-number>
<kind>B1</kind>
<name>Drummond et al.</name>
<date>20030700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>705  1</main-classification></classification-national>
</citation>
<citation>
<patcit num="00018">
<document-id>
<country>US</country>
<doc-number>6736313</doc-number>
<kind>B1</kind>
<name>Dickson</name>
<date>20040500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>235380</main-classification></classification-national>
</citation>
<citation>
<patcit num="00019">
<document-id>
<country>US</country>
<doc-number>6772331</doc-number>
<kind>B1</kind>
<name>Hind et al.</name>
<date>20040800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713151</main-classification></classification-national>
</citation>
<citation>
<patcit num="00020">
<document-id>
<country>US</country>
<doc-number>6823172</doc-number>
<kind>B1</kind>
<name>Forrest</name>
<date>20041100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>455 412</main-classification></classification-national>
</citation>
<citation>
<patcit num="00021">
<document-id>
<country>US</country>
<doc-number>7010689</doc-number>
<kind>B1</kind>
<name>Matyas et al.</name>
<date>20060300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713168</main-classification></classification-national>
</citation>
<citation>
<patcit num="00022">
<document-id>
<country>US</country>
<doc-number>7024562</doc-number>
<kind>B1</kind>
<name>Flink et al.</name>
<date>20060400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713186</main-classification></classification-national>
</citation>
<citation>
<patcit num="00023">
<document-id>
<country>GB</country>
<doc-number>2168514</doc-number>
<date>19860600</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>5</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-exemplary-claim>2</us-exemplary-claim>
<us-exemplary-claim>3</us-exemplary-claim>
<us-exemplary-claim>4</us-exemplary-claim>
<us-exemplary-claim>5</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>713190-192</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>713182-184</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>713171</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>380273</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>380277</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>380 43</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>380264</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>380260</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>380226</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>380228</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>5</number-of-drawing-sheets>
<number-of-figures>8</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20020066020</doc-number>
<kind>A1</kind>
<date>20020530</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Whytock</last-name>
<first-name>Alexander W.</first-name>
<address>
<city>Blairgowrie</city>
<country>GB</country>
</address>
</addressbook>
<nationality>
<country>GB</country>
</nationality>
<residence>
<country>GB</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<last-name>Chan</last-name>
<first-name>Michael</first-name>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>NCR Corporation</orgname>
<role>02</role>
<address>
<city>Dayton</city>
<state>OH</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Jaroenchonwanit</last-name>
<first-name>Bunjob</first-name>
<department>2152</department>
</primary-examiner>
<assistant-examiner>
<last-name>Truong</last-name>
<first-name>Lan-Dai T</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">An encrypting keypad module (<b>30</b>) comprising a keypad (<b>40</b>) and an encryption unit (<b>42</b>) is described. The encryption unit (<b>42</b>) includes an interpreter (<b>56</b>) for receiving a file (<b>150</b>) containing data and instructions for processing the data. The encryption unit (<b>42</b>) is operable to process the data in the file (<b>150</b>) by interpreting the instructions in the file (<b>150</b>). This enables a file (<b>150</b>) to be used to instruct the encryption unit (<b>42</b>) about the data that is to be operated on and the type of operations to be performed on the data.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="168.91mm" wi="121.50mm" file="US07298850-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="250.61mm" wi="171.20mm" file="US07298850-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="261.62mm" wi="189.40mm" file="US07298850-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="241.38mm" wi="152.40mm" file="US07298850-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="191.69mm" wi="138.68mm" file="US07298850-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="263.23mm" wi="158.83mm" file="US07298850-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0002" num="0001">The present invention relates to an encrypting keypad module. In particular, the present invention relates to an encrypting PIN pad (EPP) module for use with a retail point of sale (PoS) terminal or a self-service terminal (SST) such as an automated teller machine (ATM). The invention also relates to a terminal including such an encrypting keypad module.</p>
<p id="p-0003" num="0002">ATMs require high electronic security because sensitive information, such as a user's personal identification number (PIN), is entered by a user at the ATM. The entered information is conveyed within the ATM and also outside the ATM to an authorization center that authorizes a requested transaction.</p>
<p id="p-0004" num="0003">To ensure that the user's PIN is not divulged by the ATM after it has been entered by the user, a tamper-resistant integral unit is provided having a keypad and an encryption unit. The integral unit is referred to as an encrypting PIN pad (EPP) module.</p>
<p id="p-0005" num="0004">Once a user has entered his/her PIN, the EPP encrypts the entered digits to ensure that the digits are encrypted prior to leaving the EPP. This ensures that a user's PIN is never conveyed (either within or outside the ATM) as plaintext.</p>
<p id="p-0006" num="0005">The EPP includes an encryption unit having a random number generator, a cryptographic processor, a non-volatile memory for storing a unique master encryption key and an encryption algorithm, and a volatile memory for storing customer-specific encryption keys, such as a key exchange key and a PIN key.</p>
<p id="p-0007" num="0006">Typically, when an EPP is manufactured the unique master key is generated by the cryptographic processor within the EPP and stored in the non-volatile memory (which may be EEPROM or battery-backed RAM). The encryption algorithm to be used by the module is also loaded into the non-volatile memory during manufacture of the EPP. The algorithm may be, for example, the data encryption standard (DES).</p>
<p id="p-0008" num="0007">If the EPP is tampered with, for example by a third party attempting to gain access to it, then the EPP deletes the master key stored in the non-volatile memory, and any other keys stored in the volatile memory.</p>
<p id="p-0009" num="0008">When a user enters his/her PIN at an ATM, the EPP uses its PIN key and the stored encryption algorithm (such as DES) to encrypt the entered digits using a standard protocol. The result of this encryption on the entered digits is generally referred to as a PIN block.</p>
<p id="p-0010" num="0009">A protocol (also referred to as a framework) indicates how a cryptographic processor is to operate on data, how the processor is to use encryption keys, what type of algorithm is to be used for encryption, and such like.</p>
<p id="p-0011" num="0010">A number of different protocols exist, some of these are described in international standards, such as: ANSI standard X9.8 “PIN management and security”, ANSI X9.9 “Financial institution message authentication”, ANSI X9.17 “Financial institution key management”, Australian standard for electronic funds transfer AS 2805, and such like.</p>
<p id="p-0012" num="0011">The PIN block is then transmitted from the EPP to an ATM controller, which transmits the PIN block (together with the requested transaction, and typically a sequence number and a date/time stamp) to an authorization center. The authorization center decrypts the encrypted PIN block to verify the claimed identity of the user, and authorizes a requested transaction if sufficient funds are present.</p>
<p id="p-0013" num="0012">One problem associated with current EPPs is that it is difficult to change the protocol used by the EPP. Another problem is that it is difficult to derive new keys for current EPPs. There are a number of reasons for these problems. To upgrade the EPP protocol and to derive new keys, a complex application programming interface (API) must be used. In addition, the ATM application program is constrained so that only certain functions can be performed relating to deriving new keys and upgrading protocols. Furthermore, the architecture of an EPP is typically vendor-specific, so an ATM application program may have to be changed if a new type of EPP is used in the ATM.</p>
<p id="p-0014" num="0013">Thus, when a new key is to be derived, or when a new protocol is to be implemented, on a network of ATMs having different types of EPPs (that is, EPPs from different vendors), then each type of EPP requires different instructions. This makes upgrading the ATM network a time-consuming, complex, and expensive task. However, to ensure high levels of data security, EPPs in ATM networks have to be upgraded frequently.</p>
<heading id="h-0002" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0015" num="0014">It is among the objects of an embodiment of the present invention to obviate or mitigate one or more of the above disadvantages or other disadvantages associated with encrypting keypad modules.</p>
<p id="p-0016" num="0015">According to a first aspect of the present invention there is provided an encrypting keypad module comprising a keypad and an encryption unit, characterized in that the encryption unit includes an interpreter for receiving a file containing data and instructions for processing the data, whereby the encryption unit is operable to process the data in the file by interpreting the instructions in the file.</p>
<p id="p-0017" num="0016">By virtue of this aspect of the invention, the module is able to receive data and instructions from a source external to the module, and to process the data and any entered PIN, according to the instructions received. This obviates the requirement to pre-load protocols, as a protocol can be described by the file.</p>
<p id="p-0018" num="0017">This has the advantage that a standard set of instructions can be used for any such module, regardless of the architecture of the module, as the interpreter is able to translate the instructions into code that a cryptographic processor can execute.</p>
<p id="p-0019" num="0018">Preferably, the interpreter is implemented in software or firmware.</p>
<p id="p-0020" num="0019">The file may include instructions for deriving a new key based on an existing key and new data contained in the file.</p>
<p id="p-0021" num="0020">The file may have a structure comprising tagged commands and data, in a similar manner to a standard mark up language such as XML.</p>
<p id="p-0022" num="0021">Preferably, the encrypting keypad module is a single integrated unit.</p>
<p id="p-0023" num="0022">According to a second aspect of the present invention there is provided a terminal including an encrypting keypad module, characterized in that the module has an encryption unit including an interpreter for receiving a file containing data and instructions for processing the data, whereby the encryption unit is operable to process the data in the file by interpreting the instructions in the file.</p>
<p id="p-0024" num="0023">The terminal may be a point of sale terminal or a self-service terminal such as an ATM.</p>
<p id="p-0025" num="0024">According to a third aspect of the present invention there is provided a method of encrypting data in an encryption module, the method comprising the steps of: receiving data to be encrypted and instructions for encrypting the data from a source external to the module; interpreting the instructions to generate code for implementing the instructions; and applying the code to a cryptographic processor.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0026" num="0025">These and other aspects of the present invention will be apparent from the following specific description, given by way of example, with reference to the accompanying drawings, in which:</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram of a self-service terminal system according to one embodiment of the present invention;</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 2</figref> is a simplified block diagram of a self-service terminal of <figref idref="DRAWINGS">FIG. 1</figref>;</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. 3</figref> is a schematic diagram of an encrypting keypad module of the SST of <figref idref="DRAWINGS">FIG. 2</figref>;</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 4</figref> is a flowchart illustrating the steps involved in a typical transaction at the SST of <figref idref="DRAWINGS">FIG. 2</figref>;</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 5</figref> is an example of a program listing of a file used by the SST of <figref idref="DRAWINGS">FIG. 2</figref>;</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. 6</figref> is another example of a program listing of a file used by the SST of <figref idref="DRAWINGS">FIG. 2</figref>;</p>
<p id="p-0033" num="0032"><figref idref="DRAWINGS">FIG. 7</figref> is another example of a program listing of a file used by the SST of <figref idref="DRAWINGS">FIG. 2</figref>; and</p>
<p id="p-0034" num="0033"><figref idref="DRAWINGS">FIG. 8</figref> is another example of a program listing of a file used by the SST of <figref idref="DRAWINGS">FIG. 2</figref>.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0035" num="0034">Reference is now made to <figref idref="DRAWINGS">FIG. 1</figref>, which is a block diagram of a self-service terminal system <b>10</b> according to one embodiment of the present invention. In <figref idref="DRAWINGS">FIG. 1</figref>, system <b>10</b> comprises a plurality of self-service terminals <b>12</b> (in the form of ATMs) connected to a transaction host <b>14</b> by a secure private network <b>16</b>.</p>
<p id="p-0036" num="0035">The transaction host <b>14</b> is owned and operated by a financial institution and includes an authorization facility <b>18</b> and a back-office facility <b>20</b>. As is well known in the art, the authorization facility <b>18</b> authorizes transactions received from the ATMs <b>12</b>.</p>
<p id="p-0037" num="0036">The back-office facility <b>20</b> typically includes details of bank accounts held by customers of the financial institution and stores information relating to transactions executed at the ATMs <b>12</b>.</p>
<p id="p-0038" num="0037">Referring now to <figref idref="DRAWINGS">FIG. 2</figref>, which is a block diagram of one of the ATMs <b>12</b> of <figref idref="DRAWINGS">FIG. 1</figref>, each ATM <b>12</b> includes: a tamper-resistant encrypting keypad module <b>30</b> in the form of an EPP module; a motorized card reader (MCRW) module <b>31</b>; a central controller <b>32</b>; a cash dispenser module <b>33</b>; and a network connection module <b>34</b>; all interconnected by an ATM bus <b>36</b>. The controller <b>32</b> further comprises a processor <b>37</b> and associated memory <b>38</b>. In use, the memory <b>38</b> executes an ATM application program <b>39</b> for controlling the operation of the ATM <b>12</b>.</p>
<p id="p-0039" num="0038">Each ATM <b>12</b> also includes conventional ATM modules (such as a receipt printer, a journal printer, and such like) that are coupled to the ATM bus <b>36</b>, which are not illustrated in <figref idref="DRAWINGS">FIG. 2</figref> and are not described in detail herein.</p>
<p id="p-0040" num="0039">Referring now to <figref idref="DRAWINGS">FIG. 3</figref>, which is a schematic diagram of the EPP module <b>30</b>, the EPP <b>30</b> includes a keypad <b>40</b> and an encryption unit <b>42</b>.</p>
<p id="p-0041" num="0040">The keypad <b>40</b> comprises sixteen individual keys <b>44</b>, each key having a surface that is either blank or provided with a legend. Those keys having a legend have either a numeral (such as “1”, “2”, or such like) or a word (such as “Enter”, “Cancel”, or such like) etched or printed on the surface of the key <b>44</b>.</p>
<p id="p-0042" num="0041">Data from the keypad <b>40</b> is transmitted to the encryption unit <b>42</b> via a tamper-detecting bus <b>46</b>. Bus <b>46</b> includes the scan out lines that indicate which key is depressed. Bus <b>46</b> is enveloped by a membrane shield (not shown) that detects any attempt to access the data lines in the bus <b>46</b> covered by the shield.</p>
<p id="p-0043" num="0042">The encryption unit <b>42</b> has a cryptographic processor <b>48</b> in the form of a general cryptographic device. Suitable cryptographic devices are available from: Pijnenburg Custom Chips B.V., Dallas Semiconductor Corporation, or Philips Crypto B.V. (such as the Philips General Crypto Device GCD-PHI). The processor <b>48</b> has associated volatile memory <b>50</b> in the form of RAM (which has a battery back-up), and non-volatile memory <b>52</b> in the form of EEPROM.</p>
<p id="p-0044" num="0043">The RAM <b>50</b> stores a master key which was loaded during manufacture. The EEPROM <b>52</b> stores at least one encryption algorithm <b>54</b> (in this embodiment triple DES) which was also loaded during manufacture. The EEPROM <b>52</b> also stores an interpreter program <b>56</b> that is loaded into RAM <b>50</b> on power-up of the EPP <b>30</b>.</p>
<p id="p-0045" num="0044">The processor <b>48</b>, RAM <b>50</b>, and EEPROM <b>52</b> communicate via an internal bus <b>58</b>.</p>
<p id="p-0046" num="0045">Unit <b>42</b> includes a tamper-detecting membrane (not shown) for detecting any attempt to open or otherwise access the unit <b>42</b>.</p>
<p id="p-0047" num="0046">The unit <b>42</b> also includes an erase line <b>60</b> coupled to the RAM <b>50</b>. If any of the tamper-detecting membranes detects a breach, then the processor <b>48</b> activates erase line <b>60</b> to delete the master key stored therein.</p>
<p id="p-0048" num="0047">Unit <b>42</b> is also coupled to function display keys (FDKs) (not shown) via bus <b>62</b>. FDKs typically comprise two columns of keys, each column being located on an opposite side of a display, so that the FDKs align with options presented on the display, and a user can select an option by depressing an FDK aligned with that option.</p>
<p id="p-0049" num="0048">The keypad <b>40</b> and encryption unit <b>42</b> each receives power via bus <b>64</b>; and the encryption unit <b>42</b> outputs encrypted data to the ATM controller <b>32</b> (<figref idref="DRAWINGS">FIG. 2</figref>) via bus <b>66</b>.</p>
<p id="p-0050" num="0049">When the keypad module <b>30</b> is connected to an ATM <b>12</b> (<figref idref="DRAWINGS">FIG. 2</figref>), power is connected to bus <b>64</b>; an FDK input, if used, is connected to bus <b>62</b>; and a communications bus is connected to bus <b>66</b>.</p>
<p id="p-0051" num="0050">A typical transaction will now be described with reference to <figref idref="DRAWINGS">FIGS. 1 to 3</figref>, and also <figref idref="DRAWINGS">FIG. 4</figref>, which is a flowchart illustrating the steps involved.</p>
<p id="p-0052" num="0051">Initially, a user enters a card into MCRW module <b>31</b>. The MCRW <b>31</b> reads the card (step <b>100</b>) to determine account information such as the account number and the card issuer, and conveys this account information to the ATM application program <b>39</b>. ATM program <b>39</b> creates a file (step <b>102</b>) containing this account information (the file will be described in more detail below) and some instructions.</p>
<p id="p-0053" num="0052">The ATM application <b>39</b> then sends this file (step <b>104</b>) to the EPP <b>30</b>, and invites the user to enter his/her PIN at the EPP <b>30</b>.</p>
<p id="p-0054" num="0053">The EPP <b>30</b> reads the PIN entered by the user (step <b>106</b>), interprets the received file (step <b>108</b>) and executes the instructions contained in the received file (step <b>110</b>) using the PIN and the account information, so that a PIN block is generated.</p>
<p id="p-0055" num="0054">The EPP <b>30</b> then sends the PIN block (step <b>112</b>) to the ATM application <b>39</b>, which appends (step <b>114</b>) a sequence number, transaction details (for example, the amount of cash to be withdrawn), and a time and date stamp thereto to generate a wrapped PIN block.</p>
<p id="p-0056" num="0055">The ATM application <b>39</b> then sends (step <b>116</b>) the wrapped PIN block to the transaction host <b>14</b> for authorizing (step <b>118</b>).</p>
<p id="p-0057" num="0056">If the transaction host validates the transaction then the ATM application invites the user to remove the card (step <b>120</b>) then fulfills (step <b>122</b>) the transaction (for example, by dispensing the requested cash).</p>
<p id="p-0058" num="0057">If the transaction host does not validate the transaction then the ATM application aborts the transaction (step <b>124</b>).</p>
<p id="p-0059" num="0058">The account file created in step <b>102</b> of <figref idref="DRAWINGS">FIG. 4</figref> will now be described in more detail with reference to <figref idref="DRAWINGS">FIG. 5</figref>, which is a program listing of the file <b>150</b>.</p>
<p id="p-0060" num="0059">The file <b>150</b> has an instruction tag <b>152</b> (in the form of an element called “message”) indicating that what follows is a set of instructions.</p>
<p id="p-0061" num="0060">In the format shown, as is conventional for markup languages, each element is activated by a tag comprising an identifier surrounded by angled brackets, and deactivated by a tag comprising an identifier preceded by a forward slash character and surrounded by angled brackets.</p>
<p id="p-0062" num="0061">After the instruction tag there is an encryption tag <b>154</b> indicating that what follows is an encryption routine having instructions for encrypting data.</p>
<p id="p-0063" num="0062">The encryption routine has an algorithms tag <b>156</b> including an algorithm code <b>158</b> indicating the type of algorithm to be used in the encryption process. In this embodiment, the algorithm code <b>158</b> is “2 k3des_ecb”, which indicates that the two key triple DES algorithm is to be used in electronic code book mode of operation. Although only one algorithm is shown in the EPP of <figref idref="DRAWINGS">FIG. 3</figref>, in other embodiments, a plurality of algorithms may be stored, so that the account file <b>150</b> determines which algorithm is to be used.</p>
<p id="p-0064" num="0063">The encryption routine also has a plain text tag <b>160</b> including data to be operated on. In this embodiment, the plain text is the account number read from the user's card in step <b>100</b>.</p>
<p id="p-0065" num="0064">The encryption routine also has a use key tag <b>162</b> including a key code <b>164</b> indicating which of the stored keys is to be used in the encryption process. In this embodiment, the code is “Key <b>1</b>”, which indicates that the key labeled “Key <b>1</b>” and stored in the EPP is to be used.</p>
<p id="p-0066" num="0065">The encryption routine also has a use cipher text tag <b>166</b> indicating that the results of the two key triple DES encryption using “Key <b>1</b>” on the entered PIN and the account information should be referenced by the name “result”; that is, the PIN block generated is referenced by the name “result”.</p>
<p id="p-0067" num="0066">The file <b>150</b> also has an output tag <b>168</b> that instructs the EPP to send the encrypted PIN block to the ATM application program <b>39</b>.</p>
<p id="p-0068" num="0067">When this file <b>150</b> is received by the EPP <b>30</b>, the EPP <b>30</b> interprets each command to generate the cryptographic processor codes required to instruct the application programming interface in the encryption unit to execute the functions required.</p>
<p id="p-0069" num="0068">A different account file <b>180</b> is shown in <figref idref="DRAWINGS">FIG. 6</figref>. Account file <b>180</b> has a first block of commands <b>182</b> for performing two key DES encryption on a first string of text using “Key <b>1</b>”, and a second block of commands <b>184</b> for performing two key DES encryption on a second string of text using “Key <b>2</b>”, an operand tag <b>186</b> for instructing an exclusive OR (XOR) function to be performed on the result of the first and second encryption routines, and an output tag <b>188</b> that instructs the EPP to send the output of the XOR function to the ATM application program <b>39</b>.</p>
<p id="p-0070" num="0069">It will be appreciated that each of the blocks of commands comprises tags indicating an operation to be performed or data to be used; however, for clarity of explanation, tags have been grouped to indicate the function performed by that group.</p>
<p id="p-0071" num="0070">Yet another account file <b>190</b> is shown in <figref idref="DRAWINGS">FIG. 7</figref>. Account file <b>190</b> enables a new key to be derived using a key already loaded into the EPP. Account file <b>190</b> has a numeral input tag <b>192</b> having a string of numbers <b>194</b>, and a decryption block of commands <b>196</b> indicating what algorithm and key is to be used to decrypt the numbers <b>194</b>. Account file also has a key producing block <b>198</b> indicating how the decrypted numbers are to be used with the string of numbers <b>194</b> to produce a new key.</p>
<p id="p-0072" num="0071">Thus, the key derivation account file <b>190</b> does not involve a user entering any data, it is used by an owner or operator of the ATM to update the encryption in the ATM.</p>
<p id="p-0073" num="0072">Yet another account file <b>200</b> is shown in <figref idref="DRAWINGS">FIG. 8</figref>. Account file <b>200</b> enables a new longer key to be derived by using a triple DES algorithm.</p>
<p id="p-0074" num="0073">It will be appreciated that this embodiment of the invention has several advantages. It enables an ATM, or a host remote from the ATM, to send an electronic file to an EPP instructing the EPP to process data in a specified manner. It also enables a single file to be used that specifies data to be operated on and the algorithms and modes to be used in operating on that data, thus a single file contains both data and instructions. It simplifies key derivation by using a single file, and enables key derivation to be initiated from a location remote from an ATM. This enables a central location to update multiple ATMs with new keys without having to send personnel to each ATM. The markup language format used for the file enables the file to be easily generated and understood by a human.</p>
<p id="p-0075" num="0074">Various modifications may be made to the above described embodiment within the scope of the invention, for example, in other embodiments, the encrypting keypad may be used in a point of sale terminal, and the point of sale terminal may be connected to an open and public network.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method of deriving a new encryption key for use in an encrypting keypad module, the method comprising:
<claim-text>receiving a file containing (i) input data, (ii) a first command indicating an algorithm, (iii) a second command indicating an encryption key which is already stored at the encrypting keypad module, and (iv) instructions for making a new encryption key;</claim-text>
<claim-text>using the indicated algorithm and the indicated encryption key to decrypt the input data; and</claim-text>
<claim-text>executing the instructions to direct how the decrypted input data is to be operated on to produce a new encryption key which is different from the encryption key which is already stored at the encrypting keypad module.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. A method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>storing the new encryption key in the encrypting keypad module.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. A method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the file has a structure comprising tagged commands and data.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. A method of operating an encrypting keypad module having a first encryption key which is already stored at the encrypting keypad module, the method comprising:
<claim-text>receiving a file containing (i) input data, (ii) a command indicating an algorithm, and (iii) instructions for making a new encryption key which is different from the first encryption key;</claim-text>
<claim-text>using the indicated algorithm and the first encryption key to decrypt the input data;</claim-text>
<claim-text>executing the instructions to direct how the decrypted input data is to be operated on to produce a second encryption key which is different from the first encryption key which is already stored at the encrypting keypad module; and</claim-text>
<claim-text>storing the second encryption key in the encrypting keypad module.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. A method according to <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the file has a structure comprising tagged commands and data.</claim-text>
</claim>
</claims>
</us-patent-grant>
