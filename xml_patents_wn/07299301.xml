<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07299301-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07299301</doc-number>
<kind>B1</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>10657778</doc-number>
<date>20030908</date>
</document-id>
</application-reference>
<us-application-series-code>10</us-application-series-code>
<us-term-of-grant>
<us-term-extension>590</us-term-extension>
<disclaimer>
<text>This patent is subject to a terminal disclaimer.</text>
</disclaimer>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>15</main-group>
<subgroup>16</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>709249</main-classification>
<further-classification>709223</further-classification>
<further-classification>370389</further-classification>
</classification-national>
<invention-title id="d0e55">Method and architecture for logical aggregation of multiple servers</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5528595</doc-number>
<kind>A</kind>
<name>Walsh et al.</name>
<date>19960600</date>
</document-id>
</patcit>
<category>cited by other</category>
<classification-national><country>US</country><main-classification>380 8513</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5740164</doc-number>
<kind>A</kind>
<name>Liron</name>
<date>19980400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370316</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6006259</doc-number>
<kind>A</kind>
<name>Adelman et al.</name>
<date>19991200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709223</main-classification></classification-national>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>6119171</doc-number>
<kind>A</kind>
<name>Alkhatib</name>
<date>20000900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>6330562</doc-number>
<kind>B1</kind>
<name>Boden et al.</name>
<date>20011200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>6333931</doc-number>
<kind>B1</kind>
<name>LaPier et al.</name>
<date>20011200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370385</main-classification></classification-national>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>6393482</doc-number>
<kind>B1</kind>
<name>Rai et al.</name>
<date>20020500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>6405251</doc-number>
<kind>B1</kind>
<name>Bullard et al.</name>
<date>20020600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709224</main-classification></classification-national>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>6415329</doc-number>
<kind>B1</kind>
<name>Gelman et al.</name>
<date>20020700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>6446200</doc-number>
<kind>B1</kind>
<name>Ball et al.</name>
<date>20020900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>6449272</doc-number>
<kind>B1</kind>
<name>Chuah et al.</name>
<date>20020900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370389</main-classification></classification-national>
</citation>
<citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>6452920</doc-number>
<kind>B1</kind>
<name>Comstock</name>
<date>20020900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370349</main-classification></classification-national>
</citation>
<citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>6453419</doc-number>
<kind>B1</kind>
<name>Flint et al.</name>
<date>20020900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>6463475</doc-number>
<kind>B1</kind>
<name>Calhoun</name>
<date>20021000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709227</main-classification></classification-national>
</citation>
<citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>6473798</doc-number>
<kind>B1</kind>
<name>Grosser et al.</name>
<date>20021000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709224</main-classification></classification-national>
</citation>
<citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>6519254</doc-number>
<kind>B1</kind>
<name>Chuah et al.</name>
<date>20030200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370389</main-classification></classification-national>
</citation>
<citation>
<patcit num="00017">
<document-id>
<country>US</country>
<doc-number>6535493</doc-number>
<kind>B1</kind>
<name>Lee et al.</name>
<date>20030300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370329</main-classification></classification-national>
</citation>
<citation>
<patcit num="00018">
<document-id>
<country>US</country>
<doc-number>6591306</doc-number>
<kind>B1</kind>
<name>Redlich</name>
<date>20030700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709245</main-classification></classification-national>
</citation>
<citation>
<patcit num="00019">
<document-id>
<country>US</country>
<doc-number>6633563</doc-number>
<kind>B1</kind>
<name>Lin et al.</name>
<date>20031000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370389</main-classification></classification-national>
</citation>
<citation>
<patcit num="00020">
<document-id>
<country>US</country>
<doc-number>6636491</doc-number>
<kind>B1</kind>
<name>Kari et al.</name>
<date>20031000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370328</main-classification></classification-national>
</citation>
<citation>
<patcit num="00021">
<document-id>
<country>US</country>
<doc-number>6640251</doc-number>
<kind>B1</kind>
<name>Wiget et al.</name>
<date>20031000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709238</main-classification></classification-national>
</citation>
<citation>
<patcit num="00022">
<document-id>
<country>US</country>
<doc-number>6687732</doc-number>
<kind>B1</kind>
<name>Bector et al.</name>
<date>20040200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709200</main-classification></classification-national>
</citation>
<citation>
<patcit num="00023">
<document-id>
<country>US</country>
<doc-number>6832322</doc-number>
<kind>B1</kind>
<name>Boden et al.</name>
<date>20041200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>726 15</main-classification></classification-national>
</citation>
<citation>
<patcit num="00024">
<document-id>
<country>US</country>
<doc-number>6963582</doc-number>
<kind>B1</kind>
<name>Xu</name>
<date>20051100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370466</main-classification></classification-national>
</citation>
<citation>
<nplcit num="00025">
<othercit>Dial-in virtual private networks using layer tunneling Malkin, G.S.; Local Computer Networks, 1997. Proceedings., 22nd Annual Conference on Nov. 2-5, 1997 pp. 555-561.</othercit>
</nplcit>
<category>cited by examiner</category>
</citation>
<citation>
<nplcit num="00026">
<othercit>IP access service provision for broadband customers Komisarczuk, P.; Services Over the Internet—What Does Quality Cost? (Ref. No. 1999/099), IEE Colloquium on Jun. 23, 1999 pp. 5/1-5/4.</othercit>
</nplcit>
<category>cited by examiner</category>
</citation>
<citation>
<nplcit num="00027">
<othercit>Mobile PPP www.ietf.org/proceedings/98dec/I-D/draft-ietf-pppext-mppp-00.txt.</othercit>
</nplcit>
<category>cited by examiner</category>
</citation>
<citation>
<nplcit num="00028">
<othercit>L2TP Security Extensions fro Non-IP networks quimby.gnus.org/internet-drafts/draft-ietf-pppext-12tp-sec-04.txt.</othercit>
</nplcit>
<category>cited by examiner</category>
</citation>
<citation>
<nplcit num="00029">
<othercit>W. Townsley et al., “Layer Two Tunneling Protocol L2TP”, Network Working Group, RFC 2661, Aug. 1999, pp. 1-80.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00030">
<othercit>Rigney et al., “<i>Remote Authentication Dial In User Service </i>(<i>RADIUS</i>)”, Network Working Group, RFC 2138, Apr. 1997, pp. 1-65.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00031">
<othercit>C. Perkins, “IP Mobility Support”, Network Working Group, RFC 2002, Oct. 1996, pp. 1-79.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00032">
<othercit>W. Simpson, “<i>The Point-To-Point Protocol </i>(<i>PPP</i>)”, Network Working Group, RFC 1661, Jul. 1994, pp. i-52.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00033">
<othercit>W. Simpson, “PPP In HDLC-Like Framing”, Network Working Group, RFC 1662, Jul. 1994, pp. i-25.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00034">
<othercit>D. Rand, “PPP Reliable Transmission”, Network Working Group, RFC 1663, Jul. 1994, pp. 1-8.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00035">
<othercit>S. Deering, “Host Extenions for IP Multicasting”, Network Working Group, RFC 1112, Aug. 1989, pp. 1-17.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00036">
<othercit>W. Fenner, “Internet Group Management Protocol, Version 2”, Network Working Group, RFC 2236, Nov. 1997, pp. 1-24.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00037">
<othercit>Mobile IP at IETF 43—Parkins (1998) ; www.svrloc.org/˜charliep/txt/mc2r<sub>—</sub>98d/mc2r<sub>—</sub>98d.ps.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00038">
<othercit>NETBuilder Family Software Version 11.1 Features; http://support/3com/com/infodeli/tools/bridrout/u<sub>—</sub>guides/html/nb111/family/features/ras.htm, 1992.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00039">
<othercit>Remote Access Software Version 5.1 Release Notes (118362-A Rev. A); www25.nortelnetworks.com/library/tpubs/p...c51/118362A.PDF, 1997.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>20</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>709200</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709223</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709224</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709238</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709227</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709245</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370389</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>5</number-of-drawing-sheets>
<number-of-figures>5</number-of-figures>
</figures>
<us-related-documents>
<continuation>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>09514108</doc-number>
<kind>00</kind>
<date>20000228</date>
</document-id>
<parent-grant-document>
<document-id>
<country>US</country>
<doc-number>6654792</doc-number>
<kind>A </kind>
</document-id>
</parent-grant-document>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>10657778</doc-number>
</document-id>
</child-doc>
</relation>
</continuation>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Verma</last-name>
<first-name>Rohit</first-name>
<address>
<city>Schaumburg</city>
<state>IL</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Senthilnathan</last-name>
<first-name>Janakiraman</first-name>
<address>
<city>Mount Prospect</city>
<state>IL</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>McDonnell Boehnen Hulbert &amp; Berghoff LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>3Com Corporation</orgname>
<role>02</role>
<address>
<city>Marlborough</city>
<state>MA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Vu</last-name>
<first-name>Thong</first-name>
<department>2616</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A system and method are shown for multiple network devices to operate as a single logical entity for serving tunnel connections. A cluster master device is connected to a multiple network devices through a local area network (LAN). The cluster master device is also connected to a wide area network (WAN) and has a master address that is unique on the WAN. The cluster master device receives a tunnel connection set-up request (SCCRQ) from the WAN that is addressed to the master address. The cluster master device selects one of the multiple network devices and forwards the SCCRQ message over the LAN to the selected network device. The selected network device selects a tunnel identification number that is unique for the tunnel connection on the selected network device and places the tunnel identification number into a source tunnel identification field of a connection set-up reply (SCCRP). The selected network device also places its own global address on the WAN into a source address field of the SCCRP, a value from a source address field of the SCCRQ into a destination address field of the SCCRP, and a value from a source tunnel identification field of the SCCRQ into a destination tunnel identification field of the SCCRP. The selected network device then transmits the SCCRP message onto the WAN. Alternatively, the multiple network devices do not have global addresses on the WAN and the SCCRP is transmitted over the LAN to a network address translation (NAT) server that substitutes its own address into the source address field of the SCCRP and retransmits the SCCRP onto the WAN. The NAT creates a table from the information in the SCCRP that it uses to translate and route subsequent packets between the selected network device and the device that requested the tunnel connection.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="155.96mm" wi="235.63mm" file="US07299301-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="189.57mm" wi="153.50mm" orientation="landscape" file="US07299301-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="238.42mm" wi="161.04mm" orientation="landscape" file="US07299301-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="228.77mm" wi="157.90mm" orientation="landscape" file="US07299301-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="217.76mm" wi="157.65mm" orientation="landscape" file="US07299301-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="228.85mm" wi="147.32mm" orientation="landscape" file="US07299301-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS REFERENCE TO RELATED APPLICATION</heading>
<p id="p-0002" num="0001">The present patent application is a continuation application of U.S. patent application Ser. No. 09/514,108, filed on Feb. 28, 2000, the full disclosure of which is incorporated herein by reference.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">FIELD OF INVENTION</heading>
<p id="p-0003" num="0002">The present invention relates to data communications. More specifically, it relates to the transmission of packets in a point to point communication link.</p>
<heading id="h-0003" level="1">BACKGROUND</heading>
<p id="p-0004" num="0003">Connection oriented point-to-point communication links, such as a Layer 2 Tunneling Protocol (L2TP) tunnel, are an increasingly common feature of network infrastructures. Tunnels are prearranged connections established by agreement between internet service providers (ISPs). See Request for Comment (RFC) 2661 and <i>Layer Two Tunnelling Protocol </i>(L2TP), A. Valencia, et al., draft-ietf-pppext-12tp-16.txt, June 1999, herein incorporated by reference, available from the Internet Engineering Task Force (IETF) at www.ietf.org for more information. <figref idref="DRAWINGS">FIG. 1</figref> shows an architecture <b>10</b> that illustrates two L2TP tunnels <b>56</b> and <b>58</b> from tunnel initiators <b>30</b> and <b>40</b>, respectively, established through a public IP network <b>70</b> to a tunnel endpoint server <b>50</b>.</p>
<p id="p-0005" num="0004">An L2TP tunnel typically provides a conduit for communications between client devices served by the tunnel initiators and a server device served by tunnel endpoint <b>50</b>. Typically, a single tunnel slot provides the communication link between a client and server.</p>
<p id="p-0006" num="0005">When a client device establishes a dial-up connection with a tunnel initiator (TI) <b>30</b> or <b>40</b>, then the TI typically recognizes the client device as a tunnel client by means of an authentication protocol, such as RADIUS, see Request For Comment (RFC) 2138, herein incorporated by reference, or by other means for identifying the client, such as through the use of a mobile identification number (MIN) in mobile applications or, for protocols not directed toward mobile applications, the use of a Dial-up Number Information Service (DNIS) or Automatic Number identification (ANI). The authentication process can be adapted to provide an address for a tunnel endpoint device for the client. Alternatively, the client device itself may provide the tunnel endpoint address. In still another approach, each TI may have a pre-constructed table containing entries that associate a client device identifiers with a tunnel endpoint address value. Independent of how the tunnel endpoint address is obtained, the tunnel initiator will establish a tunnel connection to the tunnel endpoint device.</p>
<p id="p-0007" num="0006">Tunnel endpoint devices are typically stand-alone devices that operate independently of other tunnel endpoints. As a result, the tunnel endpoint devices are difficult to scale in order to cope with high levels of traffic to a server device connected to the tunnel endpoint device. In addition, with a single tunnel endpoint device serving a given server device, failure of the tunnel endpoint device can block all traffic to the server.</p>
<p id="p-0008" num="0007">Thus, the need remains for a method for providing multiple tunnel endpoint devices that can serve a single server device.</p>
<heading id="h-0004" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0009" num="0008">In accordance with preferred embodiments of the present invention, some of the problems associated with combining multiple tunnel endpoint devices are overcome.</p>
<p id="p-0010" num="0009">An embodiment of a system, according to the present invention, for terminating tunnel connections includes a first network and a plurality of network devices. Each network device has a network interface coupled to the first network and has a local address that is unique on the first network. Each network device is configured to receive a connection request message having a source address field, a destination address field, and a source tunnel identification field and, responsive thereto, construct a connection reply message having a source address field set to the local address of the network device, a destination address field set to the value of the source address field of the connection request message, a source tunnel identification field set to a value selected by the network device, and a destination tunnel identification field set to the value of the source tunnel identification. The connection reply message then being transmitted onto the first network. A master network device has a first interface coupled to the first network and a second interface for communicating with a second network. The master network device also has a first global address that is unique on the second network. The master network device is configured to receive tunnel connection request messages having the first global address in the destination field from the second network and, for each connection request message received, select one of the plurality of network devices, insert the local address for the selected network device into the destination field of the received connection request message, and forward the received connection request message to the selected network device over the first network. A network address translation device has a first network interface coupled to the first network and a second network interface for communicating with the second network. The network address translation device also has a second global address that is unique on the second network. The network address translation device is configured to receive the connection reply messages and, responsive thereto, create a table entry for each connection reply message that includes the value of the destination address field and the value of the source address field for the received connection reply message. The network address translation device is also configured to insert the second global address into the source address field of the connection reply message and transmit the connection reply message onto the second network.</p>
<p id="p-0011" num="0010">Another embodiment of a system for terminating tunnel connections, according to the present invention, includes a first network along with a plurality of network devices, each network device having a first network interface coupled to the first network and having a local address that is unique on the first network. Each network device also has a second network interface for communicating with a second network and has a global address that is unique on the second network. Each network device is configured to receive a connection request message on the first network interface having a source address field, a destination address field, and a source tunnel identification field and, responsive thereto, construct a connection reply message having a source address field set to the global address of the network device, a destination address field set to the value of the source address field of the connection request message, a source tunnel identification field set to a value selected by the network device, and a destination tunnel identification field set to the value of the source tunnel identification field of the connection request message. Each network device is further configured to transmit the connection reply message over the second network interface onto the second network. A master network device has a first interface coupled to the first network and a second interface for communicating with the second network. The master network device has a master global address that is unique on the second network. The master network device is configured to receive tunnel connection request messages having the master global address in the destination field from the second network and, for each connection request message received, select one of the plurality of network devices, insert the local address for the selected network device into the destination address field of the received connection request message, and transmit the received connection request message as modified over the first network interface onto the first network.</p>
<p id="p-0012" num="0011">An embodiment of a method for terminating tunnel connections, according to the present invention, calls for transmitting a tunnel connection set-up request from a first network device having a first global address value to a second global address value, the tunnel connection set-up request including a source address field containing the first global address value, a source tunnel identifier field containing a first tunnel identifier value assigned by the first network device, and a destination address field containing the second global address value. The method also calls for receiving the tunnel connection set-up request at a second network device corresponding to the second global address value, selecting one of a plurality of tunnel endpoint servers coupled to the second network device, and forwarding the tunnel connection set-up request to the selected tunnel endpoint server. Upon receiving the tunnel connection set-up request in the selected tunnel endpoint server, the method sets forth forming a tunnel set-up reply by inserting the value from the source address field of the tunnel set-up request into a destination address field of the tunnel set-up reply, inserting the value from the source tunnel identifier field of the tunnel set-up request into a destination tunnel identifier field of the tunnel set-up reply, selecting a second tunnel identifier value for the tunnel connection, inserting the second tunnel identifier value into a source tunnel identifier field of the tunnel set-up reply, and inserting an address value for the selected tunnel endpoint server into a source address field of the tunnel set-up reply. The method then provides for transmitting the tunnel set-up reply to the first network device over the first network.</p>
<p id="p-0013" num="0012">The foregoing and other features and advantages of a preferred embodiment of the present invention will be more readily apparent from the following detailed description, which proceeds with references to the accompanying drawings.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0005" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0014" num="0013">The present invention is described in the context of an embodiment of the invention with reference to the following drawings, wherein:</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 1</figref> is a functional block diagram illustrating a network architecture featuring tunnel connections from tunnel initiator devices through a public IP network to a tunnel endpoint device;</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 2</figref> is a functional block diagram illustrating a network architecture, according to an embodiment of the present invention, showing a cluster of tunnel endpoint devices operating in conjunction with a cluster master and a network address translation server;</p>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 3</figref> is a message sequence diagram illustrating an example of message traffic, according to the present invention, related to establishing a tunnel control session between a tunnel initiator and a tunnel endpoint in the architecture of <figref idref="DRAWINGS">FIG. 2</figref>;</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 4</figref> is a functional block diagram illustrating yet another network architecture, according to an embodiment of the present invention, where each tunnel endpoint device in a cluster has a unique address for routing on a public IP network; and</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 5</figref> is a message sequence diagram illustrating an example of message traffic, according to the present invention, related to establishing a tunnel control session between a tunnel initiator and a tunnel endpoint in the architecture of <figref idref="DRAWINGS">FIG. 4</figref>.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0006" level="1">DETAILED DESCRIPTION OF PREFERRED EMBODIMENTS</heading>
<p id="p-0020" num="0019">The present invention is directed toward a method and architecture for logically aggregating multiple tunnel endpoint devices.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 2</figref> is a block diagram illustrating an embodiment of a network architecture <b>100</b> according to the present invention. Architecture <b>100</b> includes tunnel initiators <b>30</b> and <b>40</b> connected to public IP network <b>70</b>. A cluster <b>150</b> according to the present invention is also connected to the public IP network via connection <b>152</b> to cluster master <b>154</b>. Cluster <b>150</b> also includes a network address translation (NAT) server <b>160</b>, such as a device conforming to RFC 2766, that is coupled to the rest of cluster <b>150</b> through a back-end local area network (LAN) <b>156</b>. Also connected to LAN <b>156</b> are tunnel endpoint devices <b>170</b>A, <b>170</b>B and <b>170</b>C.</p>
<p id="p-0022" num="0021">One example of a tunnel endpoint device is a network access server, such as that described in the patent to Dale M. Walsh et al., U.S. Pat. No. 5,528,595, which is fully incorporated by reference herein and describes an integrated network access server suitable for use in the present invention. Such a device has been commercialized widely by 3Com Corporation (previously U.S. Robotics Corp.) under the trade designation Total Control™ Enterprise Network Hub. Network access servers similar in functionality, architecture and design are available from other companies, including Lucent Technologies, Cisco Systems, and others. The invention is suitable for implementation in network access servers from the above companies, and other similar devices.</p>
<p id="p-0023" num="0022">The tunnel endpoint devices <b>170</b>A, <b>170</b>B and <b>170</b>C can have only local addresses for routing traffic on LAN <b>156</b> or they can have global IP addresses for routing traffic over IP network <b>70</b>. If the tunnel endpoint devices <b>170</b>A, <b>170</b>B and <b>170</b>C have their own global IP addresses, then NAT server <b>160</b> is unnecessary. However, in the embodiment of <figref idref="DRAWINGS">FIG. 2</figref>, tunnel endpoint devices <b>170</b>A, <b>170</b>B and <b>170</b>C have only local addresses and NAT server <b>160</b> is required to translate addresses between the LAN <b>156</b> and the IP network <b>70</b>.</p>
<p id="p-0024" num="0023">Cluster master <b>154</b> possesses a master IP address for cluster <b>150</b> that all tunnel initiator devices will use to initially contact the cluster. Thus, when tunnel initiator <b>40</b> sends out Start-Control-Connection-Request (SCCRQ) message <b>102</b> to initiate establishment of a tunnel connection, the destination address of the SCCRQ address is set to the master IP address for cluster <b>150</b>. The SCCRQ message <b>102</b> will contain a tunnel ID value assigned by tunnel initiator <b>40</b> to the tunnel connection being set-up. See RFC 2661 for additional details.</p>
<p id="p-0025" num="0024">Also note that <figref idref="DRAWINGS">FIG. 3</figref> is a message diagram illustrating an example of the message exchange taking place in the architecture of <figref idref="DRAWINGS">FIG. 2</figref> in order to establish a tunnel connection and may be viewed in combination with <figref idref="DRAWINGS">FIG. 2</figref> to further an understanding of the present invention. Thus, SCCRQ message <b>102</b> has a destination address field that is set to the IP address of cluster master <b>154</b> (dest=CM), a source address field that is set to the IP address of tunnel initiator <b>40</b>, and a source tunnel ID field set to the tunnel ID value assigned to the tunnel connection by tunnel initiator <b>40</b> (source tunnel ID=1).</p>
<p id="p-0026" num="0025">Cluster master <b>154</b> receives SCCRQ message <b>102</b> and determines which tunnel endpoint device <b>170</b>A, <b>170</b>B and <b>170</b>C should receive the message. A variety of load-sharing approaches exist for tunnel endpoint device assignment, such as round-robin or leaky bucket. The preferred approach is for the cluster master <b>154</b> to receive load status messages from each tunnel endpoint device <b>170</b>A, <b>170</b>B and <b>170</b>C and assign the SCCRQ message <b>102</b> to the device that currently has the lowest load and indicated by the load status messages.</p>
<p id="p-0027" num="0026">Note that cluster master <b>154</b> can perform additional network management functions as well. For example, the cluster master <b>154</b> can keep track of tunnel endpoint devices that are out of service or temporarily inactive. Alternatively, the cluster master <b>154</b> can inactivate one or more tunnel endpoint devices if they are unnecessarily given the level of traffic on cluster <b>150</b>. One of ordinary skill in the art will appreciate that the cluster master <b>154</b> can perform additional network management functions as well.</p>
<p id="p-0028" num="0027">In the example of <figref idref="DRAWINGS">FIG. 2</figref>, tunnel endpoint device <b>170</b>C has the lowest load level and cluster master <b>154</b> forwards the SCCRQ message <b>102</b> to tunnel endpoint device <b>170</b>C. To forward SCCRQ message <b>102</b>, cluster master <b>154</b> substitutes the local address of tunnel endpoint device <b>170</b>C in LAN <b>156</b> into the destination address field of the SCCRQ message (dest=TE) and transmits the modified SCCRQ message <b>104</b> onto LAN <b>156</b>.</p>
<p id="p-0029" num="0028">In response to the SCCRQ message <b>104</b>, tunnel endpoint device <b>170</b>C formulates a Start-Control-Connection-Reply (SCCRP) message <b>106</b>. The SCCRP message <b>106</b> includes the address of tunnel initiator <b>40</b> (dest=TI) as well as the tunnel ID value (dest tunnel ID=1) assigned to the tunnel connection by tunnel initiator <b>40</b> and contained within SCCRQ message <b>102</b>. The SCCRP message <b>106</b> also includes a tunnel ID value (source tunnel ID=2) assigned to the tunnel connection by tunnel endpoint <b>170</b>C. The SCCRP message <b>106</b> is then forwarded to NAT server <b>160</b> over LAN <b>156</b>.</p>
<p id="p-0030" num="0029">The NAT server <b>160</b> acts as a gateway for packets on LAN <b>156</b> that are addressed to destinations on IP network <b>70</b>. NAT server <b>160</b> may advertise the addresses to which it can route packets over LAN <b>156</b> to the devices attached to LAN <b>156</b>.</p>
<p id="p-0031" num="0030">When NAT server <b>160</b> receives SCCRP message <b>106</b>, it uses the message to create a table entry, as shown in Table 1 below. The table entry contains the local address for tunnel endpoint device <b>170</b>C combined with a channel or port identifier, as assigned to the tunnel connection by tunnel endpoint <b>170</b>C, along with the global IP address of tunnel initiator <b>40</b> combined with a channel or port identifier, as assigned by tunnel initiator <b>40</b>. In the present example, the channel/port identifier at each end is the UDP port assigned by the device. Other protocols will employ other types of identifiers, such as a Virtual Channel Identifier (VCI) or a Virtual Path Identifier (VPI) for an Asynchronous Transfer Mode (ATM) network. Thus, the table entry creates a correspondence between the physical devices and local connections at each end of the tunnel connection. NAT server <b>160</b> then substitutes its own global IP address for the local IP address of tunnel endpoint device <b>170</b>C in the source address field of the SCCRP message (source=NAT) and forwards the modified SCCRP message <b>108</b> to tunnel initiator <b>40</b>.</p>
<p id="p-0032" num="0031">
<tables id="TABLE-US-00001" num="00001">
<table frame="none" colsep="0" rowsep="0">
<tgroup align="left" colsep="0" rowsep="0" cols="4">
<colspec colname="1" colwidth="49pt" align="left"/>
<colspec colname="2" colwidth="49pt" align="left"/>
<colspec colname="3" colwidth="56pt" align="left"/>
<colspec colname="4" colwidth="63pt" align="left"/>
<thead>
<row>
<entry namest="1" nameend="4" rowsep="1">TABLE 1</entry>
</row>
<row>
<entry namest="1" nameend="4" align="center" rowsep="1"/>
</row>
<row>
<entry/>
<entry>FAR END</entry>
<entry/>
<entry/>
</row>
<row>
<entry>FAR END</entry>
<entry>CHANNEL/</entry>
<entry>LOCAL END</entry>
<entry>LOCAL END</entry>
</row>
<row>
<entry>IP ADDRESS</entry>
<entry>PORT</entry>
<entry>NET ADDRESS</entry>
<entry>CHANNEL/PORT</entry>
</row>
<row>
<entry namest="1" nameend="4" align="center" rowsep="1"/>
</row>
</thead>
<tbody valign="top">
<row>
<entry>Global address</entry>
<entry>(UDP port</entry>
<entry>Local address for</entry>
<entry>(UDP port assigned</entry>
</row>
<row>
<entry>for tunnel </entry>
<entry>assigned by</entry>
<entry>tunnel endpoint</entry>
<entry>by tunnel endpoint</entry>
</row>
<row>
<entry>initiator 40.</entry>
<entry>tunnel</entry>
<entry>170C.</entry>
<entry>170C).</entry>
</row>
<row>
<entry/>
<entry>initiator 40).</entry>
</row>
<row>
<entry namest="1" nameend="4" align="center" rowsep="1"/>
</row>
</tbody>
</tgroup>
</table>
</tables>
</p>
<p id="p-0033" num="0032">When tunnel initiator <b>40</b> receives modified SCCRP message <b>108</b>, it completes construction of a table entry, as shown in Table 2 below, for the tunnel connection. The table entry includes the address and connection identifier (i.e. MAC port) for the client and the tunnel ID that it has assigned for the connection (tunnel ID <b>1</b>). The table entry also contains the address from the source address field of the SCCRP message (the global IP address of NAT server <b>160</b>) along with the connection identifier (i.e. UDP port), and the tunnel ID assigned to the connection by the tunnel endpoint (tunnel ID <b>2</b>). The use of the value from the source address field of the SCCRP message <b>108</b> to construct the table is typically a standard part of the L2TP protocol and the present invention, therefore, typically will not require modification of the L2TP functionality in the tunnel initiator devices.</p>
<p id="p-0034" num="0033">
<tables id="TABLE-US-00002" num="00002">
<table frame="none" colsep="0" rowsep="0">
<tgroup align="left" colsep="0" rowsep="0" cols="4">
<colspec colname="1" colwidth="56pt" align="left"/>
<colspec colname="2" colwidth="49pt" align="left"/>
<colspec colname="3" colwidth="49pt" align="left"/>
<colspec colname="4" colwidth="63pt" align="left"/>
<thead>
<row>
<entry namest="1" nameend="4" rowsep="1">TABLE 2</entry>
</row>
<row>
<entry namest="1" nameend="4" align="center" rowsep="1"/>
</row>
<row>
<entry>CLIENT</entry>
<entry/>
<entry>FAR END</entry>
<entry>FAR END</entry>
</row>
<row>
<entry>ADDRESS</entry>
<entry>TUNNEL ID</entry>
<entry>ADDRESS</entry>
<entry>TUNNEL ID</entry>
</row>
<row>
<entry namest="1" nameend="4" align="center" rowsep="1"/>
</row>
</thead>
<tbody valign="top">
<row>
<entry>Local address for</entry>
<entry>Tunnel ID 1 (as</entry>
<entry>Global address</entry>
<entry>Tunnel ID 2 (as</entry>
</row>
<row>
<entry>client connected</entry>
<entry>assigned by</entry>
<entry>for NAT 160,</entry>
<entry>assigned by tunnel</entry>
</row>
<row>
<entry>to tunnel initiator</entry>
<entry>tunnel initiator</entry>
<entry>including</entry>
<entry>endpoint 170C and</entry>
</row>
<row>
<entry>40, including</entry>
<entry>40 and inserted</entry>
<entry>port/channel</entry>
<entry>obtained from</entry>
</row>
<row>
<entry>MAC address/</entry>
<entry>into source</entry>
<entry>identifier</entry>
<entry>source Tunnel ID</entry>
</row>
<row>
<entry>port identifier</entry>
<entry>Tunnel ID field</entry>
<entry>on NAT.</entry>
<entry>field of</entry>
</row>
<row>
<entry>for client.</entry>
<entry>of SCCRQ</entry>
<entry/>
<entry>SCCRP message).</entry>
</row>
<row>
<entry/>
<entry>message).</entry>
</row>
<row>
<entry namest="1" nameend="4" align="center" rowsep="1"/>
</row>
</tbody>
</tgroup>
</table>
</tables>
</p>
<p id="p-0035" num="0034">Tunnel initiator <b>40</b> then sends a Start-Control-Connection-Connected (SCCN) message <b>110</b> back to the NAT server <b>160</b>. NAT server <b>160</b> receives the SCCN message and uses the source address (source=TI) and connection identifier (i.e. UDP port) to search the table for the entry for the connection. The local address for tunnel endpoint <b>170</b>C is obtained from the tunnel entry and the SCCN message is forwarded via LAN <b>156</b> to the tunnel endpoint device as modified SCCN message <b>112</b>. At this point, the control connection for the tunnel connection between tunnel initiator <b>40</b> and tunnel endpoint <b>170</b>C is established. If no messages are waiting in the queue at tunnel endpoint <b>170</b>C, then a Zero-Length-Body (ZLB) acknowledge message <b>114</b> is sent to tunnel initiator <b>40</b> via NAT server <b>160</b> as modified ZLB-ACK message <b>116</b>.</p>
<p id="p-0036" num="0035">With the control session established for the tunnel connection between tunnel initiator <b>40</b> and tunnel endpoint <b>170</b>C, a call session can be established to carry traffic between a client connected to tunnel initiator <b>40</b> and tunnel endpoint <b>170</b>C. When tunnel initiator <b>40</b> receives an L2TP packet from NAT server <b>160</b> with destination port value equal to the UDP port assigned to the connection by tunnel endpoint <b>170</b>C, it will strip off the L2TP headers and use the Table 2 entry for the tunnel to route the packet to the remote client. Similarly, packets received from the remote client are encapsulated in L2TP with the destination port set to the UDP port assigned by tunnel initiator <b>40</b> and forwarded to NAT server <b>160</b>. NAT server <b>160</b> will look at the source address and port for the packets, search Table 1 for a matching entry, and, using the matching entry to identify the proper tunnel endpoint device, forward the packets to tunnel endpoint <b>170</b>C. Tunnel endpoint <b>170</b>C will receive the packets, strip off the L2TP and process the remaining portion of the packet as if it had been received on a local link interface, such as a point-to-point protocol (PPP) interface. See RFC 2661 for additional information on L2TP processing.</p>
<p id="p-0037" num="0036"><figref idref="DRAWINGS">FIG. 4</figref> is a functional block diagram illustrating another architecture <b>200</b> that includes a cluster <b>250</b> according to the present invention. Cluster <b>250</b> includes cluster master <b>254</b>, which has the master IP address for the cluster, that is connected to tunnel endpoint devices <b>270</b>A, <b>270</b>B and <b>270</b>C via LAN <b>256</b>. Tunnel endpoint devices <b>270</b>A, <b>270</b>B and <b>270</b>C are connected to IP network <b>70</b> via communications links <b>272</b>A, <b>272</b>B and <b>272</b>C, respectively, and each has its own global IP address.</p>
<p id="p-0038" num="0037">Just as in <figref idref="DRAWINGS">FIGS. 2 and 3</figref>, tunnel initiator address SCCRQ message <b>102</b> to the master IP address held by cluster master <b>254</b>. Cluster master <b>254</b> determines which of the tunnel endpoint devices <b>270</b>A, <b>270</b>B and <b>270</b>C is to service the tunnel connection request and forwards the SCCRQ message <b>102</b> to the selected device. In the example of <figref idref="DRAWINGS">FIG. 4</figref>, cluster master <b>254</b> selects tunnel endpoint device <b>270</b>C, substitutes the local address for tunnel endpoint <b>270</b>C into the destination field of SCCRQ message <b>102</b> (dest=local TE) and transmits modified message <b>204</b> over LAN <b>256</b> to tunnel endpoint <b>270</b>C.</p>
<p id="p-0039" num="0038">In response to the SCCRQ message <b>204</b>, tunnel endpoint device <b>270</b>C formulates a Start-Control-Connection-Reply (SCCRP) message <b>206</b>. The SCCRP message <b>206</b> includes the address of tunnel initiator <b>40</b> (dest=TI) as well as the tunnel ID value (dest tunnel ID=1) assigned to the tunnel connection by tunnel initiator <b>40</b> and contained within SCCRQ message <b>102</b>. The SCCRP message <b>206</b> also includes the global IP address for tunnel endpoint <b>270</b>C (source=globalTE) and a tunnel ID value (source tunnel ID=2) assigned to the tunnel connection by tunnel endpoint <b>270</b>C. The SCCRP message <b>206</b> is then transmitted over IP network <b>70</b> to tunnel initiator <b>40</b>.</p>
<p id="p-0040" num="0039">When tunnel initiator <b>40</b> receives SCCRP message <b>208</b>, it creates a table entry, as shown in Table 3 below, for the tunnel connection that includes its own tunnel ID for the connection (tunnel ID <b>1</b>), the address from the source address field of the SCCRP message (the global IP address of tunnel endpoint device <b>270</b>C) along with the UDP port, and the tunnel ID assigned to the connection by the tunnel endpoint (tunnel ID <b>2</b>). The use of the value from the source address field of the SCCRP message <b>208</b> to construct the table is typically a standard part of the L2TP protocol and the present invention, therefore, typically will not require modification of the L2TP functionality in the tunnel initiator devices.</p>
<p id="p-0041" num="0040">
<tables id="TABLE-US-00003" num="00003">
<table frame="none" colsep="0" rowsep="0">
<tgroup align="left" colsep="0" rowsep="0" cols="4">
<colspec colname="1" colwidth="56pt" align="left"/>
<colspec colname="2" colwidth="42pt" align="left"/>
<colspec colname="3" colwidth="56pt" align="left"/>
<colspec colname="4" colwidth="63pt" align="left"/>
<thead>
<row>
<entry namest="1" nameend="4" rowsep="1">TABLE 3</entry>
</row>
<row>
<entry namest="1" nameend="4" align="center" rowsep="1"/>
</row>
<row>
<entry>CLIENT</entry>
<entry/>
<entry>FAR END</entry>
<entry>FAR END</entry>
</row>
<row>
<entry>ADDRESS</entry>
<entry>TUNNEL ID</entry>
<entry>ADDRESS</entry>
<entry>TUNNEL ID</entry>
</row>
<row>
<entry namest="1" nameend="4" align="center" rowsep="1"/>
</row>
</thead>
<tbody valign="top">
<row>
<entry>Local address</entry>
<entry>Tunnel ID 1</entry>
<entry>Global address</entry>
<entry>Tunnel ID 2 (as</entry>
</row>
<row>
<entry>for client</entry>
<entry>(as assigned</entry>
<entry>for tunnel</entry>
<entry>assigned by tunnel</entry>
</row>
<row>
<entry>connected to</entry>
<entry>by tunnel</entry>
<entry>endpoint 270C.</entry>
<entry>endpoint 270C).</entry>
</row>
<row>
<entry>tunnel</entry>
<entry>initiator 40).</entry>
</row>
<row>
<entry>initiator 40.</entry>
</row>
<row>
<entry namest="1" nameend="4" align="center" rowsep="1"/>
</row>
</tbody>
</tgroup>
</table>
</tables>
</p>
<p id="p-0042" num="0041">Tunnel initiator <b>40</b> then sends a Start-Control-Connection-Connected (SCCN) message <b>210</b> back to the tunnel endpoint <b>270</b>C using the global IP address for the endpoint device and the UDP port for the tunnel connection. Tunnel endpoint device <b>270</b>C receives the SCCN message and checks the tunnel ID field against its own connection data for the tunnel connection. At this point, the control connection for the tunnel connection between tunnel initiator <b>40</b> and tunnel endpoint <b>270</b>C is established. If no messages are waiting in the queue at tunnel endpoint <b>270</b>C, then a Zero-Length-Body (ZLB) acknowledge message <b>214</b> is sent to tunnel initiator <b>40</b> with the source address field set to the global IP address of tunnel endpoint <b>270</b>C (source=globalTE). With the control session established for the tunnel connection between tunnel initiator <b>40</b> and tunnel endpoint <b>270</b>C, a call session can be established to carry traffic between a client connected to tunnel initiator <b>40</b> and tunnel endpoint <b>270</b>C, as described above and in RFC 2661.</p>
<p id="p-0043" num="0042">An advantage of the cluster <b>250</b> of <figref idref="DRAWINGS">FIG. 4</figref> is that all the tunnel endpoint devices <b>270</b>A, <b>270</b>B and <b>270</b>C are connected to IP network <b>70</b>. In the event of a failure of cluster master <b>254</b>, another one of the tunnel endpoint devices <b>270</b>A, <b>270</b>B and <b>270</b>C can take over as cluster master and process incoming tunnel connection request to the master IP address. This can improve the reliability of cluster <b>250</b>.</p>
<p id="p-0044" num="0043">The protocol according to the present invention supports the deterministic selection of an endpoint for connections having multiple origination points. Although the present invention is described in the context of an L2TP tunnel, the present invention is applicable to any communications link where it is desirable to provide for multiple tunnel endpoint server devices to operate as a single logical entity.</p>
<p id="p-0045" num="0044">It should be understood that the programs, processes, methods, systems and apparatus described herein are not related or limited to any particular type of computer apparatus (hardware or software), unless indicated otherwise. Various types of general purpose or specialized computer apparatus may be used along with the present invention or perform operations in accordance with the teachings described herein.</p>
<p id="p-0046" num="0045">In view of the wide variety of embodiments to which the principles of the invention can be applied, it should be understood that the illustrated embodiments are exemplary only, and should not be taken as limiting the scope of the present invention. For example, variations may be made in the message flow scenarios other than those described, and more or fewer elements or components may be used in the block diagrams. In addition, the present invention can be practiced with software, hardware, or a combination thereof.</p>
<p id="p-0047" num="0046">The claims should not be read as limited to the described order or elements unless stated to that effect. Therefore, all embodiments that come within the scope and spirit of the following claims and equivalents thereto are claimed as the invention.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>We claim:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A tunnel endpoint device comprising:
<claim-text>a network interface connected to a local area network having a cluster of tunnel endpoint devices, the tunnel endpoint device being one of the cluster, the network interface configured to receive a Start-Control-Connection-Request (SCCRQ) message via the local area network to initiate establishment of a tunnel connection, wherein the SCCRQ includes a destination address field modified to be set to a local address of the tunnel endpoint device and a tunnel ID value assigned by a tunnel initiator to the tunnel connection being set-up;
<claim-text>means for forming a Start-Control-Connection-Reply (SCCRP) message having an address of the tunnel initiator, the tunnel ID value assigned to the tunnel connection by the tunnel initiator, and a tunnel ID value assigned to the tunnel connection by the tunnel endpoint device; and</claim-text>
<claim-text>means for transmitting the SCCRP message to a network address translation server via the network interface.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The tunnel endpoint device of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising means for receiving a Start-Control-Connection-Connected (SCCN) message to establish a tunnel connection between the tunnel initiator and the tunnel endpoint device.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The tunnel endpoint device of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising means for forming load status messages that indicate a current traffic load of the tunnel endpoint device.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. A cluster master device comprising:
<claim-text>a first interface coupled to a first network having a plurality of network devices; and</claim-text>
<claim-text>a second interface for communicating with a second network,</claim-text>
<claim-text>wherein the cluster master device has a master global address that is unique on the second network, and</claim-text>
<claim-text>wherein the cluster master device is configured to receive from the second network tunnel connection request messages having the master global address in a destination address field and, for each tunnel connection request message received:
<claim-text>(i) select one of the plurality of network devices;</claim-text>
<claim-text>(ii) insert a local address for the selected network device into the destination address field of the received tunnel connection request message; and</claim-text>
<claim-text>(iii) transmit the received tunnel connection request message as modified over the first network interface onto the first network.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The cluster master device of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the cluster master device selects one of the plurality of network devices based on a traffic load of each network device.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The cluster master device of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the cluster master device receives load status messages from each network device and assigns the received tunnel connection request message to the network device that currently has the lowest traffic load as indicated by the load status messages.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The cluster master device of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the tunnel connections are Layer 2 Tunneling Protocol (L2TP) connections.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The cluster master device of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the first network is a local area network (LAN) and the second network is an Internet protocol (IP) network.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The cluster master device of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the tunnel connection request messages include a source address field set to an IP address of a tunnel initiator, and a source tunnel ID field set to a tunnel ID value assigned to the tunnel connection by the tunnel initiator.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The cluster master device of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the cluster master device keeps track of network devices that are out of service or temporarily inactive.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. A method for terminating tunnel connections comprising:
<claim-text>receiving a tunnel connection request message;</claim-text>
<claim-text>receiving a load status message from each tunnel endpoint device of a plurality of tunnel endpoint devices on a network;</claim-text>
<claim-text>based on the load status messages, selecting a tunnel endpoint device to receive the tunnel connection request message; and</claim-text>
<claim-text>assigning the tunnel connection request message to the selected tunnel endpoint device.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The method of <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein selecting the tunnel endpoint device to receive the tunnel connection request message comprises:
<claim-text>based on the load status messages, determining which tunnel endpoint device has the lowest load; and</claim-text>
<claim-text>selecting the tunnel endpoint device that has the lowest load.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The method of <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein assigning the tunnel connection request message to the selected tunnel endpoint device comprises:
<claim-text>inserting a local address for the selected tunnel endpoint device into a destination address field of the tunnel connection request message; and</claim-text>
<claim-text>transmitting the tunnel connection request message as modified onto the network.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. A method for terminating tunnel connections comprising:
<claim-text>receiving tunnel connection request messages having a master global address in a destination address field and, for each tunnel connection request message received:
<claim-text>selecting one of a plurality of network devices connected to a network;</claim-text>
</claim-text>
<claim-text>inserting a local address for the selected network device into the destination address field of the received tunnel connection request message; and</claim-text>
<claim-text>transmitting the received tunnel connection request message as modified onto the network.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The method of <claim-ref idref="CLM-00014">claim 14</claim-ref>, further comprising transmitting a tunnel set-up reply message over the network, wherein the tunnel set-up reply message includes a source address field having the address of the selected network device.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The method of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein transmitting the tunnel set-up reply message over the network comprises:
<claim-text>transmitting the tunnel set-up reply to a network address translation (NAT) server;</claim-text>
<claim-text>replacing the address of the selected network device in the source address field of the tunnel set-up reply message with a global address for the NAT server;</claim-text>
<claim-text>storing a table entry accessible to the NAT server that relates the global address to the address of the selected network device; and</claim-text>
<claim-text>transmitting the tunnel set-up reply message onto the network.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The method of <claim-ref idref="CLM-00014">claim 14</claim-ref>, wherein selecting one of the plurality of network devices connected to the network comprises selecting one of the plurality of network devices based upon a traffic load on each of the network devices.</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The method of <claim-ref idref="CLM-00014">claim 14</claim-ref>, further comprising receiving load status messages from each of the plurality of network devices.</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The method of <claim-ref idref="CLM-00018">claim 18</claim-ref>, wherein selecting one of the plurality of network devices connected to the network comprises selecting one of the plurality of network devices based upon which network device currently has the lowest load as indicated by the load status messages.</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. The method of <claim-ref idref="CLM-00014">claim 14</claim-ref>, wherein the tunnel connections are Layer 2 Tunneling Protocol (L2TP) connections.</claim-text>
</claim>
</claims>
</us-patent-grant>
