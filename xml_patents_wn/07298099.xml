<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07298099-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07298099</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>11102603</doc-number>
<date>20050408</date>
</document-id>
</application-reference>
<us-application-series-code>11</us-application-series-code>
<us-term-of-grant>
<us-term-extension>32</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>05</class>
<subclass>B</subclass>
<main-group>37</main-group>
<subgroup>02</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>315308</main-classification>
<further-classification>315360</further-classification>
</classification-national>
<invention-title id="d0e53">PFC and ballast control IC</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>6008593</doc-number>
<kind>A</kind>
<name>Ribarich</name>
<date>19991200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>315307</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>2002/0047635</doc-number>
<kind>A1</kind>
<name>Ribarich et al.</name>
<date>20020400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>315291</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>2004/0113569</doc-number>
<kind>A1</kind>
<name>Henry</name>
<date>20040600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>315307</main-classification></classification-national>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>2005/0156534</doc-number>
<kind>A1</kind>
<name>Oh</name>
<date>20050700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>315247</main-classification></classification-national>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>EP</country>
<doc-number>1 395 095</doc-number>
<date>20040300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>WO</country>
<doc-number>2004/006630</doc-number>
<date>20040100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00007">
<othercit>U.K. Office Action in corresponding U.K. Application No. GB0621355.7 issued Feb. 23, 2007.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>43</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>315209 R</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>315224</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>315225</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>315226</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>315291</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>315307</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>315308</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>315360</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>361 88</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>361 89</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>361 90</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>361 911</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>361 912</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>361 913</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>15</number-of-drawing-sheets>
<number-of-figures>23</number-of-figures>
</figures>
<us-related-documents>
<us-provisional-application>
<document-id>
<country>US</country>
<doc-number>60560875</doc-number>
<kind>00</kind>
<date>20040408</date>
</document-id>
</us-provisional-application>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20050225265</doc-number>
<kind>A1</kind>
<date>20051013</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Ribarich</last-name>
<first-name>Thomas J.</first-name>
<address>
<city>Laguna Beach</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Ostrolenk, Faber, Gerb &amp; Soffen, LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>International Rectifier Corporation</orgname>
<role>02</role>
<address>
<city>El Segundo</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Dinh</last-name>
<first-name>Trinh</first-name>
<department>2821</department>
</primary-examiner>
<assistant-examiner>
<last-name>Duong</last-name>
<first-name>Dieu Hien T</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">The IRS21681D is a fully integrated, fully protected 600V ballast control IC designed to drive all types of fluorescent lamps. The IRS21681D is based on the popular IR2166 control IC with additional improvements to increase ballast performance. PFC circuitry operates in critical conduction mode and provides high PF, low THD and DC bus regulation. The IRS21681D features include programmable preheat and run frequencies, programmable preheat time, programmable ignition ramp, programmable PFC over-current protection, and programmable end-of-life protection. Comprehensive protection features such as protection from failure of a lamp to strike, filament failures, end-of-life protection, DC bus under-voltage reset as well as an automatic restart function, have been included in the design. The IRS2168D has, in addition, closed-loop half-bridge ignition current regulation and a novel fault counter. The IRS21681D, unlike the IRS2168D, ramps up during ignition and shuts down at the first over-current fault. The IRS21681D and IRS2168D are both available in either 16-pin PDIP or 16-pin narrow body SOIC packages.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="236.64mm" wi="191.77mm" file="US07298099-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="262.64mm" wi="174.92mm" orientation="landscape" file="US07298099-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="235.71mm" wi="191.35mm" file="US07298099-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="251.04mm" wi="194.14mm" file="US07298099-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="233.93mm" wi="188.72mm" file="US07298099-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="248.92mm" wi="179.75mm" file="US07298099-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="246.55mm" wi="152.48mm" orientation="landscape" file="US07298099-20071120-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="255.86mm" wi="148.59mm" orientation="landscape" file="US07298099-20071120-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="212.77mm" wi="196.60mm" file="US07298099-20071120-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="203.45mm" wi="188.64mm" file="US07298099-20071120-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="250.53mm" wi="185.08mm" file="US07298099-20071120-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="266.28mm" wi="177.72mm" file="US07298099-20071120-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="257.39mm" wi="184.32mm" file="US07298099-20071120-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="255.69mm" wi="177.72mm" file="US07298099-20071120-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="252.56mm" wi="151.89mm" orientation="landscape" file="US07298099-20071120-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00015" num="00015">
<img id="EMI-D00015" he="260.60mm" wi="161.12mm" file="US07298099-20071120-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS REFERENCE TO RELATED APPLICATIONS</heading>
<p id="p-0002" num="0001">The present application is based upon and claims priority of provisional application No. 60/560,875, filed Apr. 8, 2004, incorporated by reference.</p>
<p id="p-0003" num="0002">It is related to U.S. Provisional Application 60/482,334 (IR-2199 PROV) filed Jun. 24, 2003, incorporated by reference in its entirety. The '334 provisional includes detailed descriptions of the IR2166(S) and IR2167(S) PFC Ballast Control IC's which are of background interest in this case. The '334 provisional also refers to U.S. Pat. No. 6,617,805 and several other patents and published articles, all incorporated by reference. See also Ser. No. 10/875,474 filed Jun. 23, 2004; and Ser. No. 10/615,710 filed Jul. 8, 2003, both incorporated by reference.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0004" num="0003">1. Field of the Invention</p>
<p id="p-0005" num="0004">The present invention relates to a ballast control IC, particularly for driving fluorescent lamps, and more particularly with additional PFC circuitry on the IC.</p>
<p id="p-0006" num="0005">2. Related Art</p>
<p id="p-0007" num="0006">Several aspects of the invention may provide additional functionality and reliability to the popular IR2166 and IR2167 ballast control IC's , both manufactured by the International Rectifier Corporation. Descriptions are available at www.irf.com, as well as in the above-mentioned related application and articles, especially Ser. No. 60/482,344. Detailed descriptions of the background art are thus freely available and need not be included herein.</p>
<heading id="h-0003" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0008" num="0007">Several aspects of the invention are embodied in the International Rectifier IRS21681D and IRS2168D Power Factor Correction and Ballast Control IC's, and also may be adaptable to other devices and environments by those having skill in the art.</p>
<p id="p-0009" num="0008">The IRS21681D is a fully integrated, fully protected 600V ballast control IC designed to drive all types of fluorescent lamps. The IRS21681D is based on the popular IR2166 control IC with additional improvements to increase ballast performance. PFC circuitry operates in critical conduction mode and provides high PF, low THD and DC bus regulation. The IRS21681D features include programmable preheat and run frequencies, programmable preheat time, programmable ignition ramp, programmable PFC over-current protection, and programmable end-of-life protection. Comprehensive protection features such as protection from failure of a lamp to strike, filament failures, end-of-life protection, DC bus under-voltage reset as well as an automatic restart function, have been included in the design.</p>
<p id="p-0010" num="0009">The IRS2168D has, in addition, closed-loop half-bridge ignition current regulation and a novel fault counter. The IRS21681D, unlike the IRS2168D, ramps up during ignition and shuts down at the first over-current fault.</p>
<p id="p-0011" num="0010">Referring to the IRS21681D state diagram, <figref idref="DRAWINGS">FIG. 4</figref>, it is seen that only a single event of CS pin &gt;1.25V is needed to go to fault mode from ignition or run mode. In the preheat mode, the CS pin over-current is disabled. In the timing diagram, <figref idref="DRAWINGS">FIG. 8</figref>, see the zoomed images at the bottom. The middle image shows the ignition ramp and it can be seen that the current ramps up and the ballast shuts off (fault mode) as soon as CS&gt;1.25V.</p>
<p id="p-0012" num="0011">Referring to the IRS2168D state diagram, <figref idref="DRAWINGS">FIG. 5</figref>, it can be seen that the CS pin over-current is enabled in preheat mode and run mode, but that 60 cycles of consecutive faults (internal fault counter) are needed in order to go to fault mode. During ignition, fault mode is disabled. Instead, the ignition regulation circuit keeps the CS pin limited to 1.25V, and therefore limits the maximum ignition current and voltage of the ballast output stage. See also the timing diagram, <figref idref="DRAWINGS">FIG. 9</figref>, which shows that the current is regulated for the duration of ignition.</p>
<p id="p-0013" num="0012">The IRS21681D and IRS2168D are both available in either 16-pin PDIP or 16-pin narrow body SOIC packages.</p>
<p id="p-0014" num="0013">Features of the IC's are summarized as follows:
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0014">PFC, ballast control and half-bridge driver in one IC</li>
    <li id="ul0001-0002" num="0015">Critical-conduction mode boost-type PFC</li>
    <li id="ul0001-0003" num="0016">Programmable PFC over-current protection</li>
    <li id="ul0001-0004" num="0017">Programmable half-bridge over-current protection</li>
    <li id="ul0001-0005" num="0018">Programmable preheat frequency</li>
    <li id="ul0001-0006" num="0019">Programmable preheat time</li>
    <li id="ul0001-0007" num="0020">Programmable ignition ramp</li>
    <li id="ul0001-0008" num="0021">Programmable run frequency</li>
    <li id="ul0001-0009" num="0022">Voltage-controlled oscillator (VCO)</li>
    <li id="ul0001-0010" num="0023">End-of-life window comparator pin</li>
    <li id="ul0001-0011" num="0024">DC bus under-voltage reset</li>
    <li id="ul0001-0012" num="0025">Lamp removal/auto-restart shutdown pin</li>
    <li id="ul0001-0013" num="0026">Internal bootstrap MOSFET</li>
    <li id="ul0001-0014" num="0027">Internal 15.8V (15.6V in the IRS2168D) zener clamp diode on Vcc</li>
    <li id="ul0001-0015" num="0028">Micropower startup (200 μA)</li>
    <li id="ul0001-0016" num="0029">Latch immunity and ESD protection</li>
</ul>
</p>
<p id="p-0015" num="0030">The IRS2168D has, in addition:
<ul id="ul0002" list-style="none">
    <li id="ul0002-0001" num="0031">Closed-loop current regulation</li>
    <li id="ul0002-0002" num="0032">Internal 60-event current sense up/down fault counter</li>
</ul>
</p>
<p id="p-0016" num="0033">IRS21681D vs. IR2166 Comparison
<ul id="ul0003" list-style="none">
    <li id="ul0003-0001" num="0034">New PFC Over-current sensing pin</li>
    <li id="ul0003-0002" num="0035">Improved VBUS regulation voltage tolerance</li>
    <li id="ul0003-0003" num="0036">Increased PFC on-time range</li>
    <li id="ul0003-0004" num="0037">Decreased PFC minimum on-time</li>
    <li id="ul0003-0005" num="0038">New VCO oscillator and programmable ignition ramp</li>
    <li id="ul0003-0006" num="0039">Fixed internal 1.2 μs (1.4 μs in the IRS2168D) HO and LO deadtime</li>
    <li id="ul0003-0007" num="0040">No CPH internal charging current (RCPH connected to VCC)</li>
    <li id="ul0003-0008" num="0041">No fault counter (In the IRS2168D, CS pin fault counter is active in all modes except ignition)</li>
    <li id="ul0003-0009" num="0042">Single-event over-current enabled during ignition and run (new closed-loop ignition current regulation in the IRS2168D)</li>
    <li id="ul0003-0010" num="0043">Increased SD pin shutdown voltage threshold hysteresis</li>
    <li id="ul0003-0011" num="0044">Changed EOL pin internal 2V bias to a 30 μA OTA</li>
    <li id="ul0003-0012" num="0045">Internal bootstrap MOSFET</li>
</ul>
</p>
<p id="p-0017" num="0046">Other features and advantages of the present invention will become apparent from the following description of embodiments of the invention which refers to the accompanying drawings.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWING(S)</heading>
<p id="p-0018" num="0047"><figref idref="DRAWINGS">FIG. 1</figref> is a schematic diagram showing a typical application of the IC's.</p>
<p id="p-0019" num="0048"><figref idref="DRAWINGS">FIGS. 2 and 3</figref> are schematic block diagrams of the IRS21681D and IRS2168D chips, respectively.</p>
<p id="p-0020" num="0049"><figref idref="DRAWINGS">FIGS. 4 and 5</figref> are state diagrams showing operating modes of the IRS21681D and IRS2168D, respectively.</p>
<p id="p-0021" num="0050"><figref idref="DRAWINGS">FIGS. 6 and 7</figref> show lead assignments and definitions in the IRS21681D and IRS2168D, respectively.</p>
<p id="p-0022" num="0051"><figref idref="DRAWINGS">FIG. 8</figref> shows timing diagrams for the ballast section of the IRS21681D.</p>
<p id="p-0023" num="0052"><figref idref="DRAWINGS">FIG. 9</figref> shows timing diagrams for the ballast section of the IRS2168D.</p>
<p id="p-0024" num="0053"><figref idref="DRAWINGS">FIG. 10</figref> shows start-up and supply circuitry.</p>
<p id="p-0025" num="0054"><figref idref="DRAWINGS">FIG. 11</figref> is a graph showing Vcc supply voltage versus time during start-up.</p>
<p id="p-0026" num="0055"><figref idref="DRAWINGS">FIG. 12</figref> is a schematic block diagram showing preheat circuitry.</p>
<p id="p-0027" num="0056"><figref idref="DRAWINGS">FIG. 13</figref> is a timing diagram relative to the preheat and oscillator functions.</p>
<p id="p-0028" num="0057"><figref idref="DRAWINGS">FIG. 14</figref> shows ignition circuitry.</p>
<p id="p-0029" num="0058"><figref idref="DRAWINGS">FIG. 15</figref> is a timing diagram relative to ignition regulation.</p>
<p id="p-0030" num="0059"><figref idref="DRAWINGS">FIG. 16</figref> is a timing diagram for the fault counter.</p>
<p id="p-0031" num="0060"><figref idref="DRAWINGS">FIG. 17</figref> is a schematic diagram of a boost converter.</p>
<p id="p-0032" num="0061"><figref idref="DRAWINGS">FIG. 18</figref> is a graph showing sinusoidal line input voltage (solid line), smoothed sinusoidal line input current (dashed line), and triangular PFC inductor current, over one-half cycle of the line input voltage.</p>
<p id="p-0033" num="0062"><figref idref="DRAWINGS">FIG. 19</figref> is a simplified schematic of a PFC control circuit.</p>
<p id="p-0034" num="0063"><figref idref="DRAWINGS">FIG. 20</figref> is a detailed block diagram of the PFC control circuit.</p>
<p id="p-0035" num="0064"><figref idref="DRAWINGS">FIG. 21</figref> is a timing diagram showing inductor current, and PFC pin, ZX pin and OC pin signals.</p>
<p id="p-0036" num="0065"><figref idref="DRAWINGS">FIG. 22</figref> is a timing diagram showing on-time modulation near the AC line zero-crossings.</p>
<p id="p-0037" num="0066"><figref idref="DRAWINGS">FIG. 23</figref> is a graph of RFMIN vs. frequency for use in selecting component values.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DETAILED DESCRIPTION OF EMBODIMENTS OF THE INVENTION</heading>
<p id="p-0038" num="0067">The following functional descriptions will discuss primarily the IRS2168D, the differences between the two embodiments having already been mentioned.</p>
<p id="h-0006" num="0000">Ballast Section</p>
<p id="h-0007" num="0000">Under-Voltage Lock-Out Mode (UVLO)</p>
<p id="p-0039" num="0068">The under-voltage lock-out mode (UVLO) is defined as the state the IC is in when VCC is below the turn-on threshold of the IC. To identify the different modes of the IC, refer to the State Diagram shown in <figref idref="DRAWINGS">FIG. 5</figref>. The IRS2168D undervoltage lock-out is designed to maintain an ultra low supply current of less than 400 μA, and to guarantee the IC is fully functional before the high- and low-side output drivers are activated. <figref idref="DRAWINGS">FIG. 10</figref> shows an efficient voltage supply using the micro-power start-up current of the IRS2168D together with a snubber charge pump from the half-bridge output (R<sub>VCC</sub>, C<sub>VCC1</sub>, C<sub>VCC2</sub>, C<sub>SNUB</sub>, D<sub>CP1 </sub>and D<sub>CP2</sub>).</p>
<p id="p-0040" num="0069">The VCC capacitors (C<sub>VCC1 </sub>and C<sub>VCC2</sub>) are charged by the current through supply resistor (R<sub>VCC</sub>) minus the start-up current drawn by the IC. This resistor is chosen to set the desired AC line input voltage turn-on threshold for the ballast. When the voltage at VCC exceeds the IC start-up threshold (UVLO+) and the SD pin is below 4.5 volts, the IC turns on and LO begins to oscillate. The capacitors at VCC begin to discharge due to the increase in IC operating current (<figref idref="DRAWINGS">FIG. 11</figref>). The high-side supply voltage, VB-VS, begins to increase as capacitor C<sub>BS </sub>is charged through the internal bootstrap MOSFET during the LO on-time of each LO switching cycle. When the VB-VS voltage exceeds the high-side start-up threshold (UVBS+), HO then begins to oscillate. This may take several cycles of LO to charge VB-VS above UVBS+ due to RDSon of the internal bootstrap MOSFET.</p>
<p id="p-0041" num="0070">When LO and HO are both oscillating, the external MOSFETs (MHS and MLS) are turned on and off with a 50% duty cycle and a non-overlapping deadtime of 1.6 μs. The half-bridge output (pin VS) begins to switch between the DC bus voltage and COM. During the deadtime between the turn-off of LO and the turn-on of HO, the half-bridge output voltage transitions from COM to the DC bus voltage at a dv/dt rate determined by the snubber capacitor (C<sub>SNUB</sub>). As the snubber capacitor charges, current will flow through the charge pump diode (D<sub>CP2</sub>) to VCC. After several switching cycles of the half-bridge output, the charge pump and the internal 15.6V zener clamp of the IC take over as the supply voltage. Capacitor C<sub>VCC2 </sub>supplies the IC current during the VCC discharge time and should be large enough such that VCC does not decrease below UVLO− before the charge pump takes over. Capacitor C<sub>VCC1 </sub>is provided for noise filtering and is placed as close as possible and directly between VCC and COM, and should not be lower than 0.1 μF. Resistors R<sub>1 </sub>and R<sub>2 </sub>are recommended for limiting high currents that can flow to VCC from the charge pump during hard-switching of the half-bridge or during lamp ignition. The internal bootstrap MOSFET and supply capacitor (C<sub>BS</sub>) comprise the supply voltage for the high side driver circuitry. During UVLO mode, the high- and low-side driver outputs HO and LO are both low, the internal oscillator is disabled, and pin CPH is connected internally to COM for resetting the preheat time.</p>
<p id="h-0008" num="0000">Preheat Mode (PH)</p>
<p id="p-0042" num="0071">The IRS2168D enters preheat mode when VCC exceeds the UVLO positive-going threshold (UVLO+). The internal MOSFET that connects pin CPH to COM is turned off and an external resistor (<figref idref="DRAWINGS">FIG. 12</figref>) begins to charge the external preheat timing capacitor (CPH). LO and HO begin to oscillate at a higher soft-start frequency and ramp down quickly to the preheat frequency. The VCO pin is connected to COM through an internal MOSFET so the preheat frequency is determined by the equivalent resistance at the FMIN pin formed by the parallel combination of resistors RFMIN and RPH. The frequency remains at the preheat frequency until the voltage on pin CPH exceeds ⅔*VCC and the IC enters Ignition Mode. During preheat mode, the over-current protection on pin CS and the 60-cycle consecutive over-current fault counter are both enabled. The PFC circuit is working in high-gain mode (see PFC section) and keeps the DC bus voltage regulated at a constant level.</p>
<p id="h-0009" num="0000">Ignition Mode (IGN)</p>
<p id="p-0043" num="0072">The IRS2168D ignition mode is defined by the second time CPH charges from ⅓*VCC to ⅔*VCC. When the voltage on pin CPH exceeds ⅔*VCC for the first time, pin CPH is discharged quickly through an internal MOSFET down to ⅓*VCC (see <figref idref="DRAWINGS">FIGS. 13 and 14</figref>). The internal MOSFET turns off and the voltage on pin CPH begins to increase again. The internal MOSFET at pin VCO turns off and resistor RPH is disconnected from COM. The equivalent resistance at the FMIN pin increases from the parallel combination (RPH//RFMIN) to RFMIN at a rate programmed by the external capacitor at pin VCO (CVCO) and resistor RPH. This causes the operating frequency to ramp down smoothly from the preheat frequency through the ignition frequency to the final run frequency. During this ignition ramp, the frequency sweeps through the resonance frequency of the lamp output stage to ignite the lamp.</p>
<p id="p-0044" num="0073">The over-current threshold on pin CS will protect the ballast against a non-strike or open-filament lamp fault condition. The voltage on pin CS is defined by the lower half-bridge MOSFET current flowing through the external current sensing resistor RCS. This resistor programs the maximum peak ignition current (and therefore peak ignition voltage) of the ballast output stage. Should this voltage exceed the internal threshold of 1.25V, the ignition regulation circuit discharges the VCO voltage slightly to increase the frequency slightly (see <figref idref="DRAWINGS">FIG. 15</figref>). This cycle-by-cycle feedback from the CS pin to the VCO pin will adjust the frequency each cycle to limit the amplitude of the current for the entire duration of ignition mode. When CPH exceeds ⅔*VCC for the second time, the IC enters run mode and the fault counter becomes enabled. The ignition regulation remains active in run mode but the IC will enter fault mode after 60 consecutive over-current faults and gate driver outputs HO, LO and PFC will be latched low. During ignition mode, the PFC circuit is working in high-gain mode and keeps the DC bus voltage regulated at a constant level. The high-gain mode prevents the DC bus from decreasing during lamp ignition or ignition regulation.</p>
<p id="h-0010" num="0000">Run Mode (RUN)</p>
<p id="p-0045" num="0074">Once VCC has exceeded ⅔*VCC for the second time, the IC enters run mode. CPH continues to charge up to VCC. The operating frequency is at the minimum frequency (after the ignition ramp) and is programmed by the external resistor (RFMIN) at the FMIN pin. Should hard-switching occur at the half-bridge at any time (open-filament, lamp removal, etc.), the voltage across the current sensing resistor (RCS) will exceed the internal threshold of 1.25 volts and the fault counter will begin counting (see <figref idref="DRAWINGS">FIG. 14</figref>). Should the number of consecutive over-current faults exceed 60, the IC will enter fault mode and the HO, LO and PFC gate driver outputs will be latched low. During run mode, the end-of-life (EOL) window comparator and the DC bus under-voltage reset are both enabled.</p>
<p id="h-0011" num="0000">DC Bus Under-Voltage Reset</p>
<p id="p-0046" num="0075">Should the DC bus decrease too low during a brown-out line condition or over-load condition, the resonant output stage to the lamp can shift near or below resonance. This can produce hard switching at the half-bridge that can damage the half-bridge switches, or, the DC bus can decrease too far and the lamp can extinguish. To protect against this, the VBUS pin includes a 3.0V under-voltage reset threshold. When the IC is in run mode and the voltage at the VBUS pin decreases below 3.0V, VCC will be discharged through an internal MOSFET down to the UVLO− threshold and all gate driver outputs will be latched low. For proper ballast design, the designer should set the over-current limit of the PFC section such that the DC bus does not drop until the AC line input voltage falls below the minimum rated input voltage of the ballast (see PFC section). When the PFC over-current limit is correctly set, the DC bus voltage will start to decrease when over-current is reached during low-line conditions. The voltage measured at the VBUS pin will decrease below the internal 3.0V threshold and the ballast will turn off cleanly. The pull-up resistor to VCC (R<sub>VCC</sub>) will then turn the ballast on again when the AC input line voltage increases high enough again where VCC exceeds UVLO+. R<sub>VCC </sub>should be set to turn the ballast on at the minimum specified ballast input voltage and the PFC over-current should be set somewhere below this level. This hysteresis will result in clean turn-on and turn-off of the ballast.</p>
<p id="h-0012" num="0000">SD/EOL and CS Fault Mode</p>
<p id="p-0047" num="0076">Should the voltage at the SD/EOL pin exceed 3V or decrease below 1V during run mode, an end-of-life (EOL) fault condition has occurred and the IC enters fault mode. LO, HO and PFC gate driver outputs are all latched off in the ‘low’ state. CPH is discharged to COM for resetting the preheat time and VCO is discharged to COM for resetting the frequency. To exit fault mode, VCC can be decreased below UVLO− (ballast power off) or the SD pin can be increased above 5V (lamp removal). Either of these will force the IC to enter UVLO mode (see State Diagram, <figref idref="DRAWINGS">FIG. 5</figref>). Once VCC is above UVLO+ (ballast power on) and SD is pulled above 5V and back below 3V (lamp re-insertion), the IC will enter preheat mode and begin oscillating again.</p>
<p id="p-0048" num="0077">The current sense function will force the IC to enter fault mode only after the voltage at the CS pin has been greater than 1.25V for 60 consecutive cycles of LO. The voltage at the CS pin is AND-ed with LO (see <figref idref="DRAWINGS">FIG. 16</figref>) so it will work with pulses that occur during the LO on-time or DC. If the over-current faults are not consecutive, then the internal fault counter will count down each cycle when there is no fault. Should an over-current fault occur only for a few cycles and then not occur again, the counter will eventually reset to zero. The over-current fault counter is enabled during preheat and run modes and disabled during ignition mode.</p>
<p id="h-0013" num="0000">Ballast Design Equations</p>
<p id="p-0049" num="0078">Note: The results from the following design equations can differ slightly from actual measurements due to IC tolerances, component tolerances, and oscillator over- and under-shoot due to internal comparator response time.</p>
<p id="h-0014" num="0000">Step 1: Program Run Frequency</p>
<p id="p-0050" num="0079">The run frequency is programmed with the timing resistor RFMIN at the FMIN pin. The run frequency is given as:</p>
<p id="p-0051" num="0080">
<maths id="MATH-US-00001" num="00001">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>f</mi>
          <mi>RUN</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mrow>
            <mfrac>
              <mn>1</mn>
              <mrow>
                <mrow>
                  <mo>(</mo>
                  <mrow>
                    <mrow>
                      <mn>4.8</mn>
                      <mo>⁢</mo>
                      <mi>e</mi>
                    </mrow>
                    <mo>-</mo>
                    <mn>10</mn>
                  </mrow>
                  <mo>)</mo>
                </mrow>
                <mo>·</mo>
                <msub>
                  <mi>R</mi>
                  <mi>FMIN</mi>
                </msub>
              </mrow>
            </mfrac>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>[</mo>
            <mi>Hertz</mi>
            <mo>]</mo>
          </mrow>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>⁢</mo>
          <mi>or</mi>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>1</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>R</mi>
          <mi>FMIN</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mrow>
            <mfrac>
              <mn>1</mn>
              <mrow>
                <mrow>
                  <mo>(</mo>
                  <mrow>
                    <mrow>
                      <mn>4.8</mn>
                      <mo>⁢</mo>
                      <mi>e</mi>
                    </mrow>
                    <mo>-</mo>
                    <mn>10</mn>
                  </mrow>
                  <mo>)</mo>
                </mrow>
                <mo>·</mo>
                <msub>
                  <mi>f</mi>
                  <mi>RUN</mi>
                </msub>
              </mrow>
            </mfrac>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>[</mo>
            <mi>Ohms</mi>
            <mo>]</mo>
          </mrow>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>⁢</mo>
          <mi>or</mi>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>2</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0052" num="0081">Use a graph of RFMIN vs. Frequency (<figref idref="DRAWINGS">FIG. 23</figref>) to select RFMIN value for desired run frequency.</p>
<p id="h-0015" num="0000">Step 2: Program Preheat Frequency</p>
<p id="p-0053" num="0082">The preheat frequency is programmed with timing resistors RFMIN and RPH. The timing resistors are connected in parallel for the duration of the preheat time. The preheat frequency is therefore given as:</p>
<p id="p-0054" num="0083">
<maths id="MATH-US-00002" num="00002">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>f</mi>
          <mi>PH</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mrow>
            <mfrac>
              <mrow>
                <msub>
                  <mi>R</mi>
                  <mi>FMIN</mi>
                </msub>
                <mo>+</mo>
                <msub>
                  <mi>R</mi>
                  <mi>PH</mi>
                </msub>
              </mrow>
              <mrow>
                <mrow>
                  <mo>(</mo>
                  <mrow>
                    <mrow>
                      <mn>4.8</mn>
                      <mo>⁢</mo>
                      <mi>e</mi>
                    </mrow>
                    <mo>-</mo>
                    <mn>10</mn>
                  </mrow>
                  <mo>)</mo>
                </mrow>
                <mo>·</mo>
                <msub>
                  <mi>R</mi>
                  <mi>FMIN</mi>
                </msub>
                <mo>·</mo>
                <msub>
                  <mi>R</mi>
                  <mi>PH</mi>
                </msub>
              </mrow>
            </mfrac>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>[</mo>
            <mi>Hertz</mi>
            <mo>]</mo>
          </mrow>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>⁢</mo>
          <mi>or</mi>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>3</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>R</mi>
          <mi>PH</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mrow>
            <mfrac>
              <msub>
                <mi>R</mi>
                <mi>FMIN</mi>
              </msub>
              <mrow>
                <mrow>
                  <mrow>
                    <mo>(</mo>
                    <mrow>
                      <mrow>
                        <mn>4.8</mn>
                        <mo>⁢</mo>
                        <mi>e</mi>
                      </mrow>
                      <mo>-</mo>
                      <mn>10</mn>
                    </mrow>
                    <mo>)</mo>
                  </mrow>
                  <mo>·</mo>
                  <msub>
                    <mi>R</mi>
                    <mi>FMIN</mi>
                  </msub>
                  <mo>·</mo>
                  <msub>
                    <mi>f</mi>
                    <mi>PH</mi>
                  </msub>
                </mrow>
                <mo>-</mo>
                <mn>1</mn>
              </mrow>
            </mfrac>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>[</mo>
            <mi>Ohms</mi>
            <mo>]</mo>
          </mrow>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>⁢</mo>
          <mi>or</mi>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>4</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0055" num="0084">Use a graph of RFMIN vs. Frequency (<figref idref="DRAWINGS">FIG. 23</figref>) to select REQUIV value for desired preheat frequency. Then RPH is given as:</p>
<p id="p-0056" num="0085">
<maths id="MATH-US-00003" num="00003">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>R</mi>
          <mi>PH</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mfrac>
            <mrow>
              <msub>
                <mi>R</mi>
                <mi>FMIN</mi>
              </msub>
              <mo>·</mo>
              <msub>
                <mi>R</mi>
                <mi>EQUIV</mi>
              </msub>
            </mrow>
            <mrow>
              <msub>
                <mi>R</mi>
                <mi>FMIN</mi>
              </msub>
              <mo>-</mo>
              <msub>
                <mi>R</mi>
                <mi>EQUIV</mi>
              </msub>
            </mrow>
          </mfrac>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>[</mo>
          <mi>Ohms</mi>
          <mo>]</mo>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>5</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
Step 3: Program Preheat Time
</p>
<p id="p-0057" num="0086">The preheat time is defined by the time it takes for the external capacitor on pin CPH to charge up to ⅔*VCC. An external resistor (RCPH) connected to VCC charges capacitor CPH. The preheat time is therefore given as:</p>
<p id="p-0058" num="0087">
<maths id="MATH-US-00004" num="00004">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>t</mi>
          <mi>PH</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mrow>
            <msub>
              <mi>R</mi>
              <mi>CPH</mi>
            </msub>
            <mo>·</mo>
            <mrow>
              <msub>
                <mi>C</mi>
                <mi>PH</mi>
              </msub>
              <mo>⁢</mo>
              <mstyle>
                <mspace width="0.8em" height="0.8ex"/>
              </mstyle>
              <mo>[</mo>
              <mi>Seconds</mi>
              <mo>]</mo>
            </mrow>
          </mrow>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>⁢</mo>
          <mi>or</mi>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>6</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>C</mi>
          <mi>PH</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mfrac>
            <msub>
              <mi>t</mi>
              <mi>PH</mi>
            </msub>
            <msub>
              <mi>R</mi>
              <mi>CPH</mi>
            </msub>
          </mfrac>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>[</mo>
          <mi>Farads</mi>
          <mo>]</mo>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>7</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
Step 4: Program Ignition Ramp Time
</p>
<p id="p-0059" num="0088">The ramp time is defined by the time it takes for the external capacitor on pin VCO to charge up to 2V. The external timing resistor (RPH) connected to FMIN charges capacitor CVCO. The ignition ramp time is therefore given as:</p>
<p id="p-0060" num="0089">
<maths id="MATH-US-00005" num="00005">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>t</mi>
          <mi>RAMP</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mrow>
            <msub>
              <mi>R</mi>
              <mi>PH</mi>
            </msub>
            <mo>·</mo>
            <mrow>
              <msub>
                <mi>C</mi>
                <mi>VCO</mi>
              </msub>
              <mo>⁢</mo>
              <mstyle>
                <mspace width="0.8em" height="0.8ex"/>
              </mstyle>
              <mo>[</mo>
              <mi>Seconds</mi>
              <mo>]</mo>
            </mrow>
          </mrow>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>⁢</mo>
          <mi>or</mi>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>6</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>C</mi>
          <mi>VCO</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mfrac>
            <msub>
              <mi>t</mi>
              <mi>RAMP</mi>
            </msub>
            <msub>
              <mi>R</mi>
              <mi>PH</mi>
            </msub>
          </mfrac>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>[</mo>
          <mi>Farads</mi>
          <mo>]</mo>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>7</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
Step 5: Program Maximum Ignition Current
</p>
<p id="p-0061" num="0090">The maximum ignition current is programmed with the external resistor RCS and an internal threshold of 1.25V. This threshold determines the over-current limit of the ballast, which will be reached when the frequency ramps down towards resonance during ignition and the lamp does not ignite. The maximum ignition current is given as:</p>
<p id="p-0062" num="0091">
<maths id="MATH-US-00006" num="00006">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>I</mi>
          <mi>IGN</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mrow>
            <mfrac>
              <mn>1.25</mn>
              <msub>
                <mi>R</mi>
                <mi>CS</mi>
              </msub>
            </mfrac>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>[</mo>
            <mrow>
              <mi>Amps</mi>
              <mo>⁢</mo>
              <mstyle>
                <mspace width="0.8em" height="0.8ex"/>
              </mstyle>
              <mo>⁢</mo>
              <mi>Peak</mi>
            </mrow>
            <mo>]</mo>
          </mrow>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>⁢</mo>
          <mi>or</mi>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>9</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>R</mi>
          <mi>CS</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mfrac>
            <mn>1.25</mn>
            <msub>
              <mi>I</mi>
              <mi>IGN</mi>
            </msub>
          </mfrac>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>[</mo>
          <mi>Ohms</mi>
          <mo>]</mo>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>10</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
PFC Design Equations
<br/>
Step 1: Calculate PFC Inductor Value:
</p>
<p id="p-0063" num="0092">
<maths id="MATH-US-00007" num="00007">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mrow>
            <mrow>
              <msub>
                <mi>L</mi>
                <mi>PFC</mi>
              </msub>
              <mo>=</mo>
              <mrow>
                <mrow>
                  <mfrac>
                    <mrow>
                      <mrow>
                        <mo>(</mo>
                        <mrow>
                          <mi>VBUS</mi>
                          <mo>-</mo>
                          <mrow>
                            <msqrt>
                              <mn>2</mn>
                            </msqrt>
                            <mo>·</mo>
                            <msub>
                              <mi>VAC</mi>
                              <mi>MIN</mi>
                            </msub>
                          </mrow>
                        </mrow>
                        <mo>)</mo>
                      </mrow>
                      <mo>·</mo>
                      <msubsup>
                        <mi>VAC</mi>
                        <mi>MIN</mi>
                        <mn>2</mn>
                      </msubsup>
                      <mo>·</mo>
                      <mi>η</mi>
                    </mrow>
                    <mrow>
                      <mn>2</mn>
                      <mo>·</mo>
                      <msub>
                        <mi>f</mi>
                        <mi>MIN</mi>
                      </msub>
                      <mo>·</mo>
                      <msub>
                        <mi>P</mi>
                        <mi>OUT</mi>
                      </msub>
                      <mo>·</mo>
                      <mi>VBUS</mi>
                    </mrow>
                  </mfrac>
                  <mo>⁢</mo>
                  <mstyle>
                    <mspace width="0.8em" height="0.8ex"/>
                  </mstyle>
                  <mo>[</mo>
                  <mi>Henries</mi>
                  <mo>]</mo>
                </mrow>
                <mo>⁢</mo>
                <mstyle>
                  <mspace width="0.8em" height="0.8ex"/>
                </mstyle>
                <mo>⁢</mo>
                <mi>where</mi>
              </mrow>
            </mrow>
            <mo>,</mo>
            <mstyle>
              <mtext>
</mtext>
            </mstyle>
            <mo>⁢</mo>
            <mrow>
              <mi>VBUS</mi>
              <mo>=</mo>
              <mrow>
                <mi>DC</mi>
                <mo>⁢</mo>
                <mstyle>
                  <mspace width="0.8em" height="0.8ex"/>
                </mstyle>
                <mo>⁢</mo>
                <mi>bus</mi>
                <mo>⁢</mo>
                <mstyle>
                  <mspace width="0.8em" height="0.8ex"/>
                </mstyle>
                <mo>⁢</mo>
                <mi>voltage</mi>
              </mrow>
            </mrow>
          </mrow>
          <mo>⁢</mo>
          <mstyle>
            <mtext>
</mtext>
          </mstyle>
          <mo>⁢</mo>
          <mrow>
            <msub>
              <mi>VAC</mi>
              <mi>MIN</mi>
            </msub>
            <mo>=</mo>
            <mrow>
              <mi>Minimum</mi>
              <mo>⁢</mo>
              <mstyle>
                <mspace width="0.8em" height="0.8ex"/>
              </mstyle>
              <mo>⁢</mo>
              <mi>rms</mi>
              <mo>⁢</mo>
              <mstyle>
                <mspace width="0.8em" height="0.8ex"/>
              </mstyle>
              <mo>⁢</mo>
              <mi>AC</mi>
              <mo>⁢</mo>
              <mstyle>
                <mspace width="0.8em" height="0.8ex"/>
              </mstyle>
              <mo>⁢</mo>
              <mi>input</mi>
              <mo>⁢</mo>
              <mstyle>
                <mspace width="0.8em" height="0.8ex"/>
              </mstyle>
              <mo>⁢</mo>
              <mi>voltage</mi>
            </mrow>
          </mrow>
          <mo>⁢</mo>
          <mstyle>
            <mtext>
</mtext>
          </mstyle>
          <mo>⁢</mo>
          <mrow>
            <mi>η</mi>
            <mo>=</mo>
            <mrow>
              <mi>PFC</mi>
              <mo>⁢</mo>
              <mstyle>
                <mspace width="0.8em" height="0.8ex"/>
              </mstyle>
              <mo>⁢</mo>
              <mi>efficiency</mi>
              <mo>⁢</mo>
              <mstyle>
                <mspace width="0.8em" height="0.8ex"/>
              </mstyle>
              <mo>⁢</mo>
              <mrow>
                <mo>(</mo>
                <mrow>
                  <mi>typically</mi>
                  <mo>⁢</mo>
                  <mstyle>
                    <mspace width="0.8em" height="0.8ex"/>
                  </mstyle>
                  <mo>⁢</mo>
                  <mn>0.95</mn>
                </mrow>
                <mo>)</mo>
              </mrow>
            </mrow>
          </mrow>
          <mo>⁢</mo>
          <mstyle>
            <mtext>
</mtext>
          </mstyle>
          <mo>⁢</mo>
          <msub>
            <mi>f</mi>
            <mi>MIN</mi>
          </msub>
          <mo>=</mo>
          <mrow>
            <mi>Minimum</mi>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>⁢</mo>
            <mi>PFC</mi>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>⁢</mo>
            <mi>switching</mi>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>⁢</mo>
            <mi>frequency</mi>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>⁢</mo>
            <mi>at</mi>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>⁢</mo>
            <mi>minimum</mi>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>⁢</mo>
            <mi>AC</mi>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>⁢</mo>
            <mi>input</mi>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>⁢</mo>
            <mi>voltage</mi>
          </mrow>
        </mrow>
        <mo>⁢</mo>
        <mstyle>
          <mtext>
</mtext>
        </mstyle>
        <mo>⁢</mo>
        <mrow>
          <msub>
            <mi>P</mi>
            <mi>OUT</mi>
          </msub>
          <mo>=</mo>
          <mrow>
            <mi>Ballast</mi>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>⁢</mo>
            <mi>output</mi>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>⁢</mo>
            <mi>power</mi>
          </mrow>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>1</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
Step 2: Calculate Peak PFC Inductor Current:
</p>
<p id="p-0064" num="0093">
<maths id="MATH-US-00008" num="00008">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>i</mi>
          <mi>PK</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mfrac>
            <mrow>
              <mn>2</mn>
              <mo>·</mo>
              <msqrt>
                <mn>2</mn>
              </msqrt>
              <mo>·</mo>
              <msub>
                <mi>P</mi>
                <mi>OUT</mi>
              </msub>
            </mrow>
            <mrow>
              <msub>
                <mi>VAC</mi>
                <mi>MIN</mi>
              </msub>
              <mo>·</mo>
              <mi>η</mi>
            </mrow>
          </mfrac>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>[</mo>
          <mrow>
            <mi>Amps</mi>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>⁢</mo>
            <mi>Peak</mi>
          </mrow>
          <mo>]</mo>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>2</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<ul id="ul0004" list-style="none">
    <li id="ul0004-0001" num="0000">
    <ul id="ul0005" list-style="none">
        <li id="ul0005-0001" num="0094">Note: The PFC inductor must not saturate at i<sub>PK </sub>over the specified ballast operating temperature range. Proper core sizing and air-gapping should be considered in the inductor design.
<br/>
Step 3: Calculate PFC Over-Current Resistor ROC Value:
</li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0065" num="0095">
<maths id="MATH-US-00009" num="00009">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>R</mi>
          <mi>OC</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mfrac>
            <mn>1.25</mn>
            <msub>
              <mi>i</mi>
              <mi>PK</mi>
            </msub>
          </mfrac>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>[</mo>
          <mi>Ohms</mi>
          <mo>]</mo>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>3</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
Step 4: Calculate Start-Up Resistor RVCC Value:
</p>
<p id="p-0066" num="0096">
<maths id="MATH-US-00010" num="00010">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>R</mi>
          <mi>VCC</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mfrac>
            <mrow>
              <msub>
                <mi>VAC</mi>
                <msub>
                  <mi>MIN</mi>
                  <mi>PK</mi>
                </msub>
              </msub>
              <mo>+</mo>
              <mn>10</mn>
            </mrow>
            <mi>IQCCUV</mi>
          </mfrac>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>[</mo>
          <mi>Ohms</mi>
          <mo>]</mo>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>4</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
PFC Section
</p>
<p id="p-0067" num="0097">In most electronic ballasts it is highly desirable to have the circuit act as a pure resistive load to the AC input line voltage. The degree to which the circuit matches a pure resistor is measured by the phase shift between the input voltage and input current and how well the shape of the input current waveform matches the shape of the sinusoidal input voltage. The cosine of the phase angle between the input voltage and input current is defined as the power factor (PF), and how well the shape of the input current waveform matches the shape of the input voltage is determined by the total harmonic distortion (THD). A power factor of 1.0 (maximum) corresponds to zero phase shift and a THD of 0% and represents a pure sinusoidal waveform (no distortion). For this reason it is desirable to have a high PF and a low THD. To achieve this, the IR2168D includes an active power factor correction (PFC) circuit.</p>
<p id="p-0068" num="0098">The control method implemented in the IR2168D is for a boost-type converter (<figref idref="DRAWINGS">FIG. 17</figref>) running in critical-conduction mode (CCM). This means that during each switching cycle of the PFC MOSFET, the circuit waits until the inductor current discharges to zero before turning the PFC MOSFET on again. The PFC MOSFET is turned on and off at a much higher frequency (&gt;10 KHz) than the line input frequency (50 to 60 Hz).</p>
<p id="p-0069" num="0099">When the switch MPFC is turned on, the inductor LPFC is connected between the rectified line input (+) and (−) causing the current in LPFC to charge up linearly. When MPFC is turned off, LPFC is connected between the rectified line input (+) and the DC bus capacitor CBUS (through diode DPFC) and the stored current in LPFC flows into CBUS. MPFC is turned on and off at a high frequency and the voltage on CBUS charges up to a specified voltage. The feedback loop of the IR2168D regulates this voltage to a fixed value by continuously monitoring the DC bus voltage and adjusting the on-time of MPFC accordingly. For an increasing DC bus the on-time is decreased, and for a decreasing DC bus the on-time is increased. This negative feedback control is performed with a slow loop speed and a low loop gain such that the average inductor current smoothly follows the low-frequency line input voltage for high power factor and low THD. The on-time of MPFC therefore appears to be fixed (with an additional modulation to be discussed later) over several cycles of the line voltage. With a fixed on-time, and an off-time determined by the inductor current discharging to zero, the result is a system where the switching frequency is free-running and constantly changing from a high frequency near the zero crossing of the AC input line voltage, to a lower frequency at the peaks (<figref idref="DRAWINGS">FIG. 18</figref>).</p>
<p id="p-0070" num="0100">When the line input voltage is low (near the zero crossing), the inductor current will charge up to a small amount and the discharge time will be fast resulting in a high switching frequency. When the input line voltage is high (near the peak), the inductor current will charge up to a higher amount and the discharge time will be longer giving a lower switching frequency.</p>
<p id="p-0071" num="0101">The PFC control circuit of the IR2168D (<figref idref="DRAWINGS">FIG. 19</figref>) includes five control pins: VBUS, COMP, ZX, PFC and OC. The VBUS pin measures the DC bus voltage via an external resistor voltage divider. The COMP pin programs the on-time of MPFC and the speed of the feedback loop with an external capacitor. The ZX pin detects when the inductor current discharges to zero each switching cycle using a secondary winding from the PFC inductor. The PFC pin is the low-side gate driver output for the external MOSFET, MPFC. The OC pin senses the current flowing through MPFC and performs cycle-by-cycle over-current protection.</p>
<p id="p-0072" num="0102">The VBUS pin is regulated against a fixed internal 4V reference voltage for regulating the DC bus voltage (<figref idref="DRAWINGS">FIG. 20</figref>). The feedback loop is performed by an operational transconductance amplifier (OTA) that sinks or sources a current to the external capacitor at the COMP pin. The resulting voltage on the COMP pin sets the threshold for the charging of the internal timing capacitor (C1, <figref idref="DRAWINGS">FIG. 20</figref>) and therefore programs the on-time of MPFC. During preheat and ignition modes of the ballast section, the gain of the OTA is set to a high level to raise the DC bus level quickly and to minimize the transient on the DC bus that can occur during ignition. During run mode, the gain is then decreased to a lower level necessary for a slower loop speed for achieving high power factor and low THD.</p>
<p id="p-0073" num="0103">The off-time of MPFC is determined by the time it takes the LPFC current to discharge to zero. The zero current level is detected by a secondary winding on LPFC that is connected to the ZX pin through an external current limiting resistor RZX. A positive-going edge exceeding the internal 2V threshold signals the beginning of the off-time. A negative-going edge on the ZX pin falling below 1.7V will occur when the LPFC current discharges to zero which signals the end of the off-time and MPFC is turned on again (<figref idref="DRAWINGS">FIG. 21</figref>). The cycle repeats itself indefinitely until the PFC section is disabled due to a fault detected by the ballast section (Fault Mode), an over-voltage or under-voltage condition on the DC bus, or, the negative transition of ZX pin voltage does not occur. Should the negative edge on the ZX pin not occur, MPFC will remain off until the watch-dog timer forces a turn-on of MPFC for an on-time duration programmed by the voltage on the COMP pin. The watch-dog pulses occur every 400 μs indefinitely until a correct positive- and negative-going signal is detected on the ZX pin and normal PFC operation is resumed. Should the OC pin exceed the 1.2V over-current threshold during the on-time, the PFC output will turn off. The circuit will then wait for a negative-going transition on the ZX pin or a forced turn-on from the watch-dog timer to turn the PFC output on again.</p>
<p id="h-0016" num="0000">On-Time Modulation Circuit</p>
<p id="p-0074" num="0104">A fixed on-time of MPFC over an entire cycle of the line input voltage produces a peak inductor current which naturally follows the sinusoidal shape of the line input voltage. The smoothed averaged line input current is in phase with the line input voltage for high power factor but the total harmonic distortion (THD), as well as the individual higher harmonics, of the current can still be too high. This is mostly due to cross-over distortion of the line current near the zero-crossings of the line input voltage. To achieve low harmonics which are acceptable to international standard organizations and general market requirements, an additional on-time modulation circuit has been added to the PFC control. This circuit dynamically increases the on-time of MPFC as the line input voltage nears the zero-crossings (<figref idref="DRAWINGS">FIG. 22</figref>). This causes the peak LPFC current, and therefore the smoothed line input current, to increase slightly higher near the zero-crossings of the line input voltage. This reduces the amount of cross-over distortion in the line input current which reduces the THD and higher harmonics to low levels.</p>
<p id="h-0017" num="0000">DC Bus Over-Voltage Protection (OVP)</p>
<p id="p-0075" num="0105">Should over-voltage occur on the DC bus and the VBUS pin exceeds the internal 4.3V threshold, the PFC output is disabled (set to a logic ‘low’). When the DC bus decreases again and the VBUS pin decreases below the internal 4.15V threshold, a watch-dog pulse is forced on the PFC pin and normal PFC operation is resumed.</p>
<p id="h-0018" num="0000">DC Bus Under-Voltage Reset</p>
<p id="p-0076" num="0106">When the input line voltage decreases, the on-time of MPFC increases to keep the DC bus constant. The on-time will continue to increase as the line voltage continues to decrease until the OC pin exceeds the internal 1.2V over-current threshold. At this time, the on-time can no longer increase and the PFC can no longer supply enough current to keep the DC bus fixed for the given load power. This will cause the DC bus to begin to decrease. The decreasing DC bus will cause the VBUS pin to decrease below the internal 3V threshold (<figref idref="DRAWINGS">FIG. 20</figref>). When this occurs, VCC is discharged internally to UVLO−. The IR2168D enters UVLO mode and both the PFC and ballast sections are disabled. The start-up supply resistor to VCC, together with the micro-power start-up current, should be set such that the ballast turns on at an AC line input voltage above the level at which the DC bus begins to drop. The current-sensing resistor at the OC pin sets the maximum PFC current and therefore sets the maximum on-time of MPFC. This prevents saturation of the PFC inductor and programs the minimum low-line input voltage for the ballast. The micro-power supply resistor to VCC and the current-sensing resistor at the OC pin program the on and off input line voltage thresholds for the ballast. With these thresholds correctly set, the ballast will turn off due to the 3V under-voltage threshold on the VBUS pin, and on again at a higher voltage (hysteresis) due to the supply resistor to VCC.</p>
<p id="p-0077" num="0107">Although the present invention has been described in relation to particular embodiments thereof, many other variations and modifications and other uses will become apparent to those skilled in the art. Therefore, the present invention is not limited by the specific disclosure herein.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-math idrefs="MATH-US-00001" nb-file="US07298099-20071120-M00001.NB">
<img id="EMI-M00001" he="15.16mm" wi="76.20mm" file="US07298099-20071120-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00002" nb-file="US07298099-20071120-M00002.NB">
<img id="EMI-M00002" he="14.82mm" wi="76.20mm" file="US07298099-20071120-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00003" nb-file="US07298099-20071120-M00003.NB">
<img id="EMI-M00003" he="7.03mm" wi="76.20mm" file="US07298099-20071120-M00003.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00004" nb-file="US07298099-20071120-M00004.NB">
<img id="EMI-M00004" he="11.26mm" wi="76.20mm" file="US07298099-20071120-M00004.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00005" nb-file="US07298099-20071120-M00005.NB">
<img id="EMI-M00005" he="11.26mm" wi="76.20mm" file="US07298099-20071120-M00005.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00006" nb-file="US07298099-20071120-M00006.NB">
<img id="EMI-M00006" he="14.82mm" wi="76.20mm" file="US07298099-20071120-M00006.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00007" nb-file="US07298099-20071120-M00007.NB">
<img id="EMI-M00007" he="29.63mm" wi="76.20mm" file="US07298099-20071120-M00007.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00008" nb-file="US07298099-20071120-M00008.NB">
<img id="EMI-M00008" he="7.79mm" wi="76.20mm" file="US07298099-20071120-M00008.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00009" nb-file="US07298099-20071120-M00009.NB">
<img id="EMI-M00009" he="6.69mm" wi="76.20mm" file="US07298099-20071120-M00009.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00010" nb-file="US07298099-20071120-M00010.NB">
<img id="EMI-M00010" he="7.03mm" wi="76.20mm" file="US07298099-20071120-M00010.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. An IC for controlling a power supply circuit for delivering power to a load circuit including a fluorescent lamp resonant output stage, comprising:
<claim-text>ballast control and driver circuitry that provides drive signals to the power supply circuit, receives current sense signals indicative of current in said output stage, and responds to the current sense signals by modifying the drive signals;</claim-text>
<claim-text>the ballast control and driver circuitry including:</claim-text>
<claim-text>drive circuitry that provides the drive signals; and</claim-text>
<claim-text>fault detection circuitry that receives the current sense signals and provides a detect signal in response to an overcurrent fault in the output stage, wherein each detect signal corresponds to an overcurrent condition coinciding with one of said drive signals, and in response to said detect signal, causes the drive circuitry to cease providing the drive signals;</claim-text>
<claim-text>wherein said fault detection circuitry comprises an internal fault counter that delays termination of said drive signals until a predetermined number of consecutive detect signals have been counted; and</claim-text>
<claim-text>wherein said internal fault counter reduces its count of detect signals when a drive signal does not coincide with an overcurrent condition in the output stage.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The IC of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said ballast control and driver circuitry has a plurality of operating modes including preheat, ignition and run modes, said fault detection circuitry being enabled in the ignition and run modes, and responding to a single detect signal for terminating the drive signals.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The IC of <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein said fault detection circuitry is disabled in the preheat mode.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The IC of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said ballast control and driver circuitry has a plurality of operating modes including preheat, ignition and run modes, said fault detection circuitry being enabled in the preheat and run modes, and comprising an internal fault counter that delays termination of said drive signals until a predetermined number of detect signals have been counted.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The IC of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein said predetermined number is 60.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The IC of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said ballast control and driver circuitry has a plurality of operating modes including preheat, ignition and run modes, said fault detection circuitry being disabled in said ignition mode,
<claim-text>said ballast control and driver circuitry further comprising an ignition current regulation circuit which provides a regulated current to said output stage for a predetermined time in said ignition mode, and terminates said drive signals if ignition does not occur during the predetermined time.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The IC of <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein said predetermined time is ½ second.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The IC of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said ballast control and driver circuitry has a plurality of operating modes including preheat and ignition modes;
<claim-text>further comprising a timing capacitor and a circuit for charging said capacitor;</claim-text>
<claim-text>said ballast control and driver circuitry remaining in preheat mode until said timing capacitor is charged to a first predetermined voltage, then discharging said capacitor to a second predetermined voltage, then remaining in ignition mode until said capacitor again reaches said first predetermined voltage.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The IC of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein said first and second predetermined voltages are respectively ⅔ and ⅓ of an IC supply voltage.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The IC of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein said IC has an internal switching circuit for rapidly discharging said timing capacitor from said first to said second predetermined voltage.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The IC of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein said timing capacitor and charging circuit are external of said IC.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The IC of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein said timing capacitor and charging circuit are external of said IC.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The IC of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the duration of said preheat mode is approximately twice the duration of the ignition mode.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The IC of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said ballast control and driver circuitry has a plurality of operating modes including preheat, ignition and run modes;
<claim-text>wherein said drive circuitry comprises a variable frequency oscillator providing said drive signals, the operating frequency of the oscillator being responsive to a current at an FMIN pin of said IC, said FMIN pin being connected to a voltage source and to said oscillator;</claim-text>
<claim-text>in the run mode, said current being determined by said voltage source and a resistor RFMIN connected to said FMIN pin.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The IC of <claim-ref idref="CLM-00014">claim 14</claim-ref>, wherein said current is determined in the preheat mode by the parallel combination of the RFMIN resistor and a resistor RPH which is connected to the FMIN pin and to a pin VCO of said IC, said IC having an internal switch connected to the pin VCO which is open in run mode for disconnecting RPH but closed in preheat mode for connecting RPH in parallel with RFMIN.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The IC of <claim-ref idref="CLM-00015">claim 15</claim-ref>, further comprising a capacitor CVCO connected to the pin VCO and providing a variable voltage at the VCO pin for varying the frequency range between a maximum frequency in preheat mode to a minimum frequency in run mode.</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The IC of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein said frequency range includes a resonance frequency for igniting the lamp.</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The IC of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said ballast control and driver circuitry comprises an end-of-life (EOL) window comparator which receives a lamp voltage signal at an BOL pin and generates an BOL fault signal when said lamp voltage is greater or less than a predetermined range; and further comprising a bias circuit connected to the EOL pin for biasing said lamp voltage signal at an intermediate level within said predetermined range.</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The IC of <claim-ref idref="CLM-00018">claim 18</claim-ref>, wherein said bias circuit comprises an operational transconductance amplifier referenced to a reference voltage at said intermediate level.</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. The IC of <claim-ref idref="CLM-00018">claim 18</claim-ref>, wherein said predetermined range is about 1 to 3V and said intermediate level is about 2V.</claim-text>
</claim>
<claim id="CLM-00021" num="00021">
<claim-text>21. The IC of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising power factor correction (PFC) circuitry which regulates a DC bus voltage which is provided to the resonant output stage;
<claim-text>said PFC circuitry comprising a switching device; and</claim-text>
<claim-text>an overcurrent circuit for detecting current in said PFC circuitry, and when said current exceeds a predetermined level, controlling said switching device to limit said current.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00022" num="00022">
<claim-text>22. The IC of <claim-ref idref="CLM-00021">claim 21</claim-ref>, wherein said overcurrent circuit is operative to limit said current cycle-by-cycle of a PFC switching period.</claim-text>
</claim>
<claim id="CLM-00023" num="00023">
<claim-text>23. The IC of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said output stage comprises a semiconductor switch driven by said drive circuitry, and wherein said current sense signals are indicative of current through said semiconductor switch.</claim-text>
</claim>
<claim id="CLM-00024" num="00024">
<claim-text>24. The IC of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said fault detection circuitry responds to a single detect signal for terminating said drive signals.</claim-text>
</claim>
<claim id="CLM-00025" num="00025">
<claim-text>25. A method of controlling a power supply circuit for delivering power to a load circuit including a fluorescent lamp resonant output stage, comprising the steps of:
<claim-text>providing drive signals to the power supply circuit, receiving current sense signals indicative of current in said output stage, and responding to the current sense signals by modifying the drive signals;</claim-text>
<claim-text>receiving the current sense signals and providing a detect signal in response to an overcurrent fault in the output stage, wherein each detect signal corresponds to an overcurrent condition coinciding with one of said drive signals, and in response to said detect signal, causing the drive circuitry to cease providing the drive signals; and</claim-text>
<claim-text>employing an internal fault counter to delay termination of said drive signals until a predetermined number of consecutive detect signals have been counted;</claim-text>
<claim-text>wherein said internal fault counter reduces its count of detect signals when a drive signal does not coincide with an overcurrent condition in the output stage.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00026" num="00026">
<claim-text>26. The method of <claim-ref idref="CLM-00025">claim 25</claim-ref>, further comprising providing a plurality of operating modes including preheat, ignition and run modes, and at least during said ignition and run modes, responding to a single detect signal for terminating the drive signals.</claim-text>
</claim>
<claim id="CLM-00027" num="00027">
<claim-text>27. The method of <claim-ref idref="CLM-00025">claim 25</claim-ref>, further comprising providing a plurality of operating modes including preheat, ignition and run modes, and at least in the preheat and run modes, counting said detect signals to delay termination of said drive signals until a predetermined number of detect signals have been counted.</claim-text>
</claim>
<claim id="CLM-00028" num="00028">
<claim-text>28. The method of <claim-ref idref="CLM-00027">claim 27</claim-ref>, wherein said predetermined number is 60.</claim-text>
</claim>
<claim id="CLM-00029" num="00029">
<claim-text>29. The method of <claim-ref idref="CLM-00025">claim 25</claim-ref>, further comprising providing a plurality of operating modes including preheat, ignition and run modes, and providing ignition current regulation to provide a regulated current to said output stage for a predetermined time in said ignition mode, and terminating said drive signals if ignition does not occur during the predetermined time.</claim-text>
</claim>
<claim id="CLM-00030" num="00030">
<claim-text>30. The method of <claim-ref idref="CLM-00029">claim 29</claim-ref>, wherein said predetermined time is ½ second.</claim-text>
</claim>
<claim id="CLM-00031" num="00031">
<claim-text>31. The method of <claim-ref idref="CLM-00025">claim 25</claim-ref>, further comprising:
<claim-text>providing a plurality of operating modes including preheat and ignition modes;</claim-text>
<claim-text>providing a timing capacitor and a circuit for charging said capacitor;</claim-text>
<claim-text>remaining in preheat mode until said timing capacitor is charged to a first predetermined voltage, then discharging said capacitor to a second predetermined voltage, then remaining in ignition mode until said capacitor again reaches said first predetermined voltage.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00032" num="00032">
<claim-text>32. The method of <claim-ref idref="CLM-00031">claim 31</claim-ref>, wherein said first and second predetermined voltages are respectively ⅔ and ⅓ of an IC supply voltage.</claim-text>
</claim>
<claim id="CLM-00033" num="00033">
<claim-text>33. The method of <claim-ref idref="CLM-00031">claim 31</claim-ref>, further rapidly discharging said timing capacitor from said first to said second predetermined voltage.</claim-text>
</claim>
<claim id="CLM-00034" num="00034">
<claim-text>34. The method of <claim-ref idref="CLM-00031">claim 31</claim-ref>, wherein the duration of said preheat mode is approximately twice the duration of the ignition mode.</claim-text>
</claim>
<claim id="CLM-00035" num="00035">
<claim-text>35. The method of <claim-ref idref="CLM-00025">claim 25</claim-ref>, further comprising:
<claim-text>providing a plurality of operating modes including preheat, ignition and run modes;</claim-text>
<claim-text>generating a variable frequency for providing said drive signals, the frequency being responsive to a current at an FMIN pin, and connecting said FMIN pin to a voltage source,</claim-text>
<claim-text>in the run mode, determining said current by a connecting resistor RFMIN to said FMIN pin.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00036" num="00036">
<claim-text>36. The method of <claim-ref idref="CLM-00035">claim 35</claim-ref>, wherein said current is determined in the preheat mode by the parallel combination of the RFMIN resistor and a resistor RPH which is connected to the FMIN pin and to a pin VCO of said IC, said IC having an internal switch connected to the pin VCO which is open in run mode for disconnecting RPH but closed in preheat mode for connecting RPH in parallel with RFMIN.</claim-text>
</claim>
<claim id="CLM-00037" num="00037">
<claim-text>37. The method of <claim-ref idref="CLM-00036">claim 36</claim-ref>, further comprising connecting a capacitor CVCO to the pin VCO for providing a variable voltage at the VCO pin for varying the frequency range between a maximum frequency in preheat mode to a minimum frequency in run mode.</claim-text>
</claim>
<claim id="CLM-00038" num="00038">
<claim-text>38. The method of <claim-ref idref="CLM-00037">claim 37</claim-ref>, wherein said frequency range includes a resonance frequency for igniting the lamp.</claim-text>
</claim>
<claim id="CLM-00039" num="00039">
<claim-text>39. The method of <claim-ref idref="CLM-00025">claim 25</claim-ref>, further comprising:
<claim-text>receiving a lamp voltage signal at an end-of-life (EOL) window comparator and generating an EOL fault signal when said lamp voltage is greater or less than a predetermined range; and</claim-text>
<claim-text>biasing said lamp voltage signal at an intermediate level within said predetermined range.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00040" num="00040">
<claim-text>40. The method of <claim-ref idref="CLM-00039">claim 39</claim-ref>, wherein said predetermined range is about 1 to 3V and said intermediate level is about 2V.</claim-text>
</claim>
<claim id="CLM-00041" num="00041">
<claim-text>41. The method of <claim-ref idref="CLM-00025">claim 25</claim-ref>, further comprising:
<claim-text>correcting a power factor by regulating a DC bus voltage which is provided to the resonant output stage by PFC circuitry comprising a switching device; and</claim-text>
<claim-text>detecting current in said PFC circuitry, and when said current exceeds a predetermined level, controlling said switching device to limit said current.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00042" num="00042">
<claim-text>42. The method of <claim-ref idref="CLM-00041">claim 41</claim-ref>, further comprising the step of limiting said current cycle-by-cycle of a PFC switching period.</claim-text>
</claim>
<claim id="CLM-00043" num="00043">
<claim-text>43. The method of <claim-ref idref="CLM-00025">claim 25</claim-ref>, wherein said output stage comprises a semiconductor switch driven by said drive circuitry, and wherein said current sense signals are indicative of current through said semiconductor switch.</claim-text>
</claim>
</claims>
</us-patent-grant>
