<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07298752-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07298752</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>10339340</doc-number>
<date>20030110</date>
</document-id>
</application-reference>
<us-application-series-code>10</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>JP</country>
<doc-number>2002-298227</doc-number>
<date>20021011</date>
</priority-claim>
</priority-claims>
<us-term-of-grant>
<us-term-extension>1119</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>L</subclass>
<main-group>12</main-group>
<subgroup>28</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>15</main-group>
<subgroup>173</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>370401</main-classification>
<further-classification>370390</further-classification>
<further-classification>370218</further-classification>
<further-classification>370469</further-classification>
<further-classification>370359</further-classification>
<further-classification>709226</further-classification>
<further-classification>709246</further-classification>
</classification-national>
<invention-title id="d0e71">Packet communication device</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5734649</doc-number>
<kind>A</kind>
<name>Carvey et al.</name>
<date>19980300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370355</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5864535</doc-number>
<kind>A</kind>
<name>Basilico</name>
<date>19990100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370231</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>5905725</doc-number>
<kind>A</kind>
<name>Sindhu et al.</name>
<date>19990500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>5918074</doc-number>
<kind>A</kind>
<name>Wright et al.</name>
<date>19990600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710 52</main-classification></classification-national>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>5974467</doc-number>
<kind>A</kind>
<name>Haddock et al.</name>
<date>19991000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709240</main-classification></classification-national>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>6160811</doc-number>
<kind>A</kind>
<name>Partridge et al.</name>
<date>20001200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370401</main-classification></classification-national>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>6243360</doc-number>
<kind>B1</kind>
<name>Basilico</name>
<date>20010600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370231</main-classification></classification-national>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>6424659</doc-number>
<kind>B2</kind>
<name>Viswanadham et al.</name>
<date>20020700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370469</main-classification></classification-national>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>6553000</doc-number>
<kind>B1</kind>
<name>Ganesh et al.</name>
<date>20030400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370235</main-classification></classification-national>
</citation>
<citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>6671277</doc-number>
<kind>B1</kind>
<name>Sugai et al.</name>
<date>20031200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>37039521</main-classification></classification-national>
</citation>
<citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>6775706</doc-number>
<kind>B1</kind>
<name>Fukumoto et al.</name>
<date>20040800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>6870844</doc-number>
<kind>B2</kind>
<name>Tuck et al.</name>
<date>20050300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370390</main-classification></classification-national>
</citation>
<citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>7065090</doc-number>
<kind>B2</kind>
<name>Rashid et al.</name>
<date>20060600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>37039531</main-classification></classification-national>
</citation>
<citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>2002/0097725</doc-number>
<kind>A1</kind>
<name>Dighe et al.</name>
<date>20020700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>2002/0174244</doc-number>
<kind>A1</kind>
<name>Beckwith et al.</name>
<date>20021100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709231</main-classification></classification-national>
</citation>
<citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>2003/0069973</doc-number>
<kind>A1</kind>
<name>Ganesan et al.</name>
<date>20030400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709226</main-classification></classification-national>
</citation>
<citation>
<patcit num="00017">
<document-id>
<country>US</country>
<doc-number>2003/0126233</doc-number>
<kind>A1</kind>
<name>Bryers et al.</name>
<date>20030700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709219</main-classification></classification-national>
</citation>
<citation>
<patcit num="00018">
<document-id>
<country>CN</country>
<doc-number>2506044</doc-number>
<kind>Y</kind>
<date>20010800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00019">
<document-id>
<country>JP</country>
<doc-number>11-298486</doc-number>
<date>19980400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00020">
<document-id>
<country>JP</country>
<doc-number>2002-064542</doc-number>
<date>20000800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00021">
<othercit>Itaru Mimura, Takeki Yazaki and Norihiko Moriwaki, “Terabit Node for Next-Generation IP Networks”, pp. 155-158.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00022">
<othercit>Itaru Mimura, Takeki Yazaki and Norihiko Moriwaki, “Terabit Node for Next-Generation IP Networks”, pp. 155-158, Hitachi Review, vol. 49, No. 4, Dec. 2000.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>17</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>370229-235</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370359</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370390</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370392</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370401</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370216-218</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370225</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370412</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370415</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370419</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370420</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370469</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370474</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709240</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709226</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709246</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>22</number-of-drawing-sheets>
<number-of-figures>36</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20040071142</doc-number>
<kind>A1</kind>
<date>20040415</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Moriwaki</last-name>
<first-name>Norihiko</first-name>
<address>
<city>Hachioji</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Wakayama</last-name>
<first-name>Koji</first-name>
<address>
<city>Kokubunji</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Reed Smith LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
<agent sequence="02" rep-type="attorney">
<addressbook>
<last-name>Fisher, Esq.</last-name>
<first-name>Stanley P.</first-name>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
<agent sequence="03" rep-type="attorney">
<addressbook>
<last-name>Marquez, Esq.</last-name>
<first-name>Juan Carlos A.</first-name>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Hitachi, Ltd.</orgname>
<role>03</role>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Orgad</last-name>
<first-name>Edan D.</first-name>
<department>2616</department>
</primary-examiner>
<assistant-examiner>
<last-name>Haliyur</last-name>
<first-name>Venkatesh</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A reliable packet communication device capable of flexibly adding new functions. A packet communication device is composed of multiple interface elements (IFEs), switching elements (SWE) connecting these IFEs, and a routing manager element (RME) and may also if necessary comprise special functional packet processors (xFPs) capable of different special functions. The interface element and special functional packet processor are connected by a logical bus. For the purpose of connecting the interface elements and special functional packet processors through the switching element when the logical bus has a failure, the logical bus data format is made identical to the data format for passing data through the switch element and a selection circuit is installed in the interface element for selectively sending and receiving data to/from either the logical bus or the switching element.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="160.53mm" wi="150.28mm" file="US07298752-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="111.51mm" wi="91.27mm" file="US07298752-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="261.70mm" wi="172.72mm" file="US07298752-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="182.20mm" wi="150.62mm" file="US07298752-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="256.46mm" wi="101.94mm" file="US07298752-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="127.34mm" wi="133.52mm" file="US07298752-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="238.34mm" wi="108.71mm" file="US07298752-20071120-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="239.18mm" wi="154.09mm" file="US07298752-20071120-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="118.53mm" wi="104.82mm" file="US07298752-20071120-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="228.85mm" wi="145.29mm" file="US07298752-20071120-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="233.43mm" wi="156.38mm" file="US07298752-20071120-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="270.93mm" wi="159.17mm" file="US07298752-20071120-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="242.65mm" wi="142.49mm" file="US07298752-20071120-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="191.94mm" wi="176.45mm" file="US07298752-20071120-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="271.02mm" wi="126.41mm" file="US07298752-20071120-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00015" num="00015">
<img id="EMI-D00015" he="252.22mm" wi="156.97mm" file="US07298752-20071120-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00016" num="00016">
<img id="EMI-D00016" he="117.69mm" wi="107.19mm" file="US07298752-20071120-D00016.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00017" num="00017">
<img id="EMI-D00017" he="149.52mm" wi="144.44mm" file="US07298752-20071120-D00017.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00018" num="00018">
<img id="EMI-D00018" he="261.20mm" wi="140.89mm" file="US07298752-20071120-D00018.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00019" num="00019">
<img id="EMI-D00019" he="237.74mm" wi="137.41mm" file="US07298752-20071120-D00019.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00020" num="00020">
<img id="EMI-D00020" he="226.99mm" wi="141.14mm" file="US07298752-20071120-D00020.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00021" num="00021">
<img id="EMI-D00021" he="235.97mm" wi="136.74mm" file="US07298752-20071120-D00021.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00022" num="00022">
<img id="EMI-D00022" he="181.44mm" wi="134.45mm" file="US07298752-20071120-D00022.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0002" num="0001">1. Field of the Invention</p>
<p id="p-0003" num="0002">The present invention relates to a packet communication device for performing routing and forwarding of layer <b>2</b> frames such as the Ethernet (registered commercial trademark), layer <b>3</b> packets for example, IP (Internet Protocol) and even upper layer data packets.</p>
<p id="p-0004" num="0003">2. Description of Related Art
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0004">[Non-patent document 1] Hitachi Review Vol. 49 (2000), No. 4</li>
    <li id="ul0001-0002" num="0005">[Non-patent document 2] U.S. Pat. No. 6,905,725</li>
    <li id="ul0001-0003" num="0006">[Patent document 1] JP-A No. 64542/2002</li>
</ul>
</p>
<p id="p-0005" num="0007">Data traffic including traffic on the Internet has rapidly increased in recent years. A shift can also be observed towards an Internet infrastructure with high quality and highly reliable service, which has been performed on leased lines. To cope with this shift, packet communication devices as well as transmission paths must offer high speed operation, be highly reliable and have a large capacity. Packet communication devices must also be flexible in terms of functions in order to be able to respond swiftly with new routing protocols and new services or to be capable of easily adding these functions when needed. The router is one example of a packet communications device for layer <b>3</b> processing. There are also many special function routing devices in particular whose hardware performs high speed routing and forwarding. A structure for a hardware router is disclosed for example in non-patent document 1 and non-patent document 2. <figref idref="DRAWINGS">FIG. 2</figref> is a block diagram of the hardware router disclosed in the non-patent document. Multiple routing processors <b>801</b> containing a network interface <b>811</b> are mutually connected by a crossbar switch <b>800</b>. Each routing processor <b>801</b> is composed of a forwarding controller <b>812</b>, a routing controller <b>813</b>, a routing table <b>814</b> and a packet buffer <b>815</b>. The packet header of the IP packets input through the network interface <b>811</b> are extracted from the packet by the forwarding controller <b>812</b>, and a route search performed by the routing controller <b>813</b>. Destination information, filtering information for security purposes, and QoS (Quality of Service) information are entered in the routing table <b>814</b>. The IP packet is input to the packet buffer <b>815</b> after search processing is completed. Then, the packet is sent to the desired output port through the crossbar switch <b>800</b>. The routing manager <b>802</b> contains a routing protocol and exchanges routing information with neighbor routers. This routing manager <b>802</b> also establishes the forwarding path for each IP packet. This established forwarding path is reflected in the routing table <b>814</b> within the routing processor <b>801</b>. In this way, this router has a structure with distributed routing processors and packet buffer sections.</p>
<p id="p-0006" num="0008">An example of another hardware router structure is disclosed in U.S. Pat. No. 6,905,725 (Non-patent document 2).</p>
<p id="p-0007" num="0009"><figref idref="DRAWINGS">FIG. 3</figref> is a block diagram showing the hardware router disclosed in non-patent document 2. The IP packet input through an input port <b>901</b> is stored in a buffer memory <b>903</b> through an input switch <b>902</b>. In the input switch <b>902</b>, key information <b>904</b>, which is extracted from the IP packet such as the destination IP address, is input to a controller <b>905</b>. After the destination search is performed for each packet in the controller <b>905</b>, that result (Result <b>906</b>) is sent to an output switch <b>907</b>. Based on this result <b>906</b>, the output switch <b>907</b> then loads the IP packets accumulated in the buffer memory <b>903</b> into the corresponding output port <b>908</b>. The routing processor (controller <b>905</b>) and the packet buffer in this way constitute a centralized structure.</p>
<p id="p-0008" num="0010">In the technology disclosed in JP-A No. 64542/2002 (patent document 1), the labeled packets and IP packets are separated based on header information attached to them on an input line interface. The IP header was then sent to a forwarding engine after separation. However, no consideration was given to scalability in this method.</p>
<p id="p-0009" num="0011">The switch disclosed in non-technical document 1 has high scalability performance since the routing functions and forwarding functions are distributed. In the structure shown in non-patent document 1 however, the forward controller is tightly coupled to the routing controller and installed in the same routing processor section. From the viewpoint of hardware implementation, the hardware have to be completely redesigned to introduce new routing protocols and new services. In other words, this structure is not suitable for adding new functions.</p>
<p id="p-0010" num="0012">The switch architecture disclosed in non-patent document 2 has centralized control of routing and forwarding functions. Therefore, buffer memory usage is highly efficient and the device can be compactly fabricated. However, it is difficult to apply this architecture for a large scale router because of processing bottlenecks of centralized routing functions and forwarding functions. In terms of flexibility for adding new functions, the routing hardware would require complete redesigning for new protocols, even though the routing functions and forwarding functions have been distributed. Besides, this structure is not able to perform services with upper layer packets.</p>
<heading id="h-0002" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0011" num="0013">In view of the above problems with the related art, the present invention has the object of providing a packet communication device with functional flexibility. More specifically, the invention has the object of providing a packet communication device, which can be configured as a base model having a simple layer <b>2</b> forwarding function. Further, the invention has the object of providing a packet communication device with upgradability and expandability. In other words, functions such as upper layer processing and special function services can be added to the base model. Still further, the invention has the object of providing a packet communication device with performance scalability. In other words, it is possible to increase performance of the same function dynamically as required.</p>
<p id="p-0012" num="0014">The packet communication device is composed of a basic switch element, a basic packet forwarding section, special functional packet processor and a routing manager. The basic packet forwarding section has a basic layer <b>2</b> forwarding function. The special functional packet processor performs processing for layer <b>3</b> or higher layer protocol. The special functional packet processor can be added to the base packet communication device when required. In other words, the simplest structure does not contain the special functional packet processor. The routing information processed within the routing manager is used by the special functional packet processor when necessary. The basic packet forwarding section decides whether or not the input packet requests layer <b>2</b> basic forwarding or a special function. When the packet requets a special function, the packet is forwarded to the applicable special functional packet processor.</p>
<p id="p-0013" num="0015">More specifically, a forwarding control function sends only the header to the special functional packet processor when only header processing is required. Further, when it is required to assemble multiple packets, which comprise a consecutive flow for higher layer processing, the forwarding control function sends the entire packets to the special functional packet processor.</p>
<p id="p-0014" num="0016">A preferred aspect of the present invention has multiple line interfaces for accepting the input packets, a routing manager for deciding the forwarding path of the input packets, a crossbar switch, a first connecting path to connect the crossbar switch and the multiple line interfaces, a special functional processor, a second connecting path to connect the special functional processor and the multiple line interfaces, and a special function judgment block for deciding whether or not the input packet requires special function processing. In this aspect of the present invention at least a portion of the input packets are forwarded to the special functional processor based on the decision by the special function judgment block. Unlike the data bus (first connecting path), the second connecting path does not use the crossbar switch for connecting to the special functional processor. Therefore, the first connecting path is independent from the main signal data path. These connecting paths can be a bus configuration or point-to-point connections.</p>
<p id="p-0015" num="0017">The second connecting path can be used as a redundant path for the first connecting path. The header format or the whole packet format sent to the special functional packet processor from the basic packet forwarding section is identical to the data path format to the basic switch element from the basic packet forwarding section. This aspect enables path rerouting function. This means that it is possible to send packets or headers to the special functional packet processor through the switch element when path failure occurs on the path from the basic packet forwarding section to the special functional packet processor. This aspect further comprises a function for adding a special functional packet processor of the same type when the special functional packet processor does not have sufficient capacity, enabling load balancing of the special function. To distribute the traffic load among installed functional packet processors from the basic packet forwarding section, this aspect further has any of the following functions of: (1) a HASH functional distributor based on the destination IP address; (2) a cyclical distributor and order preserving function, or (3) a load balancer function and order preserving function based on load observation of each of the special functional packet processors.</p>
<p id="p-0016" num="0018">Another aspect of the packet communication device is composed of a basic switch element, a basic packet forwarding section, a special functional switch element and a routing manager. The special functional switch element has switching function with layer <b>3</b> or higher layer processing. This special functional switch element is added to the base packet communication device when necessary. A structure without the special functional switch element constitutes a base system. The routing information from the routing manager may be transferred to the special functional switch element when required. The basic packet forwarding section decides whether or not the input packet requires layer <b>2</b> basic forwarding or a special function. The basic packet forwarding section has also a forwarding address judgment means which relates each packet requesting special function to the corresponding special functional switch element. The basic switch element has a basic crossbar switch without a buffering means. On the other hand, the special functional switch element has an input buffer means, which is used to queue the packets from the basic packet forwarding section. The packets are read sequentially from the queue and special functions are applied to them. The special functional switch element also has an output buffer, which is used to switch processed packets to the desired basic packet forwarding section in a way that avoids contention. It is also possible to add the same special functional switch element when required. The traffic from the basic packet forwarding section is load balanced among the special functional switch elements. To enable load balancing, the basic packet forwarding section further has any of the following functions of: (1) a distributor with a HASH function based on the destination IP address; (2) a cyclical distributor and order preserving function, or (3) a load balancing function and order preserving function based on load monitoring of the special functional packet processor.</p>
<p id="p-0017" num="0019">Another aspect of the present invention is composed of multiple line interfaces, a crossbar switch connecting to the multiple line interfaces, and multiple slots for installing the special functional units connected to the plurality of line interfaces. Each of the multiple line interfaces has a layer <b>2</b> processing function and a special function judgment function for deciding whether or not the packet that was input requires special processing. Packets without special function processing are forwarded directly to the crossbar switch. Packets requiring special processing are, first, sent to a corresponding special functional unit, next, subjected to upper layer processing, then, sent back to the original line interface and, finally, forwarded to the crossbar switch. In these aspects of the invention, additional special functional units can be added and deleted as needed. Therefore, scalability can be provided for each function. To increase and decrease the special functional units, the invention preferably has a load balancing function.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0018" num="0020"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram showing the function block of the packet communication device of the present invention;</p>
<p id="p-0019" num="0021"><figref idref="DRAWINGS">FIG. 2</figref> is a block diagram showing a structure of a packet communication device of the related art;</p>
<p id="p-0020" num="0022"><figref idref="DRAWINGS">FIG. 3</figref> is a block diagram showing a structure of a packet communication device of the related art;</p>
<p id="p-0021" num="0023"><figref idref="DRAWINGS">FIG. 4</figref> is a block diagram showing the structure of the interface module of the packet communication device of the present invention;</p>
<p id="p-0022" num="0024"><figref idref="DRAWINGS">FIG. 5</figref> is a block diagram showing the structure of the packet communication device of the present invention;</p>
<p id="p-0023" num="0025"><figref idref="DRAWINGS">FIG. 6</figref> is a block diagram showing the structure of the packet communication device of the present invention;</p>
<p id="p-0024" num="0026"><figref idref="DRAWINGS">FIG. 7</figref> is a block diagram showing the structure of the packet communication device of the present invention;</p>
<p id="p-0025" num="0027"><figref idref="DRAWINGS">FIG. 8</figref> is a block diagram showing the structure of the packet communication device of the present invention;</p>
<p id="p-0026" num="0028"><figref idref="DRAWINGS">FIG. 9</figref> is a block diagram showing the structure of the packet communication device of the present invention;</p>
<p id="p-0027" num="0029"><figref idref="DRAWINGS">FIG. 10</figref> is a block diagram showing the structure of the special functional packet processor (xFP) of the packet communication device of the present invention;</p>
<p id="p-0028" num="0030"><figref idref="DRAWINGS">FIG. 11</figref> is a block diagram showing the structure of the packet communication device of the present invention;</p>
<p id="p-0029" num="0031"><figref idref="DRAWINGS">FIG. 12</figref> is a block diagram showing the structure of the packet communication device of the present invention;</p>
<p id="p-0030" num="0032"><figref idref="DRAWINGS">FIG. 13</figref> is a block diagram showing the structure of the packet communication device of the present invention;</p>
<p id="p-0031" num="0033"><figref idref="DRAWINGS">FIG. 14</figref> is a block diagram showing the structure of another special functional packet processor (xFP) of the packet communication device of the present invention;</p>
<p id="p-0032" num="0034"><figref idref="DRAWINGS">FIG. 15</figref> is a block diagram showing a structure of the packet communication device of the present invention;</p>
<p id="p-0033" num="0035"><figref idref="DRAWINGS">FIG. 16</figref> is a block diagram showing another structure of the interface module of the packet communication device of the present invention;</p>
<p id="p-0034" num="0036"><figref idref="DRAWINGS">FIG. 17</figref> is a block diagram showing another structure of the interface module of the packet communication device of the present invention;</p>
<p id="p-0035" num="0037"><figref idref="DRAWINGS">FIG. 18</figref> is a block diagram showing another structure of the interface module of the packet communication device of the present invention;</p>
<p id="p-0036" num="0038"><figref idref="DRAWINGS">FIG. 19</figref> is a block diagram showing the structure of another special functional packet processor (xFP) of the packet communication device of the present invention;</p>
<p id="p-0037" num="0039"><figref idref="DRAWINGS">FIG. 20</figref> is a block diagram showing a structure of the packet communication device of the present invention;</p>
<p id="p-0038" num="0040"><figref idref="DRAWINGS">FIG. 21</figref> is a block diagram showing another structure of the interface module of the packet communication device of the present invention;</p>
<p id="p-0039" num="0041"><figref idref="DRAWINGS">FIG. 22</figref> is a block diagram showing a structure of the packet communication device of the present invention;</p>
<p id="p-0040" num="0042"><figref idref="DRAWINGS">FIG. 23</figref> is a block diagram showing another structure of the interface module of the packet communication device of the present invention;</p>
<p id="p-0041" num="0043"><figref idref="DRAWINGS">FIG. 24</figref> is a block diagram showing a structure of the packet communication device of the present invention;</p>
<p id="p-0042" num="0044"><figref idref="DRAWINGS">FIG. 25</figref> is a block diagram showing a structure of the packet communication device of the present invention;</p>
<p id="p-0043" num="0045"><figref idref="DRAWINGS">FIG. 26</figref> is a block diagram showing a structure of the packet communication device of the present invention;</p>
<p id="p-0044" num="0046"><figref idref="DRAWINGS">FIG. 27</figref> is a block diagram showing another structure of the interface module of the packet communication device of the present invention;</p>
<p id="p-0045" num="0047"><figref idref="DRAWINGS">FIG. 28</figref> is a block diagram showing the structure of the switch module of the packet communication device of the present invention;</p>
<p id="p-0046" num="0048"><figref idref="DRAWINGS">FIG. 29</figref> is a block diagram showing another structure of the interface module of the packet communication device of the present invention;</p>
<p id="p-0047" num="0049"><figref idref="DRAWINGS">FIG. 30</figref> is a block diagram showing a structure of the packet communication device of the present invention;</p>
<p id="p-0048" num="0050"><figref idref="DRAWINGS">FIG. 31</figref> is an installation example of the packet communication device of the present invention;</p>
<p id="p-0049" num="0051"><figref idref="DRAWINGS">FIG. 32</figref> is an installation example of the packet communication device of the present invention;</p>
<p id="p-0050" num="0052"><figref idref="DRAWINGS">FIG. 33</figref> is an installation example of the packet communication device of the present invention;</p>
<p id="p-0051" num="0053"><figref idref="DRAWINGS">FIG. 34</figref> is a block diagram showing a structure of the packet communication device of the present invention;</p>
<p id="p-0052" num="0054"><figref idref="DRAWINGS">FIG. 35</figref> is an installation example of the packet communication device of the present invention; and</p>
<p id="p-0053" num="0055"><figref idref="DRAWINGS">FIG. 36</figref> is a block diagram showing another structure of the interface module of the packet communication device of the present invention.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS</heading>
<p id="p-0054" num="0056">The embodiments of the packet communication device of the present invention are described next.</p>
<p id="p-0055" num="0057">A block diagram of the overall structure of the packet communication device of the present invention is shown in <figref idref="DRAWINGS">FIG. 1</figref>. This packet communication device is composed of multiple interface elements (IFE) <b>2</b>, special functional packet processors (xFP) <b>3</b> for performing special processing, a switch element (SWE) <b>1</b> connecting to the multiple IFE<b>2</b>, and routing manager elements (RME) <b>4</b>. In these RME<b>4</b>, routing information is exchanged among the other connected devices. Routing protocols such as RIP, OSPF are used to exchange routing information. Here, IFE<b>2</b> and xFP are connected through the logical bus <b>5</b>, enabling any-to-any connection.</p>
<p id="p-0056" num="0058">The IFE<b>2</b> function block is first explained using <figref idref="DRAWINGS">FIG. 4</figref>. The input side of the IFE<b>2</b> is composed of a network interface <b>21</b>, a layer <b>2</b> processor <b>22</b>, an ingress forwarding processor <b>23</b>, a packet buffer <b>24</b>, an SWE I/F <b>25</b> and an xFPI/F<b>26</b>. First, packet frames input to the device undergo physical layer-processing by the network interface <b>21</b>. For example, the case of the Ethernet, MAC (Media Access Control) layer processing is performed. The destination output port of the destination MAC address is identified by the layer <b>2</b> processor <b>22</b> using the destination address within the frame, source address, VID (VLAN ID), FDG (Forwarding Data Base).</p>
<p id="p-0057" num="0059">The ingress forwarding processor <b>23</b> then judges whether or not to perform special function processing to the input frame (called a packet in layer <b>3</b>). The ingress forwarding processor <b>23</b> is composed of a special functional judgment block <b>231</b>, a packet processor/header processor <b>232</b>, a destination (xFP) header attacher <b>233</b>, a header extraction/analyzer <b>234</b> and a waiting buffer <b>235</b>. The header of the input packet is first identified by the special functional judgment block <b>231</b> and a decision is made there as to whether or not special functional processing is required. Packets (frame) without requiring special functional processing are sent to the packet buffer <b>24</b> by bypassing the subsequent processing. Packets requiring special functional processing are then judged by the packet processor/header processor <b>232</b> regarding whether the special functional processing is required for only the packet header or for the entire packet. When processing is required only for the packet header, then the header portion is sent to the destination (xFP) header attacher <b>233</b>. The data of that packet is held in the waiting buffer <b>235</b> until the header processing ends. When the entire packed must be processed, the whole packet is sent to the destination (xFP) header attacher <b>233</b>. In the destination (xFP) header attacher <b>233</b>, the destination xFP<b>3</b> header is attached to the packet header or entire packet to send them for the corresponding desired special functional processing. Next, the packet header or entire packet is output through xFPI/F<b>26</b>. After processed in desired XFP<b>3</b>, the packet header or entire packet is sent to the header extraction/analyzer <b>234</b>. The data input to the header extraction/analyzer <b>234</b> is identified as to whether it is the packet header or the entire packet based on the header attached by xFP<b>3</b>. If identified as the entire packet then it is sent to the packet buffer <b>24</b>. If identified as the packet header, it is sent to the waiting buffer+header attacher <b>235</b>. After being coupled with the waiting packet data, it is sent to the packet buffer <b>24</b>. The packets input to the packet buffer <b>24</b> are queued and output to the SWE<b>1</b> through the SWEI/F<b>25</b>.</p>
<p id="p-0058" num="0060">An example of layer <b>2</b> packet forwarding is described next while referring to <figref idref="DRAWINGS">FIG. 5</figref>. The packet <b>60</b> input to IFE <b>2</b>-<b>1</b> is composed of a data section <b>61</b> and a header section <b>62</b>. The destination SWE<b>1</b> port is obtained at the layer <b>2</b> processor <b>22</b> in the IFE <b>2</b>. If the packet <b>60</b> is judged by the ingress forwarding processor <b>23</b> as no special processing is required, the packet is forwarded to the desired egress IFE (in this example, IFE<b>2</b>-n) according to the internal header <b>60</b>H attached at the ingress IFF<b>2</b>.</p>
<p id="p-0059" num="0061"><figref idref="DRAWINGS">FIG. 6</figref> is a block diagram showing another structure of the packet communication device of the present invention. When special function processing is not required for the device, only basic layer <b>2</b> function is installed. In other words, processing is performed using the base model without installing an xFP<b>3</b> as shown in <figref idref="DRAWINGS">FIG. 6</figref>.</p>
<p id="p-0060" num="0062">The function block of the egress IFE<b>2</b> is described while referring to <figref idref="DRAWINGS">FIG. 23</figref>. The function block of the egress IFE<b>2</b> is composed of an SWE I/F<b>25</b>, a packet buffer <b>27</b>, an egress forwarding processor <b>28</b>, and network interfaces <b>21</b>. The packet forwarded from SWE<b>1</b> is input to the packet buffer <b>27</b> through the SWE I/F<b>25</b>. It is well known that using fixed length packets enables a simple and efficient switch architecture. Therefore, if multiple fixed-length packets (cells) are used inside the system to switch packets, the cells are reconstructed into the original variable-length packet in the packet buffer <b>27</b>. Priority output control is also performed in the packet buffer <b>27</b> according to the quality class. The headers of the packets (in the case of layer <b>3</b> packets) output from the packet buffer <b>27</b> are rewritten for their next destination by the egress forwarding processor <b>28</b>. More specifically, the destination MAC address is rewritten to a MAC address called a Next Hop. This Next Hop MAC address is the MAC address of the router (switch) on the next path to the destination. The packet is then output from the output line to the next address through the network interface <b>21</b>.</p>
<p id="p-0061" num="0063">An example for transferring the layer <b>3</b> packet is described using <figref idref="DRAWINGS">FIG. 7</figref> through <figref idref="DRAWINGS">FIG. 10</figref>.</p>
<p id="p-0062" num="0064">In <figref idref="DRAWINGS">FIG. 7</figref>, the packet <b>70</b> input to IFE <b>2</b>-<b>1</b> is composed of a data section <b>71</b> and a header section <b>72</b>. In case the ingress forwarding processor <b>23</b> within the IFE<b>2</b>-<b>1</b> detects that layer <b>3</b> processing is required, only the header portion <b>72</b> of the packet is extracted and sent to xFP<b>3</b> for dedicated layer <b>3</b> processing. The data section <b>71</b> keeps waiting in the waiting buffer <b>235</b> until receiving the header from the xFP. An internal header <b>72</b>H corresponding to xFP<b>3</b> is attached to the header section <b>72</b> to forward the header section <b>72</b> for xFP<b>3</b>-<b>1</b>. The structure of the xFP<b>3</b><i>a </i>for layer <b>3</b> processing is shown in <figref idref="DRAWINGS">FIG. 10</figref>. First, the header <b>72</b> is extracted by the header extraction/attachment <b>31</b>, then, destination port searching, filtering and QoS is performed in the routing processor based on the header <b>72</b>.</p>
<p id="p-0063" num="0065"><figref idref="DRAWINGS">FIG. 8</figref> and <figref idref="DRAWINGS">FIG. 9</figref> are block diagrams showing a structure of the packet communication device of the present invention.</p>
<p id="p-0064" num="0066">The processing information for each IP address is stored in the routing table <b>33</b>. The header <b>74</b>, which contains information obtained from the routing processor <b>32</b>, is processed by the header extraction processor <b>31</b> so that an internal header <b>74</b>H is attached for the purpose of sending back the header <b>74</b> to the source IFE<b>2</b> (in this example, IFE<b>2</b>-<b>1</b>). This flow is shown in <figref idref="DRAWINGS">FIG. 8</figref>. As shown in <figref idref="DRAWINGS">FIG. 9</figref>, the header <b>74</b> that arrived at the source IFE<b>2</b> (in this example, IFE<b>2</b>-<b>1</b>) is combined with the data section <b>71</b> in the waiting buffer <b>235</b>. Then, the device internal header <b>70</b>H corresponding to the desired output IFE is attached to the data section to forward the packet to the output IFE<b>2</b> (in this example, IFE<b>2</b>-n) through SWE<b>1</b>. The xFP, which is dedicated for layer <b>3</b> processing, can be added incrementally as needed to deploy new IP protocol versions or to enhance protocol, etc.</p>
<p id="p-0065" num="0067">An example of upper layer packet forwarding is shown next using <figref idref="DRAWINGS">FIG. 11</figref> through <figref idref="DRAWINGS">FIG. 14</figref>.</p>
<p id="p-0066" num="0068">In <figref idref="DRAWINGS">FIG. 11</figref>, the packet <b>80</b> input to the IFE<b>2</b>-<b>1</b> is composed of a data section <b>81</b> and a header section <b>82</b>. When the ingress forwarding processor <b>23</b> judges that upper layer processing is required, the entire packet <b>80</b> is sent to the xFP<b>3</b> (in this example, xFP<b>3</b>-<b>2</b>) which performs upper layer dedicated processing. An internal header <b>82</b>H corresponding to the xFP<b>3</b>-<b>2</b> is attached to the packet <b>80</b> to transfer packet <b>80</b> for xFP<b>3</b>-<b>2</b>. The structure of the xFP<b>3</b>-<b>2</b> is shown in <figref idref="DRAWINGS">FIG. 14</figref>. The packet <b>80</b> input to the xFP<b>3</b>-<b>2</b> is forwarded to the network processor (NP) <b>37</b> or the microprocessor unit (MPU) <b>36</b> through the bus (for example the PCI bus). Then, packets are assembled for application layer processing. In this example, bus converter <b>34</b> terminates the PCI bus.</p>
<p id="p-0067" num="0069">An internal header <b>83</b>H, as well as packet header <b>83</b>, is attached to the packet after application layer processing as shown in <figref idref="DRAWINGS">FIG. 12</figref> so that the packet will be sent back to the original source IFE<b>2</b> (in this example, IFE<b>2</b>-<b>1</b>).</p>
<p id="p-0068" num="0070">An internal header <b>80</b>H, which indicates the desired output IFE, is attached to the packet <b>80</b> that arrived at the source IFE<b>2</b> (in this example, IFE<b>2</b>-<b>1</b>) as shown in <figref idref="DRAWINGS">FIG. 13</figref>, and then, the packet is sent to the desired output IFE<b>2</b> (in this example, IFE<b>2</b>-n) through the SWE<b>1</b>. Typical items for identifying the forwarding destination for upper layer processing are RTP and HTTP headers, URL, cookies, SSLID, application identifier and file extensions, etc. These are provided as different xFP modules having the different functions. Those modules are incrementally installed as needed.</p>
<p id="p-0069" num="0071">The following examples describe scalability for cases where the processing performance of one special function module becomes insufficient, and an identical special function module is added incrementally.</p>
<p id="p-0070" num="0072">In the example in <figref idref="DRAWINGS">FIG. 15</figref>, to increase the processing performance of the xFP<b>3</b>-<b>1</b>, an identical special function packet processor xFP<b>3</b>-<b>4</b> is additionally installed so that the traffic load can be balanced (dispersed) between these two xFPs. First, the respective header sections of the layer <b>3</b> packet <b>90</b> (composed of a data section <b>91</b> and a packet header section <b>92</b>) and a packet <b>100</b> (composed of a data section <b>101</b> and a packet header section <b>102</b>) are extracted at the ingress forwarding processor <b>23</b>. Then, the internal header <b>92</b>H corresponding to the xFP<b>3</b>-<b>1</b> is attached to the packet header <b>92</b>. In the same way, the device internal header <b>102</b>H corresponding to the xFP<b>3</b>-<b>4</b> is attached to the packet header <b>102</b>. According to the respective internal header, the packet header <b>92</b> is processed by the xFP<b>3</b>-<b>1</b>, and the packet header <b>102</b> is processed by the xFP<b>3</b>-<b>4</b> in a load balancing manners.</p>
<p id="p-0071" num="0073">The load balancing among the multiple xFPs (processors) is described next using three methods. The first method is described using <figref idref="DRAWINGS">FIG. 16</figref>. A destination xFP header attachment block <b>233</b>A within the ingress forwarding processor <b>23</b> is composed of a header analysis/function judgment (block) <b>2331</b>, a hash table <b>2332</b> and a destination xFP header generation/attachment (block) <b>2333</b>. The function required for the IP packet, which is input to the destination xFP header attachment block <b>233</b>A, is determined by the header analysis/function judgment (block) <b>2331</b>. (In this example, layer <b>3</b> processing is required, which is equivalent to XFP<b>3</b>-<b>1</b> or xFP<b>3</b>-<b>4</b>). Hash processing is then performed by the hash table <b>2332</b> using the flow information based on the source IP address (SIP) or a combination of the source IP address and destination IP address (DIP) as a key. Then packets are distributed to the corresponding xFP (In this example, xFP<b>3</b>-<b>1</b> for the packet header <b>92</b>, and xFP<b>3</b>-<b>4</b> for the packet header <b>102</b>). The destination xFP header generation/attachment (block) <b>2333</b> attaches an internal header <b>92</b>H corresponding to xFP<b>3</b>-<b>1</b> to the packet header <b>92</b>; and attaches an internal header <b>102</b>H corresponding to xFP<b>3</b>-<b>4</b> to the packet header <b>102</b> based on the processing results of the hash table <b>2332</b>. This method is characterized in that the same xFP processors handle the same flow, therefore, no reversal of packet sequence occurs in load balancing. However, load balancing could be inefficient if uneven traffic flow is fed to the device.</p>
<p id="p-0072" num="0074">The second method is described next using <figref idref="DRAWINGS">FIG. 17</figref>. A destination xFP header attachment block <b>233</b>B within the ingress forwarding processor <b>23</b> is composed of a header analysis/function judgment (block) <b>2331</b>, a sequence number generator <b>2334</b> and a destination xFP header generation/attachment (block) <b>2333</b>. A header extraction analysis block <b>234</b>B is composed of a header analysis function judgment block <b>2351</b> and a resequence buffer <b>2352</b>. The required function of input IP packet is determined by the header analysis/function judgment (block) <b>2331</b>. In this example, a function for xFP<b>3</b>-<b>4</b> or xFP<b>3</b>-<b>1</b> equivalent to layer <b>3</b> processing is required. A sequence number is then generated for the IP packet of each flow by the sequence number generator <b>2334</b>. The sequence number for each flow is administered by the sequence number generator <b>2334</b>. The destination xFP header generation/attachment (block) <b>2333</b> distributes input packets cyclically among the multiple xFPs for each function. (In this example, cyclically distributed to xFP<b>3</b>-<b>1</b> or xFP<b>3</b>-<b>4</b>.) In this method, the same xFP<b>3</b> processor is not always used for the same flow. Therefore, reversal of the packet sequence may occur as a result of load balancing. To avoid this, the order of packets from xFP<b>3</b> processors are resequenced in the header extraction analysis block <b>234</b>B. More specifically, the function and flow of the packets are identified by the header analysis function judgment <b>2351</b>. The packets are then stored in the resequence buffer <b>2352</b> based on this identification, and the sequence integrity is then recovered based on the sequence number attached by the destination xFP header attachment block <b>233</b>B. The third load balancing method is described next using <figref idref="DRAWINGS">FIG. 18</figref> and <figref idref="DRAWINGS">FIG. 19</figref>.</p>
<p id="p-0073" num="0075"><figref idref="DRAWINGS">FIG. 18</figref> is a block diagram showing another structure of the interface module of the packet communication device of the present invention.</p>
<p id="p-0074" num="0076"><figref idref="DRAWINGS">FIG. 19</figref> is a block diagram showing the structure of another special functional packet processor (xFP) of the packet communication device of the present invention.</p>
<p id="p-0075" num="0077">A destination xFP header attachment block <b>233</b>C within the ingress forwarding processor <b>23</b> is composed of a header analysis/function judgment (block) <b>2331</b>, and a destination xFP header generation/attachment (block) <b>2333</b>. A header extraction analysis block <b>234</b>C is composed of a header analysis function judgment <b>2351</b> block, a resequence buffer <b>2352</b>, and a control packet extractor <b>2353</b>. The ingress forwarding processor <b>23</b> further has an xFP load monitor-manager <b>236</b>. The function required for the IP packet, which is input to the destination xFP header attachment block <b>233</b>C, is determined by the header analysis/function judgment (block) <b>2331</b>. When the function is determined, this is reported to the xFP load monitor-manager <b>236</b>. The xFP load monitor-manager <b>236</b> monitors the load status of each xFP<b>3</b>. When some of the multiple xFP<b>3</b> processors have the same function, the xFP load monitor-manager <b>236</b> selects the xFP<b>3</b> with the lightest load and informs the status to the destination xFP header generation/attachment (block) <b>2333</b>. In the destination xFP header generation/attachment (block) <b>2333</b>, an internal header corresponding to the xFP<b>3</b>, which is indicated by the xFP load monitor-manager <b>236</b>, is attached to the packet. In this method also, the same xFP<b>3</b> processor is not assumed to process the same flow. Therefore, reversal of the packet sequence may occur due to load balancing. The sequence of the packet processed by the xFP<b>3</b> should therefore be reconstructed in the header extraction analysis block <b>234</b>B. More specifically, the applied function and flow units of each packet are identified by the header analysis function judgment <b>2351</b>. The packets are then stored in the resequence buffer <b>2352</b> based on the applied function and flow units. Finally, the packet sequence is controlled based on the sequence number, which is attached by the destination xFP header attachment block <b>233</b>C in ingress side.</p>
<p id="p-0076" num="0078">In this method, as shown in <figref idref="DRAWINGS">FIG. 19</figref>, the structure further comprises a load monitoring/control packet generator <b>38</b>, which monitors each xFP's load and periodically reports the load status to IFE<b>2</b>. When the control packet from a xFP is periodically received by each IFE, the control packet is extracted by the control packet extractor <b>2353</b>, in <figref idref="DRAWINGS">FIG. 18</figref>, and the load status is reported to the xFP load monitor-manager <b>236</b>.</p>
<p id="p-0077" num="0079">Another example of the present invention is described using <figref idref="DRAWINGS">FIG. 20</figref>.</p>
<p id="p-0078" num="0080">To perform application layer processing in the xFP<b>3</b>, as explained in the example of xFP<b>3</b>-<b>2</b>, the entire packet must be sent to (and received from) the xFP<b>3</b>. The bandwidth of the logical bus <b>5</b> therefore could be a bottleneck when a large number of packets requiring layer processing are input to the device. In other words, processing efficiency might be deteriorated. An xFTR<b>6</b> (special functional packet trunk module) is therefore added as shown in <figref idref="DRAWINGS">FIG. 20</figref>. This xFTR<b>6</b> is a module for upper layer processing, and has the same SWE<b>1</b> interface as the IFF<b>2</b>. The bandwidth bottleneck caused by the logical bus <b>5</b> can be eliminated by connecting the xFTR<b>6</b> to the IFE<b>2</b> through SWE<b>1</b>. Multiple xFTR<b>6</b> modules can also TO be added at a time for each upper layer function (In <figref idref="DRAWINGS">FIG. 20</figref>, the two modules xFTR<b>6</b>A, xFTR<b>6</b>B. A structure without xFP modules and with xFTR modules is possible, as shown in <figref idref="DRAWINGS">FIG. 30</figref>. Also as described in a previous example, scalability of processing can be attained by the load balancing using a structure containing multiple xFTR modules having the same function. A description of the IFE<b>2</b> to carry out load balancing is omitted here since it is identical to the description for <figref idref="DRAWINGS">FIG. 16</figref> through <figref idref="DRAWINGS">FIG. 19</figref>. An installation example containing the IFE<b>2</b>, xFTR modules is described next. The backplane <b>200</b> in <figref idref="DRAWINGS">FIG. 31</figref> accomodates multiple IFE (<b>2</b>-<b>1</b> through <b>2</b>-<b>6</b>) and SWE (<b>1</b>-<b>2</b>, <b>1</b>-<b>2</b>). In this example, the slot <b>201</b> and slot <b>202</b> are empty. These empty slots <b>201</b>, <b>202</b> can accept IFEs (<b>2</b>-<b>7</b>, <b>2</b>-<b>8</b>) as shown in <figref idref="DRAWINGS">FIG. 32</figref> or xFTRs (<b>6</b>A, <b>6</b>B) as shown in <figref idref="DRAWINGS">FIG. 33</figref>.</p>
<p id="p-0079" num="0081">Another embodiment of the present invention is described using <figref idref="DRAWINGS">FIG. 34</figref> and <figref idref="DRAWINGS">FIG. 35</figref>. In this embodiment, special functional processors are contained in the slots. A first module has the same physical interface as an IFE<b>2</b>. Second modules which have functional processors (IFE) are connected to the first module.</p>
<p id="p-0080" num="0082">In a structure installed with xFP<b>2</b> modules as shown in <figref idref="DRAWINGS">FIG. 34</figref>, the xFP<b>2</b> modules are mounted to the IFE slot through a connecting adapter (ADP<b>7</b>).</p>
<p id="p-0081" num="0083"><figref idref="DRAWINGS">FIG. 35</figref> is an oblique view of the adapter. The ADP<b>7</b> has the function of distributing packets received from the SWE<b>1</b>, to the multiple xFP modules (in this example, <b>8</b>A-<b>1</b> through <b>8</b>A-<b>3</b>) based on the header. The ADD<b>7</b> also has the function of multiplexing the packets received from the multiple xFPs (<b>8</b>A-<b>1</b> through <b>8</b>A-<b>3</b>) and sending them to the SWE<b>1</b>. This implementational configuration eliminates the need to prepare dedicated xFP<b>2</b> slots and wiring <b>5</b>. Also, the IFE slots are not occupied by a single special functional module as is the case when with xFTR modules. For example, multiple xFPs may be sequentially added to free IFE slot as needed. Another embodiment of the invention is shown using <figref idref="DRAWINGS">FIG. 21</figref>.</p>
<p id="p-0082" num="0084">An input/output I/F selector <b>237</b> is installed in the ingress/egress forwarding processor <b>23</b> within the IFE<b>2</b>. A device internal header is attached to the packet header or the packet, which are exchanged (sent and received) with xFP<b>3</b> modules through the logical bus <b>5</b>. The format of the internal header is identical to that of the internal header, which is applied to the packets exchanged (sent and received) with SWE<b>1</b>. If a failure occurs in the logical bus <b>5</b> as shown in <figref idref="DRAWINGS">FIG. 22</figref>, the input/output I/F selector <b>237</b> sends the packet or the packet header needing special function processing through the SWE<b>25</b> instead of sending the packet via the logical bus <b>5</b>. In <figref idref="DRAWINGS">FIG. 22</figref> shows the example of sending the packet header <b>72</b> of packet <b>70</b> as in <figref idref="DRAWINGS">FIG. 8</figref> to xFP<b>3</b>-<b>1</b> through SWE<b>1</b> instead of the logical bus <b>5</b>. The xFP<b>3</b> also sends the packets or packet headers back to the original IFE<b>2</b> through the SWE<b>1</b> instead of the logical bus <b>5</b> after special function processing. Therefore, by making the data transfer format of SWE<b>1</b> identical to the data transfer format of the logical bus <b>5</b>, a spare path can be prepared through SWE<b>1</b>, when failures occur on the logical bus <b>5</b>. A system with high reliability and a low cost can in this way be achieved without having to prepare redundant logical paths <b>5</b>.</p>
<p id="p-0083" num="0085">Another embodiment of the present invention is described next using <figref idref="DRAWINGS">FIG. 24</figref> and <figref idref="DRAWINGS">FIG. 25</figref>.</p>
<p id="p-0084" num="0086">In the previous description, the IFE<b>2</b> and xFP<b>3</b> were connected by the logical bus <b>5</b> for communication. However, the present connection configuration may utilize a CPSW (Control Path Switch) <b>51</b> as shown in <figref idref="DRAWINGS">FIG. 24</figref>. By utilizing a structure having the CPSW <b>51</b>, point-to-point connections can be made between the IFE<b>2</b> and xFP<b>3</b> and this enables higher speed communication.</p>
<p id="p-0085" num="0087">A block diagram showing a structure of the packet communication device of the present invention is shown in <figref idref="DRAWINGS">FIG. 25</figref>. When using a configuration with a switch using multiple SWE<b>1</b> a shown in <figref idref="DRAWINGS">FIG. 25</figref>, one SWE<b>1</b> may be allotted for the control path, and utilized as the control path switch plane (SWE<b>52</b>). This has the advantage that SWE<b>1</b> can also be used as the control path, which is physically identical.</p>
<p id="p-0086" num="0088">Still another embodiment of the present invention is described using <figref idref="DRAWINGS">FIG. 26</figref> through <figref idref="DRAWINGS">FIG. 29</figref>.</p>
<p id="p-0087" num="0089">In the previous examples, special function processing of packets is done with the xFP<b>3</b> as the special functional packet processor. However, a packet communications device with special functional packet processing can also be provided by consolidating this function to the switch section.</p>
<p id="p-0088" num="0090">In the packet communications device shown in <figref idref="DRAWINGS">FIG. 26</figref>, multiple FSWE (Functional Switch Element) <b>10</b> can be added to the multiple SWE<b>1</b><i>s</i>. Basic layer <b>2</b> packets are to be forwarded to the bufferless SWE<b>1</b>, and packets requiring special functional processing are to be forwarded to the FSWE <b>10</b>. The special functional packet processor with this configuration has a crossbar switch <b>10</b> connecting to multiple line interfaces <b>2</b>-<b>1</b>. The crossbar switch <b>10</b> with the special functional packet processor and the ordinary crossbar switch <b>1</b> are both connectable to a common slot. The crossbar switch <b>10</b> with the special functional packet processor and the ordinary crossbar switch <b>1</b> have separate connecting paths from the line interface.</p>
<p id="p-0089" num="0091">The input function block for interface element IFE<b>2</b>B of this embodiment is described using <figref idref="DRAWINGS">FIG. 27</figref>. The input side of the IFE<b>2</b>B is composed of a network interface <b>21</b>, a layer <b>2</b> processor <b>22</b>, an ingress forwarding processor <b>23</b>B, a packet buffer <b>24</b>, an SWE I/F <b>25</b> and an FSWE I/F <b>27</b>. First, the frames input to the device undergo physical layer processing by the network interface <b>21</b>. In case of an Ethernet interface, MAC (Media Access Control) layer processing is performed. The functional judgment is next performed by the layer <b>2</b> processor <b>22</b> utilizing the destination address within the frame, the transmit source address, VID (VLAN ID), FDB (Forwarding Data Base) etc. The destination output port of the destination MAC address is identified by this functional judgment process. The ingress forwarding processor <b>23</b> then judges whether or not to perform special function processing on the input frame (called a packet in layer <b>3</b>). This ingress forwarding processor <b>23</b> is composed of a special functional judgment block <b>231</b> and a functional header attachment <b>238</b>.</p>
<p id="p-0090" num="0092">The header of the input packet is first identified by the special functional judgment block <b>231</b> and a decision is made as to whether or not special functional processing is required. Packets (frame) not requiring special functional processing are sent to the packet buffer <b>24</b>, bypassing the subsequent processing. Packets input to the packet buffer <b>24</b> are queued. Then, packets are output to the SWE<b>1</b> through the SWEI/F<b>25</b> after undergoing competitive output control with other IFE<b>2</b>. Packets, which require special functional processing, are attached with a header corresponding to destination FSWE<b>10</b> These are then output to the FSWE through the FSWEI/F<b>27</b> without going through the packet buffer <b>24</b>. The line interface therefore has a distributing function to determine whether or not to send input packets to the crossbar switches. The IFE<b>2</b>B also has a FSWE I/F and a SWE I/F in order to send packets to any of the switches.</p>
<p id="p-0091" num="0093">The structure of the FSWE <b>10</b> is described next using <figref idref="DRAWINGS">FIG. 28</figref>. The FSWE <b>10</b> is composed of an FP<b>11</b> as the functional processor, an input packet buffer <b>12</b> and an output packet buffer <b>13</b>. The packet sent from the IFE<b>2</b> is input to the input packet buffer <b>12</b>. Packets input to the input packet buffer <b>12</b> are multiplexed at the multiplexer <b>120</b> and queued into the FIFO buffer <b>121</b>. The packets queued at the FIFO buffer are read and input to FP<b>11</b>. The headers of the packets are extracted by the routing processor <b>110</b>. Next, processing such as destination port search, filtering, and QoS (Quality of Service) are performed. The processing information for each IP address are stored in the routing table <b>111</b>. The device internal header containing the destination port information is attached to the packet based on information acquired from the routing table <b>111</b>. The packet is then input to the output packet buffer <b>13</b>. The packet input to the output packet buffer <b>13</b> is output to the desired IFE<b>2</b> after being stored in the FIFO buffer <b>131</b> of each output IFE<b>2</b> based on the device internal header information attached at the routing processor <b>110</b>. The embodiment in <figref idref="DRAWINGS">FIG. 28</figref> shows an example of processing for a layer <b>3</b> packet. The FSWE<b>10</b> is provided as a special functional packet module for the upper layer processing functions as described in <figref idref="DRAWINGS">FIG. 14</figref>.</p>
<p id="p-0092" num="0094">The egress side function block for interface element IFE<b>2</b>B of the present structure is described next in <figref idref="DRAWINGS">FIG. 29</figref>. The output side function block of IFE<b>2</b>B is composed of an SWE I/F<b>25</b>, an FSWE I/F<b>26</b>, a packet buffer <b>27</b>, an egress forwarding processor <b>29</b> and a network interface <b>21</b>. The packets forwarded from the SWE<b>1</b> are input to the packet buffer <b>27</b> through the FSWE I/F<b>27</b>. The packets forwarded from the FSWE<b>10</b> are input to the buffer <b>25</b> through the FSWEI/F<b>27</b>. The SWE <b>1</b> uses cell forwarding. In other words, when multiple fixed-length packet formats are being used, the packet is reconstructed into the original variable-length packet by the packet buffer <b>27</b>. Priority output control is in some cases also performed at the packet buffer <b>27</b> according to the quality class. The headers of the packets (when layer <b>3</b> packets), which are output from the packet buffer <b>27</b>, are rewritten for their next forwarding destination by the egress forwarding processor <b>28</b>. More specifically, the destination MAC address is rewritten to a MAC address called a Next Hop for the router (switch) on the next path to the destination. The packet is then output from the output line to the next address through the network interface <b>21</b>.</p>
<p id="p-0093" num="0095">Finally, <figref idref="DRAWINGS">FIG. 36</figref> shows a structure capable of containing a selectable special functional processor for the previously described IFE<b>2</b>. This structure is composed of a socket section <b>2301</b> allowing addition of ingress forwarding processors <b>23</b>, and two selectors <b>2303</b>A and <b>2303</b>B. If not loaded with the ingress forwarding processors <b>23</b>, both of the selectors <b>2303</b>A and <b>2303</b>B are switched to bypass the socket section <b>2301</b> and use the line <b>2302</b>. However if loaded with ingress forwarding processors <b>23</b>, both of the selectors <b>2303</b>A and <b>2303</b>B are switched to use an ingress forwarding processor <b>23</b>. A low cost IFE modules can be provided without the ingress forwarding processors <b>23</b>, if only basic layer <b>2</b> forwarding is required.</p>
<p id="p-0094" num="0096">As explained above, the embodiments provide a packet communications device which is capable of adding functions flexibly. More specifically, the present invention provides a packet communication device, starting with a base model for simple layer <b>2</b> forwarding function and functional upgradability. This means that when functions such as upper layer processing and special function services are required, these functions can be easily added as special functional modules or as special functional switch modules.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A packet communication device comprising:
<claim-text>a plurality of line interfaces for receiving input packets,</claim-text>
<claim-text>a routing manager for deciding the transfer path of said input packets;</claim-text>
<claim-text>a crossbar switch connected with a plurality of said line interfaces through a first connecting path;</claim-text>
<claim-text>a special functional processor connected with a plurality of said line interfaces through a second connecting path; and</claim-text>
<claim-text>a special function judgment block for deciding whether or not said input packet requires special function processing, said special function judgment block being attached to each of said line interfaces,</claim-text>
<claim-text>wherein packets decided by said special function judgment block not to require special processing are sent directly to said crossbar switch through said first connecting path; and packets decided to require special processing are sent to said special functional processor through said second connecting path and processed therein, and then are sent back to respective line interfaces where the packets sent from and forwarded therethrough to said crossbar switch.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. A packet communication device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein each of a plurality of said line interfaces comprises a layer <b>2</b> processing function, and said special functional processor possesses an upper layer processing function.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. A packet communication device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said special functional processor can be installed according to the required functions.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. A packet communication device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said special functional processor comprises a first special functional packet processor and a second special functional packet processor.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. A packet communication device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said first connecting path and said second connecting path have identical data formats, and when a failure occurs on said second connecting path, said line interfaces and said special functional processor is interconnected by either said first connecting path or said crossbar switch, and said line interface comprises a selection circuit for selectively sending and receiving data along either of said first and said second connecting paths.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. A packet communication device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said special functional processor is composed of a plurality of special functional processors having identical functions.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. A packet communication device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said special function processor is composed of a second crossbar switch connected with said interfaces through said second connecting path,
<claim-text>either said second crossbar switch or said crossbar switch is connected to a common slot, and</claim-text>
<claim-text>said line interface has a function for distributing said input packets to at least one of said second crossbar switch and said crossbar switch.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. A packet communication device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said special function processor is made as a module that is either attached to or removed from the slot as required.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. A packet communication device according to <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein said special function processor comprises a first module having its own slot and connected to a slot, and a second module connected to said slot of said first module.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. A packet communication device comprising:
<claim-text>a plurality of line interfaces;</claim-text>
<claim-text>a crossbar switch connected to a plurality of said line interfaces through a first connecting path;</claim-text>
<claim-text>a plurality of slots for connecting special functional units connected with a plurality of said line interfaces through a second connecting path, wherein</claim-text>
<claim-text>each of said line interfaces comprises a layer <b>2</b> processing function and a special function judgment function for deciding whether or not said input packet requires special processing, and</claim-text>
<claim-text>when said special function judgment function decides that a packet does not require special function processing, said packet is forwarded directly to said crossbar switch through said first connecting path; and when a packet is decided to require special function processing, said packet is sent to said special functional unit corresponding to said required special function through said second connecting path, next, performed upper layer processing, and then sent back to respective line interfaces where the packets sent from and finally forwarded to said crossbar switch.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. A packet communication device according to <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein a plurality of said slots have the same shape, and multiple types of special functional units of different functions can be connected to said slots.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. A packet communication device according to <claim-ref idref="CLM-00011">claim 11</claim-ref>, comprising a load balancer for distributing the load to a plurality of said special functional units when a plurality of said special functional units with identical functions are connected to a plurality of said slots.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. A packet communication device according to <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein said load balancer comprises:
<claim-text>a header analysis function judgment block for deciding the type of processing required by said input packets;</claim-text>
<claim-text>a hash table for hash processing using the flow information based on the destination IP address and source IP address of said input packets as a key; and</claim-text>
<claim-text>a destination header generator/attacher for distributing said input packets to specified said special functional units based on results of said judgment and results of said hash processing.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. A packet communication device according to <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein said load balancer comprises:
<claim-text>a header analysis function judgment block for deciding the type of process required by said input packets;</claim-text>
<claim-text>a sequence number generator for generating sequence numbers for the IP packets in each flow and also monitoring said sequence numbers in each flow; and</claim-text>
<claim-text>a destination header generator/attacher for cyclically distributing said input packets to multiple said special functional units according to each function,</claim-text>
<claim-text>said packet communication device further comprising a header extraction/analyzer for reconstructing the packet sequence of said input packets processed by said special functional units.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. A packet communication device according to <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein said load balancer comprises:
<claim-text>a header analysis function judgment block for deciding the type of process required by said input packets;</claim-text>
<claim-text>a load monitor-manager for monitoring the load status of each said special functional units, and selecting the lightest load or said special functional unit with a load lower than a specified value, when notified by said header analysis function judgment block that processing of said input packets is required and said special functional units for performing said processing have been installed; and</claim-text>
<claim-text>a destination header generator/attacher for attaching said device internal headers matching said special functional unit selected by said load monitor-manager to said packet.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. A packet communication device comprising:
<claim-text>a plurality of line interfaces,</claim-text>
<claim-text>a crossbar switch connected with said line interfaces through a first connecting path,</claim-text>
<claim-text>a plurality of special functional processors connected with said line interfaces through a second connecting path, wherein</claim-text>
<claim-text>each of said line interfaces comprise a special function judgment function for deciding whether or not said input packet requires special processing, and</claim-text>
<claim-text>when said special function judgment function decides that a packet does not require special function processing, said packet is forwarded directly to said crossbar switch through said first connecting path; and when said packet is decided to require special function processing, said packet is forwarded to any one of said special functional units through said second connecting path with the corresponding special function and upper layer processing performed, and said packet is then sent back to respective line interfaces where the packets sent from and forwarded to said crossbar switch.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. A packet switch comprising:
<claim-text>a plurality of line interfaces,</claim-text>
<claim-text>a crossbar switch connected with said line interfaces through a first connecting path,</claim-text>
<claim-text>a plurality of special functional processors connected with said line interfaces through a second connecting path, wherein</claim-text>
<claim-text>each of said line interfaces comprise a special function judgment function and a packet waiting buffer for deciding whether or not said input packet requires special processing, and</claim-text>
<claim-text>when said special function judgment function decides that said input packet does not require special function processing, said input packet is forwarded directly to said crossbar switch through said first connecting path; and when said input packet is decided to require special function processing, a packet header of said input packet is forwarded to any one of said special functional units through said second connecting path with the corresponding special function, and packet data of said input packet decided to require special function processing is stored in said packet waiting buffer, and after said packet header whose upper layer processing was completed by said special functional processor is sent back to respective line interfaces where the packets sent from, said header is then combined with said packet data stored in said packet waiting buffer, and forwarded to said crossbar switch.</claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
