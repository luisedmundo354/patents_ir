<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07299024-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07299024</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>10718821</doc-number>
<date>20031121</date>
</document-id>
</application-reference>
<us-application-series-code>10</us-application-series-code>
<us-term-of-grant>
<us-term-extension>274</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>B</subclass>
<main-group>1</main-group>
<subgroup>06</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>455258</main-classification>
<further-classification>4555561</further-classification>
<further-classification>34235712</further-classification>
</classification-national>
<invention-title id="d0e53">Compensation for frequency adjustment in mobile communication-positioning device with shared oscillator</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5542114</doc-number>
<kind>A</kind>
<name>Kojima et al.</name>
<date>19960700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>4551961</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5663735</doc-number>
<kind>A</kind>
<name>Eshenbach</name>
<date>19970900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>5950120</doc-number>
<kind>A</kind>
<name>Gardner et al.</name>
<date>19990900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>5970400</doc-number>
<kind>A</kind>
<name>Dwyer</name>
<date>19991000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>455254</main-classification></classification-national>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>6041222</doc-number>
<kind>A</kind>
<name>Horton et al.</name>
<date>20000300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>6150980</doc-number>
<kind>A</kind>
<name>Krasner</name>
<date>20001100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>6211820</doc-number>
<kind>B1</kind>
<name>Zou et al.</name>
<date>20010400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>6433734</doc-number>
<kind>B1</kind>
<name>Krasner</name>
<date>20020800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>34235709</main-classification></classification-national>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>6738608</doc-number>
<kind>B2</kind>
<name>Black et al.</name>
<date>20040500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>455260</main-classification></classification-national>
</citation>
<citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>6925292</doc-number>
<kind>B2</kind>
<name>Syrjarinne et al.</name>
<date>20050800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>455255</main-classification></classification-national>
</citation>
<citation>
<patcit num="00011">
<document-id>
<country>EP</country>
<doc-number>1 130 415</doc-number>
<kind>A2</kind>
<date>20010900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00012">
<document-id>
<country>WO</country>
<doc-number>WO 99/57929</doc-number>
<date>19991100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00013">
<document-id>
<country>WO</country>
<doc-number>WO 00/21223</doc-number>
<date>20000400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00014">
<document-id>
<country>WO</country>
<doc-number>WO 02/09310</doc-number>
<date>20020100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>12</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>455255-260</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>455208</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>4555561</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>3423571</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>34235712</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>3</number-of-drawing-sheets>
<number-of-figures>4</number-of-figures>
</figures>
<us-related-documents>
<division>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>10126449</doc-number>
<kind>00</kind>
<date>20020419</date>
</document-id>
<parent-grant-document>
<document-id>
<country>US</country>
<doc-number>6724342</doc-number>
<kind>A </kind>
</document-id>
</parent-grant-document>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>10718821</doc-number>
</document-id>
</child-doc>
</relation>
</division>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20040102165</doc-number>
<kind>A1</kind>
<date>20040527</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Bloebaum</last-name>
<first-name>L. Scott</first-name>
<address>
<city>Cary</city>
<state>NC</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Bharti</last-name>
<first-name>Piyush</first-name>
<address>
<city>London</city>
<country>GB</country>
</address>
</addressbook>
<nationality>
<country>GB</country>
</nationality>
<residence>
<country>GB</country>
</residence>
</applicant>
<applicant sequence="003" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Chung</last-name>
<first-name>Sherk</first-name>
<address>
<city>San Bruno</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="004" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Van Roy</last-name>
<first-name>Benjamin</first-name>
<address>
<city>San Mateo</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="005" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Mann</last-name>
<first-name>Wallace</first-name>
<address>
<city>Mill Valley</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<last-name>Hallman</last-name>
<first-name>Jonathan W.</first-name>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
<agent sequence="02" rep-type="attorney">
<addressbook>
<orgname>MacPherson Kwok Chen &amp; Heid LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>SiRF Technology, Inc.</orgname>
<role>02</role>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Urban</last-name>
<first-name>Edward F.</first-name>
<department>2618</department>
</primary-examiner>
<assistant-examiner>
<last-name>Haroon</last-name>
<first-name>Adeel</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">In a mobile communication device, a method for compensating for a frequency adjustment in an oscillator shared between a communication circuit and a positioning signal receiver is provided. In one embodiment, a method for determining the operating frequency of an oscillator detects a beginning time point of a reference signal received by the mobile communication device and enables a counter to count in step with a clock signal derived from the oscillator. When an ending time point of the reference signal is received by the mobile communication device, the count is stopped, and the frequency of the oscillator is determined based on the count in the counter and an expected time that elapsed between the beginning time point and the ending time point.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="139.19mm" wi="202.27mm" file="US07299024-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="202.61mm" wi="140.55mm" orientation="landscape" file="US07299024-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="246.21mm" wi="139.62mm" file="US07299024-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="257.39mm" wi="170.77mm" orientation="landscape" file="US07299024-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<p id="p-0002" num="0001">This application is a divisional of U.S. patent application Ser. No. 10/126,449 filed Apr. 19, 2002, now U.S. Pat. No. 6,724,342.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0003" num="0002">1. Field of the Invention</p>
<p id="p-0004" num="0003">The present invention relates to a mobile communication device with a positioning capability. In particular, the present invention relates to a mobile communication device (e.g., a cellular telephone) that is also capable of receiving a global positioning system (GPS) signal, and which shares an oscillator between the communication and positioning functions.</p>
<p id="p-0005" num="0004">2. Description of the Related Art</p>
<p id="p-0006" num="0005">The utility of a mobile communication device (e.g., a cellular telephone) is enhanced if it is provided the additional capability of receiving and processing global positioning system (GPS) signals that can be used to determine the position of the mobile communication device.</p>
<p id="p-0007" num="0006">To provide for both positioning and communication functions, it is possible to share a local oscillator between the receiver and transmitter of the communication circuit and the GPS signal receiver. While sharing a local oscillator can reduce the cost and bulkiness of such a mobile communication device, there are some practical problems to be overcome to achieve high performance. For example, in cellular communications, when a mobile communication device leaves the service area of a base station and enters into the service area of another base station, a “hand-off” procedure takes place in which the mobile communication device tunes into the operating frequency or channel of the new base station. During the hand-off, it is often necessary to adjust the offset (i.e., deviation from the base station's “nominal center frequency”), as each base station may have a different offset. In degraded signal conditions, continuous tracking of a carrier may also require an offset frequency adjustment. However, if such an adjustment is made during the acquisition of a GPS signal, both the mixing frequency and the sampling frequency of the GPS receiver—used in down-converting and digitizing the GPS signal, respectively—are affected. The received signal may yield an erroneous result, or even a failure to detect the GPS signal. In fact, in one system, a 0.05 parts-per-million (ppm) adjustment has the effect of a 79 Hz shift in the carrier frequency in the received GPS signal.</p>
<p id="p-0008" num="0007">One approach avoids the corruption of the GPS signal by locking the communication circuit out from accessing the oscillator for frequency adjustment so long as a GPS signal acquisition is in process. However, such an approach is undesirable because it prevents the mobile communication device from establishing contact with one or more base stations while a GPS signal is being acquired, which may lead to temporary loss of communication service. Also, such an approach complicates the control software in the mobile communication device, thereby deterring manufacturers from incorporating positioning capability in their mobile communication devices.</p>
<p id="p-0009" num="0008">In GPS signal detection, one source of uncertainty in the carrier modulation frequency in the received signal is the “clock Doppler,” which results from the unknown syntony between the clock on the signal source (e.g., a GPS satellite) and the receiver's own clock. Precise knowledge of the local oscillator's frequency can reduce the frequency search space (“Doppler range”) for the GPS signal. At any given time, the actual frequency of a local oscillator depends on a number of variables, such as manufacturing variations, temperature, aging and operating voltage. Oscillators used in signal sources (e.g., GPS satellites) are typically well-characterized and are tuned to the specified frequency with high accuracy. Because of their cost, high power requirements, and bulkiness, however, such oscillators are unsuited for use in a mobile communication device. To more accurately determine the operating frequency of a local oscillator, the prior art typically requires a more costly oscillator then conventionally found in a mobile communication device. Others require a complex calibration procedure to tune the oscillator to a precision carrier frequency. The latter approach is disclosed, for example, in U.S. Pat. No. 5,874,914 to Krasner, entitled “GPS Receiver utilizing a Communication Link.” Neither approach is satisfactory from a cost and performance standpoint.</p>
<heading id="h-0002" level="1">SUMMARY</heading>
<p id="p-0010" num="0009">According to one embodiment of the present invention, provided in a mobile communication device, is a method for compensating for a frequency adjustment in an oscillator shared between a communication circuit and a positioning signal receiver. In one embodiment, the method includes (a) at a first point in time, beginning receiving and storing into a storage device the positioning signal; (b) at a second time point, adjusting a frequency of the oscillator by a given amount; (c) recording the frequency adjustment; (d) at a third time point, completing receiving and storing of the positioning signal from the positioning signal receiver; and (e) processing the positioning signal, taking into consideration the frequency adjustment. In one implementation, the second time point is recorded as the time at which the frequency adjustment of the oscillator is made. Having the knowledge of the time at which the frequency adjustment is made, the processing searches for a frequency shift in the received positioning signal between the second time and the third time. In another implementation, the amount by which the frequency of the oscillator is adjusted is recorded, and the processing searches for a time point at which the frequency adjustment of the oscillator is made. In one implementation, the processing integrates a correlation function.</p>
<p id="p-0011" num="0010">The present invention is applicable to GPS processing using aiding data, such as satellite ephemeris data. The present invention is particularly applicable to cellular communication in which an oscillator adjustment may be made when the mobile receiver moves between service areas of base stations.</p>
<p id="p-0012" num="0011">Thus, accurate processing of the positioning data is ascertained without preventing the communication circuit from accessing the shared oscillator while positioning data is being acquired.</p>
<p id="p-0013" num="0012">According to another aspect of the present invention, a mobile communication device determines an operating frequency of an oscillator based on a reference signal from a reliable time base. In one embodiment, a beginning time point of the reference signal is received by the mobile communication device. When the beginning time point of the reference signal is detected, a counter is enabled to count a number of cycles in a clock signal derived from the oscillator. The ending time point of the reference signal is then detected. Upon detecting the ending time point of the reference signal, the counter is stopped to prevent the counter from further counting. Finally, the frequency of the oscillator is determined based on the count in the counter and an expected time that elapsed between the beginning time point and the ending time point.</p>
<p id="p-0014" num="0013">The present invention can use reference signals having a known duration in time, or having recurring events in the reference signal that recurs at a fixed frequency. In some implementation, the frequency of the oscillator so derived can be further adjusted, taking into account the processing times in the mobile communication device for detecting the beginning time point and the ending time point.</p>
<p id="p-0015" num="0014">Using the method of the present invention, the operating frequency of a local oscillator can be determined to the accuracy of the oscillator of the base station oscillator, without incurring the expense or inconvenient bulkiness of the more costly, higher precision oscillator typically found in base stations or less mobile equipment. In a GPS signal receiver, by removing the uncertainty in oscillator frequency, the Doppler range over which the positioning signal receiver software searches can be further limited.</p>
<p id="p-0016" num="0015">The present invention is better understood upon consideration of the detailed description below and the accompanying drawings.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 1</figref> shows a block diagram of mobile communication device <b>100</b> to which a method of the present invention is applicable.</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 2</figref> shows a flow chart of method <b>200</b> that compensates for the frequency adjustment in shared local oscillator <b>108</b>, in accordance with one embodiment of the present invention.</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 3</figref> shows a block diagram of mobile communication device <b>100</b> to which a method of the present invention is also applicable.</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 4</figref> illustrates method <b>400</b> for measuring the operating frequency of shared local oscillator <b>103</b>, in accordance with one embodiment of the present invention.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<p id="p-0021" num="0020">To facilitate comparison between figures and to simplify the detailed description below, like reference numerals are used for like elements in the figures.</p>
<heading id="h-0004" level="1">DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS</heading>
<p id="p-0022" num="0021">The present invention provides a method that compensates the frequency adjustment effects in the positioning signal detection process. According to another aspect of the present invention, a method for accurately determining the frequency of a local oscillator is provided.</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 1</figref> shows a block diagram of mobile communication device <b>100</b> to which a method of the present invention is applicable. Mobile communication device <b>100</b> can be, for example, a cellular telephone handset. As shown in <figref idref="DRAWINGS">FIG. 1</figref>, mobile communication device <b>100</b> includes communication receiver <b>101</b>, communication transmitter <b>102</b>, positioning signal receiver <b>103</b>, analog baseband circuit <b>106</b>, digital baseband circuit <b>107</b>, shared local oscillator <b>108</b> and synthesizer <b>109</b>. In mobile communication device <b>100</b>, shared local oscillator <b>108</b> is the frequency source for communication receiver <b>101</b>, communication transmitter <b>102</b>, and positioning signal receiver <b>103</b>. Shared local oscillator <b>108</b> can be implemented, for example, by a voltage-controlled oscillator. Antenna <b>104</b> serves both communication receiver <b>101</b> and communication receiver <b>102</b>, and antenna <b>105</b> serves positioning signal receiver <b>103</b>.</p>
<p id="p-0024" num="0023">A communication signal coupled by antenna <b>104</b> into communication receiver <b>101</b> is band-pass filtered, amplified and then down-converted by mixing with a signal from synthesizer <b>109</b> to a baseband signal; (The signal from synthesizer <b>109</b> has the expected carrier modulation frequency.) The baseband signal so obtained is low-pass filtered and sampled for digital processing in digital baseband circuit <b>107</b>. A communication signal to be transmitted is provided as a digital signal from digital baseband circuit <b>107</b>. The digital signal is converted into analog form, filtered and modulated by mixing with a carrier frequency provided by synthesizer <b>109</b>. The modulated signal is amplified and transmitted through antenna <b>104</b>. The positioning signal received at positioning signal receiver <b>103</b> is processed in substantially the same manner as described for the communication signal, except that the expected modulation carrier frequency, rather than generated by a synthesizer (e.g., synthesizer <b>109</b>), is provided by a PLL, which multiplies the frequency of shared local oscillator <b>108</b> by a factor of 100 or more.</p>
<p id="p-0025" num="0024">Analog baseband circuit <b>106</b>'s functions include enabling communication transmitter <b>102</b> to transmit a communication signal, providing a frequency adjustment to shared local oscillator <b>108</b>, and changing the frequency in synthesizer <b>109</b>. As mobile communication device <b>100</b> switches between base stations, analog baseband circuit <b>106</b> directs synthesizer <b>109</b> to switch between the channels of the base stations. As explained above, switching between base stations or tracking a carrier signal during degraded signal conditions may necessitate a frequency adjustment to shared local oscillator <b>108</b>. In addition, as shown in <figref idref="DRAWINGS">FIG. 1</figref>, analog baseband circuit <b>106</b> may include a codec and interfaces to a microphone and a speaker for processing voice communication. The codec quantizes a voice signal from the microphone into digital samples to be processed by digital baseband circuit <b>107</b> and reconstructs an analog audio or voice signal from digital samples provided by digital baseband circuit <b>107</b>. The analog audio signal is replayed at the speaker.</p>
<p id="p-0026" num="0025">Digital baseband circuit <b>107</b> includes receiver interface (RXIF) <b>111</b> and transmitter interface (TXIF) <b>112</b> to communication receiver <b>101</b> and communication transmitter <b>102</b>, respectively. The output signal of shared local oscillator <b>108</b> provides a reference signal for clock generation circuit <b>113</b> to provide the internal clock signals distributed within digital baseband circuit <b>107</b> and analog baseband circuit <b>106</b> (e.g., to drive sampling of a voice codec). The internal clock signals generate from timing generation circuit <b>114</b> timing strobes used both internally in digital baseband circuit <b>107</b> and analog baseband circuit <b>106</b>. Various serial communication and input/output (I/O) ports <b>115</b> are provided in digital baseband circuit <b>107</b> for communication with peripheral devices, positioning signal receiver <b>103</b> and analog baseband circuit <b>106</b>.</p>
<p id="p-0027" num="0026">Digital baseband circuit <b>107</b>, which can be implemented as an application specific integrated circuit (ASIC), includes central processing unit (CPU) subsystem <b>131</b>, which performs and controls the communication functions of mobile communication device <b>100</b>. Such communication functions include executing the communication protocol stack, peripheral hardware control, man-machine interface (e.g., keypad and graphical user interfaces), and any application software. As shown in <figref idref="DRAWINGS">FIG. 1</figref>, in this embodiment, external memory modules <b>127</b>, <b>128</b> and <b>129</b> are coupled to digital baseband circuit <b>107</b> through external memory interface (EMIF) <b>126</b>. External memory modules <b>127</b>, <b>128</b> and <b>129</b> are used in this embodiment to provide data memory, program memory and positioning data memory for CPU subsystem <b>131</b>. (Positioning data memory stores samples of a positioning signal and data used in positioning signal detection.) In other embodiments, data memory, program memory and positioning data memory can be provided by built-in memory modules in digital baseband circuit <b>107</b>. Alternatively, positioning data memory <b>129</b> and data memory <b>128</b> can reside in the same physical memory module. As shown in <figref idref="DRAWINGS">FIG. 1</figref>, CPU subsystem <b>131</b> communicates with RXIF <b>111</b>, TXIF <b>112</b>, clock generation circuit <b>113</b>, timing generation circuit <b>114</b> and communication and I/O ports <b>115</b> over a direct memory access (DMA) and traffic control circuit <b>116</b>.</p>
<p id="p-0028" num="0027">As shown in <figref idref="DRAWINGS">FIG. 1</figref>, CPU subsystem <b>131</b> includes CPU <b>130</b>, random access memory (RAM) <b>123</b>, read-only memory (ROM) <b>124</b> and cache memory <b>131</b>. CPU <b>130</b> communicates with RAM <b>123</b>, ROM <b>124</b> and cache memory <b>131</b> over a processor bus. Bridge <b>122</b> allows data to flow between the processor bus and DMA and traffic control circuit <b>116</b>. As known to those skilled in the art, software executed by CPU <b>130</b> can be stored in a non-volatile fashion in ROM <b>124</b> and also in external program memory <b>128</b>. RAM <b>123</b> and cache memory <b>131</b> provide the memory needs of CPU <b>130</b> during its operation.</p>
<p id="p-0029" num="0028">In the embodiment shown in <figref idref="DRAWINGS">FIG. 1</figref>, digital signal processor (DSP) subsystem <b>132</b> is provided in digital baseband circuit <b>107</b>. DSP subsystem <b>132</b> can be used to execute computationally intensive tasks, such as encoding and decoding voice samples, and executing the tasks of the physical layer in communication with a station. DSP subsystem <b>130</b> can be implemented, for example, substantially the same organization as CPU subsystem <b>131</b>, and provided similar access to external memory modules <b>127</b>, <b>128</b> and <b>129</b> through EMIF <b>126</b>.</p>
<p id="p-0030" num="0029">The positioning signal receiver software, which detects GPS signals from multiple GPS satellites to determine the location of mobile communication device <b>100</b>, may be run on either CPU subsystem <b>131</b> or DSP subsystem <b>132</b>. In this embodiment, the digitized samples of the received GPS signal are stored in memory. The stored GPS signal samples are then later retrieved and processed to search for the GPS satellite, the code phase and frequency shift (“Doppler”) that would provide the received signal. In one embodiment, positioning receiver software searches for a peak in the modulus of a complex correlation integral under hypothesized code phase, Doppler and integration time values. One example of such positioning receiver software is disclosed in co-pending and commonly assigned patent application (“Copending Application”), U.S. application Ser. No. 10/126,853, entitled “Method for Optimal Search Scheduling in Satellite Acquisition” by J. Stone et al., filed on or about the same day as the present application, now U.S. Pat. No. 6,835,241. The disclosure of the Copending Application is hereby incorporated by reference in its entirety.</p>
<p id="p-0031" num="0030">If the mobile communication device, in response to communication with a base station, adjusts the frequency of shared local oscillator <b>108</b> while the GPS signal is being captured, a discontinuity appears as a step shift in carrier frequency in the digitized GPS signal. The present invention compensates for this carrier frequency shift in the complex correlation integral.</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. 2</figref> shows a flow chart of a method that compensates for the frequency adjustment in shared local oscillator <b>108</b>, in accordance with the present invention. As shown in <figref idref="DRAWINGS">FIG. 2</figref>, at step <b>201</b>, the data processing portion of the positioning signal receiver software (PRXPF) receives a request for the user's position (e.g., the user selecting a “get position” command from a menu), or from an external source (e.g., a protocol request in a message relayed from the base station). At step <b>202</b>, PRXPF retrieves aiding data (e.g., GPS ephemeris, approximate location, and time) from local storage or memory, or from an external source (e.g., by protocol messages to a server sent over a radio communication link to a base station). At step <b>203</b>, the control portion of the positioning signal receiver software (PRXCF) initializes positioning signal receiver <b>103</b> to begin storing samples between time to t<sub>0 </sub>time t<sub>2</sub>. Time may be measured, for example, in mobile communication device <b>100</b>'s local time base or relative to a timing event in the communication link between mobile communication device <b>100</b> and a base station (e.g., a frame boundary in the radio communication interface to a base station). At time to, the contribution to the residual carrier frequency due to shared local oscillator <b>108</b> should ideally be zero.</p>
<p id="p-0033" num="0032">Suppose at time t<sub>1 </sub>(t<sub>0</sub>&lt;t<sub>1</sub>&lt;t<sub>2</sub>), mobile communication device <b>100</b> adjusts the frequency of shared local oscillator <b>108</b> by an amount such that the residual carrier frequency in the positioning signal samples changes by Δf<sub>1</sub>. Thus, at step <b>204</b>, a record is made in mobile communication device <b>100</b>, noting the time of the frequency adjustment and the amount of the frequency adjustment. At time t<sub>2 </sub>(step <b>205</b>), PRXCF turns off positioning signal receiver <b>103</b>. At step <b>206</b>, using the knowledge of the time and amount of the frequency adjustment, PRXPF performs the complex correlation integration using different hypotheses of a frequency offset due to shared local oscillator <b>108</b>, according to whether the integration time limits are with the [t<sub>0</sub>, t<sub>1</sub>] interval or [t<sub>2</sub>, t<sub>3</sub>] interval. That is:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>f</i><sub>vco</sub>(<i>t</i>)=0, for <i>t</i><sub>0</sub><i>&lt;t&lt;t</i><sub>1 </sub><?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>f</i><sub>vco</sub>(<i>t</i>)=Δ<i>f</i><sub>1</sub>, for <i>t</i><sub>0</sub><i>&lt;t&lt;t</i><sub>1 </sub><?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0034" num="0033">At step <b>207</b>, using the compensated integration of step <b>206</b>, PRXPF executes the remainder of PRXPF to obtain the pseudo-range and, consequently, the position of mobile communication device <b>100</b>.</p>
<p id="p-0035" num="0034">For any reason, if either the frequency adjustment time t<sub>1 </sub>or the amount of frequency adjustment cannot be ascertained, the frequency adjustment time t<sub>1 </sub>or the amount of frequency shift due to shared local oscillator <b>108</b> (i.e., Δf<sub>1</sub>) are considered additional search parameters. For example, if the frequency adjustment time t<sub>1 </sub>is known, but the frequency adjustment amount is not known, multiple hypothetical values for Δf<sub>1 </sub>can be used to search for Δf<sub>1</sub>. Alternatively, if the frequency adjustment time t<sub>1 </sub>is not known, but the frequency shift due to shared local oscillator <b>108</b> is known, multiple hypothetical values for t<sub>1 </sub>can be used to search for time t<sub>1</sub>. Of course, if neither the frequency adjustment time t<sub>1 </sub>nor the frequency shift due to shared local oscillator <b>108</b> is known, both the time and frequency parameter spaces have to be searched. In any case, the frequency adjustment software in the mobile communication device notifies the PRXPF that such an adjustment has occurred, and provides as much information related to the adjustment as is available.</p>
<p id="p-0036" num="0035"><figref idref="DRAWINGS">FIG. 3</figref> shows a block diagram of mobile communication device <b>300</b>, to which is a method of the present invention is also applicable. Unlike mobile communication device <b>100</b> of <figref idref="DRAWINGS">FIG. 1</figref>, mobile communication device <b>300</b> uses a CPU or DSP <b>151</b> which resides outside of digital baseband circuit <b>107</b>. Other than where the positioning signal receiver software and data reside and execute, the operation of mobile communication device <b>300</b> and mobile communication device <b>100</b> with respect to location determination and compensation for frequency adjustment in shared local oscillator <b>108</b> are substantially identical.</p>
<p id="p-0037" num="0036">According to another aspect of the present invention, the frequency of a local oscillator (e.g., shared local oscillator <b>108</b> or the higher frequency output signal of a phase-locked loop) can be determined using the oscillator of a base station. The present invention uses a timing signal of known duration, or having events of known recurring frequency, as a reference or “stop watch” signal to measure the actual local oscillator frequency. For example, in a CDMA network, a “short code” of 26 ⅔ millisecond duration is broadcast on a pilot channel. The frequency of the short code rollover at 37.5 Hz can be used for synchronization. Alternatively, a “long code” broadcast on a CDMA network can also be used to synchronize a 10 MHz source. Each code has a starting point and an ending point indicated by a predetermined pattern. Similarly, in. a GSM network, the Broadcast Control Channel (BCCH) transmitted by the base station includes a Synchronization Channel (SCH) having counts indicating the positions of the current frame within a multi-frame, super-frame and hyper-frame structures. The multi-frame, super-frame and hyper-fraxne structures have respective durations of 0.235 seconds, 6.12 seconds and approximately 3 hours and 29 minutes. Thus, in a GSM network, the starting points of successive multi-frames can be used as fixed time intervals. Other intervals inherent in the GSM air-interface frame structure can also be used as fixed time intervals. In addition, a counter is provided in the hardware that is clocked by a clock signal generated from shared local oscillator <b>108</b>. In one embodiment, a nominally 200 MHz signal from a PLL in positioning signal receiver <b>103</b> is used to clock the counter.</p>
<p id="p-0038" num="0037"><figref idref="DRAWINGS">FIG. 4</figref> illustrates method <b>400</b> for measuring the operating frequency of shared local oscillator <b>108</b>, in accordance with the present invention. As shown in <figref idref="DRAWINGS">FIG. 4</figref>, step <b>401</b> detects a starting point in the selected reference signal from the base station. At step <b>402</b>, when the starting point in the reference signal is detected, the counter is reset to enable count, incrementing one for each cycle of its input clock signal. In one embodiment, detecting the starting point and starting the counter can be accomplished by software running in CPU subsystem <b>131</b>. In other embodiments, these functions can be carried out in hardware. At step <b>403</b>, when the ending point of the reference signal is detected, the counting is disabled. At that time, the count in the counter represents the number of clock cycles elapsed between the staffing and ending point of the referenced signal (i.e., the fixed time interval). The frequency of shared local oscillator <b>108</b> is thus simply the count in the counter divided by this fixed time interval. An adjustment to the count may be desirable to account for the latencies in signal detection and the counter operations for higher accuracy.</p>
<p id="p-0039" num="0038">In one embodiment, shared local oscillator <b>108</b> can operate between 10-25 MHz. A PLL in positioning signal receiver <b>103</b> multiplies the oscillator frequency to 200 MHz. Theoretically, the uncertainty in this 200 MHz signal under method <b>400</b> in that embodiment is estimated to be 10 Hz. However, nondeterministic latencies (e.g., due to the tasks in CPU subsystem <b>130</b>) brings the uncertainty up to about 100 Hz.</p>
<p id="p-0040" num="0039">Using the method of the present invention, the operating frequency of shared local oscillator <b>108</b> can be determined to the accuracy of the oscillator of the base station oscillator, without incurring the expense or inconvenient bulkiness of the more costly higher precision oscillator typically found in base stations. By removing the uncertainty in oscillator frequency, the Doppler range over which the positioning signal receiver software searches can be further limited.</p>
<p id="p-0041" num="0040">The above detailed description is provided to illustrate specific embodiments of the present invention and is not intended to be limiting. Numerous variations and modifications within the scope of the present invention are possible. For example, the detailed description above describes a system in which the positioning signal receiver stores the sampled received signal and later retrieves the stored data for processing. Another embodiment which processes the sampled data as they are sampled is within the scope of the present invention. The present invention is set forth in the following claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>We claim:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. In a communication device, a method for determining an operating frequency of an oscillator based on a reference signal from a reliable time base, comprising:
<claim-text>detecting a beginning time point of the reference signal received by the communication device;</claim-text>
<claim-text>upon detection of the beginning time point of the reference signal, enabling a counter to count in accordance with a clock signal derived from the oscillator;</claim-text>
<claim-text>detecting an ending time point of the reference signal received by the communication device;</claim-text>
<claim-text>upon detecting the ending time point of the reference signal, disabling the counter to stop the counter from further counting; and</claim-text>
<claim-text>determining the frequency of the oscillator based on the count in the counter and an expected time that elapsed between the beginning time point and the ending time point.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. A method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the beginning time point and the ending time point represent a known duration in time.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. A method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the beginning time point and the ending time point represent arrivals of recurring events in the reference signal, the recurring events recurs at a fixed frequency.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. A method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising adjusting for processing times in the communication device for detecting the beginning time point and the ending time point.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. A method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the frequency of the oscillator thus determined is provided to a positioning signal receiver.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. A method as in <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein the positioning signal receiver receives global positioning system (GPS) signals.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. An oscillator frequency determining apparatus in a communication device, comprising:
<claim-text>an oscillator providing a periodic output signal;</claim-text>
<claim-text>a receiver receiving a reference signal from a reliable time base;</claim-text>
<claim-text>a detector detecting a beginning time point and an ending time point of the reference signal received by the communication device;</claim-text>
<claim-text>a counter that begins counting the number of periods in the output signal of the oscillator in response to the detector detecting the beginning time point and stops counting in response to the detector detecting the ending time point of the reference signal; and</claim-text>
<claim-text>an arithmetic unit for determining the frequency of the oscillator based on the count in the counter and an expected time that elapsed between the beginning time point and the ending time point.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. An apparatus as in <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the beginning time point and the ending time point represent a known duration in time.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. An apparatus as in <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the beginning time point and the ending time point represent arrivals of recurring events in the reference signal, the recurring events recurs at a fixed frequency.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. An apparatus as in <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the arithmetic unit further adjusts for processing times in the communication device for detecting the beginning time point and the ending time point.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. An apparatus as in <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the frequency of the oscillator thus determined is provided to a positioning signal receiver.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. An apparatus as in <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein the positioning signal receiver receives global positioning system (GPS) signals.</claim-text>
</claim>
</claims>
</us-patent-grant>
