<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07298736-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07298736</doc-number>
<kind>B1</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>10262748</doc-number>
<date>20021002</date>
</document-id>
</application-reference>
<us-application-series-code>10</us-application-series-code>
<us-term-of-grant>
<us-term-extension>1058</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>L</subclass>
<main-group>12</main-group>
<subgroup>56</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>370356</main-classification>
<further-classification>370252</further-classification>
</classification-national>
<invention-title id="d0e53">Method of providing voice over IP at predefined QoS levels</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>6553515</doc-number>
<kind>B1</kind>
<name>Gross et al.</name>
<date>20030400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>714 47</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>6735192</doc-number>
<kind>B1</kind>
<name>Fried et al.</name>
<date>20040500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370352</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6788651</doc-number>
<kind>B1</kind>
<name>Brent et al.</name>
<date>20040900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370255</main-classification></classification-national>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>7079486</doc-number>
<kind>B2</kind>
<name>Colavito et al.</name>
<date>20060700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370231</main-classification></classification-national>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>7245608</doc-number>
<kind>B2</kind>
<name>Tseng et al.</name>
<date>20070700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370352</main-classification></classification-national>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>2002/0186681</doc-number>
<kind>A1</kind>
<name>Martin</name>
<date>20021200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370350</main-classification></classification-national>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2004/0057383</doc-number>
<kind>A1</kind>
<name>Tseng et al.</name>
<date>20040300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370252</main-classification></classification-national>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2004/0066751</doc-number>
<kind>A1</kind>
<name>Tseng et al.</name>
<date>20040400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370252</main-classification></classification-national>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2006/0039280</doc-number>
<kind>A1</kind>
<name>Anandakumar et al.</name>
<date>20060200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370229</main-classification></classification-national>
</citation>
</references-cited>
<number-of-claims>11</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>370356</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370252</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370516</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370235</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>4</number-of-drawing-sheets>
<number-of-figures>7</number-of-figures>
</figures>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Matthews</last-name>
<first-name>Adrian S</first-name>
<address>
<city>Bridgewater</city>
<state>NJ</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
</applicants>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>AT&amp;T Corp.</orgname>
<role>02</role>
<address>
<city>New York</city>
<state>NY</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Jung</last-name>
<first-name>Min</first-name>
<department>2663</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">The present invention is a technique for provisioning and assessment of voice quality in Internet Protocol (IP) voice applications. A predetermined quality of service (QoS) is received from a user in the form of an acceptable packet loss. The technique measures current packet loss and delay in the network and in the terminal, and determines an optimum play-out delay for use by a play-out adaptation routine. An actual QoS is reported back to the user. To enhance packet delay and loss measurement, a QoS engine component is placed on the terminal side of the packetizer, therefore including packetizer losses in any measurement of the network.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="176.70mm" wi="169.93mm" file="US07298736-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="139.62mm" wi="163.32mm" file="US07298736-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="196.00mm" wi="170.35mm" file="US07298736-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="234.02mm" wi="161.54mm" file="US07298736-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="248.92mm" wi="152.32mm" file="US07298736-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">FIELD OF THE INVENTION</heading>
<p id="p-0002" num="0001">The present invention relates generally to providing telephony and other communications services over a packetized network such as the Internet, and more specifically to a non-invasive, real-time technique for assessing and providing voice quality in Internet Protocol (IP) voice applications.</p>
<heading id="h-0002" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0003" num="0002">As the use of the Internet increases, there is a concomitant increase in the use of voice-over-IP (VoIP); i.e., the use of the Internet to transmit real-time voice conversations. This is attributed to the convergence of computing and telecommunications under a single umbrella. Given availability of the requisite bandwidth, advanced users opt for the immediacy of packet voice while engaged in an IP data application, as opposed to deriving voice associated with the application either from another medium, or at a later time.</p>
<p id="p-0004" num="0003">The public Internet is a multi-node matrix of routers and switches joined by transport lines of differing capacities. As such, IP packets may experience processing delays at various nodes as they traverse the Internet matrix from one end-point to the next. Path differences can also lead to variations in arrival times of the IP voice packets, and this phenomenon, exaggerated by network congestions or other conditions, can have an adverse impact on the reconstruction of a voice conversation in real time. Link outages and traffic overload at specific nodes can also lead to packet losses, with a greater potential for negative impacts on the service. Anomalies in the behavior of the integrated network have therefore had limiting effects on the quality of IP voice applications.</p>
<p id="p-0005" num="0004">To address those problems, standards bodies have improved protocol specifications, allowing greater predictability of the quality of service that a given application might support. However, beyond these protocol specifications, it is necessary to develop tools that are effective in defining and gauging service quality. For example, it would be desirable to provide a basis for raising customer acceptance levels, thus leading to the levels of confidence that are required for mass deployment.</p>
<p id="p-0006" num="0005">VoIP is a real-time conversational application, and in any one direction, the associated IP packet flow may be described as a real-time isochronous media stream. To maintain quality and media coherency in isochronous applications, strict time dependencies between the application bits must be observed within the destination end-system. The objective metrics that are generally used to describe the packet transport characteristics between two end-points within the Internet are delay, delay variation (also referred to as jitter), and packet loss. Delay refers to the time required to transmit an IP packet between two end-points within the Internet. Causes of delay include processing operations at routers within the network, increases in traffic load on the network side, and coding and packetization processing on the terminal side. Jitter refers to variations in the packet inter-arrival times from one end-system application to the next. Jitter is caused by fluctuations in network load, and differences in path routing of individual packets. Packet loss may refer either to arrivals that are so late as to render the packets unusable, or to the actual loss of packets. Packet loss is caused by network congestion, such as overloading at routers.</p>
<p id="p-0007" num="0006">It is important to be able to control those end-to-end transport metrics to achieve quality VoIP. The capability to assess the state of those metrics also directly leads to the capability to set and predict the quality of service (QoS) that is supportable between two end-points within the Internet.</p>
<p id="p-0008" num="0007">Much complexity is involved in quantifying the relationship between the raw end-to-end packet transport metrics and the perceived voice quality for a sample instantiation of IP voice. One viable approach to applying those transport metrics in determining VoIP QoS is a translation to Mean Opinion Scores (MOS) through the use of the E-Model. The E-Model is described in detail in ITU-T Recommendation G.107, “The E-Model, a Computational Model for Use in Transmission Planning” (December 1998), the contents of which is incorporated by reference herein in its entirety. MOS modeling has been in use for several years, and provides a psychological measure of voice quality. MOS scores are derived from the arithmetic average of a group of subjective responses. The technique is widely adopted for voice quality assessment. The E-Model is an analytic model of voice quality for use in network planning purposes. The E-Model provides a method for estimating the relative voice quality when comparing two reference connections. A highlight of the E-Model is the computation of the R-factor, which is used as a measure of voice quality. Once the R-factor is computed, the E-Model allows for straightforward mapping back to MOS scores. The R-factor itself is computed by methods using the network transport metrics as discussed in Cole, R. G. and Rosenbluth, J. H., “Voice over IP Performance Monitoring,” Computer Communication Review, V. 31, No. 2 at 9-14 (April 2001), the contents of which is incorporated by reference herein in its entirety.</p>
<p id="p-0009" num="0008">The most common prior approach to prediction of QOS in the Internet involved the use of injecting echo probes into the network, and using the responses (or lack thereof) to those probes to measure the loss and round trip time (RTT). The RTT may then be used as a basis for estimating delay and jitter. The one-way delay is taken as one-half the measured RTT. That technique does not support in-service VoIP assessment and provisioning. Furthermore, the technique of injecting echo probes derives its metric information through the interface to routers in the network, and is therefore not amenable to implementation within the end-system or to integration with a VoIP application.</p>
<p id="p-0010" num="0009">It is therefore desirable to provide a method and system for evaluating a quality of service (QoS) level for a communications service through measurement of the network transport metrics available at the end-system, and for modifying parameters to achieve a QoS level based on customer requirements.</p>
<heading id="h-0003" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0011" num="0010">The present invention addresses those needs by providing a method for evaluating a quality of service (QoS) level for a communications service provided over a packetized network, and modifying parameters of that service to achieve the QoS level.</p>
<p id="p-0012" num="0011">One embodiment of the invention is a method for controlling a communications terminal communicating over a packetized network. A module performing the method receives a quality of service requirement for the service, and at least one transport metric describing characteristics of the network. Based on those parameters, the module determines control information for use by a play-out adaptation routine. The control information is then transmitted to the play-out adaptation routine.</p>
<p id="p-0013" num="0012">In that method, the step of receiving a quality of service requirement for the service may comprise receiving an attribute of acceptable packet loss. The step of receiving at least one transport metric describing characteristics of the network may comprise receiving at least one of the attributes of a group consisting of packet delay, jitter and packet loss.</p>
<p id="p-0014" num="0013">The method may also include the step of receiving an error concealment algorithm. The algorithm may be based on a speech coder used in the communications terminal.</p>
<p id="p-0015" num="0014">The step of determining control information may include estimating a packet loss distribution of the network. To estimate packet loss distribution of the network, the module may measure actual packet loss. The estimation of packet loss distribution may also include adapting parameters of a Pareto distribution.</p>
<p id="p-0016" num="0015">The step of determining control information may include determining a play-out delay for use by the play-out adaptation routine. The play-out delay d may be defined:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>d=F</i><sup>−1</sup>(<i>T</i>)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0017" num="0016">wherein the function F<sup>−1</sup>( ) is an inverse of a function defining a Pareto distribution characterizing packet delays in the network, and T is a target rate of packet accumulation required by the play-out adaptation routine to achieve the quality of service requirement. The function defining a Pareto distribution characterizing packet delays in the network may be:</p>
<p id="p-0018" num="0017">
<maths id="MATH-US-00001" num="00001">
<math overflow="scroll">
<mrow>
  <mrow>
    <mrow>
      <mi>F</mi>
      <mo>⁡</mo>
      <mrow>
        <mo>(</mo>
        <mi>x</mi>
        <mo>)</mo>
      </mrow>
    </mrow>
    <mo>=</mo>
    <mrow>
      <mn>1</mn>
      <mo>-</mo>
      <msup>
        <mrow>
          <mo>(</mo>
          <mfrac>
            <mi>k</mi>
            <mi>x</mi>
          </mfrac>
          <mo>)</mo>
        </mrow>
        <mi>α</mi>
      </msup>
    </mrow>
  </mrow>
  <mo>,</mo>
  <mrow>
    <mi>x</mi>
    <mo>≥</mo>
    <mi>k</mi>
  </mrow>
</mrow>
</math>
</maths>
</p>
<p id="p-0019" num="0018">wherein estimates are used for the values of k and α:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>{circumflex over (<i>k</i>)}=min(<i>x</i><sub>1</sub><i>,x</i><sub>2</sub><i>,x</i><sub>3</sub><i>, . . . x</i><sub>n</sub>) and<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0020" num="0019">
<maths id="MATH-US-00002" num="00002">
<math overflow="scroll">
<mrow>
  <mover>
    <mi>α</mi>
    <mo>⋒</mo>
  </mover>
  <mo>=</mo>
  <msup>
    <mrow>
      <mi>n</mi>
      <mo>⁡</mo>
      <mrow>
        <mo>[</mo>
        <mrow>
          <munderover>
            <mo>∑</mo>
            <mrow>
              <mi>i</mi>
              <mo>=</mo>
              <mn>1</mn>
            </mrow>
            <mi>n</mi>
          </munderover>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.3em" height="0.3ex"/>
          </mstyle>
          <mo>⁢</mo>
          <mrow>
            <mi>log</mi>
            <mo>⁡</mo>
            <mrow>
              <mo>(</mo>
              <mfrac>
                <msub>
                  <mi>x</mi>
                  <mi>i</mi>
                </msub>
                <mover>
                  <mi>k</mi>
                  <mo>⋒</mo>
                </mover>
              </mfrac>
              <mo>)</mo>
            </mrow>
          </mrow>
        </mrow>
        <mo>]</mo>
      </mrow>
    </mrow>
    <mrow>
      <mo>-</mo>
      <mn>1</mn>
    </mrow>
  </msup>
</mrow>
</math>
</maths>
</p>
<p id="p-0021" num="0020">where n is a total number of actual packet delay measurements and (x<sub>1</sub>, x<sub>2</sub>, x<sub>3</sub>, . . . x<sub>n</sub>) are actual packet delay measurements.</p>
<p id="p-0022" num="0021">Further, the target rate T of packet accumulation required by the play-out adaptation routine to achieve the quality of service requirement may be defined as:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>T=</i>1−<i>e</i><sub>playout </sub><?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0023" num="0022">wherein</p>
<p id="p-0024" num="0023">
<maths id="MATH-US-00003" num="00003">
<math overflow="scroll">
<mrow>
  <mrow>
    <msub>
      <mi>e</mi>
      <mi>playout</mi>
    </msub>
    <mo>=</mo>
    <mfrac>
      <mrow>
        <msub>
          <mi>e</mi>
          <mi>mos</mi>
        </msub>
        <mo>-</mo>
        <msub>
          <mi>e</mi>
          <mi>network</mi>
        </msub>
      </mrow>
      <mrow>
        <mn>1</mn>
        <mo>-</mo>
        <msub>
          <mi>e</mi>
          <mi>network</mi>
        </msub>
      </mrow>
    </mfrac>
  </mrow>
  <mo>;</mo>
</mrow>
</math>
</maths>
</p>
<p id="p-0025" num="0024">e<sub>mos </sub>being a packet loss probability associated with the quality of service requirement, and e<sub>network </sub>being a packet loss probability of the network.</p>
<p id="p-0026" num="0025">Another aspect of the invention is an audio terminal for use in communication over a packetized network. The terminal includes a packetizer for extracting incoming audio data from packets received from the network, a play-out adapter for modulating a flow of audio data from the packetizer, and a quality of service engine between the play-out adapter and the packetizer. The quality of service engine is configured to control the modulation of audio data by the play-out adapter based on transport metrics of both the packetizer and the network.</p>
<p id="p-0027" num="0026">The transport metrics may include at least one metric from the group consisting of average packet delay, packet delay variation and packet loss.</p>
<p id="p-0028" num="0027">The audio terminal may further comprise a quality of service analysis routine configured to receive the transport metrics from the quality of service engine, and to transmit play-out control information to the quality of service engine. The quality of service analysis routine may further be configured to receive a quality of service requirement from a network API, and to transmit to a network API an achievable quality of service level. The play-out control information may include a play-out delay.</p>
<p id="p-0029" num="0028">The quality of service engine may control the modulation of audio data by the play-out adapter based on a packet loss probability e<sub>playout </sub>of the play-out routine determined by</p>
<p id="p-0030" num="0029">
<maths id="MATH-US-00004" num="00004">
<math overflow="scroll">
<mrow>
  <msub>
    <mi>e</mi>
    <mi>playout</mi>
  </msub>
  <mo>=</mo>
  <mfrac>
    <mrow>
      <msub>
        <mi>e</mi>
        <mi>mos</mi>
      </msub>
      <mo>-</mo>
      <msub>
        <mi>e</mi>
        <mi>network</mi>
      </msub>
    </mrow>
    <mrow>
      <mn>1</mn>
      <mo>-</mo>
      <msub>
        <mi>e</mi>
        <mi>network</mi>
      </msub>
    </mrow>
  </mfrac>
</mrow>
</math>
</maths>
</p>
<p id="p-0031" num="0030">wherein e<sub>mos </sub>is a required maximum packet loss probability and e<sub>network </sub>is the packet loss probability based on transport metrics of both the packetizer and the network.</p>
<p id="p-0032" num="0031">The audio terminal may also include an audio controller for encoding and decoding audio data exchanged with the play-out adapter; and a DTX engine for preparing audio data exchanged with the audio control for discontinuous transmission. The DTX engine interfaces with the quality of service engine to coordinate the modulation of audio data.</p>
<p id="p-0033" num="0032">These and other advantages of the invention will be apparent to those of ordinary skill in the art by reference to the following detailed description and the accompanying drawings.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0034" num="0033"><figref idref="DRAWINGS">FIG. 1</figref> is a schematic view of an integrated network showing quality of service requirements distribution.</p>
<p id="p-0035" num="0034"><figref idref="DRAWINGS">FIG. 2</figref> is a schematic view of a communications terminal according to one embodiment of the invention.</p>
<p id="p-0036" num="0035"><figref idref="DRAWINGS">FIG. 3</figref> shows a generalized protocol architecture for IP-based communications.</p>
<p id="p-0037" num="0036"><figref idref="DRAWINGS">FIG. 4</figref> is a partial schematic view of parameter flow in a communications terminal according to the invention.</p>
<p id="p-0038" num="0037"><figref idref="DRAWINGS">FIG. 5</figref> is a block diagram depicting one method according to the invention.</p>
<p id="p-0039" num="0038"><figref idref="DRAWINGS">FIG. 6</figref> is a table showing an exemplary mapping of R-factors to MOS values.</p>
<p id="p-0040" num="0039"><figref idref="DRAWINGS">FIG. 7</figref> is a table showing exemplary estimated encoding delays for various CODECs.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0041" num="0040">Referring to <figref idref="DRAWINGS">FIG. 1</figref>, a construct is shown in which quality-of-service requirements are distributed across the various segments of an integrated network <b>100</b>. A VoIP application <b>110</b> may require a specific end-to-end service quality <b>120</b> that might be resolved into three components <b>121</b>, <b>122</b>, <b>125</b> that may be individually applied to the network <b>135</b> and two end-systems <b>131</b>, <b>132</b>. Without the capability to control and assess the transport performance of the integrated network <b>100</b>, there are likely to be differences in the quality-of-service requested by the application, and that which is provided by the integrated network. In the method and apparatus of the invention, the routines for QoS definition and assessment are integrated within the end systems <b>131</b>, <b>132</b>, and provide greater fidelity relative to the underlying end-to-end QoS <b>120</b> that is available to the VoIP application.</p>
<p id="p-0042" num="0041"><figref idref="DRAWINGS">FIG. 2</figref> is a diagram showing a generalized IP voice terminal <b>200</b> in which a preferred embodiment of the QoS technique of the invention is incorporated. IP voice terminal software components <b>205</b> include a packetizer <b>210</b>, a QoS engine <b>215</b>, a play-out adaptation routine <b>220</b>, an audio control <b>225</b> and a DTX (discontinuous transmission) engine <b>230</b>. The IP voice terminal <b>200</b> interfaces with an IP network <b>250</b> through the packetizer <b>210</b>, which is an integral functionality of the terminal. Within the packetizer <b>210</b>, in the direction toward the network, audio frames are encapsulated in packets for transmission using the real-time transport protocol (RTP). In the direction away from the network <b>250</b>, the packetizer <b>210</b> prepares packets received from the network for processing by the terminal.</p>
<p id="p-0043" num="0042">The size of the audio packets sent to the network <b>250</b> has a direct impact on bandwidth utilization and the processing load within the packetizer <b>210</b>. Variations in the behavior of the packetizer can therefore affect the measured QoS. In order to account for that component of QoS, the QoS engine <b>215</b> is placed between the play-out adapter <b>220</b> and the packetizer <b>210</b>. Such a placement has the result of capturing the effects of packet delays within the network together with the effects of the behaviour of the packetizer, offering a more precise measure of the end-to-end performance afforded by the overall system.</p>
<p id="p-0044" num="0043">The QoS engine <b>215</b> measures transport metrics such as average delay, delay variation and packet loss. The QoS engine may work in conjunction with DTX.</p>
<p id="p-0045" num="0044">The QoS engine <b>275</b> and DTX engine <b>230</b> are utilized through the use of an application programmer interface (API). <figref idref="DRAWINGS">FIG. 3</figref> shows a generalized protocol architecture <b>300</b> for IP-based communications according to the invention. As shown in <figref idref="DRAWINGS">FIG. 3</figref>, the network API interfaces with IP with reference to Network Time Protocol (NTP) <b>320</b>, Real-Time Transport Protocol (RTP) <b>330</b> and the Real-Time Control Protocol (RTCP) <b>325</b>. The architecture is an integrated services architecture available to the IP voice terminal for audio communications across the Internet. The RTP, RTCP and NTP protocols are utilized between the network API <b>310</b> and the Internet, through UDP/IP (Universal Datagram Protocol/Internet Protocol) <b>350</b>. NTP <b>320</b> specifies a procedure for time synchronization, relative to national standard time within the Internet, through the use of distributed servers that operate in a self-organizing mode. RTP <b>330</b> is a transport protocol for real-time packet traffic. A relevant feature of RTP is the inclusion of time stamps for use in media synchronization. RTCP <b>325</b> is used for media flow control.</p>
<p id="p-0046" num="0045"><figref idref="DRAWINGS">FIG. 4</figref> shows data exchanged among the various components of one embodiment of the invention. A specific QoS requirement <b>415</b> may be input into the application through the network API <b>410</b> by a user. That input <b>415</b> is directed to the QoS analysis routine <b>420</b>. The QoS analysis routine also takes as input the transport metrics <b>425</b> that are derived from the computations in the QoS engine <b>450</b>. Based on those data, the appropriate control information <b>430</b> is sent back to the QoS engine to be passed on to the play-out adaptation routine. The QoS analysis routine <b>420</b> also sends attainable MOS scores <b>440</b> back to the Network API for transmittal to the calling routine/user.</p>
<p id="p-0047" num="0046">In one example, shown in <figref idref="DRAWINGS">FIG. 2</figref>, an acceptable loss <b>271</b> is input to the QoS analysis routine <b>260</b> using a calling routine <b>270</b>. The QoS analysis routine <b>260</b> generates play-out delay information <b>265</b> using transport metrics from the QoS Engine <b>215</b>, and sends the play-out delay information to the play-out adaptation routine <b>220</b>. The play-out adaptation routine uses the play-out delay data to adjust buffering. The achievable MOS <b>272</b> is a return parameter to the calling routine <b>270</b>. In the QoS analysis routine, the transport metrics received from the QoS engine may include the delay, jitter, and loss parameters. Those parameters are mapped to MOS scores through the use of the R-factor mapping function. The MOS scores are then returned to a higher level calling routine <b>270</b>.</p>
<p id="p-0048" num="0047">The play-out adaptation routine <b>220</b> forwards buffered audio data to the audio control module <b>225</b>. The audio control module includes a coder/decoder (CODEC) <b>226</b> that contains specific algorithms for performing compression and encryption according to the schemes in use by the IP telephony system. As is known in the art, the terminal also includes a discontinuous transmission (DTX) module that suspends transmission during periods of silence, freeing bandwidth for other uses.</p>
<p id="p-0049" num="0048">A possible input into the QoS analysis routine <b>260</b> is an error concealment algorithm. The specific algorithm used depends on the type of CODEC <b>226</b> used in the application. The error concealment scheme is designed to improve the performance of the application based on the packet loss distribution within the network.</p>
<p id="p-0050" num="0049">A method according to the invention is shown in <figref idref="DRAWINGS">FIG. 5</figref>. The method <b>500</b> is preferably executed by a QoS analysis module that controls a communications service over a packetized network. A quality of service requirement for the communications service is first received (step <b>505</b>) by the terminal. As noted above, the QoS requirement may be an attribute of acceptable packet loss, such as a desired MOS input by a user. The QoS requirement is preferably input into the QoS analysis module using a calling routine.</p>
<p id="p-0051" num="0050">The module also receives (step <b>510</b>) at least one transport metric describing characteristics of the network. The transport metric is measured using NTP, RTP and/or RTCP. It may be average delay, delay variation, packet loss, or any combination of those metrics or any other metrics that reflect characteristics affecting performance of the network.</p>
<p id="p-0052" num="0051">Once those values are received, the module determines (step <b>520</b>) control information for use by a play-out adaptation routine. That control information is based on the quality of service requirement and on the transport metric or metrics. In a preferred embodiment, that control information includes a play-out delay. The determination of the control information is described in more detail below.</p>
<p id="p-0053" num="0052">The control information is subsequently transmitted (step <b>530</b>) to the play-out adaptation routine, either directly or through the QoS engine.</p>
<p id="p-0054" num="0053">A key functionality of the QoS analysis routine <b>260</b> (<figref idref="DRAWINGS">FIG. 2</figref>) is the estimation of packet loss distribution for use both in definition and control of the quality of service. In an illustrative embodiment, the loss distribution is computed by first computing running measurements of packet losses and delays within the network, using RTP in the terminal. The delay information is then used to estimate the parameters of a generalized function that characterizes the delay distribution in the network. In a preferred embodiment, the delay distribution is represented by a Pareto distribution. The parameters of the Pareto distribution are adapted to changes in traffic loads, so that time-of-day variations may be incorporated. Network losses are recorded for further use.</p>
<p id="p-0055" num="0054">A specific QoS is realized by allocating loss during play-out. The allocation depends on both the loss in the network and that which has been scheduled in the play-out adaptation routine. The combined loss in the network and in the play-out adaptation routine is referred to hereinafter as “overall loss.” The loss that is allowed in the play-out routine is “residual loss,” beyond that which has occurred in the network, and will be allocated based on the use of the Pareto distribution.</p>
<p id="p-0056" num="0055">In accordance with the present invention, let a given MOS be specified by a user through the calling routine. Let the associated packet loss probability be given by e<sub>mos</sub>. e<sub>mos </sub>shall be the acceptable loss probability for the particular application. In the QoS engine, sample delays will be measured through the use of RTP, over some specified interval I, whereby N such measurements are collected. A loss probability for the network, e<sub>network</sub>, is computed in the QoS engine. The acceptable residual loss that must be allowed in the play-out routine to support the specified MOS is given by r=e<sub>mos</sub>−e<sub>network</sub>. Of course, if the loss in the network is greater than what is established by the QoS requirement, then the specified quality of service would not be supported. The acceptable loss probability, e<sub>playout</sub>, that may be allowed in the play-out routine is then given by:</p>
<p id="p-0057" num="0056">
<maths id="MATH-US-00005" num="00005">
<math overflow="scroll">
<mrow>
  <msub>
    <mi>e</mi>
    <mi>playout</mi>
  </msub>
  <mo>=</mo>
  <mfrac>
    <mrow>
      <msub>
        <mi>e</mi>
        <mi>mos</mi>
      </msub>
      <mo>-</mo>
      <msub>
        <mi>e</mi>
        <mi>network</mi>
      </msub>
    </mrow>
    <mrow>
      <mn>1</mn>
      <mo>-</mo>
      <msub>
        <mi>e</mi>
        <mi>network</mi>
      </msub>
    </mrow>
  </mfrac>
</mrow>
</math>
</maths>
</p>
<p id="p-0058" num="0057">The Pareto distribution is described by the following equation:</p>
<p id="p-0059" num="0058">
<maths id="MATH-US-00006" num="00006">
<math overflow="scroll">
<mrow>
  <mrow>
    <mrow>
      <mi>F</mi>
      <mo>⁡</mo>
      <mrow>
        <mo>(</mo>
        <mi>x</mi>
        <mo>)</mo>
      </mrow>
    </mrow>
    <mo>=</mo>
    <mrow>
      <mn>1</mn>
      <mo>-</mo>
      <msup>
        <mrow>
          <mo>(</mo>
          <mfrac>
            <mi>k</mi>
            <mi>x</mi>
          </mfrac>
          <mo>)</mo>
        </mrow>
        <mi>α</mi>
      </msup>
    </mrow>
  </mrow>
  <mo>,</mo>
  <mrow>
    <mi>x</mi>
    <mo>≥</mo>
    <mi>k</mi>
  </mrow>
</mrow>
</math>
</maths>
</p>
<p id="p-0060" num="0059">where estimates of the parameters k and α are given by:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>{circumflex over (<i>k</i>)}=min(<i>x</i><sub>1</sub><i>,x</i><sub>2</sub><i>,x</i><sub>3</sub><i>, . . . x</i><sub>n</sub>) and,<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0061" num="0060">
<maths id="MATH-US-00007" num="00007">
<math overflow="scroll">
<mrow>
  <mover>
    <mi>α</mi>
    <mo>⋒</mo>
  </mover>
  <mo>=</mo>
  <msup>
    <mrow>
      <mi>n</mi>
      <mo>⁡</mo>
      <mrow>
        <mo>[</mo>
        <mrow>
          <munderover>
            <mo>∑</mo>
            <mrow>
              <mi>i</mi>
              <mo>=</mo>
              <mn>1</mn>
            </mrow>
            <mi>n</mi>
          </munderover>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.3em" height="0.3ex"/>
          </mstyle>
          <mo>⁢</mo>
          <mrow>
            <mi>log</mi>
            <mo>⁡</mo>
            <mrow>
              <mo>(</mo>
              <mfrac>
                <msub>
                  <mi>x</mi>
                  <mi>i</mi>
                </msub>
                <mover>
                  <mi>k</mi>
                  <mo>⋒</mo>
                </mover>
              </mfrac>
              <mo>)</mo>
            </mrow>
          </mrow>
        </mrow>
        <mo>]</mo>
      </mrow>
    </mrow>
    <mrow>
      <mo>-</mo>
      <mn>1</mn>
    </mrow>
  </msup>
</mrow>
</math>
</maths>
</p>
<p id="p-0062" num="0061">In the play-out adaptation procedure, play-out delay is adaptively set to ensure that the residual loss for a given QoS is achieved. The play-out delay may be tied to the required MOS as follows: The target rate of packet accumulation that is needed by the speech play-out process to achieve the required MOS, given the losses that have occurred in network, is given by:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>T=</i>1−<i>e</i><sub>playout </sub><?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0063" num="0062">The play-out delay, d, required to achieve this QoS is then computed as:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>d=F</i><sup>−1</sup>(<i>T</i>)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0064" num="0063">where F<sup>−1</sup>( ) is the inverse of F( ) defined above.</p>
<p id="p-0065" num="0064">Within the QoS analysis block, the network transport metrics computed in the QoS engine are mapped to MOS scores for perceptual comparison with well-known circuit-switched implementations. The mapping procedure is facilitated with CODEC-specific information, and use is made of the E-model. When using the E-model, it is necessary to first compute an R-factor using the network transport metrics. The R-factor is then mapped to MOS values through the use of the information represented in the table of <figref idref="DRAWINGS">FIG. 6</figref>.</p>
<p id="p-0066" num="0065">The general equation for the R-factor is defined by:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>R=</i>100−<i>I</i><sub>s</sub><i>−I</i><sub>d</sub><i>=I</i><sub>ef</sub><i>+A </i><?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
wherein I<sub>s</sub>, I<sub>d</sub>, and I<sub>ef </sub>are used to denote the impairments associated with the signal-to-noise ratio, network delay, and packet losses respectively. The parameter A is a normalization factor. For a specific application, the R-factor may be reduced to:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>R=β−I</i><sub>d</sub><i>−I</i><sub>ef </sub><?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0067" num="0066">wherein β, the reduction factor, may be fixed for pure packet-switched networks, or networks involving a combination of both packet-switched and circuit-switched networks. In one embodiment of the present invention in which default parameters are assigned values consistent with those described in ITU-T Recommendation G.107, β takes on a value of 94.2.</p>
<p id="p-0068" num="0067">An analytic expression for the delay impairment, I<sub>d</sub>, is given in ITU-T Recommendation G.107. However, invoking the assumption of an all IP environment, and applying default parameters as provided by the Recommendation, that expression may illustratively be reduced to:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>I</i><sub>d</sub>=0.024<i>d+</i>0.11(<i>d−</i>177.3)<i>H</i>(<i>d−</i>177.3)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0069" num="0068">wherein d is the one-way delay as defined by:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>d=d</i><sub>codec</sub><i>+d</i><sub>playout</sub><i>+d</i><sub>network </sub><?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0070" num="0069">and the function H(x) is defined as:</p>
<p id="p-0071" num="0070">
<maths id="MATH-US-00008" num="00008">
<math overflow="scroll">
<mrow>
  <mrow>
    <mi>H</mi>
    <mo>⁡</mo>
    <mrow>
      <mo>(</mo>
      <mi>x</mi>
      <mo>)</mo>
    </mrow>
  </mrow>
  <mo>=</mo>
  <mrow>
    <mo>{</mo>
    <mtable>
      <mtr>
        <mtd>
          <mrow>
            <mn>0</mn>
            <mo>,</mo>
          </mrow>
        </mtd>
        <mtd>
          <mrow>
            <mrow>
              <mrow>
                <mi>for</mi>
                <mo>⁢</mo>
                <mstyle>
                  <mspace width="0.8em" height="0.8ex"/>
                </mstyle>
                <mo>⁢</mo>
                <mi>x</mi>
              </mrow>
              <mo>&lt;</mo>
              <mn>0</mn>
            </mrow>
            <mo>,</mo>
          </mrow>
        </mtd>
      </mtr>
      <mtr>
        <mtd>
          <mrow>
            <mn>1</mn>
            <mo>,</mo>
          </mrow>
        </mtd>
        <mtd>
          <mrow>
            <mrow>
              <mi>for</mi>
              <mo>⁢</mo>
              <mstyle>
                <mspace width="0.8em" height="0.8ex"/>
              </mstyle>
              <mo>⁢</mo>
              <mi>x</mi>
            </mrow>
            <mo>&gt;</mo>
            <mn>0</mn>
          </mrow>
        </mtd>
      </mtr>
    </mtable>
  </mrow>
</mrow>
</math>
</maths>
</p>
<p id="p-0072" num="0071">d<sub>codec </sub>in the above definition of d is a processing delay associated with the specific speech coder in use in the application. That delay characterizes the encoding, compression, and packetization processes. Examples of the CODEC-specific delays for two common CODECs are illustrated in <figref idref="DRAWINGS">FIG. 7</figref>, wherein N is the number of 10 millisecond frames that are packetized in a single IP frame.</p>
<p id="p-0073" num="0072">The expression for I<sub>ef</sub>, the impairment associated with packet loss, is normally determined from MOS characterization of the available CODECs under various operating conditions. Given a number of sample data points, a curve fitting procedure is conducted to determine the parameters, γ<sub>1 </sub>. . . γ<sub>i</sub>, of the following curve:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>I</i><sub>ef</sub>=γ<sub>1</sub>+γ<sub>2 </sub>ln(1+γ<sub>3</sub><i>e</i>)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0074" num="0073">where e is the total loss probability, and is given by:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>e=e</i><sub>network</sub>+(1−<i>e</i><sub>network</sub>)<i>e</i><sub>playout </sub><?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0075" num="0074">The fitting parameters, γ<sub>i</sub>, are CODEC-specific. As an illustration, for a G.729a CODEC with a packet size of 20 ms, and random packet loss of up to 16%, I<sub>ef </sub>is given by:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>I</i><sub>ef</sub>≈11+40 ln(1+10<i>e</i>)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0076" num="0075">Using the reduced definition of the R-factor presented herein allows the development of a numerical expression for R that can be mapped to an MOS value by the application of the information presented in the table of <figref idref="DRAWINGS">FIG. 6</figref>.</p>
<p id="p-0077" num="0076">In accordance with the present invention, the proposed technique can be implemented in a number of areas. For example, the technique of the invention may be used for service characterization, whereby a terminal having the described functionality is deployed in a specific location and used to communicate with similar terminals to characterize the VoIP QoS. In another example, the inventive technique may be used for fault management in situations where network problems exist, and the sources of those problems are to be localized.</p>
<p id="p-0078" num="0077">Further, the method of the invention may be used for base-line monitoring in which, after enhanced QoS policies are applied, the technique is used to ensure that such enhancements are available. The technique may also be used for performance monitoring in cases, for example, where a service level agreement (SLA) is in place.</p>
<p id="p-0079" num="0078">The foregoing Detailed Description is to be understood as being in every respect illustrative and exemplary, but not restrictive, and the scope of the invention disclosed herein is not to be determined from the Detailed Description, but rather from the claims as interpreted according to the full breadth permitted by the patent laws. It is to be understood that the embodiments shown and described herein are only illustrative of the principles of the present invention and that various modifications may be implemented by those skilled in the art without departing from the scope and spirit of the invention.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-math idrefs="MATH-US-00001" nb-file="US07298736-20071120-M00001.NB">
<img id="EMI-M00001" he="6.35mm" wi="76.20mm" file="US07298736-20071120-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00002" nb-file="US07298736-20071120-M00002.NB">
<img id="EMI-M00002" he="10.58mm" wi="76.20mm" file="US07298736-20071120-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00003" nb-file="US07298736-20071120-M00003.NB">
<img id="EMI-M00003" he="6.01mm" wi="76.20mm" file="US07298736-20071120-M00003.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00004" nb-file="US07298736-20071120-M00004.NB">
<img id="EMI-M00004" he="6.01mm" wi="76.20mm" file="US07298736-20071120-M00004.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00005" nb-file="US07298736-20071120-M00005.NB">
<img id="EMI-M00005" he="6.01mm" wi="76.20mm" file="US07298736-20071120-M00005.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00006" nb-file="US07298736-20071120-M00006.NB">
<img id="EMI-M00006" he="6.35mm" wi="76.20mm" file="US07298736-20071120-M00006.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00007" nb-file="US07298736-20071120-M00007.NB">
<img id="EMI-M00007" he="10.58mm" wi="76.20mm" file="US07298736-20071120-M00007.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00008" nb-file="US07298736-20071120-M00008.NB">
<img id="EMI-M00008" he="7.45mm" wi="76.20mm" file="US07298736-20071120-M00008.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00009" nb-file="US07298736-20071120-M00009.NB">
<img id="EMI-M00009" he="6.35mm" wi="76.20mm" file="US07298736-20071120-M00009.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00010" nb-file="US07298736-20071120-M00010.NB">
<img id="EMI-M00010" he="10.58mm" wi="76.20mm" file="US07298736-20071120-M00010.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00011" nb-file="US07298736-20071120-M00011.NB">
<img id="EMI-M00011" he="6.01mm" wi="76.20mm" file="US07298736-20071120-M00011.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00012" nb-file="US07298736-20071120-M00012.NB">
<img id="EMI-M00012" he="6.01mm" wi="76.20mm" file="US07298736-20071120-M00012.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-claim-statement>I claim:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method for controlling a communications terminal communicating audio data over a packetized network, comprising the steps of:
<claim-text>receiving a quality of service requirement for a service, wherein the step of receiving the quality of service requirement for the service comprises receiving an attribute of acceptable packet loss;</claim-text>
<claim-text>receiving at least one transport metric describing characteristics of the network;</claim-text>
<claim-text>determining control information for use by a play-out adaptation routine, the control information being based on the quality of service requirement and on the at least one transport metric; and</claim-text>
<claim-text>transmitting the control information to the play-out adaptation routine to adapt the audio data in accordance with the control information.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. A method for controlling a communications terminal communicating audio data over a packetized network, comprising the steps of:
<claim-text>receiving a quality of service requirement for a service;</claim-text>
<claim-text>receiving at least one transport metric describing characteristics of the network;</claim-text>
<claim-text>determining control information for use by a play-out adaptation routine, the control information being based on the quality of service requirement and on the at least one transport metric;</claim-text>
<claim-text>transmitting the control information to the play-out adaptation routine to adapt the audio data in accordance with the control information; and</claim-text>
<claim-text>receiving an error concealment algorithm.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the error concealment algorithm is based on a speech coder used in the communications terminal.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. A method for controlling a communications terminal communicating audio data over a packetized network, comprising the steps of:
<claim-text>receiving a quality of service requirement for a service;</claim-text>
<claim-text>receiving at least one transport metric describing characteristics of the network;</claim-text>
<claim-text>determining control information for use by a play-out adaptation routine, the control information being based on the quality of service requirement and on the at least one transport metric, wherein the step of determining control information includes estimating a packet loss distribution of the network; and</claim-text>
<claim-text>transmitting the control information to the play-out adaptation routine to adapt the audio data in accordance with the control information.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the estimation of packet loss distribution of the network includes measuring actual packet loss.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the estimation of packet loss distribution of the network includes adapting parameters of a Pareto distribution.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. A method for controlling a communications terminal communicating audio data over a packetized network, comprising the steps of:
<claim-text>receiving a quality of service requirement for a service;</claim-text>
<claim-text>receiving at least one transport metric describing characteristics of the network;</claim-text>
<claim-text>determining control information for use by a play-out adaptation routine, the control information being based on the quality of service requirement and on the at least one transport metric, wherein the step of determining control information includes determining a play-out delay d for use by the play-out adaptation routine, wherein the play-out delay d is defined:
<claim-text>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>d=F</i><sup>−1</sup>(<i>T</i>)<?in-line-formulae description="In-line Formulae" end="tail"?>
</claim-text>
</claim-text>
<claim-text>wherein the function F<sup>−1</sup>( ) is an inverse of a function defining a Pareto distribution characterizing packet delays in the network, and T is a target rate of packet accumulation required by the play-out adaptation routine to achieve the quality of service requirement; and</claim-text>
<claim-text>transmitting the control information to the play-out adaptation routine to adapt the audio data in accordance with the control information.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the function defining the Pareto distribution characterizing packet delays in the network is:</claim-text>
<claim-text>
<maths id="MATH-US-00009" num="00009">
<math overflow="scroll">
<mrow>
  <mrow>
    <mrow>
      <mi>F</mi>
      <mo>⁡</mo>
      <mrow>
        <mo>(</mo>
        <mi>x</mi>
        <mo>)</mo>
      </mrow>
    </mrow>
    <mo>=</mo>
    <mrow>
      <mn>1</mn>
      <mo>-</mo>
      <msup>
        <mrow>
          <mo>(</mo>
          <mfrac>
            <mi>k</mi>
            <mi>x</mi>
          </mfrac>
          <mo>)</mo>
        </mrow>
        <mi>α</mi>
      </msup>
    </mrow>
  </mrow>
  <mo>,</mo>
  <mrow>
    <mi>x</mi>
    <mo>≥</mo>
    <mi>k</mi>
  </mrow>
</mrow>
</math>
</maths>
<claim-text>wherein estimates are used for the values of k and α:
<claim-text>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>{circumflex over (<i>k</i>)}=min(<i>x</i><sub>1</sub><i>,x</i><sub>2</sub><i>,x</i><sub>3</sub><i>, . . . x</i><sub>n</sub>) and<?in-line-formulae description="In-line Formulae" end="tail"?>
</claim-text>
</claim-text>
</claim-text>
<claim-text>
<maths id="MATH-US-00010" num="00010">
<math overflow="scroll">
<mrow>
  <mover>
    <mi>α</mi>
    <mo>⋒</mo>
  </mover>
  <mo>=</mo>
  <msup>
    <mrow>
      <mi>n</mi>
      <mo>⁡</mo>
      <mrow>
        <mo>[</mo>
        <mrow>
          <munderover>
            <mo>∑</mo>
            <mrow>
              <mi>i</mi>
              <mo>=</mo>
              <mn>1</mn>
            </mrow>
            <mi>n</mi>
          </munderover>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.3em" height="0.3ex"/>
          </mstyle>
          <mo>⁢</mo>
          <mrow>
            <mi>log</mi>
            <mo>⁡</mo>
            <mrow>
              <mo>(</mo>
              <mfrac>
                <msub>
                  <mi>x</mi>
                  <mi>i</mi>
                </msub>
                <mover>
                  <mi>k</mi>
                  <mo>⋒</mo>
                </mover>
              </mfrac>
              <mo>)</mo>
            </mrow>
          </mrow>
        </mrow>
        <mo>]</mo>
      </mrow>
    </mrow>
    <mrow>
      <mo>-</mo>
      <mn>1</mn>
    </mrow>
  </msup>
</mrow>
</math>
</maths>
<claim-text>where n a total number of actual packet delay measurements and (x<sub>1</sub>, x<sub>2</sub>, x<sub>3</sub>, . . . x<sub>n</sub>) are actual packet delay measurements.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The method of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the target rate T of a packet accumulation required by the play-out adaptation routine to achieve the quality of service requirement is defined as:
<claim-text>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>T=</i>1−<i>e</i><sub>playout </sub><?in-line-formulae description="In-line Formulae" end="tail"?>
</claim-text>
<claim-text>wherein</claim-text>
</claim-text>
<claim-text>
<maths id="MATH-US-00011" num="00011">
<math overflow="scroll">
<mrow>
  <mrow>
    <msub>
      <mi>e</mi>
      <mi>playout</mi>
    </msub>
    <mo>=</mo>
    <mfrac>
      <mrow>
        <msub>
          <mi>e</mi>
          <mi>mos</mi>
        </msub>
        <mo>-</mo>
        <msub>
          <mi>e</mi>
          <mi>network</mi>
        </msub>
      </mrow>
      <mrow>
        <mn>1</mn>
        <mo>-</mo>
        <msub>
          <mi>e</mi>
          <mi>network</mi>
        </msub>
      </mrow>
    </mfrac>
  </mrow>
  <mo>;</mo>
</mrow>
</math>
</maths>
<claim-text>e<sub>mos </sub>being a packet loss probability associated with the quality of service requirement, and e<sub>network </sub>being a packet loss probability of the network.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. An audio terminal for use in communication over a packetized network, the terminal comprising:
<claim-text>a packetizer for extracting incoming audio data from packets received from the network;</claim-text>
<claim-text>a play-out adapter for modulating a flow of audio data from the packetizer;</claim-text>
<claim-text>a quality of service engine between the play-out adapter and the packetizer, the quality of service engine being configured to control the modulation of audio data by the play-out adapter based on transport metrics of both the packetizer and the network; and</claim-text>
<claim-text>a quality of service analysis routine configured to receive the transport metrics from the quality of service engine, and to transmit play-out control information to the quality of service engine, wherein the quality of service analysis routine is further configured to receive a quality of service requirement from a network API, and to transmit to the network API an achievable quality of service level.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. An audio terminal for use in communication over a packetized network, the terminal comprising:
<claim-text>a packetizer for extracting incoming audio data from packets received from the network;</claim-text>
<claim-text>a play-out adapter for modulating a flow of audio data from the packetizer; and</claim-text>
<claim-text>a quality of service engine between the play-out adapter and the packetizer, the quality of service engine being configured to control the modulation of audio data by the play-out adapter based on transport metrics of both the packetizer and the network, wherein the quality of service engine controls the modulation of audio data by the play-out adapter based on a packet loss probability e<sub>playout </sub>of a play-out routine determined by</claim-text>
</claim-text>
<claim-text>
<maths id="MATH-US-00012" num="00012">
<math overflow="scroll">
<mrow>
  <mrow>
    <msub>
      <mi>e</mi>
      <mi>playout</mi>
    </msub>
    <mo>=</mo>
    <mfrac>
      <mrow>
        <msub>
          <mi>e</mi>
          <mi>mos</mi>
        </msub>
        <mo>-</mo>
        <msub>
          <mi>e</mi>
          <mi>network</mi>
        </msub>
      </mrow>
      <mrow>
        <mn>1</mn>
        <mo>-</mo>
        <msub>
          <mi>e</mi>
          <mi>network</mi>
        </msub>
      </mrow>
    </mfrac>
  </mrow>
  <mo>;</mo>
</mrow>
</math>
</maths>
<claim-text>wherein e<sub>mos </sub>is a required maximum packet loss probability and e<sub>network </sub>is the packet loss probability based on transport metrics of both the packetizer and the network.</claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
