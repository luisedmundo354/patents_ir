<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07298748-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07298748</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>10255610</doc-number>
<date>20020927</date>
</document-id>
</application-reference>
<us-application-series-code>10</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>JP</country>
<doc-number>2001-301369</doc-number>
<date>20010928</date>
</priority-claim>
</priority-claims>
<us-term-of-grant>
<us-term-extension>1057</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>L</subclass>
<main-group>12</main-group>
<subgroup>56</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>37039541</main-classification>
<further-classification>370278</further-classification>
<further-classification>370326</further-classification>
<further-classification>370443</further-classification>
</classification-national>
<invention-title id="d0e71">Method of packet transmission and wireless communication device</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5862171</doc-number>
<kind>A</kind>
<name>Mahany</name>
<date>19990100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>375132</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>6970440</doc-number>
<kind>B1</kind>
<name>Schmidl et al.</name>
<date>20051100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370330</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6973067</doc-number>
<kind>B1</kind>
<name>Haartsen</name>
<date>20051200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370337</main-classification></classification-national>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>7039038</doc-number>
<kind>B2</kind>
<name>Shoemake</name>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370349</main-classification></classification-national>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>7142880</doc-number>
<kind>B2</kind>
<name>Schmandt et al.</name>
<date>20061100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>455515</main-classification></classification-national>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>2002/0071413</doc-number>
<kind>A1</kind>
<name>Choi</name>
<date>20020600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370337</main-classification></classification-national>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2002/0122413</doc-number>
<kind>A1</kind>
<name>Shoemake</name>
<date>20020900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370349</main-classification></classification-national>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2002/0126692</doc-number>
<kind>A1</kind>
<name>Haartsen</name>
<date>20020900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370450</main-classification></classification-national>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2003/0021262</doc-number>
<kind>A1</kind>
<name>Ma et al.</name>
<date>20030100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370352</main-classification></classification-national>
</citation>
<citation>
<patcit num="00010">
<document-id>
<country>EP</country>
<doc-number>1185038</doc-number>
<kind>A2</kind>
<date>20020300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
</citation>
<citation>
<patcit num="00011">
<document-id>
<country>EP</country>
<doc-number>1376996</doc-number>
<kind>A2</kind>
<date>20040100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
</citation>
<citation>
<nplcit num="00012">
<othercit>Chawla, S. et al., “QoS Based Scheduling for Incorporating Variable Rate Coded Voice in Bluetooth,” IEEE Conference on Communications, 2001. ICC 2001. Jun. 2001, vol. 4, pp. 1232-1237.</othercit>
</nplcit>
<category>cited by examiner</category>
</citation>
</references-cited>
<number-of-claims>16</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>370230</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370234</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370235</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370277</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370278</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370282</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370294</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370321</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370326</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370329</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370336</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370337</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370345</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370347</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370348</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>3703954</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>37039541</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370437</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370442</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370443</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370458</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370468</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370236</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370461</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>17</number-of-drawing-sheets>
<number-of-figures>17</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20030099207</doc-number>
<kind>A1</kind>
<date>20030529</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Yamato</last-name>
<first-name>Katsumi</first-name>
<address>
<city>Chiba-ken</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Oblon, Spivak, McClelland, Maier &amp; Neustadt, P.C.</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Kabushiki Kaisha Toshiba</orgname>
<role>03</role>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Pham</last-name>
<first-name>Chi</first-name>
<department>2616</department>
</primary-examiner>
<assistant-examiner>
<last-name>Mills</last-name>
<first-name>Donald L</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">Provided is a method of packet transmission capable of efficiently utilizing ACL link resources in transmitting and receiving packets after an ACL link is established in Bluetooth. A Bluetooth device A determines the maximum rate for packet size to be transmitted to a Bluetooth device B established in the link based on the ratio between a token rate A requested by the device A and a token rate B requested by the device B. When the token rate A is greater than the token rate B, the maximum rate N is set from the candidates of current time slot numbers occupiable as an ACL packet. When the token rate A is smaller than the token rate B, a rate is selected from the candidates of current time slot numbers occupiable as the ACL packet based on rate U=N×token rate A/token rate B.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="113.03mm" wi="206.76mm" file="US07298748-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="210.99mm" wi="149.01mm" orientation="landscape" file="US07298748-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="231.14mm" wi="138.18mm" orientation="landscape" file="US07298748-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="203.20mm" wi="171.70mm" orientation="landscape" file="US07298748-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="154.69mm" wi="170.01mm" file="US07298748-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="174.84mm" wi="156.97mm" file="US07298748-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="204.22mm" wi="171.70mm" file="US07298748-20071120-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="198.46mm" wi="196.60mm" orientation="landscape" file="US07298748-20071120-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="216.83mm" wi="128.52mm" orientation="landscape" file="US07298748-20071120-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="220.81mm" wi="152.06mm" orientation="landscape" file="US07298748-20071120-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="198.46mm" wi="177.21mm" orientation="landscape" file="US07298748-20071120-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="235.37mm" wi="193.80mm" orientation="landscape" file="US07298748-20071120-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="220.56mm" wi="136.99mm" orientation="landscape" file="US07298748-20071120-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="220.13mm" wi="146.98mm" orientation="landscape" file="US07298748-20071120-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="220.47mm" wi="148.67mm" orientation="landscape" file="US07298748-20071120-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00015" num="00015">
<img id="EMI-D00015" he="210.31mm" wi="177.29mm" orientation="landscape" file="US07298748-20071120-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00016" num="00016">
<img id="EMI-D00016" he="214.21mm" wi="142.32mm" orientation="landscape" file="US07298748-20071120-D00016.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00017" num="00017">
<img id="EMI-D00017" he="214.04mm" wi="150.54mm" orientation="landscape" file="US07298748-20071120-D00017.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0002" num="0001">The present invention relates to a wireless communication device capable of transmitting and receiving data in packets after a short-range wireless communication unit is used to establish a link, and to a method of packet transmission between the wireless communication devices.</p>
<p id="p-0003" num="0002">In recent years, systems adapting the Bluetooth™ standard have been developed, the Bluetooth standard uses frequency hopping in a waveband of 2.4 GHz to transmit and receive data among discrete devices. For example, devices such as cellular phones, PHSs (Personal Handyphone Systems), personal computers, and personal digital assistants are mounted with a wireless module of the Bluetooth standard and the Wireless module is used to transmit and receive data, whereby data can be transmitted and received among discrete devices. Hereafter, a device mounted with the wireless module of the Bluetooth standard is denoted as BT device.</p>
<p id="p-0004" num="0003">When the BT devices have been connected through a radio rink, data can be transmitted and received among these BT devices. At this time, any one of the BT devices is operated as a master, and the other BT devices are operated as slaves.</p>
<p id="p-0005" num="0004">In Bluetooth, a channel is divided into time slots having a length of 625 microsecond, and they are given slot numbers according to the Bluetooth clock of a piconet master. A slot number is given in order of 0 to 2<sup>27</sup>−1, and it is returned to zero when reaching 2<sup>27</sup>−1. The BT devices, both the master and slaves, transmit packets using these time slots.</p>
<p id="p-0006" num="0005">In Bluetooth, the TDD (Time Division Duplex) scheme is used in which the master and the slaves alternately transmit. The master can start to transmit packets only at even numbered time slots. Then, as long as the master transmits packets to the slave itself, the slave can start to transmit packet only at odd numbered time slots placed next to the time slots where the packets have been transmitted. In addition, both the master and slaves can transmit packets extended over five time slots at maximum.</p>
<p id="p-0007" num="0006">In the meantime, link types of Bluetooth have an SCO (Synchronous Connection) Oriented) link and an ACL (Asynchronous Connection-Less) link. The SCO link is circuit-switched connection in which time slots are reserved at every fixed time interval to communicate, suitable for handling voice traffic, whereas the ACL link is packet-switched connection in which time slots not reserved by the SCO link are used to communicate, suitable for handling data traffic.</p>
<p id="p-0008" num="0007"><figref idref="DRAWINGS">FIG. 16</figref> depicts one example of the packet (ACL packet) communication between a master and a slave <b>1</b> or slave <b>2</b> using the ACL link. In the example shown in <figref idref="DRAWINGS">FIG. 16</figref>, the master transmits an ACL packet having a length of five time slots to the slave <b>1</b> at an even numbered time slot 2n. At this time, the slave <b>1</b> received the ACL packet from the master is given the right to transmit an ACL packet to the master at an odd numbered time slot 2n+5. In the example shown in <figref idref="DRAWINGS">FIG. 16</figref>, it transmits a packet having a length of three time slots at the time slot 2n+5. In addition, even when the slave <b>1</b> does not have information to be transmitted to the master, the other slaves cannot transmit ACL packets using the time slot 2n +5 the example shown in <figref idref="DRAWINGS">FIG. 16</figref>, the master successively transmits an ACL packet having a length of three time slots to a slave <b>2</b> at an even numbered time slot 2n+8. The slave <b>2</b> received this transmits an ACL packet having a length of three time slots to the master at an odd numbered time slot 2n+11.</p>
<heading id="h-0002" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0009" num="0008">When the BT device is to communicate using the ACL link, it can immediately transmit ACL packets using the time slots not reserved by the SCO link. In addition, as a packet size usable for a single time of ACL packet transmission, it can be extended over five time slots at maximum.</p>
<p id="p-0010" num="0009">However, when one BT device determines the packet size regardless of the other BT device and it transmits ACL packets, disadvantages are sometimes generated in view of efficient use of ACL link resources.</p>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 17</figref> depicts one example of the ACL packet communication on the ACL link in the case where a master requests a slave to transmit data equivalent to a length of 15 time slots and a slave requests the master to transmit data equivalent to a length of three time slots simultaneously at every time interval equivalent to a length of 18 time slots. In the example shown in <figref idref="DRAWINGS">FIG. 17</figref>, both the master and slave can transmit an ACL packet of size equivalent to a length of five time slots as the maximum rate for the ACL packet length.</p>
<p id="p-0012" num="0011">As shown in <figref idref="DRAWINGS">FIG. 17</figref>, time slot positions α, β and γ are the positions that the slave can transmit a packet to the master. However, the slave has already transmitted data equivalent to a length of three time slots at this time, and thus the slave has no data to be transmitted. On this account, it does not transmit data at the time slots α, β and γ. More specifically, in the example shown in <figref idref="DRAWINGS">FIG. 17</figref>, 3÷36 nearly equal to 8.3% of ACL link resources have not been used for data communication.</p>
<p id="p-0013" num="0012">Furthermore, when a communication error is generated on the ACL link in packet transmission, the packet is to be retransmitted. However, in this case, time needed for retransmission becomes longer as the packet size is larger. Consequently, packet transmission performance is deteriorated.</p>
<p id="p-0014" num="0013">The invention has been made in consideration of the circumstances. The object of the invention is to provide a method of packet transmission and a wireless communication device, capable of efficiently utilizing ACL link resources in transmitting and receiving data in ACL packets after the Bluetooth standard is used to establish the ACL link.</p>
<p id="p-0015" num="0014">In addition, the object of the invention is to provide a method of packet transmission and a wireless communication device capable of keeping the deterioration of packet transmission performance low in transmitting and receiving data in ACL packets after the Bluetooth standard is used to establish the ACL link.</p>
<p id="p-0016" num="0015">A method of packet transmission between a first communication device and a second communication device after a link is established by short-range wireless communications, the method of packet transmission comprising: receiving a first average rate from the second communication device, said the first average rate is requested by the second communication device in transferring data to the first communication device from the second communication device; preparing a second average rate which representing an average rate of the data transfer from the first communication device to the second communication device; and determining a maximum packet size of a packet to be transmitted to the second communication device from the first communication device based on a ratio of the first average rate to a second average rate stored in the first communication device in transferring data to the second communication device from the first communication device.</p>
<p id="p-0017" num="0016">Moreover, the invention is a wireless communication device comprising: a short-range wireless communication unit adapted to transmit and receive data in a packet after a link is established with the other wireless communication device; a receiving unit adapted to receive a first average rate requested by the other wireless communication device established with the link; and a determining unit adapted to determine a maximum rate for packet size to be transmitted to the other wireless communication device based on a ratio between a second data transfer rate to the other wireless communication device and the first data transfer rate, the second data transfer rate stored in the wireless communication device, wherein the short-range wireless communication unit transmits and receives data based on the maximum rate for packet size to be transmitted to the other wireless communication device, the maximum rate is determined by the determining unit.</p>
<p id="p-0018" num="0017">Additionally, the invention in the device or method can be realized as a program for allowing a computer to execute a procedure corresponding to the invention (or for allowing a computer to function as a unit corresponding to the invention or for allowing a computer to realize a function corresponding to the invention), and it can be realized as a computer readable medium recorded with the program as well.</p>
<p id="p-0019" num="0018">According to the invention, performance requested by a BT device to be a communication counterpart is compared to set the maximum rate for the ACL packet length in transmitting and receiving data in an ACL packet after the Bluetooth standard is used to establish a link, whereby packet transmission can be provided in which ACL link resources are effectively utilized.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0020" num="0019">The teachings of the invention can be readily understood by considering the following detailed description in conjunction with the accompanying drawings, in which:</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 1</figref> is a diagram illustrating an exemplary configuration of a BT device in an embodiment of the invention;</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 2</figref> is a diagram illustrating an example of splitting a packet in an L2CAP processing part of the BT device in the embodiment;</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 3</figref> is a diagram illustrating an exemplary internal configuration of the portion involving an SAR function in a baseband processing part of the BT device in the embodiment;</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 4</figref> is a diagram illustrating an exemplary configuration of a BT device in another embodiment;</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 5</figref> is a diagram illustrating an example of splitting packets in an L2CAP processing part of the BT device in another embodiment;</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 6</figref> is a diagram illustrating an exemplary internal configuration of a portion involving an SAR function in a baseband processing part of the BT device in another embodiment;</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 7</figref> is a flowchart illustrating one example of a procedure in determining the maximum rate for the ACL packet length in the ACL packet length control part shown in <figref idref="DRAWINGS">FIG. 3</figref>.</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 8</figref> is a diagram illustrating the overview of reserving time slots by the SCO link;</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. 9</figref> is a diagram illustrating one example of the ACL packet communication on the ACL link when the maximum rate for the ACL packet length is determined in accordance with the procedure shown in <figref idref="DRAWINGS">FIG. 7</figref> under the same conditions as <figref idref="DRAWINGS">FIG. 17</figref>;</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 10</figref> is a diagram illustrating ACL packet patterns transmitted from the slaves shown in <figref idref="DRAWINGS">FIGS. 9 and 17</figref>;</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 11</figref> is a flowchart illustrating one example of the procedure in determining the maximum rate for the ACL packet length also taking account of the QoS parameter latency of the ACL packet length control part shown in <figref idref="DRAWINGS">FIG. 3</figref>;</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. 12</figref> is a diagram illustrating one example of the ACL packet communication in the case where the maximum rate for the ACL packet length is temporarily increased in accordance with the temporary suspension of data transfer in a BT device to be a communication counterpart;</p>
<p id="p-0033" num="0032"><figref idref="DRAWINGS">FIG. 13</figref> is a diagram illustrating the manner of retransmitting an ACL packet (transmitting a single ACL packet) when errors are generated in ACL packet transmission;</p>
<p id="p-0034" num="0033"><figref idref="DRAWINGS">FIG. 14</figref> is a diagram illustrating the manner of retransmitting ACL packets (transmitting by splitting into five ACL packets) when errors are generated in ACL packet transmission;</p>
<p id="p-0035" num="0034"><figref idref="DRAWINGS">FIG. 15</figref> is a diagram illustrating a concept of changing the maximum rate for the ACL packet length based on the deterioration of transmission performance;</p>
<p id="p-0036" num="0035"><figref idref="DRAWINGS">FIG. 16</figref> is a diagram illustrating one example of the ACL packet communication between the master and the slaves using the ACL link; and <figref idref="DRAWINGS">FIG. 17</figref> is a diagram illustrating one example of the ACL packet communication on the ACL link in the case where a data transfer request is generated simultaneously in the master and the slave.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DESCRIPTION OF THE PREFERRED EMBODIMENT</heading>
<p id="p-0037" num="0036">Hereafter, embodiments of the invention will be described with reference to the drawings.</p>
<p id="p-0038" num="0037">Additionally, an example where the Bluetooth standard is used to establish the ACL link then data is transmitted and received in ACL packets will be described below.</p>
<p id="p-0039" num="0038"><figref idref="DRAWINGS">FIG. 1</figref> depicts one example of the configuration of a BT device in an embodiment of the invention (the configuration corresponds to a protocol stack).</p>
<p id="p-0040" num="0039">In <figref idref="DRAWINGS">FIG. 1</figref>, on a baseband processing part <b>11</b> of a physical layer specification for Bluetooth, an L2CAP processing part <b>12</b> for executing a data link layer specification (L2CAP: Logical link Control and Adaptation Protocol) utilizing the ACL link is placed. Then, as an upper level protocol for utilizing the L2CAP processing part <b>12</b>, there exist protocols (discrete processing parts corresponding to these protocols) such as a service discovery protocol (SDP) <b>13</b>, an RFCOMM <b>14</b> and a telephony control protocol specification (TCS) <b>15</b>. In addition, when the SCO link is used, the upper level protocols for utilizing SCO transfer are to be directly placed on the baseband processing part <b>11</b> without using the L2CAP processing part <b>12</b>. In the embodiment, the case where the L2CAP processing parts <b>12</b> in BT devices communicate through the ACL link will be described.</p>
<p id="p-0041" num="0040"><figref idref="DRAWINGS">FIG. 2</figref> depicts an example of splitting a packet in the L2CAP processing part <b>12</b>. In the drawing, <b>21</b> denotes a packet (L2CAP packet) defined by the L2CAP processing part <b>12</b>. The L2CAP packet is formed of a Length field (two-octet length) for indicating an information payload size per octet, a CID (channel identifier) field (two-octet length) for specifying a destination channel end point of the packet, and a Payload field (0 to 65535-octet length) for storing communication information received from the upper level protocols. The Length field and the CID field are combined and called an L2CAP header.</p>
<p id="p-0042" num="0041">An SAR (Segmentation And Reassembly) function mounted in the baseband processing part <b>11</b> splits the L2CAP packet <b>21</b> into a payload for the ACL packet handled in the baseband processing part <b>12</b>, and it reassembles the L2CAP packet with the payload of the ACL packet. Furthermore, so that the SAR function (in the baseband processing part <b>11</b>) of the BT device received with the ACL packet can reassemble it into the L2CAP packet, L_CH (logical channel) field (two-bit length) defined by the payload header of the ACL packet is used to indicate whether the ACL packet is a start part (continuation part) of the L2CAP packet. More specifically, rate “10” is set to the L_CH field in the ACL packet containing the first segment of the L2CAP packet (see an ACL packet <b>22</b> shown in <figref idref="DRAWINGS">FIG. 2</figref>), and rate “01” is set to the L_CH field in the ACL packets containing the subsequent segment (see ACL packets <b>23</b> and <b>24</b> shown in <figref idref="DRAWINGS">FIG. 2</figref>).</p>
<p id="p-0043" num="0042"><figref idref="DRAWINGS">FIG. 3</figref> depicts one example of an internal configuration of the portion involving the SAR function of the baseband processing part <b>11</b>. As shown in <figref idref="DRAWINGS">FIG. 3</figref>, the portion involving the SAR function of the baseband processing part <b>11</b> includes an L2CAP packet splitting part <b>31</b> for segmenting the L2CAP packet, an ACL packet creating part <b>32</b> for creating ACL packets by giving a header, a TX buffer <b>33</b> for controlling the ACL packets or SCO packets to be transmitted onto time slots, an RX buffer <b>34</b> for receiving the ACL packets or SCO packets transmitted on time slots, a payload extracting part <b>35</b> for extracting payload information in the ACL packets, an L2CAP packet reassembling part <b>36</b> for reassembling the ACL packets to create the L2CAP packet, and an ACL packet length control part <b>37</b>.</p>
<p id="p-0044" num="0043">In <figref idref="DRAWINGS">FIG. 3</figref>, the size of the ACL packet transmitted by the BT device is determined in the packet length control part <b>37</b>. Depending on desired communication performance between the BT devices established in the ACL link or transmission status of actual ACL packets, the ACL packet length control part <b>37</b> dynamically corrects the maximum rate for the ACL packet length and posts it to the L2CAP packet splitting part <b>31</b> (see <b>42</b> in the drawing). The L2CAP packet splitting part <b>31</b> splits the L2CAP packet so as to create ACL packets not exceeding the maximum ACL packet length posted from the ACL packet length control part <b>37</b>.</p>
<p id="p-0045" num="0044">In the embodiment shown in <figref idref="DRAWINGS">FIG. 1</figref>, the L2CAP processing part <b>12</b> is directly placed on the baseband processing part <b>11</b>. As a further embodiment, as shown in <figref idref="DRAWINGS">FIG. 4</figref>, there is an embodiment in which an HCI processing part <b>16</b> for executing a host controller interface specification (HCI) is placed between a baseband processing part <b>11</b> and an L2CAP processing part <b>12</b>.</p>
<p id="p-0046" num="0045">For the embodiment shown in <figref idref="DRAWINGS">FIG. 4</figref>, for example, named is the case where a BT host (PC) installed with upper layer software such as the L2CAP processing part <b>12</b> is connected to a BT device mounted with the baseband processing part <b>11</b> through a USB (Universal Serial Bus). At this time, the BT host communicates with the BT device based on the HCI specification.</p>
<p id="p-0047" num="0046">In the case of using the HCI processing part <b>16</b> as shown in <figref idref="DRAWINGS">FIG. 4</figref>, an L2CAP packet is split as shown in <figref idref="DRAWINGS">FIG. 5</figref>. The L2CAP packet transmitted from the BT host is once split into packets (HCI packets) defined by the HCI specification in the HCI processing part <b>16</b> on the BT host side, and then they are passed to the BT device.</p>
<p id="p-0048" num="0047">The HCI packet is formed of a Connection Handle field (12-bit length) used for identifying connection, a Packet Boundary flag (PB flag: two-bit length) indicating whether it is a first segment of the L2CAP packet, a Broadcast flag (BC flag: two-bit length) for indicating whether it is point-to-point communication or broadcast communication, a Data Total Length field (two-octet length) for indicating data length per octet, and a Data field for splitting and storing the L2CAP packet.</p>
<p id="p-0049" num="0048">In addition, the maximum length of the HCI packet is set so as not to exceed the maximum rate of the buffer size held by the BT device to which the HCI packet is passed. The SAR function in the baseband processing part <b>11</b> that has received the HCI packet is to split the HCI packet into a payload of the ACL packet.</p>
<p id="p-0050" num="0049">Furthermore, in the case of using the HCI processing part <b>16</b> as shown in <figref idref="DRAWINGS">FIG. 4</figref>, the internal configuration of the portion involving the SAR function of the baseband processing part <b>11</b> is that shown in <figref idref="DRAWINGS">FIG. 6</figref>.</p>
<p id="p-0051" num="0050"><figref idref="DRAWINGS">FIG. 7</figref> depicts one example of a procedure in determining the maximum rate for the ACL packet length in the ACL packet length control part <b>37</b>. The procedure shown in <figref idref="DRAWINGS">FIG. 7</figref> illustrates the procedure in determining the maximum rate for the packet length of the ACL packet to be transmitted to a BT device B when a BT device A has established the ACL link with the BT device B (the procedure is the same in the BT device B (the BT device A is replaced by the BT device B in the procedure shown in <figref idref="DRAWINGS">FIG. 7</figref>)).</p>
<p id="p-0052" num="0051">As the cue to change the maximum rate for the ACL packet length in the BT device A, for example, named is the case where the ACL link is established with the BT device B or services provided by using the ACL link are changed in the BT device A or BT device B.</p>
<p id="p-0053" num="0052">When the BT device B posts the BT device A because QoS parameters are changed in the BT device B, the QoS parameters in the BT device B are described as the parameters of a Configuration Request packet and they are transmitted to the BT device A (the parameters of the Configuration Request packet are used in negotiating agreements on the ACL link between the L2CAP processing part <b>12</b> in one BT device and the L2CAP processing part <b>12</b> in the other BT device). In this case, the BT device A receives the notification of the QoS parameter from the BT device B and then it knows the QoS parameters of the BT device B.</p>
<p id="p-0054" num="0053">The QoS parameters requested by the L2CAP processing part <b>12</b> in the BT device B are posted to the ACL packet length control part <b>37</b> (see <b>41</b> shown in <figref idref="DRAWINGS">FIG. 3</figref>).</p>
<p id="p-0055" num="0054">In the meantime, the QoS parameters requested by the L2CAP processing part <b>12</b> in the BT device A itself are also posted to the ACL packet length control part <b>37</b> (see <b>41</b> shown in <figref idref="DRAWINGS">FIG. 3</figref>).</p>
<p id="p-0056" num="0055">In addition, when the QoS parameters are changed in the BT device A, the BT device A similarly posts the QoS parameters to the BT device B.</p>
<p id="p-0057" num="0056">When the QoS parameters are changed in the BT device A itself or in the BT device B (Step S<b>51</b>), the BT device A compares token rates, one of the QoS parameters (Step S<b>52</b>). The token rate is a rate allowing successive data transfer indicated per byte. The BT device A compares the token rate in the BT device A with the token rate in the BT device B and it determines which token rate is greater.</p>
<p id="p-0058" num="0057">When the token rate requested by the BT device A is equal to the token rate requested by the BT device B or the former is greater than the latter, the maximum rate N is set as the maximum rate for the ACL packet in the BT device A among the candidates of current time slot numbers occupiable as the ACL packet (Step S<b>53</b>).</p>
<p id="p-0059" num="0058">When the token rate requested by the BT device A is smaller than the token rate requested by the BT device B, the maximum rate for the ACL packet in the BT device A is selected from the candidates of current time slot numbers occupiable as the ACL packet based on a rate U obtained from Equation (1), where the token rate requested by the BT device A is set to T(A) and the token rate requested by the BT device B is set to T(B) (Step S<b>54</b>).
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>U=N×T</i>(<i>A</i>)/<i>T</i>(<i>B</i>)  (1)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0060" num="0059">As a method for selecting the maximum rate for the ACL packet length in the BT device A based on a rate U, for example, the following procedures are named.
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0060">1. The minimum rate not exceeding U is selected from the candidates of current time slot numbers occupiable as the ACL packet, and the maximum rate for the ACL packet length is set so as to occupy time slots for the selected rate (the minimum rate not exceeding U).</li>
    <li id="ul0001-0002" num="0061">2. Among the candidates of current time slot numbers occupiable as the ACL packet, the rate closest to U is selected and the maximum rate for the ACL packet length is set so as to occupy time slots for the selected rate (the rate closest to U).</li>
</ul>
</p>
<p id="p-0061" num="0062">Here, the candidates of current time slot numbers occupiable as the ACL packet will be described.</p>
<p id="p-0062" num="0063">In the Bluetooth standard, the number of time slots occupiable by a single ACL packet is up to five time slots. The master continuously transmits packets at even numbered time slots and the slave continuously transmits packets at odd numbered time slots, whereby the maximum rate for the ACL packet length is selected from 1, 3 and 5 for setting.</p>
<p id="p-0063" num="0064">Consequently, when the token rate requested by the BT device A is equal to the token rate requested by the BT device B, the maximum rate N is selected at Step S<b>53</b> in both the BT device A and BT device B according to the procedure shown in <figref idref="DRAWINGS">FIG. 7</figref>. When the token rate requested by the BT device A is not equal to the token rate requested by the BT device B, the maximum rate N is selected at Step S<b>53</b> in the BT device having a greater token rate and the rate conforming to Step S<b>54</b> is selected in the BT device having a smaller token rate.</p>
<p id="p-0064" num="0065">In the meantime, the SCO link can also be established between the BT devices other than the ACL link. In contrast to the ACL link, the SCO link reserves time slots at every fixed time interval beforehand for communication. Time slots usable as the ACL link are limited to the time slots not reserved by the SCO link.</p>
<p id="p-0065" num="0066"><figref idref="DRAWINGS">FIG. 8</figref> depicts the overview of reserving time slots by the SCO link. In the example shown in <figref idref="DRAWINGS">FIG. 8</figref>, time slots are reserved for the SCO link at every six slots in both a master and slave. In this case, five cannot be set as the maximum rate for the ACL packet length. More specifically, only one and three are named as the candidates of time slot numbers occupiable as the ACL packet. Then, when a length of three time slots is set as the maximum rate for the ACL packet length in either the master or slave having a greater token rate according to the procedure shown in <figref idref="DRAWINGS">FIG. 7</figref>, the maximum rate for the ACL packet length in the other is necessarily to be a length of one time slot. When such allocation is determined to be undesirable from the ratio between the requested token rates (the ratio of the maximum time slot length is 3:1), the time slot length is set to one in both the master and slave as the maximum rate for the ACL packet length.</p>
<p id="p-0066" num="0067">In this manner, the candidates of the time slot numbers occupiable as the ACL packet are varied in accordance with the setting status of the SCO link. On this account, each time events such as new setup of the SCO link and release of the existing SCO link are generated, processing is needed in which the time slot numbers occupiable as the ACL packet are reviewed.</p>
<p id="p-0067" num="0068">In the following example, it will be described under the circumstances that the SCO link is not established for simplifying the embodiment. More specifically, the candidates of the time slot numbers occupiable as the ACL packet are one, three and five all the time.</p>
<p id="p-0068" num="0069"><figref idref="DRAWINGS">FIG. 9</figref> depicts one example of the ACL packet communication on the ACL link in which the maximum rate for the ACL packet length has been determined according to the procedure shown in <figref idref="DRAWINGS">FIG. 7</figref> under the same conditions as those shown in <figref idref="DRAWINGS">FIG. 17</figref>. In the example shown in <figref idref="DRAWINGS">FIG. 17</figref>, both the master and slave could transmit ACL packets corresponding to a length of five time slots. Suppose the token rate, one of the QoS parameters requested by both the master and slave sides is equal to the data arrival process shown in <figref idref="DRAWINGS">FIG. 17</figref>. In this case, the ratio between the token rates of the master and slave sides is 5:1. Thus, the maximum rate for the ACL packet length to be set in the master side is set equal to a length of five time slots. On the other hand, the maximum rate for the ACL packet length set in the slave side is:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>5×1/5=1,<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
according to the Equation (1), being set equal to a length of one time slot.
</p>
<p id="p-0069" num="0070">When the maximum rate for the ACL packet length is set according to the procedure shown in <figref idref="DRAWINGS">FIG. 7</figref>, time slots α, β and γ where data is not transferred shown in <figref idref="DRAWINGS">FIG. 17</figref> do not exist. This means that the ACL link resources are utilized more efficiently than the example shown in <figref idref="DRAWINGS">FIG. 17</figref>.</p>
<p id="p-0070" num="0071">In the meantime, when the maximum rate for the ACL packet length is set based only on the token rate of the request QoS parameters, violation is likely generated against the request QoS parameters other than the token rate. <figref idref="DRAWINGS">FIG. 10</figref> depicts ACL packet patterns transmitted by the slaves shown in <figref idref="DRAWINGS">FIGS. 17</figref> (a length of five time slots is set as the maximum rate for the ACL packet length) and <b>9</b> (a length of one time slot is set as the maximum rate for the ACL packet length) ((a) indicates the case of <figref idref="DRAWINGS">FIG. 17</figref> and (b) indicates the case of <figref idref="DRAWINGS">FIG. 9</figref>).</p>
<p id="p-0071" num="0072">To transmit the same data (it corresponds to a length of three time slots), time difference corresponding to a length of 10 time slots is generated to complete the entire data transfer in the example shown in <figref idref="DRAWINGS">FIG. 10</figref> between the cases where a length of five time slots is set as the maximum rate for the ACL packet length and where a length of one time slot is set. A length of a single time slot is 625 microseconds, and thus a 6.25 millisecond delay is generated when a length of one time slot is set as the maximum rate for the ACL packet length. At this time, when a rate shorter than 6.25 milliseconds is set as the QoS parameter latency requested by the slave side, it is violation.</p>
<p id="p-0072" num="0073">In the procedure shown in <figref idref="DRAWINGS">FIG. 7</figref>, only the token rate receives attention as the QoS parameter to determine the maximum rate for the ACL packet length, and thus the problem shown in <figref idref="DRAWINGS">FIG. 10</figref> is generated.</p>
<p id="p-0073" num="0074"><figref idref="DRAWINGS">FIG. 11</figref> depicts one example of the procedure in determining the maximum rate for the ACL packet length also taking into account of the QoS parameter latency in the ACL packet length control part <b>37</b>.</p>
<p id="p-0074" num="0075">In <figref idref="DRAWINGS">FIG. 11</figref>, Steps S<b>51</b> to S<b>54</b> are the same as the procedure shown in <figref idref="DRAWINGS">FIG. 7</figref>.</p>
<p id="p-0075" num="0076">In the procedure shown in <figref idref="DRAWINGS">FIG. 11</figref>, when the maximum rate for the ACL packet length selected at Step S<b>54</b> is used, it is examined whether the QoS parameter latency is also satisfied at the same time (Step S<b>55</b>). When it is determined that the maximum rate for the ACL packet length selected at Step S<b>54</b> is used to satisfy the latency at the same time, the rate is set as the maximum rate (Step S<b>56</b>). On the other hand, when it is determined not to satisfy the latency, the current maximum rate for the ACL packet length is increased by one rank (Step S<b>57</b>). More specifically, when a length of one time slot is selected as the current maximum rate for the ACL packet, it is corrected to three, whereas when a length of three time slots is selected, it is corrected to five. Then, it is examined again whether the latency can be satisfied (Step S<b>55</b>).</p>
<p id="p-0076" num="0077">In addition, not shown in <figref idref="DRAWINGS">FIG. 11</figref>, when the latency cannot be satisfied even though the maximum rate for the ACL packet length is set to any number, the L2CAP processing part <b>12</b> controls the request QoS parameters including the latency to be corrected.</p>
<p id="p-0077" num="0078">Here, in the BT device in which the maximum rate for the ACL packet length is set to a length of one time slot or a length of three time slots according to the procedures shown in <figref idref="DRAWINGS">FIGS. 7 and 11</figref>, the ACL link can be used more effectively by temporarily increasing the maximum rate for the ACL packet length when data transfer is suspended in the BT device to be a communication counterpart using the ACL link.</p>
<p id="p-0078" num="0079"><figref idref="DRAWINGS">FIG. 12</figref> depicts one example of the ACL packet communication when the maximum rate for the ACL packet length is temporarily increased in accordance with the temporary suspension of data transfer in the BT device to be the communication counterpart. Additionally, in <figref idref="DRAWINGS">FIG. 12</figref>, unshaded ACL packets (three packets transmitted by the BT device B) indicate that communication information is not described in the payload of the packets (only ACK information on the ACL packet last received is described).</p>
<p id="p-0079" num="0080">In the example shown in <figref idref="DRAWINGS">FIG. 12</figref>, the maximum rate for the ACL packet length is set to a length of one time slot in the BT device A and the maximum rate for the ACL packet length is set to a length of five time slots in the BT device B. Then, in the BT device A, it is determined that the BT device B does not have data to be transmitted by receiving the ACL packet not described with communication information in the payload from the BT device B. In the example shown in <figref idref="DRAWINGS">FIG. 12</figref>, the BT device A determines that the BT device B has temporarily suspended data transfer when it continuously receives two ACL packets not including communication information in the payload from the BT device B. Then, the BT device A sets the current maximum rate for the ACL packet length to a length of five time slots to create the following ACL packets and transmits them to the BT device B.</p>
<p id="p-0080" num="0081">When the BT device B restarts data transfer, the BT device A is to receive the ACL packets described with communication information in the payload. This cues the BT device A in again setting the maximum rate for the ACL packet length to the initial rate (a length of one time slot in the example shown in <figref idref="DRAWINGS">FIG. 12</figref>), creating the following ACL packets and transmitting them to the BT device B.</p>
<p id="p-0081" num="0082">As described above, in order to realize correcting the maximum rate for the ACL packet length in accordance with the temporary suspension of data transfer in the BT device to be the communication counterpart, the payload extracting part <b>35</b> (<figref idref="DRAWINGS">FIG. 3</figref>) determines at the step of reassembling the L2CAP packet from the received ACL packet whether the ACL packet contains payload information in the baseband processing part <b>11</b> of the BT device. When payload information is not contained, it is posted to the ACL packet length control part <b>37</b> (<figref idref="DRAWINGS">FIG. 3</figref>) (see <b>43</b> in <figref idref="DRAWINGS">FIG. 3</figref>).</p>
<p id="p-0082" num="0083">Furthermore, in the example shown in <figref idref="DRAWINGS">FIG. 12</figref>, it has been determined whether the BT device to be the communication counterpart is temporarily suspending data transfer based on whether the ACL packet with no payload information has been received. However, the same determination is feasible based on whether the BT device to be the communication counterpart has transmitted the ACL packet. In this case, the RX buffer <b>34</b> (<figref idref="DRAWINGS">FIG. 3</figref>) for receiving ACL packets determines whether the ACL packet has been received from the BT device to be the communication counterpart at a predetermined time slot. When it does not receive the ACL packet, it posts that to the ACL packet length control part <b>37</b> (<figref idref="DRAWINGS">FIG. 3</figref>) (see <b>44</b> in <figref idref="DRAWINGS">FIG. 3</figref>).</p>
<p id="p-0083" num="0084">Next, <figref idref="DRAWINGS">FIGS. 13 and 14</figref> depict the manner of retransmitting ACL packets when errors are generated in ACL packet transmission. In addition, the BT device A transmits data corresponding to a length of five time slots to the BT device B in both <figref idref="DRAWINGS">FIGS. 13 and 14</figref>, and errors are generated at the same time slots. Furthermore, in the example shown <figref idref="DRAWINGS">FIG. 13</figref>, data is transmitted in a single ACL packet <b>1</b> corresponding to a length of five time slots. In the example shown in <figref idref="DRAWINGS">FIG. 14</figref>, data is transmitted in five ACL packets A, B, C, D and E corresponding to a length of one time slot.</p>
<p id="p-0084" num="0085">Comparing the results shown in <figref idref="DRAWINGS">FIGS. 13 and 14</figref>, the ACL packet <b>1</b> is retransmitted twice (1′ and 1″), needing <b>13</b> time slots until transfer completion in <figref idref="DRAWINGS">FIG. 13</figref>.</p>
<p id="p-0085" num="0086">On the other hand, the ACL packets B and D are retransmitted for one time each, needing <b>14</b> time slots until transfer completion in <figref idref="DRAWINGS">FIG. 14</figref>. More specifically, when the ACL packet length is greater, retransmission information accompanying the generation of errors becomes greater, and thus time necessary to complete retransmission becomes greater. In wireless transmission, burst errors partially concentrated can be generated due to fading, but in this case, the frequency of retransmitting sending packets is extremely increased. On this account, also taking account of wireless transmission environments, it is necessary to dynamically change the maximum rate for the ACL packet length.</p>
<p id="p-0086" num="0087">Next, <figref idref="DRAWINGS">FIG. 15</figref> depicts the concept of changing the maximum rate for the ACL packet length due to the deterioration of transmission performance. Such changes are done that it is determined in the BT device whether transmission performance is deteriorated or transmission performance is not deteriorated and is normal, and the maximum rate for the ACL packet length is set to default (it is the maximum rate determined according to the procedure shown in <figref idref="DRAWINGS">FIG. 7</figref> or <b>11</b>), or the maximum rate for the ACL packet length is decreased (it is set equal to a length of one time slot).</p>
<p id="p-0087" num="0088">In addition, for the scheme of determining whether transmission performance is deteriorated, a method of referring acknowledge information described in the header of the ACL packet transmitted from the BT device to be a communication counterpart can be considered. The header of the ACL packet is provided with one-bit information (ARQN) indicating acknowledge. ARQN=1 indicates that reception has been done normally and ARQN=0 indicates that reception has not been done normally, whereby posting it to the sender BT device. For example, when the BT device receives the ACL packet of ARQN=0 for a predetermined times within fixed time, it determines that transmission performance is deteriorated, and it decreases the maximum rate for the sending ACL packet length. Furthermore, the BT device examines the ARQN rate of the received ACL packet after the maximum rate for the ACL packet length has been decreased. When it received no ACL packets of ARQN=0 within fixed time, it determines that the deterioration of transmission performance has been eliminated, and it returns the maximum rate for the sending ACL packet length to the set rate. Moreover, when a BT device does not receive the ACL packet that must contain acknowledge information for the transmitted ACL packet despite of requesting acknowledge information, the BT device assumes that it has received the ACL packet of ARQN=0.</p>
<p id="p-0088" num="0089">In addition, the function corresponding to the portion performing processing such as calculation and control among the components described above can be realized as software (in this case, the BT device is incorporated with a computer (a CPU and an MPU) and the built-in computer runs the software).</p>
<p id="p-0089" num="0090">Furthermore, the function corresponding to the portion performing processing such as calculation and control among the components described above can also be implemented as a program for allowing a computer to execute predetermined units (or for allowing a computer to function as predetermined units, or for allowing a computer to implement predetermined functions), which can be implemented as a computer readable medium recorded with the program as well.</p>
<p id="p-0090" num="0091">Moreover, the configuration shown in the embodiments is an example, which does not mean to exclude configurations other than that. Other configurations are also feasible such that a part of the configuration exemplified is replaced by another one, a part of the configuration exemplified is omitted, a part of the configuration exemplified is added with another function or element, or these are combined. Besides, the other configurations equivalent to the exemplified configuration, the other configurations including the portion logically equivalent to the exemplified configuration, and the other configurations including the portion logically equivalent to the essential portions of the exemplified configuration are feasible as well. In addition, the other configurations attaining purposes which are the same or similar to those in the exemplified configuration and the other configurations exerting advantages which are the same or similar to those in the exemplified configuration are also feasible.</p>
<p id="p-0091" num="0092">Furthermore, variations of each of the components exemplified in the embodiments of the invention can be combined and implemented properly.</p>
<p id="p-0092" num="0093">Moreover, the embodiments of the invention include and contain the inventions in various viewpoints, steps, concepts and categories such as the invention as discrete devices, the invention of two or more devices involved, the invention as the overall system, the invention of components in the discrete devices, and the invention of methods corresponding to them.</p>
<p id="p-0093" num="0094">Accordingly, the invention can be extracted from the contents disclosed in the embodiments of the invention without limiting to the exemplified configurations.</p>
<p id="p-0094" num="0095">The invention is not limited to the embodiments described above, which can be modified variously in the technical scope.</p>
<p id="p-0095" num="0096">According to the invention, the ACL link resources can be utilized effectively in transmitting and receiving data in ACL packets after the Bluetooth standard is used to establish the ACL link.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method of packet transmission between a first communication device and a second communication device after a link is established by short-range wireless communications, the method of packet transmission comprising:
<claim-text>receiving a first rate from the second communication device, the first rate is requested by the second communication device in transferring data to the first communication device from the second communication device;</claim-text>
<claim-text>preparing a second rate representing a rate of the data transfer from the first communication device to the second communication device; and</claim-text>
<claim-text>determining a maximum packet size of a packet to be transmitted to the second communication device from the first communication device based on a ratio of the first rate to the second rate stored in the first communication device in transferring data to the second communication device from the first communication device, wherein the short-range wireless communications are based on the Bluetooth standard, the link is an ACL link (Asynchronous Connection-Less), and the packet is an ACL packet, in which the ACL packet is transmitted per time slot obtained by time division of a physical channel, and the first communication device compares the first rate with the second rate,</claim-text>
<claim-text>when the second rate is not smaller than the first rate, the maximum rate for the ACL packet size transmitted by the first communication device is set so as to occupy a largest time slot rate among candidates of the maximum rate for time slot size occupiable by the ACL packet, and</claim-text>
<claim-text>when the second rate is smaller than the first rate, a rate closest to a rate U among the candidates of the maximum rate for time slot size occupiable by the ACL packet is selected and set as the maximum rate for time slot number occupiable by the ACL packet transmitted by the first communication device based on the rate U obtained by U=N×S/T where the time slot rate is N, the first rate is S, and the second rate is T, and the maximum rate for ACL packet size transmitted by the first communication device is set so as to conform the maximum rate for time slot number.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of packet transmission according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein as the maximum rate for time slot number occupiable by the ACL packet transmitted by the first communication device, a minimum rate above the rate U is selected and set from the candidates of the maximum rate for time slot size occupiable by the ACL packet.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of packet transmission according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the candidates of the maximum rate for time slot size occupiable by the ACL packet are those extracting only occupiable time slot sizes from time slots excluding time slots currently reserved for an SCO link among rate <b>1</b>, <b>3</b> and <b>5</b>.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of packet transmission according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein when receiving no ACL packet containing payload information from the second communication device for fixed time, the first communication device changes the maximum rate for ACL packet size transmitted by the first communication device to the largest time slot rate N among the candidates of the maximum rate for time slot size occupiable by the ACL packet, and
<claim-text>when again receiving an ACL packet containing payload information from the second communication device after this change, the first communication device returns the maximum rate for packet size transmitted by the first communication device to the rate before the change.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of packet transmission according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein when determining that transmission performance is deteriorated in the ACL link established with the second communication device, the first communication device decreases the maximum rate for ACL packet size transmitted by the first communication device, and
<claim-text>when determining that the deterioration of transmission performance is avoided in the ACL link established with the second communication device after this decrease, the first communication device returns the maximum rate for ACL packet size transmitted by the first communication device to the rate before the decrease.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of packet transmission according to <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein the first communication device determines whether transmission performance is deteriorated in the ACL link established with the second communication device, based on acknowledge information to the ACL packet already sent from the first communication device, the acknowledge information is sent from the second communication device.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method of packet transmission according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the candidates of the maximum rate for time slot size occupiable by the ACL packet are those extracting only occupiable time slot sizes from time slots excluding time slots currently reserved for an SCO link among rate <b>1</b>, <b>3</b> and <b>5</b>.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method of packet transmission according to <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein when determining that transmission performance is deteriorated in the ACL link established with the second communication device, the first communication device decreases the maximum rate for ACL packet size transmitted by the first communication device, and
<claim-text>when determining that the deterioration of transmission performance is avoided in the ACL link established with the second communication device after this decrease, the first communication device returns the maximum rate for ACL packet size transmitted by the first communication device to the rate before the decrease.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The method of packet transmission according to <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the first communication device determines whether transmission performance is deteriorated in the ACL link established with the second communication device, based on acknowledge information to the ACL packet already sent from the first communication device, the acknowledge information is sent from the second communication device.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The method of packet transmission according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein when receiving no ACL packet containing payload information from the second communication device for fixed time, the first communication device changes the maximum rate for ACL packet size transmitted by the first communication device to the largest time slot rate N among the candidates of the maximum rate for time slot size occupiable by the ACL packet, and
<claim-text>when again receiving an ACL packet containing payload information from the second communication device after this change, the first communication device returns the maximum rate for ACL packet size transmitted by the first communication device to the rate before the change.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The method of packet transmission according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein when determining that transmission performance is deteriorated in the ACL link established with the second communication device, the first communication device decreases the maximum rate for ACL packet size transmitted by the first communication device, and
<claim-text>when determining that deterioration of transmission performance is avoided in the ACL link established with the second communication device after this decrease, the first communication device returns the maximum rate for ACL packet size transmitted by the first communication device to the rate before the decrease.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. A wireless communication device comprising:
<claim-text>a short-range wireless communication unit adapted to transmit and receive data in a packet after a link is established with the other wireless communication device;</claim-text>
<claim-text>a receiving unit adapted to receive a first data transfer rate requested by the other wireless communication device established with the link;</claim-text>
<claim-text>a determining unit adapted to determine a maximum rate for packet size to be transmitted to the other wireless communication device based on a ratio between a second data transfer rate to the other wireless communication device and the first data transfer rate, the second data transfer rate stored in the wireless communication device, wherein the short-range wireless communication unit transmits and receives data based on the maximum rate for packet size to be transmitted to the other wireless communication device, the maximum rate is determined by the determining unit, and wherein the short-range wireless communications are based on Bluetooth™ standard, the link is an ACL link (Asynchronous Connection-Less), and the packet is an ACL packet, in which the ACL packet is transmitted per time slot obtained by time division of a physical channel; and</claim-text>
<claim-text>a comparing unit adapted to compare the first data transfer rate with the second data transfer rate, wherein when the second data transfer rate is not smaller than the first data transfer rate, the maximum rate for ACL packet size transmitted by the wireless communication device is set so as to occupy a largest time slot rate among candidates of the maximum rate for time slot size occupiable by the ACL packet, and</claim-text>
<claim-text>when the second requested rate is smaller than the first requested rate, a rate closest to a rate U among candidates of the maximum rate for time slot size occupiable by the ACL packet is selected and set as the maximum rate for time slot number occupiable by the ACL packet transmitted by the wireless communication device based on the rate U obtained by U=N×S/T, where the time slot rate is N, the first data transfer rate is S, and the second data transfer rate is T, and the maximum rate for the ACL packet size transmitted by the wireless communication device is set so as to conform the maximum rate for time slot number.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The wireless communication device according to <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein as the maximum rate for time slot number occupiable by the ACL packet transmitted by the wireless communication device, a minimum rate above the rate U is selected and set from the candidates of the maximum rate for time slot size occupiable by the ACL packet.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The wireless communication device according to <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein the candidates of the maximum rate for time slot size occupiable by the ACL packet are those extracting only occupiable time slot sizes from time slots excluding time slots currently reserved for an SCO link among rate <b>1</b>, <b>3</b> and <b>5</b>.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The wireless communication device according to <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein when an ACL packet containing payload information is not received from the other wireless communication device for fixed time, the maximum rate for ACL packet size transmitted by the wireless communication device is changed to the largest time slot rate N among the candidates of maximum rate for time slot size occupiable by the ACL packet, and
<claim-text>when an ACL packet containing payload information is again received from the other wireless communication device after this change, the maximum rate for ACL packet size transmitted by the wireless communication device is returned to the rate before the change.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The wireless communication device according to <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein when transmission performance is deteriorated in the ACL link established with the other wireless communication device, the maximum rate for ACL packet size transmitted by the wireless communication device is decreased, and
<claim-text>when the deterioration of transmission performance is avoided in the ACL link established with the other wireless communication device after this decrease, the maximum rate for ACL packet size transmitted by the wireless communication device is returned to the rate before the decrease.</claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
