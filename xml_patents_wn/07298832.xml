<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07298832-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07298832</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>11221306</doc-number>
<date>20050907</date>
</document-id>
</application-reference>
<us-application-series-code>11</us-application-series-code>
<us-term-of-grant>
<us-term-extension>2</us-term-extension>
<disclaimer>
<text>This patent is subject to a terminal disclaimer.</text>
</disclaimer>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>M</subclass>
<main-group>15</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>379137</main-classification>
<further-classification>379133</further-classification>
<further-classification>379139</further-classification>
<further-classification>37911206</further-classification>
<further-classification>370493</further-classification>
</classification-national>
<invention-title id="d0e55">Method for determining concurrent voice over IP calls</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5696809</doc-number>
<kind>A</kind>
<name>Voit</name>
<date>19971200</date>
</document-id>
</patcit>
<category>cited by other</category>
<classification-national><country>US</country><main-classification>379 2201</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5999604</doc-number>
<kind>A</kind>
<name>Walter</name>
<date>19991200</date>
</document-id>
</patcit>
<category>cited by other</category>
<classification-national><country>US</country><main-classification>379133</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6028914</doc-number>
<kind>A</kind>
<name>Lin et al.</name>
<date>20000200</date>
</document-id>
</patcit>
<category>cited by other</category>
<classification-national><country>US</country><main-classification>379 14</main-classification></classification-national>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>6333931</doc-number>
<kind>B1</kind>
<name>LaPier et al.</name>
<date>20011200</date>
</document-id>
</patcit>
<category>cited by other</category>
<classification-national><country>US</country><main-classification>370385</main-classification></classification-national>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>6381306</doc-number>
<kind>B1</kind>
<name>Lawson et al.</name>
<date>20020400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>379 3201</main-classification></classification-national>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>6385301</doc-number>
<kind>B1</kind>
<name>Nolting et al.</name>
<date>20020500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>379 3201</main-classification></classification-national>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>6954520</doc-number>
<kind>B1</kind>
<name>Lang et al.</name>
<date>20051000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>379137</main-classification></classification-national>
</citation>
</references-cited>
<number-of-claims>6</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>37911201</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>37911206</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>37911207</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>37911208</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>37911401</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>379126</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>379133</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>379134</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>379137</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>379139</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370493</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370495</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370496</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>3</number-of-drawing-sheets>
<number-of-figures>4</number-of-figures>
</figures>
<us-related-documents>
<continuation>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>10403178</doc-number>
<kind>00</kind>
<date>20030328</date>
</document-id>
<parent-grant-document>
<document-id>
<country>US</country>
<doc-number>6954520</doc-number>
<kind>A </kind>
</document-id>
</parent-grant-document>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>11221306</doc-number>
</document-id>
</child-doc>
</relation>
</continuation>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20060002534</doc-number>
<kind>A1</kind>
<date>20060105</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Lang</last-name>
<first-name>Howard L.</first-name>
<address>
<city>Holmdel</city>
<state>NJ</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Woerner</last-name>
<first-name>Eric M.</first-name>
<address>
<city>Burlington Township, Burlington County</city>
<state>NJ</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="003" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Voets</last-name>
<first-name>Jaap</first-name>
<address>
<city>Maarssen</city>
<country>NL</country>
</address>
</addressbook>
<nationality>
<country>NL</country>
</nationality>
<residence>
<country>NL</country>
</residence>
</applicant>
</applicants>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>AT&amp;T Corp</orgname>
<role>02</role>
<address>
<city>New York</city>
<state>NY</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Tran</last-name>
<first-name>Quoc</first-name>
<department>2614</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A method employs call detail records for developing a report on the usage of VoIP calling along a network path or through a network location. By utilizing, for example, a call-beginning record and a call-ending record for each connection, a report is created of the number of concurrent VoIP calls that a specified equipment or network path carries at any given instance by retrieving batches of stored call detail records, culling the records that are relevant to the specified equipment or network path, considering the culled records in a time sorted manner, and incrementing or decrementing a counter based on whether a considered record is a call-beginning record or a call-ending record, respectively. The state of the counter is reported, illustratively, as a line entry each time the counter's state is modified.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="145.03mm" wi="104.56mm" file="US07298832-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="188.81mm" wi="147.57mm" file="US07298832-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="203.03mm" wi="162.14mm" file="US07298832-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="217.17mm" wi="137.92mm" file="US07298832-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">RELATED APPLICATIONS</heading>
<p id="p-0002" num="0001">This is a continuation of U.S. patent application Ser. No. 10/403,178, filed Mar. 28, 2003 now U.S. Pat. No. 6,954,520.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0003" num="0002">This invention relates to IP telephony and, more particularly, to method and apparatus for insuring that IP telephony is carried out in a manner that is effective for customers.</p>
<p id="p-0004" num="0003">Conventionally, a business enterprise's telephonic interactions with customers, providers, and branches of the enterprise are conducted through a PBX having trunks that connect the PBX trunks to the local public switched network. The local network is connected to an inter-exchange carrier's network, and to the network of international telephone service providers. The business enterprise's computer interactions are typically conducted through a corporate local area network, or wide area network, followed by a digital network (often, via a gateway) which, typically, is a packet network. This may be an Asynchronous Transfer Mode (ATM) network, an IP network, Frame Relay network, or some other network. Through software control a segregated network is sometimes created within the general-use packet network, and such segregated networks are called Virtual Private Networks (VPNs). Business enterprises often purchase such VPNs with a certain load carrying capability.</p>
<p id="p-0005" num="0004">In recent years the notion of IP telephony has been making inroads into the realm of telephone communications, where telephone calls are digitized, and are carried over the same network as computer interactions. Relative to situations where a customer has resources for data communication and separate resources for voice communication, combining data and voice so that a single resource may be used sometimes has a cost advantage because resources can be utilized more efficiently. Moreover, utilizing the network that was previously dedicated for computer communications has the advantage of bypassing toll charges from inter-exchange carriers and international telephone service providers. In a business enterprise environment, this is achieved by dedicating a number of trunks of the PBX to Internet telephony, and connecting those trunks to a voice-enabled Internet router, for example, a router manufactured by Cisco Systems. The voice-enabled router includes interface circuitry that effects encoding of an analog telephone call to digital to permit transfer over the IP network, and then decoding back to analog at the receiving side. The function is bidirectional, permitting full duplex phone conversations. Since this interface circuitry is conventional, its precise structure is not relevant to the principles disclosed herein and, therefore, it is not further described herein.</p>
<p id="p-0006" num="0005"><figref idref="DRAWINGS">FIG. 1</figref> presents a block diagram of such an arrangement, comprising packet network <b>100</b> and PSTN <b>200</b>, which illustratively, is made up of a first domestic transport network, <b>210</b>, a second domestic transport network, <b>230</b>, and international transport network <b>220</b>. Calls between telephone <b>11</b> in New York City, for example, and telephone <b>15</b> in Sao Paulo, for example, traverse PBX <b>21</b> and networks <b>210</b>, <b>220</b>, and <b>230</b>. More specifically, when telephone <b>11</b> wishes to establish a call to telephone <b>15</b>, a process within PBX <b>21</b> decides whether the call ought to be made via PSTN <b>200</b>, and if so, PBX <b>21</b> outputs the call on one of the trunks that is connected to switch <b>211</b>, and thence the conventional call establishment process takes over. That is, the call is extended to switch <b>211</b> in network <b>210</b>, then to international network <b>220</b>, then to domestic network <b>230</b> and to switch <b>232</b> within it, and lastly to PBX <b>25</b>. PBX <b>25</b> connects to telephone <b>15</b>.</p>
<p id="p-0007" num="0006">When the process within PBX <b>21</b> decides that the call ought to be made via packet network <b>100</b>, it outputs the call on one of the trunks (<b>22</b>) that is connected to interface circuitry <b>311</b> in voice-enabled router <b>31</b> in, or near, the location of telephone <b>11</b>, i.e., in, or near, New York City. In accordance with known voice-over-IP (VoIP) techniques a packet flow is established between interface circuitry <b>311</b> and interface circuitry <b>321</b> within voice-enabled router <b>32</b> that is in, or near, Sao Paulo, and interface circuitry <b>321</b> output signals on a trunk line <b>34</b> that connects to PBX <b>25</b>.</p>
<p id="p-0008" num="0007">Generally speaking, a router such as router <b>32</b> can have a multiple number of output port groupings, and each grouping is connected to a different PBX and, conversely, a PBX can be connected to a number of routers. <figref idref="DRAWINGS">FIG. 1</figref> shows two trunk groupings from router <b>32</b> (one connected directly to PBX <b>25</b>, and one connected to switch <b>231</b>, to demonstrate that connection of a voice-enabled router <b>32</b> is not limited to a PBX (such as PBX <b>25</b>).</p>
<p id="p-0009" num="0008">In operation, when PBX <b>21</b> receives the telephone number of called party <b>15</b> and decides to route the call through packet network <b>100</b>, router <b>31</b> identifies the trunk grouping at the output of router <b>32</b> that needs to be addressed, and addresses packets to that trunk grouping; i.e., to trunk grouping <b>34</b>. When the packets arrive at router <b>32</b>, they are converted to the format acceptable to PBX <b>25</b>, directed to trunk grouping <b>34</b>, and applied to PBX <b>25</b>. The data thus provided to PBX <b>25</b> includes the called party's telephone number, and PBX <b>25</b> establishes a connection to telephone <b>15</b>.</p>
<p id="p-0010" num="0009">If the destination telephone (of the call made by telephone <b>11</b>) is telephone <b>12</b>, which is not behind a PBX, as is telephone <b>15</b>, the principles of this invention still apply. Router <b>31</b> identifies that trunk grouping <b>35</b>, the destination information is provided to switch <b>32</b>, switch <b>32</b> routes the incoming call to switch <b>231</b> in domestic transport network <b>230</b>, and through network <b>230</b> to switch <b>232</b>, which establishes a connection to telephone <b>12</b>. It is noted that since telephone <b>12</b> is not behind a PBX that can make decisions as to whether to complete a call using the PSTN network or the IP network, the operation is not symmetric; that is, calls initiated by telephone <b>11</b> can enjoy the benefits of this invention, but calls initiated by telephone <b>12</b> cannot.</p>
<p id="p-0011" num="0010">This asymmetry can be rectified, of course, by embedding the decision-making capacity of PBXs <b>21</b> and <b>25</b> within switch <b>232</b>.</p>
<p id="p-0012" num="0011">It may also be mentioned that some, or all, of the telephones that can gain access to the <figref idref="DRAWINGS">FIG. 1</figref> routers can be IP telephones, reducing the data conversion burdens of the voice-enabled routers.</p>
<p id="p-0013" num="0012">One issue, of course, relates to the above-mentioned decision: when ought a call be established via network <b>100</b>, and when via network <b>200</b>. Cost and availability of a channel are the primary factors and, hence, it is desirable to provide a means for determining the effectiveness of the hard-wired split, i.e., the number of PBX <b>21</b> trunks that are connected to switch <b>211</b> and the number of PBX <b>21</b> trunks that are connected to interface circuitry <b>41</b>.</p>
<heading id="h-0003" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0014" num="0013">An advance in the art is achieved with an arrangement that employs call detail records for developing a report on the usage of VoIP calling between equipment that connects to a packet network; for example, the peak simultaneous usage of a voice-enabled router connected to an IP network. By using information from call detail records (CDRs) such as a call-beginning record and a call-ending record, which contains call origin and destination information, a report is created of the number of concurrent VoIP calls that a specified equipment carries at any given time. This report is created by retrieving batches of stored call detail records, culling out the records that are relevant to the specified equipment and time interval, considering the culled records in a time sorted manner, and incrementing or decrementing a counter based on whether a considered record is a call-beginning record or a call-ending record, respectively. The state of the counter is reported, illustratively, as a line entry or bar chart, each time the counter's state is modified.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 1</figref> presents a block diagram of an arrangement that permits voice calls to be carried by PSTN, or by a packet network;</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 2</figref> depicts an arrangement that permits monitoring occupancy performance of elements in the packet network;</p>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 3</figref> presents a flowchart of a process for monitoring the occupancy performance; and</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 4</figref> gives a graphical example of a report created by the <figref idref="DRAWINGS">FIG. 3</figref> process.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0019" num="0018">Although <figref idref="DRAWINGS">FIG. 1</figref> does not explicitly show it, it might be useful to point out that IP telephony, circa <b>2003</b>, has an advantage over traditional telephony, in that, often, the costs for IP telephony are based on the provided capacity (i.e., the maximum number of simultaneous calls that can be carried by the provided channel—the restricted resource), rather than on “per minute” charges. In order to establish a packet flow between an input port of interface circuit <b>311</b> and an output port of interface circuit <b>321</b>, one must establish a correspondence between the telephone number of the desired called party, i.e., the telephone number of telephone <b>15</b> is Sao Paulo, and the IP address of a router that has a trunk connection to PBX <b>25</b>, i.e., the IP address of interface circuitry <b>321</b>. Neither PBX <b>21</b> nor router <b>31</b> has this information. This information is available, however, to an entity whose business is to establish VoIP calls, and router <b>31</b> may, indeed, be under control of this entity. Thus, by accessing a database, router <b>31</b> obtains the tuple number of telephone <b>15</b>: IP address of router <b>321</b>.</p>
<p id="p-0020" num="0019">In an arrangement where router <b>32</b> is also under control of an entity that provides VoIP, when a call establishment request that specifies the telephone number of telephone <b>15</b> in Sao Paulo is forwarded to router <b>32</b>, interface circuitry <b>321</b> accesses a database, the latter identifies trunk grouping <b>34</b>, and a packet flow is established. The VoIP provider charges for its service and also charges for the number of trunks that are connected from PBX <b>21</b> to router <b>31</b> (because the total number of interface circuits <b>31</b> that a router has is limited).</p>
<p id="p-0021" num="0020">One issue that a business enterprise needs to resolve is what is the appropriate number of router-connected PBX trunks that should be acquired/leased. When the maximum number of VoIP channels are in use, any excess voice calls must be routed differently which, presumably, are more expensive options, such as the public switched telephone network (PSTN), cellular telephone systems, packet networks of other providers, etc. If the number of simultaneous VoIP calls that can be carried is much greater than actual usage, then the fixed costs are higher. The challenge in addressing this issue is to identify the load that is experienced by router-connected PBX trunks, so as to properly size the VoIP network</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 2</figref> presents a block diagram of an arrangement that provides a means for determining the load that is experienced by equipment that is used for VoIP, such as the set of trunks that connects PBX <b>21</b> to interface circuitry <b>311</b>. The <figref idref="DRAWINGS">FIG. 2</figref> arrangement includes the elements found in <figref idref="DRAWINGS">FIG. 1</figref> (though not all shown), and includes the additional elements of a Call Record Acquisition (CRA) module that is associated with each voice-enabled router. Illustratively, router <b>31</b> has an associated CRA <b>41</b>, router <b>32</b> has an associated CRA <b>42</b>, voice-enabled router <b>34</b> has an associated CRA <b>44</b> to which PBX <b>24</b> and telephone <b>14</b> (in Detroit) connect, and voice-enabled router <b>33</b> has an associated CRA <b>43</b> to which PBX <b>23</b> and telephone <b>13</b> (in Tokyo) connect.</p>
<p id="p-0023" num="0022">Additionally, the <figref idref="DRAWINGS">FIG. 2</figref> arrangement includes a Management Information System (MIS) network <b>300</b> from which all of the CRAs can be accessed, regional Cisco Voice Manager (CVM) servers that are connected to network <b>300</b>, of which server <b>50</b> (in Raleigh) and server <b>51</b> (in Tokyo) are shown, and Network Performance Reporter (NPR) <b>60</b> that is also connected to network <b>300</b>.</p>
<p id="p-0024" num="0023">Operationally, call detail records (CDRs) are created within the CRAs. For purposes of this disclosure, the records may be created according to a number of algorithms. One algorithm, for example, creates a record at the beginning of an established call, and another record at the end of an established call, each with a flag that identifies the record as a call beginning record or as a call-ending record. These records can be considered together (combined physically, or merely logically) and treated as a single CDR tuple. Alternatively, a single record is created, at the time of a call's completion, identifying the call's start time, and its duration, as well as the call's origin and destination. Such a record can also be considered as a CDR tuple, from which two individual CDRs can be derived, if necessary. The former approach is employed herein; that is, each CRA creates a record at the beginning of a call that comprises a call ID that identifies the telephone that is involved in the call (for charging purposes), and information about equipment that is interposed between the telephone and the voice-enabled router, time of day in a preselected time zone, e.g., GMT time, and a +1 flag (to indicate call commencement); and a record at the end of a call that comprises the same call ID, the time of day, and a −1 flag (to indicate call termination).</p>
<p id="p-0025" num="0024">It may be noted that each call has an originating point with its associated router, and a destination point with its associated router. Since a sense of the number of concurrent established calls is independent of whether a router carries a call by virtue of it the originating point's router, or by virtue of it being the destination point's router, it follows that each call engenders two CDRs; one relative to the originating router (e.g., <b>31</b>), and one relative to the destination router (e.g., <b>32</b>). In this manner, a report can be created that reveals the number of concurrent established calls at each router.</p>
<p id="p-0026" num="0025">At times it may be desirable to create a report that identifies the number of concurrent calls that exist between two selected routers. To provide for such a report, each CDR carries an ID that relates to the call itself, which results in a CDR of a call at the originating router having the same ID (or a portion thereof) as the ID of the CDR of the same call at the destination router. To give a mere example, the ID, or a portion of the ID might comprise the concatenation of the originating telephone's number and the terminating telephone's number.</p>
<p id="p-0027" num="0026">The records created in the CRAs are communicated to prearranged regional CVM servers by having each regional CVM server poll a predetermined set of CRAs. For example, CVM <b>50</b> polls all of the CRAs in the United States, and CVM <b>51</b> polls all of the CRAs in Japan. The polling is carried out periodically, for example, every hour, and the CDRs that are collected by the polling process are forwarded, also periodically, to NPR <b>60</b>; for example, once a day. NPR <b>60</b> analyzes the data and creates reports, such as disclosed below.</p>
<p id="p-0028" num="0027">In order to determine the VoIP load relative to a particular piece of equipment, a process not unlike the one depicted in <figref idref="DRAWINGS">FIG. 3</figref> may be executed, for example, in NPR <b>60</b>. Here, too, numerous methodologies may be employed. For example, a report for each piece of equipment may be updated each time a batch of data is delivered to NPR <b>60</b>. Alternatively, a report may be created for a given piece of equipment, and for a selected period of time, on an “as needed” basis.</p>
<p id="p-0029" num="0028">In connection with the second method, where a report is created on an “as needed basis,” data is retrieved from the storage means within NPR <b>60</b> when a report is requested. Obviously it is desirable to retrieve as little data as is necessary, but in embodiments where two CDRs are created for each call (a call-beginning CDR, and a call-ending CDR) a problem arises in that whatever instance is selected at the initial point in time from which data is retrieved, there are conversations in progress, so one might need to back-up in time. This problem is overcome herein by noting that data is retrieved by the regional CVM servers from the CRAs in batches, that data is obtained by the NPR in batches (albeit, not necessarily the same time-interval batches), and by observing that obtained data can be stored by the NPR in batches that are augmented to accommodate the need for having call-beginning CDRs for all calls that are active at the time corresponding to the beginning of a stored batch. The size of these augmented batches (i.e., their start and end times) need not be related to either the batches retrieved from the CRA, or the batches sent to NPR <b>60</b>. However, it may be convenient for NPR <b>60</b> to augment the batches received by NPR <b>60</b> as they arrive and are stored in a storage means within NPR <b>60</b>.</p>
<p id="p-0030" num="0029">The important point to note is that whatever batch storing granularity is employed, a number of virtual call-beginning records need to be included at each batch storing time to account for calls that are in progress at the beginning of the considered batch.</p>
<p id="p-0031" num="0030">To illustrate, assume that NPR <b>60</b> polls the set of CVM once a day (e.g., at 0:00 GMT), and assume further that the batch granularity selected for NPR <b>60</b> is also 24 hours, synchronized to the daily receipt of data at NPR <b>60</b>. When NPR <b>60</b> obtains a set of CDRs, for example at 0:00 GMT of Sep. 12, 2002, it passes the received records through a checkpoint in their way to storage as batch 09122002. Each call-beginning CDR that passes the checkpoint is copied into a checkpoint buffer, and each call-ending CDR that passes the checkpoint erases from the checkpoint buffer the corresponding, previously copied, call-beginning CDR. Thus, when the storage of batch 09122002 is complete, the checkpoint buffer contains a copy of the CDR records of calls that began (actually, or virtually) during batch 09122002 but did not terminate. At the next batch storing process, that is, when batch 09132002 CDR records are stored, the records stored in the checkpoint buffer are pre-pended to batch 09132002. These are the aforementioned virtual call-beginning records that augment the batch stored for Sep. 13, 2002; i.e., stored for batch 09132002.</p>
<p id="p-0032" num="0031">It may be noted briefly that the other method for creating CDR tuples, where each tuple comprises the end time and a duration, there is no need to augment the stored batch because a call-beginning CDR can be created for each encountered call-ending CDR, but this approach has a finite likelihood of errors, which arise from calls that began prior to the time interval of interest but do not end within the time interval of interest.</p>
<p id="p-0033" num="0032"><figref idref="DRAWINGS">FIG. 3</figref> presents an illustrative process for determining the VoIP load, during any chosen time interval. At step <b>101</b> one identifies the equipment relative to which the analysis is performed, and in step <b>102</b>, which follows, a collection of CDR batches is retrieved from the storage means of NPR <b>60</b>, corresponding to the desired analysis time interval. The collection of batches, which encompasses both the start time of the interval of interest and the end time of the interval of interest, can be viewed as a single set of records CDR(i), i=1,2, . . . N, where N is the total number of records in the collection of batches. Control then passes to step <b>103</b>, which sorts the records by time of call beginnings, and thence to step <b>105</b>, which sets index i to 1 and passes control to step <b>106</b>. Step <b>106</b> ascertains whether the CDR(i) record pertains to the equipment specified in step <b>101</b>. If not, control passes to step <b>110</b>, which increments index i and returns control to step <b>106</b>. Otherwise, control passes to step <b>107</b>, which updates a counter. Specifically, if the CDR flag is a +1, step <b>107</b> increments the counter, and if the CDR flag is a −1, step <b>107</b> decrements the counter. Control then passes to step <b>108</b>, which creates a line entry in a report that specifies the count value of the counter and the time of the CDR record that updated the counter. Control then passes to step <b>109</b>, which returns control to step <b>110</b>, unless it determines that all of the retrieved records were considered.</p>
<p id="p-0034" num="0033">Data that is generated by the step <b>108</b> report, when presented graphically, appears like an amplitude-quantized signal with number of concurrent calls on the ordinate, and time on the abscissa, not unlike what is depicted in <figref idref="DRAWINGS">FIG. 4</figref>. The discontinuities along the abscissa occur at times of call beginnings and call-endings. Various parameters can be easily derived from this data, such as the number of concurrent calls at a specified time, the average number of concurrent calls, the maximum and minimum number of concurrent calls, standard deviation, etc. In other words, the object of this disclosure to provide a means for informing customers about the efficacy of their contract for a given number of trunks from, for example, PBX <b>21</b> to router <b>31</b> is clearly achieved. Knowing, for example, the average number of these trunks that are occupied at any one time, or the pattern of usage, can enable customers to more effectively utilize their communications budget. This can take the form of contracting for more trunks, contracting for fewer trunks, adding, or subtracting destinations to which PBX <b>21</b> tries to connect via network <b>100</b>, or even controlling the set of these destinations based on time of day. For example, PBX <b>21</b> may be set to assign a larger number of destinations to VoIP mode calls before 9 AM and after 4 PM, then during the peak workday usage.</p>
<p id="p-0035" num="0034">A skilled artisan would realize that the disclosed process for monitoring the number of concurrent calls that pass through a piece of equipment is limited solely by the information contained in the call ID field, and that various modifications can be made to the field, or other fields of the CDRs to provide additional capabilities. It should also be realized that while it is NPR <b>60</b> that creates the reports in the above-disclosed arrangement, that is not a requirement. For example, each one of the CVMs can be assigned the task of creating reports. Of course, if a report is desired for the entire network, covering more than one region, then it is more convenient to use NPR <b>60</b> to create the necessary report. Still further, it should be realized that the process depicted in <figref idref="DRAWINGS">FIG. 3</figref> first sorts records and then culls out the relevant ones, but the process can be reversed; that is, have the records culled first, and then sorted. Lastly, it may be pointed out that the CDRs are created not only at the CRA of the calling party's router, but also at the CRA of the called party's router, independently of who pays for the calls.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>The invention claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method for developing a report on usage of voice-over-Internet (VoIP) calling between network equipment that connects to a packet network and network paths that said equipment uses to connect to the packet network comprising the steps of:
<claim-text>collecting call detail records (CDRs) having an identifier that permits segregating call detail records based on said specified piece of equipment or network path, which call detail records are adapted to yield call-beginning information, or call-ending information, or both;</claim-text>
<claim-text>conditioning said collected CDR by employing a process of culling CDRs that pertain to said network equipment that connects to a packet network and network paths that said equipment uses to connect to the packet network, and a process for permitting said CDRs to be considered in time-ordered manner, said conditioning executing said processes in any chosen order; and</claim-text>
<claim-text>employing the conditioned CDR to identify VoIP calls from call origin and destination information contained in said CDRs, and developing therefrom a report of concurrent VoIP calls that said equipment carries.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> where said collecting is for a specified time interval, and said report identifies number of concurrent established VoIP calls pertaining to said specified piece of equipment or network path.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> where each CDR includes an identifier.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00003">claim 3</claim-ref> where the identifier of a CDR resulting from a call carried by a piece of equipment in said network or network path in said network where said call originates (ID-A), and the identifier of a CDR resulting from said call carried by a piece of equipment in said network or network path in said network where said call terminates (ID-B) contain information is used to identify pairs of CDRs relating to the same call.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method according to <claim-ref idref="CLM-00002">claim 2</claim-ref> where said developing of the report increments a counter when a considered CDR provides call-beginning information, and decrements said counter when said considered CDR provides call-ending information.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method according to <claim-ref idref="CLM-00005">claim 5</claim-ref> where said developing the report augments state of the counter to account for calls that are in progress at beginning of said interval.</claim-text>
</claim>
</claims>
</us-patent-grant>
