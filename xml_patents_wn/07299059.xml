<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07299059-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07299059</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>11030334</doc-number>
<date>20050107</date>
</document-id>
</application-reference>
<us-application-series-code>11</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>FI</country>
<doc-number>20021357</doc-number>
<date>20020710</date>
</priority-claim>
</priority-claims>
<us-term-of-grant>
<us-term-extension>371</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>Q</subclass>
<main-group>7</main-group>
<subgroup>20</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>B</subclass>
<main-group>17</main-group>
<subgroup>00</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>455457</main-classification>
<further-classification>4554561</further-classification>
<further-classification>4554565</further-classification>
<further-classification>455 6711</further-classification>
<further-classification>455 677</further-classification>
</classification-national>
<invention-title id="d0e71">Positioning technique</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5781150</doc-number>
<kind>A</kind>
<name>Norris</name>
<date>19980700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>6263208</doc-number>
<kind>B1</kind>
<name>Chang et al.</name>
<date>20010700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>4554563</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6269246</doc-number>
<kind>B1</kind>
<name>Rao et al.</name>
<date>20010700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>6275186</doc-number>
<kind>B1</kind>
<name>Kong</name>
<date>20010800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>6393294</doc-number>
<kind>B1</kind>
<name>Perez-Breva et al.</name>
<date>20020500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>6397073</doc-number>
<kind>B1</kind>
<name>Hottinen</name>
<date>20020500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>6477380</doc-number>
<kind>B1</kind>
<name>Uehara et al.</name>
<date>20021100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>4554561</main-classification></classification-national>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>6782265</doc-number>
<kind>B2</kind>
<name>Perez-Breva et al.</name>
<date>20040800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2003/0064735</doc-number>
<kind>A1</kind>
<name>Spain et al.</name>
<date>20030400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>455456</main-classification></classification-national>
</citation>
<citation>
<patcit num="00010">
<document-id>
<country>EP</country>
<doc-number>1 022 578</doc-number>
<kind>A2</kind>
<date>20000700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00011">
<document-id>
<country>JP</country>
<doc-number>H10-051840</doc-number>
<kind>A</kind>
<date>19980200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00012">
<document-id>
<country>WO</country>
<doc-number>WO 01/33825</doc-number>
<kind>A1</kind>
<date>20010500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00013">
<document-id>
<country>WO</country>
<doc-number>WO 01/58195</doc-number>
<kind>A1</kind>
<date>20010800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00014">
<othercit>Millymaki et al, “A Probabilistic Approach to WLAN User Location Estimation”, The Third IEEE Workshop on Wireless local Area Networks, Sep. 2001.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00015">
<othercit>Piaggio et al, “Global localization via sub-graph isomorphism”, 1999 Third European Workshop on Advanced Mobile Robots, 1999, pp. 151-158.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00016">
<othercit>Duckett et al, “Knowing Your Place in Real World Environments”, 1999 Third European Workshop on Advanced Mobil Robots, 1999 pp. 135-142.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>18</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>4554561</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>4554562</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>4554565</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>4554566</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>455 6711</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>455517</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>455457</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>455 677</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>4</number-of-drawing-sheets>
<number-of-figures>10</number-of-figures>
</figures>
<us-related-documents>
<continuation>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>PCT/FI03/00553</doc-number>
<kind>00</kind>
<date>20030708</date>
</document-id>
<parent-status>PENDING</parent-status>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>11030334</doc-number>
</document-id>
</child-doc>
</relation>
</continuation>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20050197139</doc-number>
<kind>A1</kind>
<date>20050908</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Misikangas</last-name>
<first-name>Pauli</first-name>
<address>
<city>Helsinki</city>
<country>FI</country>
</address>
</addressbook>
<nationality>
<country>FI</country>
</nationality>
<residence>
<country>FI</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Lekman</last-name>
<first-name>Lare</first-name>
<address>
<city>Helsinki</city>
<country>FI</country>
</address>
</addressbook>
<nationality>
<country>FI</country>
</nationality>
<residence>
<country>FI</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Barnes &amp; Thornburg LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Ekahau Oy</orgname>
<role>03</role>
<address>
<city>Helsinki</city>
<country>FI</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Eng</last-name>
<first-name>George</first-name>
<department>2617</department>
</primary-examiner>
<assistant-examiner>
<last-name>Cho</last-name>
<first-name>Un C.</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A target device's location in a radio network is estimated by maintaining a probabilistic model for several sample points that indicate expected distributions of signal values at a given location. The target device observes signal values, wherein the sequence of observations and the respective locations constitute a Hidden Markov Model. A graph models the topology of the positioning environment. The graph indicates several nodes which are permissible locations in the environment and several arcs which are permissible transitions between two nodes. The graph is used to estimate the target device's location based on the probabilistic model and the sequence of observations.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="105.66mm" wi="169.59mm" file="US07299059-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="244.52mm" wi="183.22mm" file="US07299059-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="237.57mm" wi="188.21mm" file="US07299059-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="190.67mm" wi="177.38mm" file="US07299059-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="230.89mm" wi="187.03mm" file="US07299059-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<p id="p-0002" num="0001">This is a Continuation application of International Application No. PCT/FI03/00553, filed Jul. 8, 2003, which relies on priority from Finnish Application No. 20021357, filed Jul. 10, 2002, the contents of both of which are hereby incorporated by reference in their entireties.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0003" num="0002">The invention relates generally to a positioning technique in which a target device's location is estimated on the basis of a sequence of observations on the target device's wireless communication environment. <figref idref="DRAWINGS">FIG. 1</figref> schematically illustrates an example of such a positioning technique. A target device T communicates via base stations BS via a radio interface RI. In this example, the communication is assumed to be radio communication. The target device T observes signal values at the radio interface RI. The observations O are applied to a probabilistic model PM that models the target device's wireless communication environment and produces a location estimate LE. As used herein, a target device is a device whose location is to be determined. The target device communicates via signals in a wireless environment, and signal values in the wireless environment are used for determining the target device's location. For example, the target device may be a data processing device communicating in a wireless local-area network (WLAN). The data processing device may be a general-purpose laptop or palmtop computer or a communication device, or it may be a dedicated test or measurement apparatus such as a hospital instrument connected to the WLAN. A location, as used herein, is a coordinate set of one to three coordinates. In some special cases, such as tunnels, a single coordinate may be sufficient but in most cases the location is expressed by a coordinate pair (x, y or angle/radius).</p>
<p id="p-0004" num="0003">More particularly, the invention relates to a positioning technique that is based on a Hidden Markov Model. <figref idref="DRAWINGS">FIG. 2</figref> schematically illustrates a Hidden Markov Model HMM. The model consists of locations, transitions between the locations and observations made at the locations. In the example shown in <figref idref="DRAWINGS">FIG. 2</figref>, the target device moves along a path of which five locations q<sub>t−2 </sub>through q<sub>t+2 </sub>are shown. More formally, q<sub>t </sub>defines the location distribution at time t, so that P(q<sub>t</sub>=s) is the probability for the target device being at location s at time t. However, because a location distribution can easily be converted to a single location estimate, the shorthand notation “location q” will be used to refer to a location distribution q.</p>
<p id="p-0005" num="0004">The locations along the target device's path can be called path points. The target device communicates via signals in a wireless environment, and signal values in the wireless environment are used for determining the target device's location.</p>
<p id="p-0006" num="0005">A practical example of the target device is a data processing device communicating in a wireless local-area network (WLAN) or a cellular radio network. The data processing device may be a general-purpose laptop or palmtop computer or a communication device, or it may be a dedicated test or measurement apparatus such as a hospital instrument connected to the WLAN. A signal value, as used herein, is a measurable and location-dependent quantity of a fixed transmitter's signal. For example, signal strength and bit error rate/ratio are examples or measurable and location-dependent quantities.</p>
<p id="p-0007" num="0006">The word ‘hidden’ in the Hidden Markov Model stems from the fact that we are primarily interested in the locations q<sub>t−2 </sub>through q<sub>t+2 </sub>but the locations are not directly observable. Instead we can make a series of observations o<sub>t−2 </sub>through o<sub>t+2 </sub>on the basis of the signal values but there is no simple relationship between the observations o<sub>t−2 </sub>. . . o<sub>t+2 </sub>and locations q<sub>t−2 </sub>. . . q<sub>t+2</sub>. (Note that the straight arrows through the locations q<sub>t−2 </sub>through q<sub>t+2 </sub>are not meant to imply that the target devices moves along a straight path or with a constant speed, or that the observations are made at equal intervals.)</p>
<p id="p-0008" num="0007">Note that a single ‘observation’ may comprise, and typically does comprise, several signal value measurements from one or more channels. In a probabilistic model, the idea is to measure the probability distribution of a signal value, and if there is any overlap in signal values in various locations, the locations cannot be determined on the basis of a single measurement per location. Instead, each observation must comprise a plurality of measurements in order to determine a probability distribution.</p>
<p id="p-0009" num="0008">It should also be understood that in <figref idref="DRAWINGS">FIGS. 1 and 2</figref>, time is quantified. This means that a target device that has a single radio receiver may only observe one channel at any point of time, but the radio receiver can be re-tuned to a different channel in milliseconds, whereas the observations o<sub>t−2 </sub>. . . o<sub>t+2 </sub>are typically separated by at least a hundred milliseconds. The interval between observations can be selected based on the a typical target device's speed. Thus a single observation can comprise signal values from several channels even if a radio receiver has to be re-tuned between channels.</p>
<p id="p-0010" num="0009">The radio receiver may measure signal values, such as signal strength, virtually continuously, but in a positioning application based on a Hidden Markov Model, it is beneficial to treat the observations in quantified time. Thus the term ‘observation’ can be summarized as a statistical sample of several signal values from a given period of time.</p>
<p id="p-0011" num="0010">A problem underlying the invention derives from the Hidden Markov Model: we cannot observe a variable that has a monotonous relationship with distance or location. Instead the positioning method is based on observations of signal values. It is possible for two or more locations to have near-identical sets of signal values, and a location estimate may be grossly inaccurate.</p>
<heading id="h-0002" level="1">BRIEF DESCRIPTION OF THE INVENTION</heading>
<p id="p-0012" num="0011">An object of the invention is to provide a method and an apparatus for implementing the method so as to alleviate the above disadvantages. In other words, it is an object of the invention to reduce the uncertainty of a positioning technique that is based on a probabilistic model of expected signal values. The object of the invention is achieved by the methods and equipment which are characterized by what is stated in the independent claims. The preferred embodiments of the invention are disclosed in the dependent claims.</p>
<p id="p-0013" num="0012">The invention is based on the use of a graph (or a set of graphs) that models the topology of the positioning environment. A graph G={V,A} comprises n nodes or vertices V={v<sub>1</sub>, v<sub>2</sub>, . . . v<sub>n</sub>} and m arcs A={a<sub>1</sub>, a<sub>2</sub>, . . . a<sub>m</sub>} such that each arc a<sub>k</sub>=(v<sub>i</sub>, v<sub>j</sub>) describes a possible path or transition from v<sub>i </sub>to v<sub>j</sub>. Thus all permissible routes in the positioning environment can be described by various combinations of the arcs of the graph G. For example, the graph G for a typical office would have an arc for each corridor, arcs connecting corridors to rooms (via doors), etc. It is a matter or semantics whether environments consisting of multiple floors are described by several interconnected graphs or one graph in which some of the arcs describe vertical transitions (lifts, stairs or escalators). In computer-aided design, an arc means a curve segment, but in graph theory, as well as in the context of the present invention, an arc means merely a connection between two nodes. In practice, an arc is drawn as a straight line.</p>
<p id="p-0014" num="0013">It should be noted that the graph according to the invention is a property of the positioning environment in general, and is determined based on the obstacles in the positioning environment, in comparison to some prior art positioning techniques in which each target device's permissible locations are determined separately, based on the target device's own location history and attainable speed.</p>
<p id="p-0015" num="0014">An advantage of the invention is that the target device's reported location moves naturally, that is, the target device does not appear to move through walls or other obstacles. Another advantage is that the graph serves as a good basis for establishing the probabilistic model on the basis of calibration measurements or calculations. If the graph nodes are also used as sample points of the probabilistic model, the positioning system is most accurate in areas where the target devices are likely to move.</p>
<p id="p-0016" num="0015">If the target device's location is interpreted as a point or node of the graph, the target device's movements are easier to analyze by computers. In other words, the reported locations, being interpreted as points or nodes on a well-defined graph, are a much better source for data mining operations than are arbitrary locations, without any quantification. For example, a department store designer may want to search for patterns or correlations in customer movement. If the graph nodes are located at certain desks, it is rather easy to see if a client who stopped at desk x also passed by desk y. Without the graph, and the inherent quantification, the designer would have to look for coordinates within a certain area near each desk. Each graph node is a permissible location but a permissible location is not necessarily a graph node. The distance between nodes should be selected on the basis of the desired resolution. In other words, whoever drafts the graph, must answer the following question: how far off can a reported location be from the true location? The answer depends on the nature of a typical target device. If the target device is a communication device carried in person, an error of several meters may be acceptable because persons can easily be recognized from a distance of several meters. On the other hand, if the target devices comprise hospital instruments or the like, a smaller resolution is desirable. In most applications, the resolution (inter-node distance) is approximately one meter. A smaller distance gives a better resolution at the cost of increased consumption of resources. The consumed resources include calibration measurements, memory for storing the probabilistic model and computation power. Open spaces can be treated as a grid of horizontal and vertical arcs. Since visibility is good in open spaces, a coarser-than-normal resolution may be acceptable.</p>
<p id="p-0017" num="0016">The graph G can be connected to the Hidden Markov Model as follows. Let d be a typical distance between points along an arc. The typical distance is the same as desired resolution, such as one meter. Let S={s<sub>1</sub>, s<sub>2</sub>, . . . s<sub>k</sub>} be the set of points along the arc such that the inter-point distance is d. S can be used as the value domain for the hidden state variables q<sub>i </sub>of the Hidden Markov Model.</p>
<p id="p-0018" num="0017">The graph G is preferably used in connection with a set of transition probabilities between the graph nodes. Transition probabilities P(q<sub>t</sub>|q<sub>t−1</sub>) can be defined so that the probability for a transition from s<sub>i </sub>to s<sub>j</sub>, i.e., P(q<sub>t</sub>=s<sub>j</sub>|q<sub>t−1</sub>=s<sub>i</sub>), is non-zero only if a target device can make that transition in a period of time that fits between two observations.</p>
<p id="p-0019" num="0018">Two alternative techniques for using the transition probabilities will be described. The first technique is based only on the speed of a typical target device, the period of time between observations and the distance between points. Let d<sub>max </sub>be the maximum distance travelled by a typical target device within a maximum period of time between observations. Any transition over d<sub>max </sub>in length has a probability of zero or very close to zero. For example, people rarely move faster than 2 m/s in typical indoor environments. Thus, if the time between two observations is 1 s, the probability of any transition over two meters in length is zero, or at least very low. (A non-zero probability means, for example, that people rarely run but running is not strictly prohibited.)</p>
<p id="p-0020" num="0019">The second technique for transition probabilities is based on the concept of neighbours or closely-connected points. Two points, s<sub>i </sub>and s<sub>j </sub>are neighbours if one can be reached from the other via arcs of A without visiting any other point of S. The neighbour-based technique is elegant in the sense that the set of arcs in G is also the set of permissible transitions, which simplifies computation. A slight drawback is the fact that a fast-moving target device's position is reported with a delay. Assume that the target device moves quickly but linearly to a node three nodes away from its previous estimated location. Since only transitions to neighbours are permitted, the location estimate must proceed via all of the intervening nodes, which causes a delay of three observation periods.</p>
<p id="p-0021" num="0020">According to a further preferred embodiment of the invention, the transition probabilities are first assigned a preliminary value on the basis of internode distances and typical target device speeds. When the positioning system is used, history of target device movement is assembled, and the transition probabilities are fine-tuned experimentally.</p>
<p id="p-0022" num="0021">Uses for the transition probabilities are further discussed later, under the heading “Recursion-based techniques”.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0023" num="0022">In the following the invention will be described in greater detail by means of preferred embodiments with reference to the attached drawings, in which</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 1</figref> schematically illustrates a positioning technique;</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 2</figref> illustrates a Hidden Markov Model;</p>
<p id="p-0026" num="0025"><b>3</b> illustrates a graph according to the invention;</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 4</figref> shows a location estimation module LEM for estimating the target device's location based on signal values at the radio interface RI;</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIGS. 5A and 5B</figref> are block diagrams illustrating typical target devices whose location is to be determined;</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. 6</figref> illustrates handling of long spans;</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 7</figref> shows a preferred technique for preparing a probabilistic model on the basis of a graph according to the invention;</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 8</figref> shows how the graph can be used as a road map; and</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. 9</figref> shows further examples of location interpretation and optimal path selection.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DETAILED DESCRIPTION OF THE INVENTION</heading>
<p id="p-0033" num="0032"><figref idref="DRAWINGS">FIG. 3</figref> illustrates a graph G according to the invention. In this example the graph G comprises two subgraphs G<b>1</b> and G<b>2</b> such that subgraph G<b>1</b> corresponds to the floor plan <b>31</b> of the first floor and subgraph G<b>2</b> corresponds to the floor plan <b>32</b> of the second floor. The graph comprises nodes, drawn as black circles, such that each node indicates a permissible location for a target device. The distance between nodes should be selected on the basis of the desired resolution. In most applications, the resolution (inter-node distance) is approximately one meter. A smaller distance gives a better resolution at the cost of increased consumption of resources. The consumed resources include calibration measurements, memory for storing the probabilistic model and computation power. For most office rooms, a single node is sufficient, such as the node <b>311</b> in the upper left-hand room. On the other hand, larger rooms may have more nodes such as the nodes <b>312</b> and <b>313</b> in the lower left-hand room. Nodes <b>314</b> to <b>319</b> are nodes placed in an open space. Such nodes should be placed such that the desired resolution is achieved, without consuming too much computational resources. The floor plan comprises an impermissible area <b>33</b> that is drawn with a dashed line. For example, the impermissible area may be a receptionist's desk, office equipment, building structure, or any obstacle into which a target device cannot move. Or, to express it more precisely, the target device may move into the area <b>33</b> but its location is interpreted as being outside the area <b>33</b>.</p>
<p id="p-0034" num="0033">In addition to the nodes <b>310</b>, <b>311</b>, etc., that indicate permissible locations, the graph G comprises arcs that indicate permissible transitions between the nodes. To keep the graph simple in <figref idref="DRAWINGS">FIG. 3</figref>, arcs are only allowed if they are horizontal or vertical and connect exactly two nodes, without passing through additional nodes. For instance, arc <b>331</b> connects nodes <b>314</b> and <b>315</b>, and arc <b>332</b> connects nodes <b>315</b> and <b>316</b> but there is no arc from node <b>314</b> to node <b>316</b>.</p>
<p id="p-0035" num="0034">Although the office space shown in <figref idref="DRAWINGS">FIG. 3</figref> is three-dimensional, it is treated as several interconnected two-dimensional spaces. Nodes <b>310</b> and <b>320</b> are the entry points to the first and second floor, respectively. Arc <b>333</b> connects the entry points, <b>310</b>, <b>320</b>, to the two floors.</p>
<p id="p-0036" num="0035"><figref idref="DRAWINGS">FIG. 4</figref> is a block diagram of an exemplary location estimation module LEM for estimating the target device's location based on signal values at the radio interface RI. <figref idref="DRAWINGS">FIG. 4</figref> shows a compact location estimation module LEM, but more distributed embodiments are equally possible. An essential feature of the location estimation module is a probabilistic model PM of the target device's wireless environment, the probabilistic model being able to predict the target device's location given a plurality of observations from the radio interface. In this example, the probabilistic model PM is built and maintained by a model construction module MCM. The model construction module MCM builds and maintains the probabilistic model on the basis of calibration data CD or propagation data PD in the form of one or more propagation models, or any combination thereof. Calibration data CD is the result of physically measuring signal values at known locations (or determining the coordinates of those locations if they are not known by other means). Optionally, the calibration data records may also comprise the time at which the measurement was made, in case the signal parameters vary with time. Instead of the calibration data CD, or in addition to them, one or more propagation models PD can be used to model the radio interface RI. The propagation models can be constructed by techniques that are analogous to ray-tracing techniques for visual simulation. The locations at which calibration measurements are collected are called calibration points. The calibration data CD comprises data records each of which comprises the location of the calibration point in question and the set of signal parameters measured at that calibration point. The location can be expressed in any absolute or relative coordinate system. In special cases, such as trains, highways, tunnels, waterways or the like, a single coordinate may be sufficient, but normally two or three co-ordinates will be used.</p>
<p id="p-0037" num="0036">There is also a location calculation module LCM for producing a location estimate LE on the basis of the target device's observation set OS and the probabilistic model PM. For instance, the location calculation module can be implemented as a software program being executed in a laptop or palmtop computer. Technically, the ‘measurements’ and ‘observations’ can be performed similarly, but to avoid confusion, the term ‘measurement’ is generally used for the calibration measurements, and the signal parameters obtained at the current location of the target device are called ‘observations’. The target device's most recent set of observations is called current observations.</p>
<p id="p-0038" num="0037">The graph G has several major applications within a positioning system. For example, the graph can be used during construction of the probabilistic model. Sample points of the probabilistic model are preferably placed at the nodes of the graph. For instance, the model construction module MCM preferably comprises an automatic check that a sample point has been actually determined (calibrated, simulated or interpolated) for each graph node.</p>
<p id="p-0039" num="0038">The graph is also a good foundation for determining transition probabilities between possible locations.</p>
<p id="p-0040" num="0039">Finally, the graph can be used to estimate or interpret the target device's location. For example, the target device's location can be interpreted as a point on the arc closest to the estimated location. Thus the location is forced on one of the arcs of the graph. The location can be further quantified by interpreting it as the graph node closest to the estimated location. A final location interpretation can be made by combining several intermediate estimates.</p>
<p id="p-0041" num="0040">Some or all of the applications of the graph are preferably used simultaneously, such that the sample points of the probabilistic model are placed at the graph nodes and the target device's location is estimated or interpreted based on the graph. Because the permissible locations are at or close to the graph nodes, the positioning application is most accurate near the graph nodes. Conversely, the positioning application may be relatively inaccurate at impermissible locations, such as the area <b>33</b>, but if this area cannot be entered at all, or at least locations inside the area are not reported as the target device's location, any inaccuracy in such areas is immaterial. Dashed lines <b>41</b> and <b>42</b> illustrate, respectively, uses of the graph G for model construction and location estimation/interpretation. Naturally, it is not the visual presentation of the graph that is important but its internal structure.</p>
<p id="p-0042" num="0041"><figref idref="DRAWINGS">FIG. 5A</figref> is a block diagram illustrating a typical target device T whose location is to be determined. In this example, the target device T is shown as a portable computer that communicates via a radio network RN. For example, the radio network can be WLAN (wireless local-area network) network. In the embodiment shown in <figref idref="DRAWINGS">FIG. 5A</figref>, the location estimation module LEM comprising the probabilistic model PM is not installed in the target device T. As a result, the target device T must send its observation set OS to the location estimation module LEM via one or more of the base station BS it is connected to. The location estimation module LEM returns the target device its location estimate LE via the radio interface RI.</p>
<p id="p-0043" num="0042"><figref idref="DRAWINGS">FIG. 5B</figref> shows an alternative embodiment in which the target device's attached computer PC receives a copy of the probabilistic model PM on a detachable memory DM, such as a CD-ROM disk, and the target device T is able to determine its own location without transmitting anything. As a yet further alternative (not shown separately), the attached computer PC may receive the probabilistic model via an Internet (or any other data) connection to the location estimation module LEM. Wideband mobile stations can receive the probabilistic model via the radio interface RI. A hybrid of the technologies may also be used such that the receiver receives an initial probabilistic model via a wired connection or on the detachable memory, but later updates to the model are sent via the radio interface.</p>
<p id="p-0044" num="0043"><figref idref="DRAWINGS">FIG. 6</figref> illustrates handling of long spans. In this context, “long” means longer than the desired resolution of the positioning system. If it is desirable to have a round-off error less than one meter, then any span over two meters is “long”. Such long spans are common in corridors and in large open spaces. In this example, a graph <b>600</b> has two naturally-occurring nodes, <b>601</b>, <b>605</b>, at the ends of the corridor, but interpreting the target device's location as one of the end nodes introduces too much quantization error. Accordingly, the graph <b>600</b> is preferably drawn with a computer-aided program such that the operator only has to enter the nodes <b>601</b> and <b>605</b> at which bends or junctions occur naturally, and the program automatically recognizes spans that exceed the desired resolution and inserts additional nodes as needed. For example, if the span from <b>601</b> to <b>605</b> is nine meters and a round-off error of one meter is tolerated, then the span <b>601</b> to <b>605</b> is split into four arcs <b>611</b> to <b>614</b> with three additional nodes <b>602</b>, <b>603</b> and <b>604</b>.</p>
<p id="p-0045" num="0044">Alternatively, if the distance between nodes is larger than the desired resolution, we can interpolate between the nodes. For example, if the target device's observations correspond to nodes <b>602</b> and <b>603</b>, but node <b>602</b> is a better match, the target device's location could be interpolated to point <b>620</b> between nodes <b>602</b> and <b>603</b>. However, in many applications it is preferable to place nodes densely enough so that no interpolation is needed and the target device's location is interpreted as the node closest to the estimated location. For instance, data mining applications are simplified by quantifying the estimated locations to graph nodes instead of points between nodes.</p>
<p id="p-0046" num="0045">The graph nodes <b>601</b> to <b>605</b> are preferably also the sample points of the probabilistic model PM. There are or may be several kinds of sample points. One type of sample point, called a calibration point, is based on actual calibration measurements made in the actual positioning environment. (See the calibration data CD in <figref idref="DRAWINGS">FIG. 4</figref>.) Another type of sample point is calculated on the basis of one or more propagation models PM. A third type of sample point is based on interpolation between calibration points or calculated points. For instance, assume that the nodes <b>601</b> and <b>605</b> are calibration points. Then the nodes <b>602</b>, <b>603</b> and <b>604</b> can be derived from the calibration points by interpolation. The interpolation should not be based on summing (averaging) the probability distributions at the nodes <b>601</b> and <b>605</b>, for the following reason. Assume that signal strength is used for positioning and that the signal strength at node <b>601</b> has a probability peak at 20 units. At node <b>605</b> the probability peak is at 40 units. If the probability distributions are averaged, the combined probability distribution still has peaks at 20 and 40 units, although it seems natural that the combined probability should have one peak at about 30 units. Thus a preferred form of interpolation is based on a combination of cumulative distribution functions of the signal values at the nodes that the interpolation is based on. If the interpolation does not take place at the middle point, then the known nodes are inversely distance-weighted. For example, assume that node <b>602</b> is to be interpolated on the basis of known calibration points <b>601</b> and <b>605</b>. Node <b>605</b> is three times more distant than node <b>601</b>. Accordingly, the cumulative distribution function of node <b>601</b> is weighted three time stronger than that of node <b>605</b>.</p>
<p id="p-0047" num="0046"><figref idref="DRAWINGS">FIG. 7</figref> shows a preferred technique for preparing a probabilistic model on the basis of a graph according to the invention. In step <b>71</b>, a program similar to a computer-aided design (CAD) program displays the floor plan of the positioning environment. In step <b>72</b>, the operator enters node coordinates and arcs. In step <b>73</b>, the CAD-like program detects arcs whose length exceeds the desired resolution and splits them by inserting nodes such that the resulting arcs are shorter than the desired resolution, as described in connection with <figref idref="DRAWINGS">FIG. 6</figref>. The program may automatically insert the minimum amount of extra nodes or prompt the operator for a suitable number of nodes to be inserted. In step <b>74</b> the graph G is displayed and, most likely, printed on paper to serve as a map for calibration personnel. In step <b>75</b>, the calibration nodes are calibrated and/or the nodes based on the propagation model(s) are calculated. The operator-entered nodes are preferably determined by actual calibration or calculation. In an optional step <b>76</b>, the computer-inserted nodes are determined by interpolation on the basis of calibrated or calculated nodes. In a further optional step <b>77</b>, the inter-node transition probabilities are determined on the basis of a typical target device's speed and observation frequency, as described earlier.</p>
<p id="p-0048" num="0047"><figref idref="DRAWINGS">FIG. 8</figref> shows how the graph can be used as a road map. Such a road map can be used to guide a target device to a desired location via an optimal path P. The path can be optimized, for example, by minimizing some cost parameter of the path, such as length, time or energy. As is well known, some path optimization problems are very complex and cannot be solved in a reasonable time. The invention does not relate to path optimization per se. Rather, some aspects of the invention relate to constructing the optimal path from the arcs of the graph G according to the invention. Thus the term ‘optimal’ does not necessarily mean that the path is indeed optimal but that it is the result of some optimization process (that may or may not be perfect).</p>
<p id="p-0049" num="0048">The optimal path P may by indicated to a person or a robot. The floor plan and graph shown in <figref idref="DRAWINGS">FIG. 3</figref> will be used again. For the purpose of a concrete example, assume that the environment is a hospital, the target device is carried by a doctor who is at node (room) <b>312</b> and the doctor is urgently needed at node <b>325</b>. <figref idref="DRAWINGS">FIG. 8</figref> shows the full graph G, consisting of subgraphs G<b>1</b> and G<b>2</b> for each of the two floors, in order to show how the optimal path P is constructed from arcs of the graph. However, the full graph G is preferably not shown to the doctor. Instead, only the optimal path P, via nodes <b>312</b>-<b>319</b>-<b>310</b>-<b>320</b>-<b>324</b>-<b>321</b>-<b>325</b>, is shown. Because a typical target device, such as a palmtop computer, has a small display, the optimal path P and the underlying floor plan are preferably shown in parts, in response to the target device's detected location. At first, the path portion <b>312</b>-<b>319</b>-<b>310</b> on the first floor may be shown, with the underlying portions of the floor plan <b>31</b>. When the target device approaches the stairs or lift <b>333</b>, that portion is shown, and when it approaches the entry node <b>320</b> to the second floor <b>32</b>, the remaining part <b>320</b>-<b>324</b>-<b>321</b>-<b>325</b>, is shown. Thus not only do the graph nodes serve as quantified locations but also selected arcs of the graph can be combined to an optimal path from the target device's detected location to its desired location.</p>
<p id="p-0050" num="0049"><figref idref="DRAWINGS">FIG. 9</figref> shows further examples of location interpretation and optimal path selection. Assume that a guard is at node <b>910</b> and an alarm is given somewhere beyond a large obstacle <b>900</b>. The target device sending the alarm is actually located at point <b>920</b> but, naturally, the positioning system does not know the exact location. Assume that the probabilistic positioning system determines that node (sample point) <b>933</b> is node having the highest probability (40%) of being the node closest to the target device. In this example, the positioning system determines that nodes <b>931</b>, <b>932</b>, <b>933</b>, <b>934</b>, <b>935</b> and <b>936</b> have respective probabilities of 5, 5, 40, 35, 10 and 5 per cent. In this example, if the target device's location estimate may be the probability distribution of the six nodes <b>931</b> to <b>936</b> (or some other subset of nodes whose probability exceeds a given threshold). But for most practical purposes, the probability distribution must be interpreted as a single location. For example, the target device's location can be interpreted as a probability-weighted combination of the nodes <b>931</b> to <b>936</b>. This probability-weighted combination is shown as location <b>921</b>. It is frequently beneficial to interpret the target device's location as a point or node of the graph G closest to the estimated location <b>921</b>. The point of the graph G closest to the location <b>921</b> is point <b>922</b>.</p>
<p id="p-0051" num="0050">Sometimes it is desired to interpret or quantify the target device's location as one of the graph nodes (instead of an arbitrary point of the graph). Such quantification simplifies data mining or decision making, for example. On the basis of the probabilistic model, node <b>933</b> has the highest probability of being the closest node. If the target device's location is interpreted as node <b>933</b>, the optimal path P from node <b>910</b> is via node <b>932</b>. On the other hand, node <b>934</b> is the node closest to the probability-weighted combination <b>921</b> of nodes. If node <b>934</b> is selected as the target device's interpreted location, the optimal path P′ from node <b>910</b> is via node <b>935</b>. Accordingly, a preferred implementation of the optimal path is a path that minimizes the expected value of some cost parameter, such as length or time, of the path.</p>
<p id="p-0052" num="0051">In the discussion so far, only the target device's most recent observation has been used to estimate its location. In the following, more advanced sequence-based techniques for location estimation will be described.</p>
<p id="h-0005" num="0000">Recursion-based Techniques</p>
<p id="p-0053" num="0052">Given a time-ordered sequence of observations o<sub>1</sub><sup>T</sup>={o<sub>1 </sub>. . . , o<sub>T</sub>} we want to determine the location distribution q<sub>t</sub>at time t, 1 &lt;&lt;. Assume that an observation o<sub>i </sub>only depends on the current location q<sub>i </sub>and that q<sub>i </sub>only depends on the previous location q<sub>i−1</sub>. The latter assumption means that history is not studied further than one prior observation. If these assumptions are met, we can represent the positioning problem as a hidden Markov model (HMM) of order <b>1</b> where o<sub>1</sub><sup>T </sup>is a sequence of observations and q<sub>1</sub><sup>T </sup>is a sequence of locations. In this case, the joint probability of o<sub>1</sub><sup>T </sup>and q<sub>1</sub><sup>T </sup>is:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>P</i>(<i>o</i><sub>1</sub><sup>T</sup><i>,q</i><sub>1</sub><sup>T</sup>)=<i>P</i>(<i>q</i><sub>1</sub>)Π<sub>t=1 . . . T−1</sub><i>P</i>(<i>q</i><sub>t+1</sub><i>|q</i><sub>t</sub>)Π<sub>t=1 . . . T</sub><i>P</i>(<i>o</i><sub>t</sub><i>|q</i><sub>t</sub>)  [1]<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0054" num="0053">The joint distribution is therefore completely specified in terms of
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0000">
    <ul id="ul0002" list-style="none">
        <li id="ul0002-0001" num="0054">1. the initial state probabilities P(q<sub>1</sub>),</li>
        <li id="ul0002-0002" num="0055">2. the transition probabilities P(q<sub>t</sub>|q<sub>t−1</sub>) and,</li>
        <li id="ul0002-0003" num="0056">3. the observation probabilities P(o<sub>t</sub>|q<sub>t</sub>).</li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0055" num="0057">If all locations are considered equally probable by default, we can simplify equation 1 by setting the initial state probability P(q<sub>1</sub>) same for all locations. Thus, the joint distribution depends only on the transition probabilities and observation probabilities. These probabilities can be defined in various ways. For example, transition probabilities can be based on the spatial distance between locations so that the transition probability approaches zero when the distance increases. Because the recursion-based techniques can be applied regardless on how transition and observation probabilities are determined, we assume from now on that the transition probabilities and the observation probabilities are given.</p>
<p id="p-0056" num="0058">The location distribution at time t can be defined as:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>P</i>(<i>q</i><sub>t</sub><i>|o</i><sub>1</sub><sup>T</sup>)=<i>P</i>(<i>o</i><sub>1</sub><sup>t</sup><i>,q</i><sub>t</sub>)<i>P</i>(<i>o</i><sub>t+1</sub><sup>T</sup><i>|q</i><sub>t</sub>)/<i>P</i>(<i>o</i><sub>1</sub><sup>T</sup>)  [2]<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0057" num="0059">where P(o<sub>1</sub><sup>t</sup>, q<sub>t</sub>) and P(o<sub>t+1</sub><sup>T</sup>|q<sub>t</sub>) are obtained from equations 3 and 4 (forward and backward recursions) and P(o<sub>1</sub><sup>T</sup>) is the probability of the observations, used for normalizing. Let S be the set of possible locations in this model and n=|S| be the size of S. The time complexity of the forward and backward recursions is O(T<sub>m</sub>) where T is the length of the history and m is the number of non-zero transition probabilities at each time step. Obviously, m&lt;<sup>2 </sup>because in the worst case all transitions have non-zero probability. Most transitions have a probability of zero, however, so in practice m&lt;&lt;n<sup>2 </sup>which makes computation very fast.
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>P</i>(<i>o</i><sub>1</sub><sup>t</sup><i>,q</i><sub>t</sub>)=<i>P</i>(<i>o</i><sub>t</sub><i>|q</i><sub>t</sub>)Σ<sub>qt−1</sub><i>P</i>(<i>q</i><sub>t</sub><i>|q</i><sub>t−1</sub>)<i>P</i>(<i>o</i><sub>1</sub><sup>t−1</sup><i>,q</i><sub>t−1</sub>)  [3]<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>P</i>(<i>o</i><sub>t+1</sub><sup>T</sup><i>|q</i><sub>t</sub>)=Σ<sub>qt+1</sub><i>P</i>(<i>o</i><sub>t+1</sub><i>|q</i><sub>t+1</sub>)<i>P</i>(<i>q</i><sub>t+1</sub><i>|q</i><sub>t</sub>)<i>P</i>(<i>o</i><sub>t+2</sub><sup>T</sup><i>|q</i><sub>t+1</sub>)  [4]<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0058" num="0060">In this way we can obtain the probabilities of different locations at a given time. However, many applications require a location estimate that is a single location instead of the location distribution. Again, there are several ways to calculate the point estimate at time t. For example, the point estimate can be a weighted average of locations where the location probability is used as the weight, or the location having the highest probability.</p>
<p id="p-0059" num="0061">In order to find the most likely route, the Viterbi algorithm can be used. The Viterbi algorithm can find a sequence of locations S<sub>1</sub>, . . . ,S<sub>T </sub>that it maximizes the probability P(o<sub>1</sub><sup>T</sup>|q<sub>1</sub>=s<sub>1</sub>, . . . , q<sub>T</sub>=s<sub>T</sub>). Obviously, a location s<sub>t </sub>can be used as the location estimate at time t. However, this method has the drawback that at each time step, the location estimate can only be one of the possible locations. Thus, the accuracy of the location estimate depends on the density of possible locations. Accuracy could be improved by using a large S having possible locations very close to each other. Unfortunately, this would radically increase time requirements of the algorithm.</p>
<p id="p-0060" num="0062">In order to gain accurate location estimates with a reasonable amount of computation, we can use relatively small S and calculate a location estimate for time t as a weighted average of possible locations Σ(w<sub>i</sub>·s<sub>i</sub>)/Σw<sub>i</sub>.The weight w<sub>i </sub>for a location s<sub>i </sub>can be defined as the probability of the most likely path that goes through location s<sub>i </sub>at time t. Path probabilities are obtained by using the Viterbi algorithm normally for time steps <b>1</b>−t (creating forward paths) and backwards from time step T to t (creating backward paths) and multiplying the probabilities of forward and backward paths ending to s<sub>i </sub>for each i=1 . . . n.</p>
<p id="p-0061" num="0063">It is apparent to a person skilled in the art that, as the technology advances, the inventive concept can be implemented in various ways. The invention and its embodiments are not limited to the examples described above but may vary within the scope of the claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>The invention claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method for estimating a target device's location in a wireless communication environment, the method comprising:
<claim-text>maintaining a probabilistic model for a plurality of sample points, each sample point comprising a sample location and an expected distribution of signal values at that sample point;</claim-text>
<claim-text>making a sequence of observations of signal values wherein each observation corresponds to a respective location along the target device's path, wherein the sequence of observations and the respective locations constitute a Hidden Markov Model;</claim-text>
<claim-text>forming a graph that models the topology of the wireless communication environment, wherein the graph indicates:
<claim-text>a set of nodes, each node indicating a permissible location in the wireless communication environment;</claim-text>
<claim-text>a set of arcs, each arc indicating a permissible target device transition between two nodes; and</claim-text>
</claim-text>
<claim-text>using the graph to estimate the target device's location based on the probabilistic model and the sequence of observations.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. A method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the step of using the graph comprises estimating the target device's location and interpreting the estimated location as a point of the arc closest to the estimated location.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. A method according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, further comprising interpreting the target device's estimated location as the node closest to the estimated location.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. A method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the step of using the graph comprises estimating the target device's location as a subset of graph points or nodes, associating a probability to each point or node in the subset and interpreting the estimated location as probability-weighted combination of the subset of points or nodes.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. A method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein each arc indicates a permissible target device transition between two nodes in a period of time that fits between two observations.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. A method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising using the nodes as the sample points of the probabilistic model.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. A method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the step of forming the graph comprises the following acts performed by a programmed computer:
<claim-text>receiving coordinates of operator-indicated nodes and arcs from an operator; and</claim-text>
<claim-text>detecting arcs whose length exceeds a predetermined maximum distance that is based on a typical target device speed and a typical period of time between observations, and dividing such arcs with additional nodes.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. A method according to <claim-ref idref="CLM-00007">claim 7</claim-ref>, further comprising placing the sample points of the probabilistic model at the nodes of the graph, and:
<claim-text>determining at least some of the sample points at operator-indicated nodes based on calibration and/or a propagation model; and</claim-text>
<claim-text>determining at least some sample points at the additional nodes by interpolation from the operator-indicated nodes.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. A method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising determining transition probabilities between the nodes.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. A method according to <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein the transition probabilities are based on a typical target device speed and a typical period of time between observations.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. A method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising forming an optimal path of nodes from the target device's detected node to its desired node.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. A method according to <claim-ref idref="CLM-00010">claim 10</claim-ref>, further comprising displaying the optimal path superimposed with an underlying map or floor plan.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. A method according to <claim-ref idref="CLM-00011">claim 11</claim-ref>, further comprising displaying the optimal path in parts in response to the target device's detected location.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. A method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising estimating the target device's location based on one or more recursions of the sequence of observations.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. A method according to <claim-ref idref="CLM-00014">claim 14</claim-ref>, wherein the one or more recursions comprise a forward recursion and a backward recursion.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. A location estimation module for estimating a target device's location in a wireless communication environment, the location estimation module comprising:
<claim-text>a probabilistic model for a plurality of sample points, each sample point comprising a sample location and an expected distribution of signal values at that sample point;</claim-text>
<claim-text>means for making a sequence of observations of signal values wherein each observation corresponds to a respective location along the target device's path, wherein the sequence of observations and the respective location constitute a Hidden Markov Model;</claim-text>
<claim-text>a graph for modeling the topology of the wireless communication environment, wherein the graph indicates:
<claim-text>several nodes, each node indicating a permissible location in the wireless communication environment;</claim-text>
<claim-text>several arcs, each arc indicating a permissible target device transition between two nodes;</claim-text>
</claim-text>
<claim-text>means for estimating the target device's location based on the probabilistic model and the sequence of observations and the graph.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. A location estimation module according to <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the location estimation module is contained in the target device.</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. A location estimation module according to <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the location estimation module is contained in a fixed part of the wireless communication environment.</claim-text>
</claim>
</claims>
</us-patent-grant>
