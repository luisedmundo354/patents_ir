<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07299428-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07299428</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>10773541</doc-number>
<date>20040206</date>
</document-id>
</application-reference>
<us-application-series-code>10</us-application-series-code>
<us-term-of-grant>
<us-term-extension>420</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>177</main-group>
<subgroup>50</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>716  4</main-classification>
<further-classification>716  5</further-classification>
</classification-national>
<invention-title id="d0e53">Model stamping matrix check technique in circuit simulator</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5084824</doc-number>
<kind>A</kind>
<name>Lam et al.</name>
<date>19920100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>716 11</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5313398</doc-number>
<kind>A</kind>
<name>Rohrer et al.</name>
<date>19940500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>703 14</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>5588142</doc-number>
<kind>A</kind>
<name>Sharrit</name>
<date>19961200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>703 14</main-classification></classification-national>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>6334100</doc-number>
<kind>B1</kind>
<name>Ahrikencheikh et al.</name>
<date>20011200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>703 14</main-classification></classification-national>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>2004/0049370</doc-number>
<kind>A1</kind>
<name>Stanley et al.</name>
<date>20040300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>703 14</main-classification></classification-national>
</citation>
<citation>
<nplcit num="00006">
<othercit>Achar, R. et al., (May 2001). “Simulation of High-Speed Interconnects,” <i>Proceeding of the IEEE </i>89(5):693-728.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00007">
<othercit>Bomhof, C. W. (2001). “Introduction,” Chapter 1 <i>In Interative and Parallel Methods for Linear Systems, With Applications in Circuit Simulation</i>, located at &lt;http://www.library.uu.nl/digiarchief/dip/diss/1957853/c1.pdf&gt;, last visited on Jun. 15, 2004, 15 pages (Includes Table of Contents).</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00008">
<othercit>Devgan, A. (1995) “Efficient and Accurate Transient Simulation in Charge-Voltage Plane,” International Conference on Computer Aided Design (ICCAD '95) Proceedings of the 1995 IEEE/ACM international conference on Computer-aided design, San Jose, California, United States, pp. 110-114.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00009">
<othercit>Nguyen, T. V. et al., (1998). “Simulation of Coupling Capacitances Using Matrix Partitioning,” International Conference on Computer Aided Design (ICCAD '98), Proceedings of the 1998 IEEE/ACM imternational conference on Computer-aided design, San Jose, California, United States pp. 12-18.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00010">
<othercit>Schwarz, D. E. et al., (2000). “Structural Analysis For Electric Circuits and Consequences for MNA,” <i>Int. J. Circ. Theor. Appl</i>. 28:131-162.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00011">
<othercit>Krummenacher, F. et al., (Jul. 28, 2000). “RF EKV MOSFET Model Implementation,” EPFL—Electronics Laboratories (LEG), EPF-Lausanne, Switzerland, Craft European Project No. 25710, Jul. 28, 2000, WP2, Deliverable D2.1, Ecole Polytechnique Federale de Lausanne 4 pages.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00012">
<othercit>Zhou, X. (2000). “Multi-Level Modeling of Deep-Submicron Mosfets and ULSI Circuits,” <i>9th International Conference on Mixed Design of Integrated Circuits and Systems, Mixdes 2002</i>, Wroclaw, Poland, Jun. 20-22, 2002, 7 pages.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00013">
<othercit>Wroclaw, Poland, Jun. 20-22, 2002, 7 pages.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>20</number-of-claims>
<us-exemplary-claim>13</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>716  4</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>716  5</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>5</number-of-drawing-sheets>
<number-of-figures>5</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20050177807</doc-number>
<kind>A1</kind>
<date>20050811</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Ma</last-name>
<first-name>Yutao</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>McGaughy</last-name>
<first-name>Bruce</first-name>
<address>
<city>Fremont</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="003" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Liu</last-name>
<first-name>Zhihong</first-name>
<address>
<city>Cupertino</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Morrison &amp; Foerster LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Cadence Design Systems, Inc</orgname>
<role>02</role>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Garbowski</last-name>
<first-name>Leigh M.</first-name>
<department>2825</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">The present invention includes a method for detecting model stamping errors during circuit simulation without the need for golden data. The method checks for model stamping errors by determining whether entries in model stamping matrices interrelate according to a plurality of preset rules before circuit equations are solved.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="157.48mm" wi="228.35mm" file="US07299428-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="214.63mm" wi="159.94mm" orientation="landscape" file="US07299428-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="149.52mm" wi="136.48mm" orientation="landscape" file="US07299428-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="230.72mm" wi="201.93mm" orientation="landscape" file="US07299428-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="229.11mm" wi="159.51mm" orientation="landscape" file="US07299428-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="71.71mm" wi="98.13mm" orientation="landscape" file="US07299428-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<p id="p-0002" num="0001">The present invention relates to large sparse linear systems arising in the simulation of physical and other phenomena, such as an integrated circuit including circuit elements represented by matrix stamps in a system of matrix equations.</p>
<heading id="h-0001" level="1">BACKGROUND</heading>
<p id="p-0003" num="0002">The development of complicated physical systems often requires powerful numerical simulation programs. For example, circuit simulation is now an essential part in the design flow of integrated circuits. It helps circuit designers to verify the functionality and performance of their designs without going through expensive fabrication processes. Examples of electronic circuit simulators include the Simulation Program with Integrated Circuit Emphasis (SPICE) developed at the University of California, Berkeley (UC Berkeley), and various enhanced versions or derivatives of SPICE, such as, SPICE2 or SPICE3, also developed at UC Berkeley; HSPICE, developed by Meta-software and now owned by Synopsys; PSPICE, developed by Micro-Sim; and SPECTRE, developed by Cadence. The SPICE and its derivatives or enhanced versions will be referred to hereafter as SPICE circuit simulators, or SPICE.</p>
<p id="p-0004" num="0003">An electronic circuit is a network of circuit elements such as resistors, capacitors, inductors, mutual inductors, transmission lines, diodes, bipolar junction transistors (BJT), junction field effect transistors (JFET), metal-oxide-semiconductor field effect transistors (MOSFET), metal-semiconductor field effect transistors (MESFET), thin-film transistors (TFT), etc. SPICE usually handles a circuit in a node/element fashion, i.e., the circuit is regarded as a collection of various circuit elements connected at nodes. At the heart of SPICE is the so-called Nodal Analysis, which is accomplished by formulating nodal equations (or circuit equations) in matrix format to represent the circuit and solving the nodal equations. The circuit elements are modeled by device models, which produce model results that are represented in the circuit equations as matrix stamps.</p>
<p id="p-0005" num="0004">A device model for modeling a circuit element, such as the BSIM4 model for modeling MOSFET devices developed by UC Berkeley, typically includes model equations and a set of model parameters to mathematically represent characteristics of the circuit element under various bias conditions. For example, a circuit element with n terminals can be modeled by the following current-voltage relations:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>I</i><sub>i</sub><i>=f</i><sub>i</sub>(<i>V</i><sub>1</sub><i>, . . . , V</i><sub>n</sub><i>, t</i>) for <i>i</i>=1<i>, . . . , n,</i><?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where I<sub>i </sub>represents the current entering terminal i, V<sub>j </sub>(j=1, . . . , n) represents the voltage or terminal bias across terminal j and a reference terminal, such as the ground, and t represents the time. The Kirchhoff's Current Law implies that the current entering terminal n is given by
</p>
<p id="p-0006" num="0005">
<maths id="MATH-US-00001" num="00001">
<math overflow="scroll">
<mrow>
  <msub>
    <mi>I</mi>
    <mi>n</mi>
  </msub>
  <mo>=</mo>
  <mrow>
    <munderover>
      <mo>∑</mo>
      <mrow>
        <mi>i</mi>
        <mo>=</mo>
        <mn>1</mn>
      </mrow>
      <mrow>
        <mi>n</mi>
        <mo>-</mo>
        <mn>1</mn>
      </mrow>
    </munderover>
    <mo>⁢</mo>
    <mrow>
      <msub>
        <mi>I</mi>
        <mi>i</mi>
      </msub>
      <mo>.</mo>
    </mrow>
  </mrow>
</mrow>
</math>
</maths>
<br/>
A conductance matrix of the circuit element is defined by:
</p>
<p id="p-0007" num="0006">
<maths id="MATH-US-00002" num="00002">
<math overflow="scroll">
<mrow>
  <mrow>
    <mi>G</mi>
    <mo>⁡</mo>
    <mrow>
      <mo>(</mo>
      <mrow>
        <mrow>
          <msub>
            <mi>V</mi>
            <mrow>
              <mn>1</mn>
              <mo>,</mo>
            </mrow>
          </msub>
          <mo>⁢</mo>
          <mi>…</mi>
        </mrow>
        <mo>⁢</mo>
        <mstyle>
          <mspace width="0.6em" height="0.6ex"/>
        </mstyle>
        <mo>,</mo>
        <msub>
          <mi>V</mi>
          <mi>n</mi>
        </msub>
        <mo>,</mo>
        <mi>t</mi>
      </mrow>
      <mo>)</mo>
    </mrow>
  </mrow>
  <mo>:=</mo>
  <mrow>
    <mrow>
      <mo>(</mo>
      <mtable>
        <mtr>
          <mtd>
            <mfrac>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>f</mi>
                  <mn>1</mn>
                </msub>
              </mrow>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>V</mi>
                  <mn>1</mn>
                </msub>
              </mrow>
            </mfrac>
          </mtd>
          <mtd>
            <mi>⋯</mi>
          </mtd>
          <mtd>
            <mfrac>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>f</mi>
                  <mn>1</mn>
                </msub>
              </mrow>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>V</mi>
                  <mi>n</mi>
                </msub>
              </mrow>
            </mfrac>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mi>⋮</mi>
          </mtd>
          <mtd>
            <mi>⋰</mi>
          </mtd>
          <mtd>
            <mi>⋮</mi>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mfrac>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>f</mi>
                  <mi>n</mi>
                </msub>
              </mrow>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>V</mi>
                  <mn>1</mn>
                </msub>
              </mrow>
            </mfrac>
          </mtd>
          <mtd>
            <mi>⋯</mi>
          </mtd>
          <mtd>
            <mfrac>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>f</mi>
                  <mi>n</mi>
                </msub>
              </mrow>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>V</mi>
                  <mi>n</mi>
                </msub>
              </mrow>
            </mfrac>
          </mtd>
        </mtr>
      </mtable>
      <mo>)</mo>
    </mrow>
    <mo>.</mo>
  </mrow>
</mrow>
</math>
</maths>
<br/>
To model the circuit element under alternating current (AC) operations, the device model also considers the relationship between node charges and the terminal biases:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>□<i>Q</i><sub>i</sub><i>=q</i><sub>i</sub>(<i>V</i><sub>1</sub><i>, . . . , V</i><sub>n</sub><i>, t</i>) for <i>i</i>=1<i>, . . . , n.</i><?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where Q<sub>i </sub>represents the represents the node charge at terminal i. Thus, the capacitance matrix of the n-terminal circuit element is defined by
</p>
<p id="p-0008" num="0007">
<maths id="MATH-US-00003" num="00003">
<math overflow="scroll">
<mrow>
  <mrow>
    <mi>C</mi>
    <mo>⁡</mo>
    <mrow>
      <mo>(</mo>
      <mrow>
        <mrow>
          <msub>
            <mi>V</mi>
            <mrow>
              <mn>1</mn>
              <mo>,</mo>
            </mrow>
          </msub>
          <mo>⁢</mo>
          <mi>…</mi>
        </mrow>
        <mo>⁢</mo>
        <mstyle>
          <mspace width="0.6em" height="0.6ex"/>
        </mstyle>
        <mo>,</mo>
        <msub>
          <mi>V</mi>
          <mi>n</mi>
        </msub>
        <mo>,</mo>
        <mi>t</mi>
      </mrow>
      <mo>)</mo>
    </mrow>
  </mrow>
  <mo>:=</mo>
  <mrow>
    <mrow>
      <mo>(</mo>
      <mtable>
        <mtr>
          <mtd>
            <mfrac>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>q</mi>
                  <mn>1</mn>
                </msub>
              </mrow>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>V</mi>
                  <mn>1</mn>
                </msub>
              </mrow>
            </mfrac>
          </mtd>
          <mtd>
            <mi>⋯</mi>
          </mtd>
          <mtd>
            <mfrac>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>q</mi>
                  <mn>1</mn>
                </msub>
              </mrow>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>V</mi>
                  <mi>n</mi>
                </msub>
              </mrow>
            </mfrac>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mi>⋮</mi>
          </mtd>
          <mtd>
            <mi>⋰</mi>
          </mtd>
          <mtd>
            <mi>⋮</mi>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mfrac>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>q</mi>
                  <mi>n</mi>
                </msub>
              </mrow>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>V</mi>
                  <mn>1</mn>
                </msub>
              </mrow>
            </mfrac>
          </mtd>
          <mtd>
            <mi>⋯</mi>
          </mtd>
          <mtd>
            <mfrac>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>q</mi>
                  <mi>n</mi>
                </msub>
              </mrow>
              <mrow>
                <mo>∂</mo>
                <msub>
                  <mi>V</mi>
                  <mi>n</mi>
                </msub>
              </mrow>
            </mfrac>
          </mtd>
        </mtr>
      </mtable>
      <mo>)</mo>
    </mrow>
    <mo>.</mo>
  </mrow>
</mrow>
</math>
</maths>
</p>
<p id="p-0009" num="0008">For non-linear circuits, i.e., circuits including non-linear devices, SPICE often solves the circuit equations using the so-called Newton-Ralphson (N-R) iteration. To start the iteration process, SPICE selects an initial operating point for which the device model is evaluated. The initial operating point may include a set of terminal biases V<sub>j</sub>(j=1, . . . , n) associated with each of a plurality of circuit elements. Based on the set of terminal biases for each of the circuit elements, SPICE evaluates the device models for modeling the circuit elements and produces model results such as terminal currents, node charges and the derivatives of the terminal currents and node charges (conductance and capacitance) associated with the circuit elements. SPICE then stamps the terminal currents, node charges, and their derivatives into designated entries in the matrices of the circuit equations. The process of obtaining model results and stamping the model results into matrices are often referred to as model evaluation and model stamping or matrix stamping. SPICE then solves the circuit equations to produce circuit voltages and currents based on the initial operating point. The circuit voltages and currents based on the initial guess of the operating point are used to generate a second operating point, and SPICE then iterates the above process to solve the circuit equations based on the second operating point. The iteration continues until the differences in circuit voltages and currents from two consecutive iteration rounds have fallen below some predetermined limits, and the solution is considered to have converged.</p>
<p id="p-0010" num="0009">Thus, the correctness and the efficiency of circuit simulation depend on the correct implementation of the device models and correct stamping of the model results. For example, a basic requirement for the convergence of N-R iteration is the consistency between the terminal currents, node charges and their derivatives, which can be destroyed due to errors in the stamping of conductance or capacitance. As the technology advances and integrated circuits become more and more complex, it has become more and more difficult to guarantee the correct stamping of the model results. Usually, extensive model quality assurance (QA) procedures are followed after model evaluation to compare model results with golden data, which are obtained by measurements, by using a slower but more reliable simulation tool such as an electromagnetic field solver, or simply from a previous circuit simulation run. But this model QA method is disadvantageous because it depends on the quality of the golden data, which may be erroneous or simply unavailable, as in cases involving new technology and state-of-art device models.</p>
<p id="p-0011" num="0010">Even when the golden data are available and reliable, conventional model QA procedures are still insufficient because the golden data are typically obtained by DC sweep of bias voltages and because conventional model QA procedures often use DC solution of the model equations for comparison with the golden data. As a result, conventional model QA procedures cannot detect errors in matrix stamping of conductance or capacitance entries because these errors have no effect on the accuracy of DC solutions. The errors in matrix stamping of conductance or capacitance entries will, however, affect the convergence and speed of the circuit simulation and should be detected before they are used to solve the circuit equations.</p>
<p id="p-0012" num="0011">Furthermore, conventional model QA procedures are insufficient because they do not provide 100% bias coverage. The DC solution of the model equations and the comparison with golden data are usually performed for typical biases only. Moreover, conventional mode QA procedures do not test the consistency between currents, charges and their derivatives (conductance and capacitance), which is crucial for the convergence of N-R iteration.</p>
<heading id="h-0002" level="1">SUMMARY</heading>
<p id="p-0013" num="0012">The present invention includes a method for detecting model stamping errors during circuit simulation. In one embodiment of the present invention, the method is implemented in a circuit simulator for simulating an integrated circuit having various interconnected circuit elements. The circuit simulator includes a model engine module (model engine) and a solver module (solver). The model engine includes device models for modeling the circuit elements and is programmed to produce model results associated with a circuit element based on the set of terminal biases for the circuit element supplied by the solver. The solver is programmed to form circuit equations in matrix format, to supply the set of terminal biases for each of a plurality of circuit elements represented in the circuit equations to the model engine, to receive the model results produced by the model engine, to stamp the model results into designated entries in matrices associated with the circuit equations, to check for correctness of the stamped model results by determining whether the model results interrelate according to a plurality of preset rules, and to solve the circuit equations to produce circuit simulation results.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram of a computer system that can be used to carry out a method according to one embodiment of the present invention.</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 2</figref> is a block diagram illustrating a circuit simulation program according to one embodiment of the present invention.</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 3</figref> is a flowchart illustrating a process for simulating an integrated circuit according to one embodiment of the present invention.</p>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 4</figref> is a flowchart illustrating a process for checking local variable matrices according to one embodiment of the present invention.</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 5</figref> is an equivalent circuit in the BSIM4 model for modeling MOSFET devices for illustrating an application of the present invention.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0019" num="0018">The present invention includes a method for simulating a system by solving for the states of the system having a large number of elements interconnected through their terminals, some or all of which are modeled by element models each for generating model results describing the behavior or characteristic of an element in the system under a set of terminal conditions. An example of such a system is an integrated circuit having various interconnected circuit elements. Preferred embodiments of the present invention are thus described in the context of integrated circuits. But the present invention is applicable to the simulation of any system having interconnected elements when the simulation is carried out by solving system equations in matrix format and the elements in the system are represented in the system equations as matrix stamps.</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 1</figref> illustrates a computer system (system) <b>100</b> that can be used to carry out the method according to one embodiment of the present invention. As shown in <figref idref="DRAWINGS">FIG. 1</figref>, the computer system (system) <b>100</b> includes a central processing unit (CPU) <b>102</b>, and a disk memory <b>110</b> coupled to the CPU <b>102</b> through a bus <b>108</b>. The system <b>100</b> further includes a set of input/output (I/O) devices <b>106</b>, such as a keypad, a mouse, and a display device, also coupled to the CPU <b>102</b> through the bus <b>108</b>. The system <b>100</b> may also include other devices <b>122</b>, such as an input port for receiving data from a computer network or from a data collecting device (not shown). An example of system <b>100</b> is a Pentium 133 PC/Compatible computer having a RAM larger than 64 MB and a hard disk larger than 1 GB.</p>
<p id="p-0021" num="0020">Memory <b>110</b> has computer readable memory spaces such as memory space <b>112</b> that stores operating system <b>112</b> such as Windows 95/98/NT4.0/2000, which has instructions for communicating, processing, accessing, storing and searching data. Memory <b>110</b> further includes a database <b>114</b> that stores data and/or data structures used to carry out the circuit simulation program according to one embodiment of the present invention, and memory space <b>116</b> that stores program instructions (software) of a circuit simulation program <b>200</b> according to one embodiment of the present invention. Memory space <b>116</b> may be further subdivided as appropriate, for example to include memory portions <b>118</b> and <b>120</b> for storing modules and plug-in models, respectively, of the software.</p>
<p id="p-0022" num="0021">As shown in <figref idref="DRAWINGS">FIG. 2</figref>, in one embodiment of the present invention, the method for simulating an integrated circuit (or circuit) having various interconnected circuit elements is implemented in a circuit simulation program <b>200</b> having a model engine module (model engine) <b>210</b> and a solver module (solver) <b>230</b>. The model engine <b>210</b> includes device models for modeling the circuit elements and is programmed to produce model results associated with a circuit element based on a set of terminal biases for the circuit element supplied by the solver <b>230</b>. The solver <b>230</b> is programmed to form circuit equations in matrix format, to supply the set of terminal biases for each circuit element represented in the circuit equations to the model engine, to receive the model results produced by the model engine, to stamp the model results into designated entries in matrices associated with the circuit equations, to check for correctness of the model results by determining whether the model results interrelate according to a plurality of preset rules, and to solve the circuit equations to produce circuit simulation results. The circuit simulation program may also include a data input module <b>220</b> that arranges input data describing the circuit to be simulated in proper format or data structures, such as a netlist, for use by the solver, and a data output module <b>240</b> that arranges simulation results in proper format for display and use by circuit design engineers.</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 3</figref> illustrates a process <b>300</b> performed by the solver <b>230</b> and the model engine <b>210</b> during the simulation of the integrated circuit. As shown in <figref idref="DRAWINGS">FIG. 3</figref>, in process <b>300</b>, the solver <b>230</b> forms in step <b>301</b> the circuit equations according to an input netlist from the data input module <b>220</b>. The circuit equations are formed in a matrix format and have at this point associated matrices with unfilled entries. Then, in order to form an initial operating point for the N-R solution of the circuit equations, the solver performs direct current (DC) simulation of the circuit in step <b>302</b>. In DC simulation, AC sources are ignored, capacitors are replaced with open circuits and inductors with short circuits, and nonlinear devices are represented by their associated device models, and the simulator uses the Newton-Raphson algorithm to solve Kirchoff's Current Law at each node.</p>
<p id="p-0024" num="0023">The result of the DC simulation is a DC operating point of the circuit, which is selected in step <b>303</b> by the solver as the initial operating point. The initial operating point includes currents and node voltages in the circuit, from which the solver forms a set of terminal conditions such as terminal biases for a circuit element and supplies the set of terminal biases in step <b>304</b> to the model engine <b>210</b>. The set of terminal biases may include information such as a terminal bias voltage between each terminal of the circuit element and the ground, or a terminal bias voltage between a reference terminal selected among the terminals of the circuit element and each of the other terminals of the circuit element. Thus, if the circuit element is a device having n terminals, the set of terminal biases may include {V<sub>1</sub>, . . . , V<sub>n</sub>}, where V<sub>i </sub>represents the terminal bias voltage between terminal i and the ground or the terminal bias voltage between terminal i and a reference terminal such as terminal n (in this case V<sub>n</sub>=0).</p>
<p id="p-0025" num="0024">Upon receiving the set of terminal biases, the model engine performs at step <b>306</b> model evaluation, and produces model results (or local variables) such as terminal currents, node charges, conductance and capacitance, etc., associated with the circuit element. The model results are communicated at step <b>308</b> to the solver. The solver then stamps the model results into designated entries in the matrices associated with the circuit equations in step <b>310</b>. During the stamping in step <b>310</b>, the model results or local variables are also arranged and stored as local variable matrices. For example, when the model results are for a circuit element with n terminals, the terminal currents or node charges are arranged as a local current vector I or local charge vector Q, respectively,</p>
<p id="p-0026" num="0025">
<maths id="MATH-US-00004" num="00004">
<math overflow="scroll">
<mrow>
  <mrow>
    <mi>I</mi>
    <mo>=</mo>
    <mrow>
      <mo>[</mo>
      <mtable>
        <mtr>
          <mtd>
            <msub>
              <mi>I</mi>
              <mn>1</mn>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mi>⋮</mi>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msub>
              <mi>I</mi>
              <mi>n</mi>
            </msub>
          </mtd>
        </mtr>
      </mtable>
      <mo>]</mo>
    </mrow>
  </mrow>
  <mo>,</mo>
  <mstyle>
    <mspace width="1.7em" height="1.7ex"/>
  </mstyle>
  <mo>⁢</mo>
  <mrow>
    <mrow>
      <mi>or</mi>
      <mo>⁢</mo>
      <mstyle>
        <mspace width="1.7em" height="1.7ex"/>
      </mstyle>
      <mo>⁢</mo>
      <mi>Q</mi>
    </mrow>
    <mo>=</mo>
    <mrow>
      <mo>[</mo>
      <mtable>
        <mtr>
          <mtd>
            <msub>
              <mi>Q</mi>
              <mn>1</mn>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mi>⋮</mi>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msub>
              <mi>Q</mi>
              <mi>n</mi>
            </msub>
          </mtd>
        </mtr>
      </mtable>
      <mo>]</mo>
    </mrow>
  </mrow>
  <mo>,</mo>
</mrow>
</math>
</maths>
<br/>
where I<sub>i </sub>represents the current entering terminal i, and q<sub>i </sub>represents the charge at terminal i, where i=1, . . . , n. Similarly, the conductance or capacitance associated with each pair of terminals of the circuit element is stores as a local conductance G or capacitance matrix C, respectively,
</p>
<p id="p-0027" num="0026">
<maths id="MATH-US-00005" num="00005">
<math overflow="scroll">
<mrow>
  <mrow>
    <mi>G</mi>
    <mo>=</mo>
    <mrow>
      <mo>(</mo>
      <mtable>
        <mtr>
          <mtd>
            <msub>
              <mi>G</mi>
              <mn>11</mn>
            </msub>
          </mtd>
          <mtd>
            <mi>⋯</mi>
          </mtd>
          <mtd>
            <msub>
              <mi>G</mi>
              <mrow>
                <mn>1</mn>
                <mo>⁢</mo>
                <mi>n</mi>
              </mrow>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mi>⋮</mi>
          </mtd>
          <mtd>
            <mi>⋰</mi>
          </mtd>
          <mtd>
            <mi>⋮</mi>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msub>
              <mi>G</mi>
              <mrow>
                <mi>n</mi>
                <mo>⁢</mo>
                <mstyle>
                  <mspace width="0.3em" height="0.3ex"/>
                </mstyle>
                <mo>⁢</mo>
                <mn>1</mn>
              </mrow>
            </msub>
          </mtd>
          <mtd>
            <mi>⋯</mi>
          </mtd>
          <mtd>
            <msub>
              <mi>G</mi>
              <mi>nn</mi>
            </msub>
          </mtd>
        </mtr>
      </mtable>
      <mo>)</mo>
    </mrow>
  </mrow>
  <mo>,</mo>
  <mstyle>
    <mspace width="1.7em" height="1.7ex"/>
  </mstyle>
  <mo>⁢</mo>
  <mrow>
    <mrow>
      <mi>or</mi>
      <mo>⁢</mo>
      <mstyle>
        <mspace width="1.7em" height="1.7ex"/>
      </mstyle>
      <mo>⁢</mo>
      <mi>C</mi>
    </mrow>
    <mo>=</mo>
    <mrow>
      <mo>(</mo>
      <mtable>
        <mtr>
          <mtd>
            <msub>
              <mi>C</mi>
              <mn>11</mn>
            </msub>
          </mtd>
          <mtd>
            <mi>⋯</mi>
          </mtd>
          <mtd>
            <msub>
              <mi>C</mi>
              <mrow>
                <mn>1</mn>
                <mo>⁢</mo>
                <mi>n</mi>
              </mrow>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mi>⋮</mi>
          </mtd>
          <mtd>
            <mi>⋰</mi>
          </mtd>
          <mtd>
            <mi>⋮</mi>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msub>
              <mi>C</mi>
              <mrow>
                <mi>n</mi>
                <mo>⁢</mo>
                <mstyle>
                  <mspace width="0.3em" height="0.3ex"/>
                </mstyle>
                <mo>⁢</mo>
                <mn>1</mn>
              </mrow>
            </msub>
          </mtd>
          <mtd>
            <mi>⋯</mi>
          </mtd>
          <mtd>
            <msub>
              <mi>C</mi>
              <mi>nn</mi>
            </msub>
          </mtd>
        </mtr>
      </mtable>
      <mo>)</mo>
    </mrow>
  </mrow>
  <mo>,</mo>
</mrow>
</math>
</maths>
</p>
<p id="p-0028" num="0027">where G<sub>ij </sub>and C<sub>ij </sub>represents the conductance and capacitance, respectively, associated with terminals i and j, where j=1, . . . , n.</p>
<p id="p-0029" num="0028">The solver then checks at step <b>312</b> for correctness of the model results by determining whether the model results interrelate according to a plurality of preset rules. The step <b>312</b> may involve both the solver and the model engine in order to determine whether the model results interrelate according to some of the plurality of preset rules, as discussed below. If it is determined that the model results violate one or more of the plurality of preset rules in step <b>313</b>, the solver prompts for a model error check, which is done at step <b>314</b> either manually or automatically using a separate computer program module. After checking for correctness of the model results, the solver proceeds to step <b>316</b> in which the solver determines if another circuit element also needs model evaluation.</p>
<p id="p-0030" num="0029">If the solver determines that there is a second circuit element for which a device model needs to be evaluated, the solver obtains the a set of terminal biases for the second circuit element based on the initial operating point and goes back to step <b>304</b> to provide the set of terminal biases associated with the second circuit element to the model engine, which then performs model evaluation for the second circuit element at step <b>306</b> and provides the model results for the second circuit element to the solver at step <b>308</b>. The solver again stamps the model results into matrices in step <b>310</b> and checks the correctness of the model results for the second circuit element in step <b>312</b> to determine whether the results are interrelated according to the plurality of preset rules. If they are not, the solver again prompts for model error check. The solver then determines in step <b>316</b> if a third circuit element needs model evaluation.</p>
<p id="p-0031" num="0030">Steps <b>304</b> through <b>316</b> are thus repeated until the solver determines that no more circuit elements need model evaluation or the matrices associated with the circuit equations are filled. The solver then proceeds to obtain solutions of the states of the circuit by solving the circuit equations at step <b>318</b>. In one embodiment of the present invention, the solutions of the circuit equations include currents and node voltages in the circuit.</p>
<p id="p-0032" num="0031">Steps <b>303</b> through <b>318</b> are iterated until the solver determines that a convergence has been reached in step <b>319</b>. During the iteration, the solution of the circuit equations in each iteration round is used to form the operating point for the next iteration round in step <b>303</b>, and a convergence is considered to have been reached in step <b>319</b> when the difference between the solutions of two consecutive iteration rounds are below some preset limits. When the convergence is reached, the solver outputs the simulation results at step <b>320</b>.</p>
<p id="p-0033" num="0032">In one embodiment of the present invention, the plurality of the preset rules may include some or all of the following rules:
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0000">
    <ul id="ul0002" list-style="none">
        <li id="ul0002-0001" num="0033">1. The sum of the entries in the current vector is zero;</li>
        <li id="ul0002-0002" num="0034">2. The sum of the entries in the charge vector is zero;</li>
        <li id="ul0002-0003" num="0035">3. The sum of the entries in each row of the conductance matrix is zero;</li>
        <li id="ul0002-0004" num="0036">4. The sum of the entries in each column of the conductance matrix is zero;</li>
        <li id="ul0002-0005" num="0037">5. The sum of the entries in each row of the capacitance matrix is zero;</li>
        <li id="ul0002-0006" num="0038">6. The sum of the entries in each column of the capacitance matrix is zero;</li>
        <li id="ul0002-0007" num="0039">7. Each diagonal entry in the conductance matrix is non-negative;</li>
        <li id="ul0002-0008" num="0040">8. Each diagonal entry in the capacitance matrix is non-negative;</li>
        <li id="ul0002-0009" num="0041">9. Each entry in the conductance matrix is the derivative of a corresponding entry in the terminal current vector with respect to a corresponding terminal bias voltage, i.e.,</li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0034" num="0042">
<maths id="MATH-US-00006" num="00006">
<math overflow="scroll">
<mrow>
  <mrow>
    <msub>
      <mi>G</mi>
      <mi>ij</mi>
    </msub>
    <mo>=</mo>
    <mfrac>
      <mrow>
        <mo>∂</mo>
        <msub>
          <mi>I</mi>
          <mi>i</mi>
        </msub>
      </mrow>
      <mrow>
        <mo>∂</mo>
        <msub>
          <mi>V</mi>
          <mi>j</mi>
        </msub>
      </mrow>
    </mfrac>
  </mrow>
  <mo>;</mo>
</mrow>
</math>
</maths>
<ul id="ul0003" list-style="none">
    <li id="ul0003-0001" num="0000">
    <ul id="ul0004" list-style="none">
        <li id="ul0004-0001" num="0043">10. Each entry in the capacitance matrix is the derivative of a corresponding entry in the terminal charge vector with respect to a corresponding terminal bias voltage, i.e.,</li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0035" num="0044">
<maths id="MATH-US-00007" num="00007">
<math overflow="scroll">
<mrow>
  <msub>
    <mi>C</mi>
    <mi>ij</mi>
  </msub>
  <mo>=</mo>
  <mrow>
    <mfrac>
      <mrow>
        <mo>∂</mo>
        <msub>
          <mi>Q</mi>
          <mi>i</mi>
        </msub>
      </mrow>
      <mrow>
        <mo>∂</mo>
        <msub>
          <mi>V</mi>
          <mi>j</mi>
        </msub>
      </mrow>
    </mfrac>
    <mo>.</mo>
  </mrow>
</mrow>
</math>
</maths>
</p>
<p id="p-0036" num="0045">Rule #1 and Rule #2 can be used to test if the terminal currents and node charges of all the nodes associated with the circuit element are conservative. Rule #3 through Rule #6 can be used to test if the conductance and capacitance associated with each pair of the terminals of the circuit element are calculated correctly. Rule #7 and Rule #8 can be used to test if there are any non-physical results, such as negative resistor or negative capacitor, in the model results. Rule #9 can be used to check the consistency between the conductance associated with any pair of terminals and the corresponding terminal current. Rule #10 can be used to check the consistency between the capacitance associated with any pair of terminals and the corresponding node charge.</p>
<p id="p-0037" num="0046">Rule #1 through #10 are applicable to any device model when an equivalent circuit associated with the device model includes only resistors, capacitors, and voltage-controlled current sources and when the circuit element being modeled by the device model has no external connections other than those through the terminals of the circuit element. Thus, Rule #1 through #10 are applicable to all of the compact models currently available for circuit simulation, such as the device models for active devices including MOSFETs, BJTs, JFETs, MESFETs, DIODEs, TFTs, and passive devices including resistors, capacitors, etc.</p>
<p id="p-0038" num="0047"><figref idref="DRAWINGS">FIG. 4</figref> illustrates in further detail step <b>312</b> for checking the local variable matrices, such as I, Q, G, C, according to one embodiment of the present invention. As shown in <figref idref="DRAWINGS">FIG. 4</figref>, step <b>312</b> includes step <b>402</b> in which the local matrices are checked to see if they conform or substantially conform to some or all of Rule #1 through Rule #8, as stated above. When only substantial conformation is required, the sum of entries in the current vector, for example, does not have to be exactly zero to conform to Rule #1. When the sum of entries in the current vector is close to zero so that the difference between the sum of entries in the current vector and zero is within a predetermined limit, the local matrices are considered to substantially conform to Rule #1. The same is true for Rule #2 through #6 for substantial conformation.</p>
<p id="p-0039" num="0048">If Rule #9 and Rule #10 are to be checked, step <b>312</b> further includes steps <b>404</b>, <b>406</b>, <b>408</b>, <b>410</b> and <b>412</b>, which are performed for each terminal j, j=1, 2, . . . , n, of the circuit element. In step <b>404</b>, terminal bias V<sub>j </sub>corresponding to terminal j is changed slightly to V<sub>j</sub>+ΔV<sub>j </sub>in the set of terminal biases and the changed set of terminal biases {V<sub>1</sub>, . . . , V<sub>j</sub>+ΔV<sub>j</sub>, . . . , V<sub>n</sub>}, where j=1, 2, . . . , n, is supplied to the model engine. Upon receiving the changed set of terminal biases, the model engine performs model evaluation in step <b>406</b> and produces model results based on the changed terminal biases to the solver. Upon receiving the model results in step <b>408</b>, the solver arranges and stores the model results in step <b>410</b> as a new set of local variable matrices I′, Q′, G′, C′, and conformation with Rule 9 and/or Rule 10 are checked in step <b>512</b> by verifying that</p>
<p id="p-0040" num="0049">
<maths id="MATH-US-00008" num="00008">
<math overflow="scroll">
<mrow>
  <mrow>
    <msub>
      <mi>G</mi>
      <mi>ij</mi>
    </msub>
    <mo>=</mo>
    <mrow>
      <mfrac>
        <mrow>
          <mo>∂</mo>
          <msub>
            <mi>I</mi>
            <mi>i</mi>
          </msub>
        </mrow>
        <mrow>
          <mo>∂</mo>
          <msub>
            <mi>V</mi>
            <mi>j</mi>
          </msub>
        </mrow>
      </mfrac>
      <mo>≅</mo>
      <mfrac>
        <mrow>
          <msub>
            <mi>I</mi>
            <mi>i</mi>
          </msub>
          <mo>-</mo>
          <msubsup>
            <mi>I</mi>
            <mi>i</mi>
            <mi>′</mi>
          </msubsup>
        </mrow>
        <mrow>
          <mi>Δ</mi>
          <mo>⁢</mo>
          <mstyle>
            <mspace width="0.3em" height="0.3ex"/>
          </mstyle>
          <mo>⁢</mo>
          <msub>
            <mi>V</mi>
            <mi>j</mi>
          </msub>
        </mrow>
      </mfrac>
    </mrow>
  </mrow>
  <mo>,</mo>
  <mstyle>
    <mspace width="1.7em" height="1.7ex"/>
  </mstyle>
  <mo>⁢</mo>
  <mrow>
    <mrow>
      <mi>and</mi>
      <mo>⁢</mo>
      <mstyle>
        <mtext>/</mtext>
      </mstyle>
      <mo>⁢</mo>
      <mi>or</mi>
      <mo>⁢</mo>
      <mstyle>
        <mspace width="1.7em" height="1.7ex"/>
      </mstyle>
      <mo>⁢</mo>
      <msub>
        <mi>C</mi>
        <mi>ij</mi>
      </msub>
    </mrow>
    <mo>=</mo>
    <mrow>
      <mfrac>
        <mrow>
          <mo>∂</mo>
          <msub>
            <mi>Q</mi>
            <mi>i</mi>
          </msub>
        </mrow>
        <mrow>
          <mo>∂</mo>
          <msub>
            <mi>V</mi>
            <mi>j</mi>
          </msub>
        </mrow>
      </mfrac>
      <mo>≅</mo>
      <mrow>
        <mfrac>
          <mrow>
            <msub>
              <mi>Q</mi>
              <mi>i</mi>
            </msub>
            <mo>-</mo>
            <msubsup>
              <mi>Q</mi>
              <mi>i</mi>
              <mi>′</mi>
            </msubsup>
          </mrow>
          <mrow>
            <mi>Δ</mi>
            <mo>⁢</mo>
            <mstyle>
              <mspace width="0.3em" height="0.3ex"/>
            </mstyle>
            <mo>⁢</mo>
            <msub>
              <mi>V</mi>
              <mi>j</mi>
            </msub>
          </mrow>
        </mfrac>
        <mo>.</mo>
      </mrow>
    </mrow>
  </mrow>
</mrow>
</math>
</maths>
<br/>
When ΔV<sub>j </sub>is small enough, G<sub>ij </sub>should exactly equal to
</p>
<p id="p-0041" num="0050">
<maths id="MATH-US-00009" num="00009">
<math overflow="scroll">
<mfrac>
  <mrow>
    <msub>
      <mi>I</mi>
      <mi>i</mi>
    </msub>
    <mo>-</mo>
    <msubsup>
      <mi>I</mi>
      <mi>i</mi>
      <mi>′</mi>
    </msubsup>
  </mrow>
  <mrow>
    <mi>Δ</mi>
    <mo>⁢</mo>
    <mstyle>
      <mspace width="0.3em" height="0.3ex"/>
    </mstyle>
    <mo>⁢</mo>
    <msub>
      <mi>V</mi>
      <mi>j</mi>
    </msub>
  </mrow>
</mfrac>
</math>
</maths>
<br/>
and C<sub>ij </sub>should exactly equal to
</p>
<p id="p-0042" num="0051">
<maths id="MATH-US-00010" num="00010">
<math overflow="scroll">
<mfrac>
  <mrow>
    <msub>
      <mi>Q</mi>
      <mi>i</mi>
    </msub>
    <mo>-</mo>
    <msubsup>
      <mi>Q</mi>
      <mi>i</mi>
      <mi>′</mi>
    </msubsup>
  </mrow>
  <mrow>
    <mi>Δ</mi>
    <mo>⁢</mo>
    <mstyle>
      <mspace width="0.3em" height="0.3ex"/>
    </mstyle>
    <mo>⁢</mo>
    <msub>
      <mi>V</mi>
      <mi>j</mi>
    </msub>
  </mrow>
</mfrac>
</math>
</maths>
<br/>
if there is no error with model evaluation. Again, in some applications, only substantial conformation with Rule #9 and Rule #10 are required, and Rule #9 and Rule #10 are considered being substantially conformed with when the difference between G<sub>ij </sub>and
</p>
<p id="p-0043" num="0052">
<maths id="MATH-US-00011" num="00011">
<math overflow="scroll">
<mfrac>
  <mrow>
    <msub>
      <mi>I</mi>
      <mi>i</mi>
    </msub>
    <mo>-</mo>
    <msubsup>
      <mi>I</mi>
      <mi>i</mi>
      <mi>′</mi>
    </msubsup>
  </mrow>
  <mrow>
    <mi>Δ</mi>
    <mo>⁢</mo>
    <mstyle>
      <mspace width="0.3em" height="0.3ex"/>
    </mstyle>
    <mo>⁢</mo>
    <msub>
      <mi>V</mi>
      <mi>j</mi>
    </msub>
  </mrow>
</mfrac>
</math>
</maths>
<br/>
and the difference between C<sub>ij </sub>and
</p>
<p id="p-0044" num="0053">
<maths id="MATH-US-00012" num="00012">
<math overflow="scroll">
<mfrac>
  <mrow>
    <msub>
      <mi>Q</mi>
      <mi>i</mi>
    </msub>
    <mo>-</mo>
    <msubsup>
      <mi>Q</mi>
      <mi>i</mi>
      <mi>′</mi>
    </msubsup>
  </mrow>
  <mrow>
    <mi>Δ</mi>
    <mo>⁢</mo>
    <mstyle>
      <mspace width="0.3em" height="0.3ex"/>
    </mstyle>
    <mo>⁢</mo>
    <msub>
      <mi>V</mi>
      <mi>j</mi>
    </msub>
  </mrow>
</mfrac>
</math>
</maths>
<br/>
are within predetermined limits.
</p>
<p id="p-0045" num="0054">Thus, the present invention includes a self-contained method to insure the correctness of model stamping matrix without the need for golden data. The method is carried out during circuit simulation before circuit equations are solved. So, compared with prior art model QA techniques, which are standalone techniques performed after circuit simulation by comparing the simulation results with golden data, the present invention is more advantageous because it directly detects errors in model stamping matrix before solving the circuit equations. Also, without relying on golden data, the present invention provides a method to check for model evaluation errors over all applicable bias ranges. The method can also be used to check for inconsistency between terminal currents, node charges and their derivatives, i.e., conductance and capacitance, so that convergence problems associated with such inconsistencies can be avoided.</p>
<p id="p-0046" num="0055">To illustrate an application of the present invention, consider a gate resistance network in the BSIM4 model for modeling MOSFET devices, as shown in <figref idref="DRAWINGS">FIG. 5</figref>. The gate resistance network includes 5 nodes, Geltd, Gprime, G. intS, and intD, a resistor Rgeltd between node Geltd and node Gprime, a resistor R<sub>ii </sub>between node Gprime and node G, a capacitor Cgso between node Gprime and node intS, and a capacitor Cgdo between node Gprime and node intD. The charges associated with the capacitors Cgso and Cgdo should be calculated as in the following:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>Qgdo=Cgdo</i>×(<i>V</i><sub>Gprime</sub><i>−V</i><sub>int D</sub>), and<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>Qgso=Cgso</i>×(<i>V</i><sub>Gprime</sub><i>−V</i><sub>int S</sub>),<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where Qgdo and Qgso are the charges associated with the capacitors Cgso and Cgdo, respectively, and V<sub>Gprime</sub>, V<sub>intD</sub>, and V<sub>intS </sub>are the terminal bias voltages for nodes Gprime, intD, and intS, respectively. If Qgdo and Qgso are incorrectly calculated during model evaluation, such as in the following:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>Qgdo=Cgdo</i>×(<i>V</i><sub>G</sub><i>−V</i><sub>int D</sub>), and<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>Qgso=Cgso</i>×(<i>V</i><sub>G</sub><i>−V</i><sub>int S</sub>),<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where V<sub>G </sub>is the terminal bias voltage for node G, the incorrect calculation would cause inconsistency between Qgdo and Cgdo and between Qdso and Cgso and thus convergence problems in N-R iteration. This inconsistency cannot be detected using conventional model QA techniques but can be easily discovered using the present invention because the model results would violate Rule #10, as stated above.
</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-math idrefs="MATH-US-00001" nb-file="US07299428-20071120-M00001.NB">
<img id="EMI-M00001" he="8.81mm" wi="76.20mm" file="US07299428-20071120-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00002" nb-file="US07299428-20071120-M00002.NB">
<img id="EMI-M00002" he="18.03mm" wi="76.20mm" file="US07299428-20071120-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00003" nb-file="US07299428-20071120-M00003.NB">
<img id="EMI-M00003" he="18.03mm" wi="76.20mm" file="US07299428-20071120-M00003.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00004" nb-file="US07299428-20071120-M00004.NB">
<img id="EMI-M00004" he="11.68mm" wi="76.20mm" file="US07299428-20071120-M00004.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00005" nb-file="US07299428-20071120-M00005.NB">
<img id="EMI-M00005" he="11.68mm" wi="76.20mm" file="US07299428-20071120-M00005.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00006" nb-file="US07299428-20071120-M00006.NB">
<img id="EMI-M00006" he="6.69mm" wi="76.20mm" file="US07299428-20071120-M00006.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00007" nb-file="US07299428-20071120-M00007.NB">
<img id="EMI-M00007" he="6.69mm" wi="76.20mm" file="US07299428-20071120-M00007.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00008" nb-file="US07299428-20071120-M00008.NB">
<img id="EMI-M00008" he="7.03mm" wi="76.20mm" file="US07299428-20071120-M00008.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00009" nb-file="US07299428-20071120-M00009.NB">
<img id="EMI-M00009" he="7.03mm" wi="76.20mm" file="US07299428-20071120-M00009.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00010" nb-file="US07299428-20071120-M00010.NB">
<img id="EMI-M00010" he="7.03mm" wi="76.20mm" file="US07299428-20071120-M00010.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00011" nb-file="US07299428-20071120-M00011.NB">
<img id="EMI-M00011" he="7.03mm" wi="76.20mm" file="US07299428-20071120-M00011.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00012" nb-file="US07299428-20071120-M00012.NB">
<img id="EMI-M00012" he="7.03mm" wi="76.20mm" file="US07299428-20071120-M00012.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-claim-statement>We claim:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method for evaluating a device model for a circuit element, comprising:
<claim-text>supplying a first set of terminal biases associated with the circuit element;</claim-text>
<claim-text>obtaining a first set of model results based on the first set of terminal biases;</claim-text>
<claim-text>checking for correctness of the first set of model results by determining whether the first set of model results interrelate according to a plurality of rules; and</claim-text>
<claim-text>storing the first set of model results in a memory device.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the first set of model results include a current vector having a plurality of entries, and wherein determining whether the model results interrelate according to the plurality of rules comprises determining whether the sum of the plurality of entries in the current vector is zero.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the first set of model results include a charge vector having a plurality of entries, and wherein determining whether the first set of model results interrelate according to the plurality of rules comprises determining whether the sum of the plurality of entries in the charge vector is zero.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the first set of model results include a conductance matrix having a plurality of rows of entries, and wherein determining whether the first set of model results interrelate according to the plurality of rules comprises determining whether the sum of the entries in each of the plurality of rows of entries is zero.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the first set of model results include a conductance matrix having a plurality of columns of entries and wherein determining whether the first set of model results interrelate according to the plurality of rules comprises determining whether the sum of the entries in each of the plurality of columns of entries is zero.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the first set of model results include a capacitance matrix having a plurality of rows of entries, and wherein determining whether the first set of model results interrelate according to the plurality of rules comprises determining whether the sum of the entries in each of the plurality of rows of entries is zero.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the first set of model results include a capacitance matrix having a plurality of columns of entries, and wherein determining whether the first set of model results interrelate according to the plurality of rules comprises determining whether the sum of the entries in each of the plurality of columns of entries is zero.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the first set of model results include a conductance matrix having a plurality of diagonal entries, and wherein determining whether the first set of model results interrelate according to the plurality of rules comprises determining whether each diagonal entry is non-negative.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the first set of model results include a capacitance matrix having a plurality of diagonal entries, and wherein determining whether the first set of model results interrelate according to the plurality of rules comprises determining whether each diagonal entry is non-negative.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the first set of model results are stamped into designated positions in matrices associated with equations for simulating the circuit element.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein checking for correctness of the first set of model results further comprises:
<claim-text>supplying a second set of terminal biases that is slightly different from the first set of terminal biases;</claim-text>
<claim-text>obtaining a second set of model results based on the second set of terminal biases; and</claim-text>
<claim-text>checking for correctness of the first set of model results based on differences between the first set of model results and the second set of model results and on differences between the first set of terminal biases and the second set of terminal biases.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The method of <claim-ref idref="CLM-00011">claim 11</claim-ref> wherein all except one of the second set of terminal biases are equal to respective ones of the first set of terminal biases.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. A method for simulating a system having a large number of elements interconnected through their terminals, some or all of the elements are modeled by element models each for generating model results describing characteristic of an element under a set of terminal conditions; comprising:
<claim-text>obtaining a first set of model results associated with an clement in the system based on a first set of terminal conditions for the element;</claim-text>
<claim-text>checking for correctness of the first set of model results by determining whether the first set of model results interrelate according to a plurality of rules; and</claim-text>
<claim-text>storing the first set of model results in a memory device.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The method of <claim-ref idref="CLM-00013">claim 13</claim-ref> wherein the model results are stamped into designated entries in matrices associated with a set of matrix equations that simulate the system and the method further comprising:
<claim-text>obtaining solutions for states of the system by solving the set of matrix equations.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The method of <claim-ref idref="CLM-00014">claim 14</claim-ref>, further comprising:
<claim-text>forming a second set of terminal conditions for the element based on the solutions for the states of the system;</claim-text>
<claim-text>obtaining a second set of model results associated with the element based on the second set of terminal conditions for the element; and</claim-text>
<claim-text>checking for correctness of the second set of model results by determining whether the second set of model results interrelate according to the plurality of rules.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. A computer readable medium storing therein computer readable program instructions that, when executed by a computer, cause the computer to perform a method for evaluating a device model for a circuit element, the computer readable program instructions comprising:
<claim-text>instructions for supplying a first set of terminal biases;</claim-text>
<claim-text>instructions for obtaining a first set of model results based on the first set of terminal biases;</claim-text>
<claim-text>instructions for checking for correctness of the first set of model results by determining whether the first set of model results interrelate according to a plurality of rules; and</claim-text>
<claim-text>instructions for storing the first set of model results in a memory device.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The computer readable medium of <claim-ref idref="CLM-00016">claim 16</claim-ref> wherein the first set of model results include a current vector and a charge vector each having a plurality of entries, and wherein the instructions for determining whether the model results interrelate according to the plurality of rules comprises:
<claim-text>instructions for determining whether the sum of the plurality of entries in the current vector is zero; and</claim-text>
<claim-text>instructions for determining whether the sum of the plurality of entries in the charge vector is zero.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The computer readable medium of <claim-ref idref="CLM-00016">claim 16</claim-ref> wherein the first set of model results include a conductance matrix and a capacitance matrix each having a plurality of rows of entries and a plurality of columns of entries, and wherein the instructions for determining whether the first set of model results interrelate according to the plurality of rules comprises:
<claim-text>instructions for determining whether the sum of the entries in each of the plurality of rows of entries in the conductance matrix is zero;</claim-text>
<claim-text>instructions for determining whether the sum of the entries in each of the plurality of columns of entries in the conductance matrix is zero;</claim-text>
<claim-text>instructions for determining whether the sum of the entries in each of the plurality of rows of entries in the capacitance matrix is zero;</claim-text>
<claim-text>instructions for determining whether the sum of the entries in each of the plurality of columns of entries in the capacitance matrix is zero;</claim-text>
<claim-text>instructions for determining whether each diagonal entry in the conductance matrix is non-negative; and</claim-text>
<claim-text>instructions for determining whether each diagonal entry in the capacitance matrix is non-negative.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The computer readable medium of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the instructions for checking for correctness of the first set of model results further comprises:
<claim-text>instructions for supplying a second set of terminal biases that is slightly different from the first set of terminal biases;</claim-text>
<claim-text>instructions for obtaining a second set of model results based on the second set of terminal biases; and</claim-text>
<claim-text>instructions for checking for correctness of the first set of model results based on differences between the first set of model results and the second set of model results and on differences between the first set of terminal biases and the second set of terminal biases.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. The computer readable medium of <claim-ref idref="CLM-00019">claim 19</claim-ref> wherein all except one of the second set of terminal biases are equal to respective ones of the first set of terminal biases.</claim-text>
</claim>
</claims>
</us-patent-grant>
