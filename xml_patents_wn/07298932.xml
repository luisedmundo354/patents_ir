<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07298932-20071120.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20071106" date-publ="20071120">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07298932</doc-number>
<kind>B2</kind>
<date>20071120</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>10834662</doc-number>
<date>20040429</date>
</document-id>
</application-reference>
<us-application-series-code>10</us-application-series-code>
<us-term-of-grant>
<us-term-extension>658</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>K</subclass>
<main-group>9</main-group>
<subgroup>60</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20071120</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>382305</main-classification>
<further-classification>3482312</further-classification>
</classification-national>
<invention-title id="d0e53">Control apparatus and control method for image sensing apparatus</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5499294</doc-number>
<kind>A</kind>
<name>Friedman</name>
<date>19960300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713179</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5898779</doc-number>
<kind>A</kind>
<name>Squilla et al.</name>
<date>19990400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713176</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6889324</doc-number>
<kind>B1</kind>
<name>Kanai et al.</name>
<date>20050500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713176</main-classification></classification-national>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>6968058</doc-number>
<kind>B1</kind>
<name>Kondoh et al.</name>
<date>20051100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>380200</main-classification></classification-national>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>7055034</doc-number>
<kind>B1</kind>
<name>Levy</name>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713176</main-classification></classification-national>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>7075571</doc-number>
<kind>B1</kind>
<name>Nakajima et al.</name>
<date>20060700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>3482316</main-classification></classification-national>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2002/0001395</doc-number>
<kind>A1</kind>
<name>Davis et al.</name>
<date>20020100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382100</main-classification></classification-national>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2002/0051577</doc-number>
<kind>A1</kind>
<name>Kinjo</name>
<date>20020500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382218</main-classification></classification-national>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2002/0114454</doc-number>
<kind>A1</kind>
<name>Hamilton</name>
<date>20020800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>380200</main-classification></classification-national>
</citation>
<citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>2004/0218064</doc-number>
<kind>A1</kind>
<name>Wakao</name>
<date>20041100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00011">
<document-id>
<country>JP</country>
<doc-number>2001-078142</doc-number>
<date>20010300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00012">
<document-id>
<country>JP</country>
<doc-number>2002-244924</doc-number>
<date>20020800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00013">
<othercit>Schneider et al, “A robust content-based digital signature for image authentication,” Proc. ICIP'96, pp. 227-230, Lausanne, Switzerland, Sep. 1996.</othercit>
</nplcit>
<category>cited by examiner</category>
</citation>
<citation>
<nplcit num="00014">
<othercit>Lu et al, “Structural Digital Signature for Image Authentication:An Incidental Distortion Resistant Scheme”, IEEE Transactions on Multimedia, vol. 5, No. 2, Jun. 2003.</othercit>
</nplcit>
<category>cited by examiner</category>
</citation>
<citation>
<nplcit num="00015">
<othercit>English Abstract for Japanese Patent Application Laid-Open 2001-078142.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00016">
<othercit>English Abstract for Japanese Patent Application Laid-Open 2002-244924.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>12</number-of-claims>
<us-exemplary-claim>9</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>382100</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>34820799</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>3482312</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>3482316</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>713177</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>713176</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>380200</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>18</number-of-drawing-sheets>
<number-of-figures>18</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20040218053</doc-number>
<kind>A1</kind>
<date>20041104</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Wakao</last-name>
<first-name>Satoru</first-name>
<address>
<city>Kanagawa</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Morgan &amp; Finnegan LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Canon Kabushiki Kaisha</orgname>
<role>03</role>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Ahmed</last-name>
<first-name>Samir</first-name>
<department>2624</department>
</primary-examiner>
<assistant-examiner>
<last-name>Allison</last-name>
<first-name>Andrae</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A control apparatus which controls an image sensing apparatus, includes a determination unit, a command generating unit and a command sending unit. The determination unit determines whether or not verification data has been added to an image file, the verification data being used to determine whether or not a digital image in the image file has been altered. The command generating unit generates a command that requests the image sensing apparatus to change the contents of the image file. The command sending unit sends the command to the image sensing apparatus if the determination unit determines that the verification data has not been added to the image file, the command being not sent to the image sensing apparatus if the determination unit determines that the verification data has been added to the image file.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="211.07mm" wi="157.82mm" file="US07298932-20071120-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="80.18mm" wi="152.57mm" file="US07298932-20071120-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="193.21mm" wi="162.56mm" orientation="landscape" file="US07298932-20071120-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="163.24mm" wi="122.51mm" file="US07298932-20071120-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="115.65mm" wi="98.21mm" file="US07298932-20071120-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="189.82mm" wi="156.21mm" orientation="landscape" file="US07298932-20071120-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="162.98mm" wi="119.97mm" file="US07298932-20071120-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="112.95mm" wi="99.74mm" file="US07298932-20071120-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="161.97mm" wi="158.33mm" orientation="landscape" file="US07298932-20071120-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="225.30mm" wi="159.09mm" file="US07298932-20071120-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="241.47mm" wi="161.54mm" orientation="landscape" file="US07298932-20071120-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="242.65mm" wi="159.09mm" orientation="landscape" file="US07298932-20071120-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="175.34mm" wi="152.32mm" file="US07298932-20071120-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="175.94mm" wi="155.53mm" file="US07298932-20071120-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="244.43mm" wi="159.17mm" orientation="landscape" file="US07298932-20071120-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00015" num="00015">
<img id="EMI-D00015" he="244.52mm" wi="163.49mm" orientation="landscape" file="US07298932-20071120-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00016" num="00016">
<img id="EMI-D00016" he="112.78mm" wi="154.52mm" file="US07298932-20071120-D00016.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00017" num="00017">
<img id="EMI-D00017" he="160.78mm" wi="159.09mm" file="US07298932-20071120-D00017.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00018" num="00018">
<img id="EMI-D00018" he="158.41mm" wi="156.72mm" file="US07298932-20071120-D00018.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">FIELD OF THE INVENTION</heading>
<p id="p-0002" num="0001">The present invention relates to a control apparatus and control method which control an image sensing apparatus.</p>
<heading id="h-0002" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0003" num="0002">At present, there is proposed a system which verifies alteration of image data generated by an image sensing apparatus such as a digital camera (see, e.g., U.S. Pat. No. 5,499,294 and Japanese Patent Application Laid-Open No. 2002-244924).</p>
<p id="p-0004" num="0003">Japanese Patent Application Laid-Open No. 2001-78142 (reference 1) discloses an image sensing apparatus having a function of embedding verification data (data necessary to determine whether an image file has been altered: called “feature data” in reference 1) in a sensed image file, and an apparatus which inhibits any change of the contents of an image file when verification data is embedded in the image file.</p>
<p id="p-0005" num="0004">However, reference 1 does not consider any arrangement which prevents the image sensing apparatus from changing the contents of an image file (with verification data) in accordance with an instruction from an external control apparatus.</p>
<heading id="h-0003" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0006" num="0005">The present invention has been made to overcome the conventional drawbacks, and has as its main object to prevent an image sensing apparatus from changing the contents of an image file (with verification data) in accordance with an instruction from a control apparatus.</p>
<p id="p-0007" num="0006">According to an aspect of the present invention, a control apparatus which controls an image sensing apparatus, comprising: generation unit adapted to generate an instruction which requests the image sensing apparatus to perform predetermined processing for an image file; and determination unit adapted to determine whether verification data has been added to the image file, wherein generation of the instruction is controlled in accordance with a determination result of the determination unit.</p>
<p id="p-0008" num="0007">According to another aspect of the present invention, a control method of controlling an image sensing apparatus, comprising steps of: generating an instruction which requests the image sensing apparatus to perform predetermined processing for an image file; determining whether verification data has been added to the image file; and controlling generation of the instruction in accordance with a determination result of the determination step.</p>
<p id="p-0009" num="0008">Other features and advantages of the present invention will be apparent from the following description taken in conjunction with the accompanying drawings, in which like reference characters designate the same or similar parts throughout the figures thereof.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0010" num="0009">The accompanying drawings, which are incorporated in and constitute a part of the specification, illustrate embodiments of the invention and, together with the description, serve to explain the principles of the invention.</p>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram showing the main building components of an image verification system according to the first embodiment;</p>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 2</figref> is a block diagram showing the main building components of an image sensing apparatus <b>10</b>A;</p>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 3</figref> is a flow chart for explaining processing of generating an image file with an MAC;</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. 4</figref> is a view showing an example of the structure of an image file with an MAC;</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 5</figref> is a block diagram showing the main building components of an image sensing apparatus <b>10</b>B;</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 6</figref> is a flow chart for explaining processing of generating an image file with a digital signature;</p>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 7</figref> is a view showing an example of the structure of an image file with a digital signature;</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 8</figref> is a block diagram showing the main building components of an image verification apparatus <b>20</b>;</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 9</figref> is a flow chart for explaining image registration processing;</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 10</figref> is a view showing an example of a list window (before verification) for an “MAC” group;</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 11</figref> is a view showing an example of a list window (before verification) for a “digital signature” group;</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 12</figref> is a flow chart for explaining the first image verification processing;</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 13</figref> is a flow chart for explaining the second image verification processing;</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 14</figref> is a view showing an example of a list window (after verification) for the “MAC” group;</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 15</figref> is a view showing an example of a list window (after verification) for the “digital signature” group;</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 16</figref> is a block diagram for explaining the main building components of a control system according to the second embodiment;</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 17</figref> is a flow chart for explaining an example of processing executed in a control system comprised of an image sensing apparatus <b>10</b>A and computer <b>30</b> according to the second embodiment; and</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 18</figref> is a flow chart for explaining an example of processing executed in a control system comprised of an image sensing apparatus <b>10</b>B and computer <b>30</b> according to the second embodiment.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS</heading>
<p id="p-0029" num="0028">Preferred embodiments of the present invention will now be described in detail in accordance with the accompanying drawings.</p>
<heading id="h-0006" level="1">First Embodiment</heading>
<p id="p-0030" num="0029">The main building components of an image verification system according to the first embodiment of the present invention will be explained with reference to <figref idref="DRAWINGS">FIG. 1</figref>.</p>
<p id="p-0031" num="0030">An image sensing apparatus <b>10</b>A generates an image file with an MAC (Message Authentication Code) from digital image data of an object, and records the generated image file with the MAC on, e.g., a removable recording medium (e.g., a memory card) or the recording medium of an external apparatus. The image sensing apparatus <b>10</b>A can be implemented by an apparatus such as a digital camera, a digital video camera, a portable terminal (for example, PDA, cell phone, or the like) with a camera function, a scanner, a copying machine, or a facsimile apparatus.</p>
<p id="p-0032" num="0031">An image sensing apparatus <b>10</b>B generates an image file with a digital signature from digital image data of an object, and records the generated image file with the digital signature on, e.g., a removable recording medium (e.g., a memory card) or the recording medium of an external apparatus. Similar to the image sensing apparatus <b>10</b>A, the image sensing apparatus <b>10</b>B can be implemented by an apparatus such as a digital still camera, a digital video camera, a portable terminal (PDA, cell phone, or the like) with a camera function, a scanner, a copying machine, or a facsimile apparatus.</p>
<p id="p-0033" num="0032">In the following description, the image sensing apparatuses <b>10</b>A and <b>10</b>B are digital still cameras or apparatuses having the digital still camera function.</p>
<p id="p-0034" num="0033">An image verification apparatus <b>20</b> has a function of verifying whether an image file with an MAC generated by the image sensing apparatus <b>10</b>A or an image file with a digital signature generated by the image sensing apparatus <b>10</b>B has been altered, and a function of notifying the verifier (user) of the verification result. The image verification apparatus <b>20</b> also has a function of notifying the verifier of accessory information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, model name, manufacturing number, and the like) for an image file with an MAC or digital signature. These functions are realized, for example, by executing an image verification program stored in the program memory of the image verification apparatus <b>20</b> and performing necessary control.</p>
<p id="p-0035" num="0034">Processing of generating an image file with an MAC will be explained with reference to <figref idref="DRAWINGS">FIGS. 2 and 3</figref>. <figref idref="DRAWINGS">FIG. 2</figref> is a block diagram showing the main building components of the image sensing apparatus <b>10</b>A. <figref idref="DRAWINGS">FIG. 3</figref> is a flow chart for explaining MAC-attached image file generation processing executed by the image sensing apparatus <b>10</b>A. Processing shown in <figref idref="DRAWINGS">FIG. 3</figref> is realized when a controller <b>110</b>A having a CPU controls functional units shown in <figref idref="DRAWINGS">FIG. 2</figref> in accordance with a program stored in, for example, a nonvolatile memory <b>109</b>A.</p>
<p id="p-0036" num="0035">Step S<b>301</b>: the user manipulates an operation unit <b>111</b>A having a shutter button, lens zoom key, and the like, and inputs a photographing instruction to the controller <b>110</b>A. An image sensing unit <b>101</b>A having a lens, lens driving circuit, image sensing element, and the like senses an object in accordance with an instruction from the controller <b>110</b>A, and outputs a digital image.</p>
<p id="p-0037" num="0036">Step S<b>302</b>: the controller <b>110</b>A generates accessory information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, and the like) of the digital image sensed by the image sensing unit <b>101</b>A, and stores the generated accessory information in an internal memory <b>103</b>A.</p>
<p id="p-0038" num="0037">Step S<b>303</b>: an image processor <b>102</b>A determines an image recording format selected by manipulating the operation unit <b>111</b>A by the user before photographing.</p>
<p id="p-0039" num="0038">When the image recording format is, e.g., a JPEG format, the image processor <b>102</b>A reads out, from the nonvolatile memory <b>109</b>A, image adjustment parameters selected by manipulating the operation unit <b>111</b>A by the user before photographing. In the first embodiment, pieces of information for adjusting, e.g., the contrast, sharpness (edge emphasis), color density, color temperature, color space, compression ratio, and size (number of pixels) of a digital image after image sensing will be called “image adjustment parameters”.</p>
<p id="p-0040" num="0039">The image processor <b>102</b>A adjusts the digital image sensed by the image sensing unit <b>101</b>A in accordance with the image adjustment parameters read out from the nonvolatile memory <b>109</b>A. The image processor <b>102</b>A compresses the adjusted digital image in accordance with the JPEG format, and writes the compressed digital image in the internal memory <b>103</b>A.</p>
<p id="p-0041" num="0040">When the image recording format is, e.g., a RAW format, the image processor <b>102</b>A compresses the digital image sensed by the image sensing unit <b>101</b>A according to a predetermined lossless compression method without any adjustment in accordance with the image adjustment parameters in the nonvolatile memory <b>109</b>A. The image processor <b>102</b>A writes the compressed digital image in the internal memory <b>103</b>A.</p>
<p id="p-0042" num="0041">Step S<b>304</b>: an MAC generator <b>105</b>A generates a hash value (also called digest data) for the accessory information generated in step S<b>302</b> and the digital image processed in step S<b>303</b>. That is, the first embodiment verifies both the digital image and its accessory information. Examples of a hash function necessary to generate a hash value are MD5, SHA1, and RIPEMD.</p>
<p id="p-0043" num="0042">Step S<b>305</b>: the MAC generator <b>105</b>A converts the hash value into an MAC by using a common key Kc stored in advance in a memory <b>104</b>A formed by, e.g., a rewritable nonvolatile memory. The MAC generator <b>105</b>A stores the MAC in the internal memory <b>103</b>A. The MAC is information necessary to verify whether accessory information and a digital image have been altered. In other words, the MAC is information necessary to verify whether a digital image and accessory information are pieces of original information.</p>
<p id="p-0044" num="0043">The common key Kc is information corresponding to the common key of common key cryptography (which is cryptography using the same key as encryption and decryption keys and is also called secret key cryptography or symmetric key cryptography). The common key Kc is information which must be managed in secret in the image sensing apparatus <b>10</b>A.</p>
<p id="p-0045" num="0044">Step S<b>306</b>: the controller <b>110</b>A generates an image file with an MAC by using the internal memory <b>103</b>A. <figref idref="DRAWINGS">FIG. 4</figref> shows an example of the structure of an image file with an MAC.</p>
<p id="p-0046" num="0045">In <figref idref="DRAWINGS">FIG. 4</figref>, an area <b>401</b> stores accessory information generated in step S<b>302</b>. That is, the area <b>401</b> stores information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, and the like) on an image file, and information (for example, model name, manufacturing number, and the like) on an apparatus which has generated the image file. In the first embodiment, a number which specifies an apparatus that has generated an image file will be called a “manufacturing number”. An area <b>402</b> stores a digital image processed in step S<b>303</b>. That is, the area <b>402</b> stores an original image. An area <b>403</b> contains a marker representing the type of verification data present in an area <b>404</b>. In this case, the marker represents an MAC. The area <b>404</b> stores an MAC obtained in step S<b>305</b>. The area <b>404</b> can be set between the areas <b>401</b> and <b>402</b> or in the area <b>401</b>.</p>
<p id="p-0047" num="0046">Step S<b>307</b>: when the recording destination selected by manipulating the operation unit <b>111</b>A by the user before photographing is a recording medium <b>11</b>A, a memory controller <b>106</b>A writes in the recording medium <b>11</b>A the image file with the MAC generated in step S<b>306</b>. In the first embodiment, the recording medium <b>11</b>A is a removable recording medium such as a memory card. When the recording destination selected by manipulating the operation unit <b>111</b>A by the user before photographing is an external apparatus <b>12</b>A, a communication controller <b>107</b>A writes in the recording medium of the external apparatus <b>12</b>A the image file with the MAC generated in step S<b>306</b>. A display <b>108</b>A displays the reduced image of the image file with the MAC generated in step S<b>306</b>.</p>
<p id="p-0048" num="0047">Processing of generating an image file with a digital signature will be explained with reference to <figref idref="DRAWINGS">FIGS. 5 and 6</figref>. <figref idref="DRAWINGS">FIG. 5</figref> is a block diagram showing the main building components of the image sensing apparatus <b>10</b>B. <figref idref="DRAWINGS">FIG. 6</figref> is a flow chart for explaining processing of generating an image file with a digital signature. Processing shown in <figref idref="DRAWINGS">FIG. 6</figref> is realized when a controller <b>110</b>B controls functional units shown in <figref idref="DRAWINGS">FIG. 5</figref> in accordance with a program stored in a nonvolatile memory <b>109</b>B.</p>
<p id="p-0049" num="0048">Step S<b>601</b>: the user manipulates an operation unit <b>111</b>B having a shutter button, lens zoom key, and the like, and inputs a photographing instruction to the controller <b>110</b>B. An image sensing unit <b>101</b>B having a lens, lens driving circuit, image sensing element, and the like senses an object in accordance with an instruction from the controller <b>110</b>B, and outputs a digital image.</p>
<p id="p-0050" num="0049">Step S<b>602</b>: the controller <b>110</b>B generates accessory information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, and the like) of the digital image sensed by the image sensing unit <b>101</b>B, and stores the generated accessory information in an internal memory <b>103</b>B.</p>
<p id="p-0051" num="0050">Step S<b>603</b>: an image processor <b>102</b>B determines an image recording format selected by manipulating the operation unit <b>111</b>B by the user before photographing.</p>
<p id="p-0052" num="0051">When the image recording format is, e.g., a JPEG format, the image processor <b>102</b>B reads out, from the nonvolatile memory <b>109</b>B, image adjustment parameters selected by manipulating the operation unit <b>111</b>B by the user before photographing. In the first embodiment, pieces of information for adjusting, e.g., the contrast, sharpness (edge emphasis), color density, color temperature, color space, compression ratio, and size (number of pixels) of a digital image after image sensing will be called “image adjustment parameters”.</p>
<p id="p-0053" num="0052">The image processor <b>102</b>B adjusts the digital image sensed by the image sensing unit <b>101</b>B in accordance with the image adjustment parameters read out from the nonvolatile memory <b>109</b>B. The image processor <b>102</b>B compresses the adjusted digital image in accordance with the JPEG format, and writes the compressed digital image in the internal memory <b>103</b>B.</p>
<p id="p-0054" num="0053">When the image recording format is, e.g., a RAW format, the image processor <b>102</b>B compresses the digital image sensed by the image sensing unit <b>101</b>B according to a predetermined lossless compression method without any adjustment in accordance with the image adjustment parameters in the nonvolatile memory <b>109</b>B. The image processor <b>102</b>B writes the compressed digital image in the internal memory <b>103</b>B.</p>
<p id="p-0055" num="0054">Step S<b>604</b>: a digital signature generator <b>105</b>B generates a hash value (also called digest data) for the accessory information generated in step S<b>602</b> and the digital image processed in step S<b>603</b>. Similar to the image sensing apparatus <b>10</b>A, the image sensing apparatus <b>10</b>B verifies both the digital image and its accessory information. Examples of a hash function necessary to generate a hash value are MD5, SHA1, and RIPEMD.</p>
<p id="p-0056" num="0055">Step S<b>605</b>: the digital signature generator <b>105</b>B converts the hash value into a digital signature by using a private key Ks stored in advance in a memory <b>104</b>B formed by, e.g., a rewritable nonvolatile memory. The digital signature generator <b>105</b>B stores the digital signature in the internal memory <b>103</b>B. The digital signature is information necessary to verify whether accessory information and a digital image have been altered. In other words, the digital signature is information necessary to verify whether a digital image and accessory information are pieces of original information.</p>
<p id="p-0057" num="0056">The first embodiment adopts the private key Ks to generate a digital signature. The private key Ks is information corresponding to the private key of public key cryptography (which is cryptography using different encryption and decryption keys and is also called asymmetric key cryptography). The private key Ks is information which must be managed in secret in the image sensing apparatus <b>10</b>B.</p>
<p id="p-0058" num="0057">Step S<b>606</b>: the controller <b>110</b>B generates an image file with a digital signature by using the internal memory <b>103</b>B. <figref idref="DRAWINGS">FIG. 7</figref> shows an example of the structure of an image file with a digital signature.</p>
<p id="p-0059" num="0058">In <figref idref="DRAWINGS">FIG. 7</figref>, an area <b>501</b> stores accessory information generated in step S<b>602</b>. That is, the area <b>501</b> stores information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, and the like) on an image file, and information (for example, model name, manufacturing number, and the like) on an apparatus which has generated the image file. An area <b>502</b> stores a digital image processed in step S<b>603</b>. That is, the area <b>502</b> stores an original image. An area <b>503</b> contains a marker representing the type of verification data present in an area <b>504</b>. In this case, the marker represents a digital signature. The area <b>504</b> stores a digital signature obtained in step S<b>605</b>. The area <b>504</b> can be set between the areas <b>501</b> and <b>502</b> or in the area <b>501</b>.</p>
<p id="p-0060" num="0059">Step S<b>607</b>: when the recording destination selected by manipulating the operation unit <b>111</b>B by the user before photographing is a recording medium <b>11</b>B, a memory controller <b>106</b>B writes in the recording medium <b>11</b>B the image file with the digital signature generated in step S<b>606</b>. In the first embodiment, the recording medium <b>11</b>B is a removable recording medium such as a memory card. When the recording destination selected by manipulating the operation unit <b>111</b>B by the user before photographing is an external apparatus <b>12</b>B, a communication controller <b>107</b>B writes in the recording medium of the external apparatus <b>12</b>B the image file with the digital signature generated in step S<b>606</b>. A display <b>108</b>B displays the reduced image of the image file with the digital signature generated in step S<b>606</b>.</p>
<p id="p-0061" num="0060">The main building components of the image verification apparatus <b>20</b> will be explained with reference to <figref idref="DRAWINGS">FIG. 8</figref>.</p>
<p id="p-0062" num="0061">A memory controller <b>201</b> reads out an image file with an MAC or digital signature selected by the verifier from a removable recording medium <b>202</b>, and stores the readout image file with the MAC or digital signature in an internal memory <b>205</b>. The removable recording medium <b>202</b> may be connectable to the image sensing apparatus <b>10</b>A or <b>10</b>B.</p>
<p id="p-0063" num="0062">A communication controller <b>203</b> reads out the image file with the MAC or digital signature selected by the verifier from the recording medium of an external apparatus <b>204</b> via a network, and stores the readout image file with the MAC or digital signature in the internal memory <b>205</b>. The external apparatus <b>204</b> may be the image sensing apparatus <b>10</b>A or <b>10</b>B.</p>
<p id="p-0064" num="0063">A memory <b>206</b> stores the common key Kc necessary to verify alteration of an image file with an MAC. The common key Kc is the same key as a common key Kc managed in secret by the image sensing apparatus <b>10</b>A. The common key Kc is also information which must be managed in secret in the image verification apparatus <b>20</b>. A first image verification unit <b>207</b> verifies using the common key Kc in the memory <b>206</b> whether the image file with the MAC in the internal memory <b>205</b> has been altered.</p>
<p id="p-0065" num="0064">A memory <b>208</b> stores a public key Kp necessary to verify alteration of an image file with a digital signature. The public key Kp corresponds to the private key Ks managed in secret by the image sensing apparatus <b>10</b>B. The public key Kp is information which corresponds to the public key of public key cryptography and need not be managed in secret. A second image verification unit <b>209</b> verifies using the private key Ks in the memory <b>208</b> whether an image file with a digital signature in the internal memory <b>205</b> has been altered.</p>
<p id="p-0066" num="0065">A main controller <b>210</b> has a microcomputer which executes an image verification program stored in a program memory <b>211</b>.</p>
<p id="p-0067" num="0066">A display <b>212</b> displays a list window which is generated by the main controller <b>210</b> in accordance with the image verification program. Examples of the list window are illustrated in <figref idref="DRAWINGS">FIGS. 10 and 11</figref>. The list window shown in <figref idref="DRAWINGS">FIG. 10</figref> is a list window for an “MAC” group, and displays, side by side, pieces of accessory information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, model name, manufacturing number, and the like), file names, sizes, and verification results for all image files with MACs belonging to the “MAC” group. The list window shown in <figref idref="DRAWINGS">FIG. 11</figref> is a list window for a “digital signature” group, and contains pieces of accessory information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, model name, manufacturing number, and the like), file names, sizes, and verification results for all image files with digital signatures belonging to the “digital signature” group.</p>
<p id="p-0068" num="0067">As shown in <figref idref="DRAWINGS">FIGS. 10 and 11</figref>, the first embodiment displays the MAC group, digital signature group, and “others” group by assigning different tabs. Although these groups may also be displayed in independent windows, tab display facilitates switching between groups to be displayed.</p>
<p id="p-0069" num="0068">An operation unit <b>213</b> receives an instruction from the verifier, and supplies the received instruction to the main controller <b>210</b>. The verifier manipulates the operation unit <b>213</b> to register an image file with an MAC or digital signature in the image verification apparatus. The verifier manipulates the operation unit <b>213</b> to select an image file with an MAC or digital signature to be verified in accordance with the image verification program.</p>
<p id="p-0070" num="0069">The operation unit <b>213</b> includes, e.g., a touch panel arranged on the display <b>212</b>, and allows clicking a button contained in a GUI displayed on the display <b>212</b> or designating switching of a tab to be displayed.</p>
<p id="p-0071" num="0070">Image registration processing of registering one or more image files selected by the user in the image verification program will be explained with reference to the flow chart of <figref idref="DRAWINGS">FIG. 9</figref>. Image registration processing is controlled in accordance with the image verification program stored in, for example, the program memory <b>211</b>.</p>
<p id="p-0072" num="0071">Step S<b>901</b>: the main controller <b>210</b> selects one image file in accordance with a predetermined order from one or more image files selected by the user. An image file selected by the main controller <b>210</b> will be called a “selected image file”. When the user selects a folder, the main controller <b>210</b> performs processing on the assumption that all image files in the folder have been selected.</p>
<p id="p-0073" num="0072">Step S<b>902</b>: the main controller <b>210</b> opens the selected image file, and determines whether the selected image file has successfully been opened. If YES in step S<b>902</b>, the flow advances to step S<b>904</b>; if NO, to step S<b>903</b>.</p>
<p id="p-0074" num="0073">Step S<b>903</b>: the main controller <b>210</b> displays on the display <b>212</b> a message or sign representing that opening of the selected image file has failed.</p>
<p id="p-0075" num="0074">Step S<b>904</b>: the main controller <b>210</b> reads the selected image file in order to load the selected image file from the removable recording medium <b>202</b> or the recording medium of the external apparatus <b>204</b> into the internal memory <b>205</b>. If read of the selected image file fails, the flow advances to step S<b>905</b>; if read of the selected image file is successful, to step S<b>906</b>.</p>
<p id="p-0076" num="0075">Step S<b>905</b>: the main controller <b>210</b> displays on the display <b>212</b> a message or sign representing that read of the selected image file has failed.</p>
<p id="p-0077" num="0076">Step S<b>906</b>: the main controller <b>210</b> inspects the file format of the selected image file in the internal memory <b>205</b>, and determines whether the file format of the selected image file is normal. If YES in step S<b>906</b>, the flow advances to step S<b>908</b>; if NO, to step S<b>907</b>.</p>
<p id="p-0078" num="0077">Step S<b>907</b>: if NO in step S<b>906</b>, the main controller <b>210</b> discards the selected image file in the internal memory <b>205</b>, and displays on the display <b>212</b> a message or sign representing that the file format of the selected image file is abnormal.</p>
<p id="p-0079" num="0078">Step S<b>908</b>: if YES in step S<b>906</b>, the main controller <b>210</b> determines whether verification data (MAC or digital signature in the first embodiment) has been added to the selected image file. If YES in step S<b>908</b>, the flow advances to step S<b>910</b>; if NO, to step S<b>909</b>.</p>
<p id="p-0080" num="0079">Step S<b>909</b>: if NO in step S<b>908</b>, the main controller <b>210</b> classifies the selected image file into the “others” group. The “others” group contains image files having no MAC or digital signature. The main controller <b>210</b> registers the accessory information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, model name, manufacturing number, and the like), file name, and size of the selected image file in an “others” table within the internal memory <b>205</b>. The “others” table is a management table which manages image files classified into the “others” group. The main controller <b>210</b> displays the thumbnail image, file name, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, and manufacturing number of the selected image file side by side in the list window for the “others” group. If no thumbnail image can be extracted from the selected image file, the main controller <b>210</b> displays a message or sign representing that no thumbnail image exists, in a column which displays a thumbnail image in the list window. The main controller <b>210</b> displays the total number of image files belonging to the “others” group in the list window.</p>
<p id="p-0081" num="0080">Step S<b>910</b>: the main controller <b>210</b> detects the type of verification data added to the selected image file. If the verification data is an MAC, the flow advances to step S<b>912</b>; if the verification data is a digital signature, to step S<b>911</b>.</p>
<p id="p-0082" num="0081">Step S<b>911</b>: if the verification data of the selected image file is a digital signature, the main controller <b>210</b> classifies the selected image file into the “digital signature” group. The “digital signature” group contains image files with digital signatures. The main controller <b>210</b> registers the accessory information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, model name, manufacturing number, and the like), file name, and size of the selected image file in a “digital signature” table within the internal memory <b>205</b>. The “digital signature” table is a management table which manages image files classified into the “digital signature” group. For example, as shown in <figref idref="DRAWINGS">FIG. 11</figref>, the main controller <b>210</b> displays the thumbnail image, file name, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, and manufacturing number of the selected image file side by side in the list window for the “digital signature” group. If the selected image file does not have any thumbnail image, the main controller <b>210</b> displays a message or sign representing that no thumbnail image exists, in a column which displays a thumbnail image in the list window. As shown in <figref idref="DRAWINGS">FIG. 11</figref>, the main controller <b>210</b> displays the total number (seven in the first embodiment) of image files belonging to the “digital signature” group in the list window, and the total number (20 in the first embodiment) of image files belonging to all the groups.</p>
<p id="p-0083" num="0082">Step S<b>912</b>: if the verification data of the selected image file is an MAC, the main controller <b>210</b> classifies the selected image file into the “MAC” group. The “MAC” group contains image files with MACs. The main controller <b>210</b> registers the accessory information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, model name, manufacturing number, and the like), file name, and size of the selected image file in an “MAC” table within the internal memory <b>205</b>. The “MAC” table is a management table which manages image files classified into the “MAC” group. As shown in <figref idref="DRAWINGS">FIG. 10</figref>, the main controller <b>210</b> displays the thumbnail image, file name, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, and manufacturing number of the selected image file side by side in the list window for the “MAC” group. If the selected image file does not have any thumbnail image, the main controller <b>210</b> displays a message or sign representing that no thumbnail image exists, in a column which displays a thumbnail image in the list window. For example, as shown in <figref idref="DRAWINGS">FIG. 10</figref>, the main controller <b>210</b> displays the total number (10 in the first embodiment) of image files belonging to the “MAC” group in the list window, and the total number (20 in the first embodiment) of image files belonging to all the groups.</p>
<p id="p-0084" num="0083">Step S<b>913</b>: the main controller <b>210</b> determines whether all image files selected by the user have been registered. If NO in step S<b>913</b>, the main controller <b>210</b> returns to step S<b>901</b>.</p>
<p id="p-0085" num="0084">By the above sequence, the image verification apparatus <b>20</b> according to the first embodiment can register one or more image files selected by the user.</p>
<p id="p-0086" num="0085">The first image verification processing of verifying whether an image file with an MAC has been altered will be described with reference to the flow chart of <figref idref="DRAWINGS">FIG. 12</figref>. The first image verification processing is executed by the first image verification unit <b>207</b> of the image verification apparatus <b>20</b> under the control of the main controller <b>210</b>.</p>
<p id="p-0087" num="0086">Step S<b>1201</b>: the user selects one or more image files with MACs to be verified from the “MAC” group tab in the list window by using the operation unit <b>213</b>, and designates the start of verification by clicking a “verification start” button shown in <figref idref="DRAWINGS">FIG. 10</figref>. The main controller <b>210</b> detects that the “verification start” button has been clicked, and selects one image file with an MAC in accordance with a predetermined order from the one or more image files with MACs selected by the user. An image file with an MAC selected by the main controller <b>210</b> will be called a “selected image file”.</p>
<p id="p-0088" num="0087">Step S<b>1202</b>: the main controller <b>210</b> loads the selected image file from the removable recording medium <b>202</b> or the recording medium of the external apparatus <b>204</b> into the internal memory <b>205</b>, and requests the first image verification unit <b>207</b> to verify the selected image file. The first image verification unit <b>207</b> extracts accessory information and digital image data from the areas <b>401</b> and <b>402</b> of the selected image file, and generates their hash value.</p>
<p id="p-0089" num="0088">Step S<b>1203</b>: the first image verification unit <b>207</b> extracts the MAC from the area <b>404</b> of the selected image file, and reads out the common key Kc from the memory <b>206</b>. The first image verification unit <b>207</b> converts (decrypts) the MAC back into a hash value by using the common key Kc.</p>
<p id="p-0090" num="0089">Step S<b>1204</b>: the first image verification unit <b>207</b> compares the hash value obtained in step S<b>1202</b> and the hash value obtained in step S<b>1203</b>, and determines whether the two hash values coincide with each other, in order to verify whether the selected image file has been altered. If the areas <b>401</b>, <b>402</b>, and <b>404</b> of the selected image file have not been altered, the two hash values coincide with each other. In this case, the first image verification unit <b>207</b> determines “not altered”, in other words, that the selected image file is an original.</p>
<p id="p-0091" num="0090">If at least one of the areas <b>401</b>, <b>402</b>, and <b>404</b> of the selected image file has been altered, the two hash values do not coincide with each other. In this case, the first image verification unit <b>207</b> determines “altered”, in other words, the selected image file is not an original. The determination result of the first image verification unit <b>207</b> is sent to the main controller <b>210</b>.</p>
<p id="p-0092" num="0091">Step S<b>1205</b>: if the two hash values coincide with each other, the main controller <b>210</b> displays “OK” in the column for the verification result of the selected image file in the list window, as shown in <figref idref="DRAWINGS">FIG. 14</figref>. “OK” is information representing that the selected image file is an image file determined to be “not altered”.</p>
<p id="p-0093" num="0092">Step S<b>1206</b>: if the two hash values do not coincide with each other, the main controller <b>210</b> displays “NG” in the verification result column, as shown in <figref idref="DRAWINGS">FIG. 14</figref>. “NG” is information representing that the selected image file is an image file determined to have been “altered”. If the selected image file is an image file determined to have been “altered”, accessory information in the area <b>401</b> may have been altered. To notify the user that accessory information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, manufacturing number, and the like) obtained from the area <b>401</b> of the selected image file may have been altered, the main controller <b>210</b> changes the display form of the accessory information in the list window for the selected image file determined to have been “altered”.</p>
<p id="p-0094" num="0093">As change examples of the display form, the first to third display forms will be explained. In the first display form, all pieces of information displayed in the columns for the thumbnail, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, and manufacturing number are erased. In the second display form, a sign (e.g., “×”) representing the possibility of alteration is added to a thumbnail image displayed in the thumbnail column, and all pieces of information displayed in the columns for the photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, and manufacturing number are erased, for example, as shown in <figref idref="DRAWINGS">FIG. 14</figref>. In the third display form, a sign (e.g., “×”) representing the possibility of alteration is added to all pieces of information displayed in the columns for the thumbnail, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, and manufacturing number. Another display form can also be adopted as far as the display form can notify the user that accessory information of the selected image file may have been altered.</p>
<p id="p-0095" num="0094">Step S<b>1207</b>: the main controller <b>210</b> determines whether all image files with MACs selected by the user have been verified. If NO in step S<b>1207</b>, the flow returns to step S<b>1201</b>.</p>
<p id="p-0096" num="0095">By this processing sequence, the image verification apparatus <b>20</b> can verify whether an image file with an MAC selected by the user has been altered.</p>
<p id="p-0097" num="0096">The second image verification processing of verifying whether an image file with a digital signature has been altered will be described with reference to the flow chart of <figref idref="DRAWINGS">FIG. 13</figref>. The second image verification processing is executed by the second image verification unit <b>209</b> of the image verification apparatus <b>20</b> under the control of the main controller <b>210</b>.</p>
<p id="p-0098" num="0097">Step S<b>1301</b>: the user selects, from the “digital signature” group, one or more image files with digital signatures to be verified in accordance with the image verification program, and clicks a “verification start” button shown in <figref idref="DRAWINGS">FIG. 11</figref>. The main controller <b>210</b> detects that the “verification start” button has been clicked, and selects one image file with a digital signature in accordance with a predetermined order from the one or more image files with digital signatures selected by the user. An image file with a digital signature selected by the main controller <b>210</b> will be called a “selected image file”.</p>
<p id="p-0099" num="0098">Step S<b>1302</b>: the main controller <b>210</b> loads the selected image file from the removable recording medium <b>202</b> or the recording medium of the external apparatus <b>204</b> into the internal memory <b>205</b>, and requests the second image verification unit <b>209</b> to verify the selected image file. The second image verification unit <b>209</b> extracts accessory information and digital image data from the areas <b>501</b> and <b>502</b> of the selected image file, and generates their hash value.</p>
<p id="p-0100" num="0099">Step S<b>1303</b>: the second image verification unit <b>209</b> extracts the digital signature from the area <b>504</b> of the selected image file, and reads out the public key Kp from the memory <b>208</b>. The second image verification unit <b>209</b> converts (decrypts) the digital signature back into a hash value by using the public key Kp.</p>
<p id="p-0101" num="0100">Step S<b>1304</b>: the second image verification unit <b>209</b> compares the hash value obtained in step S<b>1302</b> and the hash value obtained in step S<b>1303</b>, and determines whether the two hash values coincide with each other, in order to verify whether the selected image file has been altered. If the areas <b>501</b>, <b>502</b>, and <b>504</b> of the selected image file have not been altered, the two hash values coincide with each other. In this case, the main controller <b>210</b> determines “not altered”, in other words, that the selected image file is an original.</p>
<p id="p-0102" num="0101">If at least one of the areas <b>501</b>, <b>502</b>, and <b>504</b> of the selected image file has been altered, the two hash values do not coincide with each other. In this case, the main controller <b>210</b> determines “altered”, in other words, the selected image file is not an original. The determination result of the second image verification unit <b>209</b> is sent to the main controller <b>210</b>.</p>
<p id="p-0103" num="0102">Step S<b>1305</b>: if the two hash values coincide with each other, the main controller <b>210</b> displays “OK” in the column for the verification result of the selected image file in the list window, as shown in <figref idref="DRAWINGS">FIG. 15</figref>. “OK” is information representing that the selected image file is an image file determined to be “not altered”.</p>
<p id="p-0104" num="0103">Step S<b>1306</b>: if the two hash values do not coincide with each other, the main controller <b>210</b> displays “NG” in the verification result column, as shown in <figref idref="DRAWINGS">FIG. 15</figref>. “NG” is information representing that the selected image file is an image file determined to have been “altered”. If the selected image file is an image file determined to have been “altered”, accessory information in the area <b>501</b> may have been altered. To notify the user that accessory information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, manufacturing number, and the like) obtained from the area <b>501</b> of the selected image file may have been altered, the main controller <b>210</b> changes the display form of the accessory information in the list window for the selected image file determined to have been “altered”.</p>
<p id="p-0105" num="0104">As change examples of the display form, the first to third display forms will be explained. In the first display form, all pieces of information displayed in the columns for the thumbnail, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, and manufacturing number are erased. In the second display form, a sign (e.g., “×”) representing the possibility of alteration is added to a thumbnail image displayed in the thumbnail column, and all pieces of information displayed in the columns for the photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, and manufacturing number are erased, for example, as shown in <figref idref="DRAWINGS">FIG. 15</figref>. In the third display form, a sign (e.g., “×”) representing the possibility of alteration is added to all pieces of information displayed in the columns for the thumbnail, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, and manufacturing number. Another display form can also be adopted as far as the display form can notify the user that accessory information of the selected image file may have been altered.</p>
<p id="p-0106" num="0105">Step S<b>1307</b>: the main controller <b>210</b> determines whether all image files with digital signatures selected by the user have been verified. If NO in step S<b>1307</b>, the main controller <b>210</b> returns to step S<b>1301</b>.</p>
<p id="p-0107" num="0106">By this processing sequence, the image verification apparatus <b>20</b> can verify whether an image file with a digital signature selected by the user has been altered.</p>
<p id="p-0108" num="0107">In this manner, the image verification apparatus <b>20</b> according to the first embodiment can change the display form of accessory information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, manufacturing number, and the like) of an image file with an MAC determined to have been altered. The user can be notified in an easy-to-understand way of accessory information which may have been altered.</p>
<p id="p-0109" num="0108">Also, the image verification apparatus <b>20</b> according to the first embodiment can change the display form of accessory information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, manufacturing number, and the like) of an image file with a digital signature determined to have been altered. The user can be notified in an easy-to-understand way of accessory information which may have been altered.</p>
<heading id="h-0007" level="1">Second Embodiment</heading>
<p id="p-0110" num="0109">The main building components of a control system according to the second embodiment of the present invention will be explained with reference to <figref idref="DRAWINGS">FIG. 16</figref>. The control system according to the second embodiment employs a computer <b>30</b> as a control apparatus which controls an image sensing apparatus <b>10</b>A or <b>10</b>B, instead of the image verification apparatus in the verification system according to the first embodiment described with reference to <figref idref="DRAWINGS">FIG. 1</figref>. The computer <b>30</b> controls the image sensing apparatuses <b>10</b>A and <b>10</b>B in accordance with a control program recorded on a recording medium <b>40</b>. The computer <b>30</b> can function as an external apparatus <b>12</b>A or <b>12</b>B for the image sensing apparatus <b>10</b>A or <b>10</b>B, i.e., can communicate with a communication controller <b>107</b>A of the image sensing apparatus <b>10</b>A and a communication controller <b>107</b>B of the image sensing apparatus <b>10</b>B. The computer <b>30</b> can be implemented by the same arrangement as that of the image verification apparatus described in the first embodiment, and may have the function of the image verification apparatus.</p>
<p id="p-0111" num="0110">The image sensing apparatuses <b>10</b>A and <b>10</b>B according to the second embodiment have a function of changing the contents of image files present in internal memories <b>103</b>A and <b>103</b>B or recording media <b>11</b>A and <b>11</b>B in accordance with an instruction from the computer <b>30</b>. This function can be realized using image processors <b>102</b>A and <b>102</b>B by interpreting commands received via the communication controllers <b>107</b>A and <b>107</b>B by controllers <b>110</b>A and <b>110</b>B.</p>
<p id="p-0112" num="0111">An example of processing executed in a control system comprised of the image sensing apparatus <b>10</b>A and computer <b>30</b> will be explained with reference to the flow chart of <figref idref="DRAWINGS">FIG. 17</figref>.</p>
<p id="p-0113" num="0112">The computer <b>30</b> inquires, e.g., the contents of an image file in the recording medium <b>11</b>A of the image sensing apparatus <b>10</b>A. The image sensing apparatus <b>10</b>A acquires and sends back pieces of information (e.g., the file name and reduced image of each image file) necessary to create a list window for image files in the recording medium <b>11</b>A. Using these pieces of information, the computer <b>30</b> displays a list window capable of selecting an image file on a display <b>212</b>.</p>
<p id="p-0114" num="0113">Step S<b>1701</b>: whether the user has selected one image file from the list window via an operation unit <b>213</b> is determined. If YES in step S<b>1701</b>, the computer <b>30</b> advances to step S<b>1702</b>. An image file selected by the user will be called a “selected image file”.</p>
<p id="p-0115" num="0114">Step S<b>1702</b>: the computer <b>30</b> determines whether the user has selected one change process from a plurality of change processes provided on, e.g., a menu window or context menu (menu displayed by mouse clicking). In this case, development processing, recompression processing, or size change processing can be selected as the change process.</p>
<p id="p-0116" num="0115">Development processing can be selected when the selected image file is a RAW image file (image file recorded in the RAW format). A digital image in the selected image file is adjusted in accordance with image adjustment parameters input by the user to the computer <b>30</b>. The adjusted digital image is compressed in the JPEG format.</p>
<p id="p-0117" num="0116">Recompression processing can be selected when the selected image file is a JPEG image file (image file recorded in the JPEG format). The compression ratio of a digital image in the selected image file is changed to a compression ratio input by the user to the computer <b>30</b>. The compression ratio selectable in recompression processing is smaller than the original compression ratio of the selected image file.</p>
<p id="p-0118" num="0117">Size change processing can be selected when the selected image file is a JPEG image file. The size (number of pixels) of a digital image in the selected image file is changed to a size (number of pixels) input by the user to the computer <b>30</b>. The size selectable in size change processing is smaller than the original size of the selected file.</p>
<p id="p-0119" num="0118">If any change processing is selected in step S<b>1702</b>, the flow advances to step S<b>1703</b>.</p>
<p id="p-0120" num="0119">Step S<b>1703</b>: the computer <b>30</b> causes, e.g., the image sensing apparatus <b>10</b>A to examine whether an MAC has been added to the selected image file. The image sensing apparatus <b>10</b>A examines the selected image file in the recording medium <b>11</b>A in accordance with an instruction from the computer <b>30</b>, determines the presence/absence of an MAC, and notifies the computer <b>30</b> of the determination result. If no MAC is added to the selected image file, the flow advances to step S<b>1704</b>; if an MAC is added to the selected image file, to step S<b>1706</b>.</p>
<p id="p-0121" num="0120">Step S<b>1704</b>: the computer <b>30</b> generates a command (instruction) which requests to change the contents of the selected image file in accordance with change processing selected by the user, and transmits the generated command to the image sensing apparatus <b>10</b>A. This command contains information which specifies the selected image file, and information necessary for change processing selected by the user. The controller <b>110</b>A receives the command by using the communication controller <b>107</b>A, and changes the contents of the selected image file in accordance with the command. After changing the contents of the selected image file, the controller <b>110</b>A sends back, to the computer <b>30</b> by using the communication controller <b>107</b>A, a response representing that the contents of the selected image file have been changed.</p>
<p id="p-0122" num="0121">Step S<b>1705</b>: the computer <b>30</b> receives the response from the image sensing apparatus <b>10</b>A, and then displays, on the display <b>212</b> of the computer <b>30</b>, a message that change processing selected by the user has been executed.</p>
<p id="p-0123" num="0122">Step S<b>1706</b>: the computer <b>30</b> inhibits execution of change processing selected by the user in order to prevent any change of the contents of the selected image file. At this time, the computer <b>30</b> does not generate any command (instruction) which requests to change the contents of the selected image file in accordance with change processing selected by the user, and does not transmit any command to the image sensing apparatus <b>10</b>A.</p>
<p id="p-0124" num="0123">Step S<b>1707</b>: the computer <b>30</b> displays on the display <b>212</b> a message which notifies the user that change processing selected by the user cannot be executed.</p>
<p id="p-0125" num="0124">In this manner, when an MAC has been added to a selected image file, the computer <b>30</b> according to the second embodiment inhibits transmission, to the image sensing apparatus <b>10</b>A, of a command (instruction) which requests to change the contents of the selected image file in accordance with change processing selected by the user. This can prevent the image sensing apparatus <b>10</b>A from changing the contents of the selected image file (with the MAC) in accordance with an instruction from the computer <b>30</b>.</p>
<p id="p-0126" num="0125">An example of processing executed in a control system comprised of the image sensing apparatus <b>10</b>B and computer <b>30</b> will be explained with reference to the flow chart of <figref idref="DRAWINGS">FIG. 18</figref>.</p>
<p id="p-0127" num="0126">Step S<b>1801</b>: the computer <b>30</b> determines whether the user has selected one image file from the recording medium <b>11</b>B. If YES in step S<b>1801</b>, the computer <b>30</b> advances to step S<b>1802</b>. An image file selected by the user will be called a “selected image file”.</p>
<p id="p-0128" num="0127">Step S<b>1802</b>: the computer <b>30</b> determines whether the user has selected one change process from a plurality of change processes. As described above, development processing, recompression processing, or size change processing can be selected.</p>
<p id="p-0129" num="0128">If any change processing is selected in step S<b>1802</b>, the flow advances to step S<b>1803</b>.</p>
<p id="p-0130" num="0129">Step S<b>1803</b>: in the same way as that for the image sensing apparatus <b>10</b>A, the computer <b>30</b> determines whether a digital signature has been added to the selected image file. If no digital signature is added to the selected image file, the flow advances to step S<b>1804</b>; if a digital signature is added to the selected image file, to step S<b>1806</b>.</p>
<p id="p-0131" num="0130">Step S<b>1804</b>: the computer <b>30</b> generates a command (instruction) which requests to change the contents of the selected image file in accordance with change processing selected by the user, and transmits the generated command to the image sensing apparatus <b>10</b>B. This command contains information which specifies the selected image file, and information necessary for change processing selected by the user. The controller <b>110</b>B receives the command by using the communication controller <b>107</b>B, and changes the contents of the selected image file in accordance with the command. After changing the contents of the selected image file, the controller <b>110</b>B sends back, to the computer <b>30</b> by using the communication controller <b>107</b>B, a response representing that the contents of the selected image file have been changed.</p>
<p id="p-0132" num="0131">Step S<b>1805</b>: the computer <b>30</b> receives the response from the image sensing apparatus <b>10</b>B, and then displays, on the display of the computer <b>30</b>, a message that change processing selected by the user has been executed.</p>
<p id="p-0133" num="0132">Step S<b>1806</b>: the computer <b>30</b> inhibits execution of change processing selected by the user in order to prevent any change of the contents of the selected image file. At this time, the computer <b>30</b> does not generate any command (instruction) which requests to change the contents of the selected image file in accordance with change processing selected by the user, and does not transmit any command to the image sensing apparatus <b>10</b>B.</p>
<p id="p-0134" num="0133">Step S<b>1807</b>: the computer <b>30</b> displays on the display <b>212</b> a message which notifies the user that change processing selected by the user cannot be executed.</p>
<p id="p-0135" num="0134">As described above, when a digital signature has been added to a selected image file, the computer <b>30</b> according to the second embodiment inhibits transmission, to the image sensing apparatus <b>10</b>B, of a command (instruction) which requests to change the contents of the selected image file in accordance with change processing selected by the user. This can prevent the image sensing apparatus <b>10</b>B from changing the contents of the selected image file (with the digital signature) in accordance with an instruction from the computer <b>30</b>.</p>
<heading id="h-0008" level="1">Third Embodiment</heading>
<p id="p-0136" num="0135">The first embodiment can be changed to an embodiment which verifies whether an image file has been altered before accessory information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, manufacturing number, and the like), file name, and size of the image file with an MAC are displayed.</p>
<p id="p-0137" num="0136">Similarly, the first embodiment can be changed to an embodiment which verifies whether an image file has been altered before accessory information (for example, thumbnail image, photographing date &amp; time, shutter speed, F-number, ISO sensitivity, size, model name, manufacturing number, and the like), file name, and size of the image file with a digital signature are displayed.</p>
<heading id="h-0009" level="1">Other Embodiments</heading>
<p id="p-0138" num="0137">Note that the present invention can be applied to an apparatus comprising a single device or to system constituted by a plurality of devices.</p>
<p id="p-0139" num="0138">Furthermore, the invention can be implemented by supplying a software program, which implements the functions of the foregoing embodiments, directly or indirectly to a system or apparatus, reading the supplied program code with a computer of the system or apparatus, and then executing the program code. In this case, so long as the system or apparatus has the functions of the program, the mode of implementation need not rely upon a program.</p>
<p id="p-0140" num="0139">Accordingly, since the functions of the present invention are implemented by computer, the program code installed in the computer also implements the present invention. In other words, the claims of the present invention also cover a computer program for the purpose of implementing the functions of the present invention.</p>
<p id="p-0141" num="0140">In this case, so long as the system or apparatus has the functions of the program, the program may be executed in any form, such as an object code, a program executed by an interpreter, or scrip data supplied to an operating system.</p>
<p id="p-0142" num="0141">Example of storage media that can be used for supplying the program are a floppy disk, a hard disk, an optical disk, a magneto-optical disk, a CD-ROM, a CD-R, a CD-RW, a magnetic tape, a non-volatile type memory card, a ROM, and a DVD (DVD-ROM and a DVD-R).</p>
<p id="p-0143" num="0142">As for the method of supplying the program, a client computer can be connected to a website on the Internet using a browser of the client computer, and the computer program of the present invention or an automatically-installable compressed file of the program can be downloaded to a recording medium such as a hard disk. Further, the program of the present invention can be supplied by dividing the program code constituting the program into a plurality of files and downloading the files from different websites. In other words, a WWW (World Wide Web) server that downloads, to multiple users, the program files that implement the functions of the present invention by computer is also covered by the claims of the present invention.</p>
<p id="p-0144" num="0143">It is also possible to encrypt and store the program of the present invention on a storage medium such as a CD-ROM, distribute the storage medium to users, allow users who meet certain requirements to download decryption key information from a website via the Internet, and allow these users to decrypt the encrypted program by using the key information, whereby the program is installed in the user computer.</p>
<p id="p-0145" num="0144">Besides the cases where the aforementioned functions according to the embodiments are implemented by executing the read program by computer, an operating system or the like running on the computer may perform all or a part of the actual processing so that the functions of the foregoing embodiments can be implemented by this processing.</p>
<p id="p-0146" num="0145">Furthermore, after the program read from the storage medium is written to a function expansion board inserted into the computer or to a memory provided in a function expansion unit connected to the computer, a CPU or the like mounted on the function expansion board or function expansion unit performs all or a part of the actual processing so that the functions of the foregoing embodiments can be implemented by this processing.</p>
<p id="p-0147" num="0146">As has been described above, the present invention can prevent an image sensing apparatus from changing the contents of an image file (with verification data) in accordance with an instruction from a control apparatus.</p>
<p id="p-0148" num="0147">As many apparently widely different embodiments of the present invention can be made without departing from the spirit and scope thereof, it is to be understood that the invention is not limited to the specific embodiments thereof except as defined in the appended claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A control apparatus which controls an image sensing apparatus, comprising:
<claim-text>a determination unit which determines whether or not verification data has been added to an image file, wherein the verification data is used to determine whether or not a digital image in the image file has been altered;</claim-text>
<claim-text>a command generating unit which generates a command that requests the image sensing apparatus to change the contents of the image file; and</claim-text>
<claim-text>a command sending unit which sends the command to the image sensing apparatus if said determination unit determines that the verification data has not been added to the image file whereas the command is not sent to the image sensing apparatus if said determination unit determines that the verification data has been added to the image file.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The control apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said control apparatus displays a message indicating that the contents of the image file cannot be changed, if said determination unit determines that the verification data has been added to the image file.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The control apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the verification data is generated using cryptography in which an encryption key and a decryption key are identical.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The control apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the verification data is generated using cryptography in which an encryption key and a decryption key are different.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. A method of controlling an image sensing apparatus, said method comprising the steps of:
<claim-text>determining whether or not verification data has been added to an image file, wherein the verification data is used to determine whether or not a digital image in the image file has been altered;</claim-text>
<claim-text>generating a command that requests the image sensing apparatus to change the contents of the image file; and</claim-text>
<claim-text>sending the command to the image sensing apparatus if it is determined in said determining step that the verification data has not been added to the image file whereas the command is not sent to the image sensing apparatus if it is determined in said determining step that the verification data has been added to the image file.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method according to <claim-ref idref="CLM-00005">claim 5</claim-ref>, further comprising the step of:
<claim-text>displaying a message indicating that the contents of the image file cannot be changed, if it is determined in said determining step that the verification data has been added to the image file.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method according to <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein the verification data is generated using cryptography in which an encryption key and a decryption key are identical.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method according to <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein the verification data is generated using cryptography in which an encryption key and a decryption key are different.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. A computer readable medium which stores a program causing a computer to perform a method of controlling an image sensing apparatus, the method comprising the steps of:
<claim-text>determining whether or not verification data has been added to an image file, wherein the verification data is used to determine whether or not a digital image in the image file has been altered;</claim-text>
<claim-text>generating a command that requests the image sensing apparatus to change the contents of the image file; and</claim-text>
<claim-text>sending the command to the image sensing apparatus if it is determined in the determining step that the verification data has not been added to the image file whereas the command is not sent to the image sensing apparatus if it is determined in the determining step that the verification data has been added to the image file.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The computer readable medium according to <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein the method further comprising the step of:
<claim-text>displaying a message indicating that the contents of the image file cannot be changed, if it is determined in the determining step that the verification data has been added to the image file.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The computer readable medium according to <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein the verification data is generated using cryptography in which an encryption key and a decryption key are identical.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The computer readable medium according to <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein the verification data is generated using cryptography in which an encryption key and a decryption key are different.</claim-text>
</claim>
</claims>
</us-patent-grant>
